<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<title>Functional Mock-Up Interface Specification</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:30em;padding-right:0}
#toc.toc2{width:30em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* customizations */

body{
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}

.toc-hidden {
  padding-left: 0 !important;
}

.imageblock {
  text-align: center;
}

.imageblock img {
  display: block;
  margin: auto;
}

.imageblock .title {
  display: inline-block;
  margin: auto;
}

.vertical-text {
	transform: rotate(-90deg) translate(-11em, 0);
	transform-origin: left top 0;
  float: left;
  display: inline-block;
  white-space: nowrap;
  width: 1em;
  height: 11em;
}

/* no alternating row colors */
table tr.even,table tr.alt,table tr:nth-of-type(even) {
  background:none
}

/* use parent text color for captions */
.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
  color: inherit;
}

a {
  text-decoration: none;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<script>
// hide / show the Table of Contents (TOC)
function toggleTOC() {
  var toc = document.getElementById("toc");
  var body = document.getElementsByTagName("body")[0];

  if (toc.style.display === "none") {
      toc.style.display = "block";
      body.classList.remove("toc-hidden");
  } else {
      toc.style.display = "none";
      body.classList.add("toc-hidden");
  }
}

// toggle the TOC when "t" key is pressed
document.addEventListener('keydown', (event) => {
  if (event.key == 't') {
    toggleTOC();
  }
});
</script>

<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
.tocify-header {
    font-style: italic;
}

.tocify-subheader {
    font-style: normal;
    font-size: 90%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    color: #7a2518;
    background-color: rgba(0, 0, 0, 0.1);
}

.tocify-focus > a {
    color: #7a2518;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            // don't hide the sections in the TOC
            showAndHide: false,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5,h6",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>

<img style="display: block; margin: 2em auto; width: 30em;" src="images/FMI_logo_horizontal.svg" alt="FMI logo">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Functional Mock-Up Interface Specification</h1>
<div class="details">
<span id="revnumber">version 3.0-alpha.5,</span>
<span id="revdate">unreleased</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#fmi-whats-new">1.1. What is new in FMI 3.0</a></li>
<li><a href="#_overview">1.2. Overview</a>
<ul class="sectlevel3">
<li><a href="#_fmi_for_model_exchange_me">1.2.1. FMI for Model Exchange (ME)</a></li>
<li><a href="#_fmi_for_co_simulation_cs">1.2.2. FMI for Co-Simulation (CS)</a></li>
<li><a href="#_fmi_for_scheduled_execution_se">1.2.3. FMI for Scheduled Execution (SE)</a></li>
<li><a href="#_feature_overview_of_fmi_interface_types">1.2.4. Feature Overview of FMI Interface Types</a></li>
</ul>
</li>
<li><a href="#_properties_and_guiding_ideas">1.3. Properties and Guiding Ideas</a></li>
<li><a href="#_how_to_read_this_document">1.4. How to Read This Document</a></li>
</ul>
</li>
<li><a href="#fmi-common-concepts">2. Common Concepts</a>
<ul class="sectlevel2">
<li><a href="#mathematical-definitions">2.1. Mathematical Definitions</a></li>
<li><a href="#general-mechanisms">2.2. General Mechanisms</a>
<ul class="sectlevel3">
<li><a href="#header-files-and-naming-of-functions">2.2.1. Header Files and Naming of Functions</a></li>
<li><a href="#_platform_dependent_definitions">2.2.2. Platform Dependent Definitions</a></li>
<li><a href="#status-returned-by-functions">2.2.3. Status Returned by Functions</a></li>
<li><a href="#inquire-version-number">2.2.4. Inquire Version Number of Header Files</a></li>
<li><a href="#advancing-time">2.2.5. Advancing Time</a></li>
<li><a href="#fmu-variables">2.2.6. Variables</a>
<ul class="sectlevel4">
<li><a href="#serialization-of_variables">2.2.6.1. Serialization of Array Variables</a></li>
<li><a href="#get-and-set-variable-values">2.2.6.2. Getting and Setting Variable Values</a></li>
<li><a href="#min-max-violations">2.2.6.3. Handling min/max Range Violations</a></li>
<li><a href="#get-set-fmu-state">2.2.6.4. Getting and Setting the Complete FMU State</a></li>
</ul>
</li>
<li><a href="#selectiv-computation">2.2.7. Selective Computation of Variables</a></li>
<li><a href="#algebraic-loops">2.2.8. Algebraic Loops</a></li>
<li><a href="#clocks">2.2.9. Clocks</a>
<ul class="sectlevel4">
<li><a href="#_motivation">2.2.9.1. Motivation</a></li>
<li><a href="#_clock_types">2.2.9.2. Clock Types</a></li>
<li><a href="#clocked-variable">2.2.9.3. Model Partitions and Clocked Variables</a></li>
<li><a href="#_scheduled_execution">2.2.9.4. Scheduled Execution</a></li>
<li><a href="#_api">2.2.9.5.  API</a></li>
</ul>
</li>
<li><a href="#model-dependencies">2.2.10. Dependencies of Variables</a></li>
<li><a href="#partial-derivatives">2.2.11. Getting Partial Derivatives</a>
<ul class="sectlevel4">
<li><a href="#directionDerivatives">2.2.11.1. Directional Derivatives</a></li>
<li><a href="#adjointDerivatives">2.2.11.2. Adjoint Derivatives</a></li>
</ul>
</li>
<li><a href="#getting-output-derivatives">2.2.12. Getting Derivatives of Continuous Outputs</a></li>
</ul>
</li>
<li><a href="#common-state-machine">2.3. State Machine and Semantics</a>
<ul class="sectlevel3">
<li><a href="#FMUStateSetable">2.3.1. Super State: FMU State Setable</a>
<ul class="sectlevel4">
<li><a href="#Instantiated">2.3.1.1. State: Instantiated</a></li>
<li><a href="#InitializationMode">2.3.1.2. State: Initialization Mode</a></li>
<li><a href="#ConfigurationMode">2.3.1.3. State: Configuration Mode</a></li>
<li><a href="#Terminated">2.3.1.4. State: Terminated</a></li>
</ul>
</li>
<li><a href="#Initialized">2.3.2. Super State: Initialized</a>
<ul class="sectlevel4">
<li><a href="#EventMode">2.3.2.1. State: Event Mode</a></li>
<li><a href="#ReconfigurationMode">2.3.2.2. State: Reconfiguration Mode</a></li>
</ul>
</li>
<li><a href="#IntermediateUpdateMode">2.3.3. State: Intermediate Update Mode</a></li>
</ul>
</li>
<li><a href="#fmi-description-schema">2.4. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#fmiModelDescription">2.4.1. Definition of an FMU</a></li>
<li><a href="#common-capability-flags">2.4.2. Definition of Capability Flags</a></li>
<li><a href="#_definition_of_units">2.4.3. Definition of Units</a></li>
<li><a href="#definition-of-types">2.4.4. Definition of Types</a></li>
<li><a href="#definition-of-log-categories">2.4.5. Definition of Log Categories</a></li>
<li><a href="#DefaultExperiment">2.4.6. Definition of a Default Experiment</a></li>
<li><a href="#definition-of-model-variables">2.4.7. Definition of Model Variables</a>
<ul class="sectlevel4">
<li><a href="#namingSection">2.4.7.1. Variable Naming Conventions</a></li>
</ul>
</li>
<li><a href="#ModelStructure">2.4.8. Definition of the Model Structure</a></li>
<li><a href="#fmiTerminalsAndIcons">2.4.9. Definition of Terminals and Icons</a>
<ul class="sectlevel4">
<li><a href="#graphicalRepresentation">2.4.9.1. Definition of a Graphical Representation</a>
<ul class="sectlevel5">
<li><a href="#_overview_2">2.4.9.1.1. Overview</a></li>
<li><a href="#_coordinatesystem">2.4.9.1.2. CoordinateSystem</a></li>
<li><a href="#_icon">2.4.9.1.3. Icon</a></li>
<li><a href="#_placement_extent_and_painting_order_of_graphical_items">2.4.9.1.4. Placement, Extent, and Painting Order of Graphical Items</a></li>
</ul>
</li>
<li><a href="#definitionOfTerminals">2.4.9.2. Definition of Terminals</a>
<ul class="sectlevel5">
<li><a href="#_overview_3">2.4.9.2.1. Overview</a></li>
<li><a href="#section-terminals">2.4.9.2.2. Terminals</a></li>
<li><a href="#section-terminalvars">2.4.9.2.3. Terminal Member Variable</a></li>
<li><a href="#_terminal_stream_member_variable">2.4.9.2.4. Terminal Stream Member Variable</a></li>
<li><a href="#_terminal_graphical_representation">2.4.9.2.5. Terminal Graphical Representation</a></li>
<li><a href="#GeneralRemarkOnSignal">2.4.9.2.6. General Remark on Signal</a></li>
<li><a href="#_general_remark_on_inflow_and_outflow">2.4.9.2.7. General Remark on Inflow and Outflow</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmu-distribution">2.5. FMU Distribution</a>
<ul class="sectlevel3">
<li><a href="#structure-of-zip">2.5.1. Structure of the ZIP file</a>
<ul class="sectlevel4">
<li><a href="#documentation-directory">2.5.1.1. Directory Documentation</a>
<ul class="sectlevel5">
<li><a href="#license-information">2.5.1.1.1. Directory Licenses</a></li>
</ul>
</li>
<li><a href="#Icons-directory">2.5.1.2. Directory Icons</a></li>
<li><a href="#sources-directory">2.5.1.3. Directory Sources</a>
<ul class="sectlevel5">
<li><a href="#_sourcefileset">2.5.1.3.1. SourceFileSet</a></li>
<li><a href="#_sourcefile">2.5.1.3.2. SourceFile</a></li>
<li><a href="#_preprocessordefinition">2.5.1.3.3. PreprocessorDefinition</a></li>
<li><a href="#_preprocessordefinitionoption">2.5.1.3.4. PreprocessorDefinition/Option</a></li>
<li><a href="#_includedirectory">2.5.1.3.5. IncludeDirectory</a></li>
<li><a href="#_library">2.5.1.3.6. Library</a></li>
<li><a href="#_examples">2.5.1.3.7. Examples</a></li>
</ul>
</li>
<li><a href="#binaries-directory">2.5.1.4. Directory Binaries</a>
<ul class="sectlevel5">
<li><a href="#platform-tupe-definition">2.5.1.4.1. Platform Tuple Definition</a></li>
<li><a href="#external-libraries">2.5.1.4.2. External Libraries</a></li>
</ul>
</li>
<li><a href="#resources-directory">2.5.1.5. Directory Resources</a></li>
<li><a href="#extra-directory">2.5.1.6. Directory Extra</a></li>
</ul>
</li>
<li><a href="#_multiple_interface_types">2.5.2. Multiple Interface Types</a></li>
<li><a href="#dependency-on-exteranl-tool">2.5.3. Dependency on Installed Tool</a></li>
<li><a href="#_import_examples">2.5.4. Import Examples</a>
<ul class="sectlevel4">
<li><a href="#_accessing_fmi_functions_in_shared_libraries">2.5.4.1. Accessing FMI Functions in Shared Libraries</a></li>
<li><a href="#_accessing_fmi_functions_in_static_libraries_and_source_code">2.5.4.2. Accessing FMI Functions in Static Libraries and Source Code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#VersioningLayered">2.6. Versioning and Layered Standards</a></li>
</ul>
</li>
<li><a href="#fmi-for-model-exchange">3. FMI for Model Exchange</a>
<ul class="sectlevel2">
<li><a href="#concepts-model-exchange">3.1. Concepts</a>
<ul class="sectlevel3">
<li><a href="#_event_handling">3.1.1. Event Handling</a></li>
</ul>
</li>
<li><a href="#state-machine-model-exchange">3.2. State Machine for Model Exchange</a>
<ul class="sectlevel3">
<li><a href="#ContinuousTimeMode">3.2.1. State: Continuous-Time Mode</a></li>
</ul>
</li>
<li><a href="#_code_example">3.3. Code Example</a></li>
<li><a href="#model-exchange-schema">3.4. Description Schema</a>
<ul class="sectlevel3">
<li><a href="#xml-example-model-exchange">3.4.1. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmi-for-co-simulation">4. FMI for Co-Simulation</a>
<ul class="sectlevel2">
<li><a href="#concepts-co-simulation">4.1. Concepts</a>
<ul class="sectlevel3">
<li><a href="#smoothness">4.1.1. Smoothness, Continuity and Discontinuity</a></li>
<li><a href="#early-return">4.1.2. Early Return</a></li>
</ul>
</li>
<li><a href="#state-machine-co-simulation">4.2. State Machine for Co-Simulation</a>
<ul class="sectlevel3">
<li><a href="#StepMode">4.2.1. State: Step Mode</a></li>
</ul>
</li>
<li><a href="#_code_examples">4.3. Code Examples</a>
<ul class="sectlevel3">
<li><a href="#_co_simulation">4.3.1. Co-Simulation</a></li>
<li><a href="#code-example-clocked-co-simulation">4.3.2. Clocks</a></li>
</ul>
</li>
<li><a href="#co-simulation-schema">4.4. Description Schema</a>
<ul class="sectlevel3">
<li><a href="#_example_xml_description_file">4.4.1. Example XML Description File</a>
<ul class="sectlevel4">
<li><a href="#xml-example-co-simulation">4.4.1.1. Example XML Description File with Early Return</a></li>
<li><a href="#xml-example-clocked-co-simulation">4.4.1.2. Example XML Description File with Clocks</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmi-for-scheduled-execution">5. FMI for Scheduled Execution</a>
<ul class="sectlevel2">
<li><a href="#concepts-scheduled-execution">5.1. Concepts</a>
<ul class="sectlevel3">
<li><a href="#preemption-support">5.1.1. Preemption Support</a></li>
</ul>
</li>
<li><a href="#state-machine-scheduled-execution">5.2. State Machine for Scheduled Execution</a>
<ul class="sectlevel3">
<li><a href="#Initialized-SE">5.2.1. Super State: Initialized</a></li>
<li><a href="#ClockActivationMode">5.2.2. State: Clock Activation Mode</a></li>
</ul>
</li>
<li><a href="#example-scheduled-execution">5.3. Code Example</a>
<ul class="sectlevel3">
<li><a href="#_simulation_algorithm_implementation">5.3.1. Simulation Algorithm Implementation</a></li>
<li><a href="#_fmu_implementation">5.3.2. FMU Implementation</a></li>
</ul>
</li>
<li><a href="#scheduled-execution-schema">5.4. Description Schema</a>
<ul class="sectlevel3">
<li><a href="#_example_xml_description_file_2">5.4.1. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_references">References</a></li>
<li><a href="#glossary">Appendix A: Glossary</a></li>
<li><a href="#_acknowledgements">Appendix B: Acknowledgements</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://fmi-standard.org/">Functional Mock-Up Interface (FMI)</a> is a free standard that defines a container and an interface to exchange dynamic models using a combination of XML files, binaries and C code, distributed as a ZIP file.
It is supported by <a href="https://fmi-standard.org/tools/">more than 150 tools</a> and maintained as a <a href="https://www.modelica.org/projects">Modelica Association Project</a>.
<a href="https://github.com/modelica/fmi-standard/releases">Releases</a> and <a href="https://github.com/modelica/fmi-standard/issues">issues</a> can be found on <a href="https://github.com/modelica/fmi-standard">github.com/modelica</a>.</p>
</div>
<div class="paragraph">
<p><br>
</p>
</div>
<div class="paragraph">
<p>Copyright &#169; 2008-2011 MODELISAR Consortium and 2012-2021 The Modelica Association Project FMI.</p>
</div>
<div class="paragraph">
<p>This document is licensed under the Attribution-ShareAlike 4.0 International license.
The code is released under the 2-Clause BSD License.
The licenses text can be found in the <a href="https://raw.githubusercontent.com/modelica/fmi-standard/master/LICENSE.txt">LICENSE.txt</a> file that accompanies this distribution.</p>
</div>
<div class="paragraph">
<p>Attention is drawn to the possibility that some of the elements of this document may be the subject of patent rights.
Modelica Association shall not be held responsible for identifying such patent rights.
All contributors to this specification have signed the <a href="https://svn.fmi-standard.org/fmi/branches/public/FMI_CCLA_v1.0_2016_06_21.pdf">Corporate Contributor License Agreement of the FMI Project</a> or the <a href="https://www.modelica.org/licenses/ModelicaAssociationCLA_1.1">Contributor License Agreement of the Modelica Association</a>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="fmi-whats-new">1.1. What is new in FMI 3.0</h3>
<div class="paragraph">
<p>The FMI Design Community has improved the FMI standard to react to new requirements from the system simulation community.</p>
</div>
<div class="paragraph">
<p>Especially the ability to package control code into FMUs required some workarounds in FMI 2.0.
With FMI 3.0, virtual electronic control units (vECUs) can be exported as FMU in a more natural way.
Concrete features to support vECU export are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>introduction of <a href="#definitionOfTerminals">terminals</a> to group variables semantically to ease connecting compatible signals,</p>
</li>
<li>
<p>introduction of <a href="#graphicalRepresentation">icons</a> to define a graphical representation of the FMU and its terminals,</p>
</li>
<li>
<p>introduction of clocks to more exactly control timing of events and evaluation of model partitions across FMUs,</p>
</li>
<li>
<p>introduction of more integer types and a 32-bit float type (see <a href="#fmi-description-schema">Section 2.4</a>) to communicate native controller types to the outside,</p>
</li>
<li>
<p>introduction of a binary type to support non-numeric data handling, such as complex sensor data interfaces,</p>
</li>
<li>
<p>extension of variables to arrays for more efficient and natural handling of non-scalar variables,</p>
</li>
<li>
<p>introduction of structural parameters that allow description and changing of array sizes, even during runtime to support advanced online calibration of control code, and</p>
</li>
<li>
<p>addition of the new interface type FMI for Scheduled Execution (see <a href="#fmi-for-scheduled-execution">Section 5</a>) that allows activation of individual model partitions (or tasks) from an external scheduler.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A second need of the simulation community was address by introducing the more advanced co-simulation interface <a href="#fmi-for-co-simulation">FMI for Co-Simulation</a>.
New features, like</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#early-return">early return</a> from a <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> call,</p>
</li>
<li>
<p>the <a href="#IntermediateUpdateMode">intermediate update</a>, or</p>
</li>
<li>
<p><a href="#clocks">clocks and clocked variables</a>,</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>allow implementation of more robust and efficient co-simulation algorithms to handle the growing system simulations the community is facing.</p>
</div>
<div class="paragraph">
<p>Parallel to the new standard features, the FMI Design Community has worked on improving the standard quality by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>modernizing the development methodology (e.g. moving to github) and a text-based source format,</p>
</li>
<li>
<p>publishing the FMI Standard now primarily as html to support easier navigation within the document and viewing on a wider range of devices,</p>
</li>
<li>
<p>supplying a large set of continuously validated Reference FMUs, and</p>
</li>
<li>
<p>integrating within the FMI Standard only validated C-code, XML and XSD snippets to reduce redundancy and ensure correctness.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While a number of desirable features had to be postponed, the resulting FMI 3.0 is certainly a significant step forward towards meeting the most important requirements of the system simulation community for the years to come.</p>
</div>
<div class="paragraph">
<p>The asynchronous mode for FMUs known from FMI 2.0 has been removed since this mode was not supported by tools and it can be suitably replaced by Co-Simulation implementations that control the asynchronous computation of FMUs via separate tasks/threads created for each FMU.</p>
</div>
</div>
<div class="sect2">
<h3 id="_overview">1.2. Overview</h3>
<div class="paragraph">
<p>The FMI (Functional Mock-Up Interface) defines an interface to be implemented by an executable called an FMU (Functional Mock-Up Unit).
The FMI functions are used (called) by a simulation environment to create one or more instances of the FMU and to simulate them, typically together with other models.
An FMU may either have its own solvers (<a href="#fmi-for-co-simulation">FMI for Co-Simulation</a>), or require the simulation environment to perform numerical integration (<a href="#fmi-for-model-exchange">FMI for Model Exchange</a>), or require the simulation environment to trigger model partition execution (<a href="#fmi-for-scheduled-execution">FMI for Scheduled Execution</a>).
The goal of this interface is that the calling of an FMU in a simulation environment is reasonably simple.
This document does not describe how to generate an FMU from a modeling environment.</p>
</div>
<div class="paragraph">
<p>The interfaces have large parts in common, defined in <a href="#fmi-common-concepts">Common Concepts</a>.
In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI Application Programming Interface (C)&#8201;&#8212;&#8201;<a href="#general-mechanisms">Section 2.2</a><br>
All required equations or tool coupling computations are evaluated by calling standardized C functions.
C is used because it is the most portable programming language today and is the only programming language that can be utilized in all embedded control systems.</p>
</li>
<li>
<p>FMI Description Schema (XML)&#8201;&#8212;&#8201;<a href="#fmi-description-schema">Section 2.4</a><br>
The schema defines the structure and content of an XML file generated by a modeling environment.
This XML file contains the definition of all variables of the FMU in a standardized way.
It is then possible to run the C code in an embedded system without the overhead of the variable definition (the alternative would be to store this information in the C code and access it via function calls, but this is neither practical for embedded systems nor for large models).
Furthermore, the variable definition is a complex data structure and tools should be free to determine how to represent this data structure in their programs.
The selected approach allows a tool to store and access the variable definitions (without any memory or efficiency overhead of standardized access functions) in the programming language of the simulation environment.</p>
</li>
<li>
<p>FMU Distribution (ZIP)&#8201;&#8212;&#8201;<a href="#fmu-distribution">Section 2.5</a><br>
An FMU is distributed in one ZIP file.
The ZIP file contains the FMI Description file (XML), the binaries and libraries required to execute the FMI functions (.dll or .so files), the sources of the FMI functions (optional), and other data used by the FMU (e.g., tables or maps).
It is possible for an FMU to hide the source code to secure the contained know-how or to allow a fully automatic import of the FMU in another simulation environment.
A schematic view of an FMU is shown in <a href="#figure-data-flow">Figure 1</a>.</p>
</li>
</ul>
</div>
<div id="figure-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/enclosing_model.svg" alt="enclosing model" width="60%">
</div>
<div class="title">Figure 1. Data flow between the environment and an FMU. <span class="blue">Blue</span> arrows denote the information provided by the FMU, and the <span class="red">Red</span> arrows denote the information provided to the FMU.</div>
</div>
<div class="sect3">
<h4 id="_fmi_for_model_exchange_me">1.2.1. FMI for Model Exchange (ME)</h4>
<div class="paragraph">
<p>The Model Exchange interface exposes an ODE to an external solver of an importing tool.
Models are described by differential, algebraic and discrete equations with time-, state- and step-events.
That integration algorithm of the importing tool, usually a DAE solver, is responsible for advancing time, setting states, handling events, etc.
(See <a href="#fmi-for-model-exchange">Section 3</a>.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_fmi_for_co_simulation_cs">1.2.2. FMI for Co-Simulation (CS)</h4>
<div class="paragraph">
<p>The FMI for Co-Simulation interface is designed both for the coupling of simulation tools, and the coupling of subsystem models, exported by their simulators together with its solvers as runnable code.
(See <a href="#fmi-for-co-simulation">Section 4</a>.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_fmi_for_scheduled_execution_se">1.2.3. FMI for Scheduled Execution (SE)</h4>
<div class="paragraph">
<p>The Scheduled Execution interface exposes individual model partitions (e.g. tasks of a control algorithm), to be called by a scheduler that acts as external scheduler.
The scheduler is responsible for advancing the overall simulation time, triggering of time-based and triggered clocks for all exposed model partitions of a set of FMUs, and handling events (e.g. clock ticks) signaled by the FMUs.</p>
</div>
<div class="paragraph">
<p>In many ways, the Scheduled Execution interface is the equivalent of the Model Exchange interface: the first externalizes a scheduling algorithm usually found in a controller algorithm and the second interface externalizes the ODE solver.
(See <a href="#fmi-for-scheduled-execution">Section 5</a>.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_feature_overview_of_fmi_interface_types">1.2.4. Feature Overview of FMI Interface Types</h4>
<div class="imageblock text-center">
<div class="content">
<img src="images/fmi-types-overview.svg" alt="fmi types overview" width="50%">
</div>
</div>
<div class="paragraph">
<p><a href="#table-overview-features">Table 1</a> gives an overview of the features of the different interfaces.</p>
</div>
<table id="table-overview-features" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Overview of features per interface.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-center valign-top">Model Exchange</th>
<th class="tableblock halign-center valign-top">Co-Simulation</th>
<th class="tableblock halign-center valign-top">Scheduled Execution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advancing Time</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Call <a href="#fmi3SetTime"><code>fmi3SetTime</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Call <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and monitor argument <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Call <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solver Included</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Not applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheduler Included</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Not applicable</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event Indicators</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#early-return">Early Return</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Includes similar or better mechanism</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#IntermediateUpdateMode">Intermediate Update</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Includes similar or better mechanism</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Signal output clock ticks: <span class="icon"><i class="fa fa-check"></i></span><br>
Inputs/Outputs: <span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#clocks">Clocks</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Feedthrough</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">At events: <span class="icon"><i class="fa fa-check"></i></span><br>
Else: <span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_properties_and_guiding_ideas">1.3. Properties and Guiding Ideas</h3>
<div class="paragraph">
<p>In this section, properties are listed and some principles are defined that guided the low-level design of the FMI.
This shall increase self consistency of the FMI functions.
The listed issues are sorted, starting from high-level properties to low-level implementation issues.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Expressivity</dt>
<dd>
<p>The FMI provides the necessary features to package models of different domains, such as multibody and virtual ECUs, into an FMU.</p>
</dd>
<dt class="hdlist1">Stability</dt>
<dd>
<p>The FMI is expected to be supported by many simulation tools worldwide.
Implementing such support is a major investment for tool vendors.
Stability and backwards compatibility of the FMI has therefore high priority.
To support this, the FMI defines "capability flags" that will be used by future versions of the FMI to extend and improve the FMI in a backwards compatible way, whenever feasible.</p>
</dd>
<dt class="hdlist1">Implementation</dt>
<dd>
<p>FMUs can be written manually or can be generated automatically from a modeling environment.
Existing manually coded models can be transformed manually to a model according to the FMI standard.</p>
</dd>
<dt class="hdlist1">Processor independence</dt>
<dd>
<p>It is possible to distribute an FMU without knowing the target processor.
This allows an FMU to run on a PC, a Hardware-in-the-Loop simulation platform or as part of the controller software of an ECU.
Keeping the FMU independent of the target processor increases the usability of the FMU.
To be processor independent, the FMU must include its C (or C++) sources.</p>
</dd>
<dt class="hdlist1">Simulator independence</dt>
<dd>
<p>It is possible to compile, link and distribute an FMU without knowing the environment in which the FMU will be loaded.</p>
<div class="paragraph">
<p>Reason: The standard would be much less attractive otherwise, unnecessarily restricting the later use of an FMU at compile time and forcing users to maintain simulator specific variants of an FMU.
To be simulator independent, the FMU must export its implementation in self-contained binary form.
This requires that the target operating system and processor be known.
Once exported with binaries, the FMU can be executed by any simulator running on the target platform (provided the necessary licenses are available, if required from the model or from the used run-time libraries).</p>
</div>
</dd>
<dt class="hdlist1">Semantic versioning</dt>
<dd>
<p>The FMI standard uses semantic version numbers, as defined in <a href="#PW13">[PW13]</a>, where the standard version consists of a triple of version numbers, consisting of major version, minor version, and patch version numbers, see <a href="#VersioningLayered">Section 2.6</a>.</p>
</dd>
<dt class="hdlist1">Version independence</dt>
<dd>
<p>FMUs with a specific major and minor version number are valid FMUs w.r.t. the same major version and any minor version because features of minor versions are optional and ignorable.</p>
<div class="paragraph">
<p>Reason: A tool can always export the greatest minor version it supports.
Such an FMU can be imported into all tools supporting this major version and arbitrary minor versions.
This achieves maximal longevity of FMUs protecting its value for users.</p>
</div>
</dd>
<dt class="hdlist1">Small run-time overhead</dt>
<dd>
<p>Communication between an FMU and an importer through the FMI does not introduce significant run-time overhead.
This can be achieved by enabling caching of the FMU outputs and by exchanging multiple quantities with one call.</p>
</dd>
<dt class="hdlist1">Small footprint</dt>
<dd>
<p>A compiled FMU binary requires little memory.</p>
<div class="paragraph">
<p>Reason: An FMU may run on an ECU (Electronic Control Unit, for example, a microprocessor), and ECUs have strong memory limitations.
This is achieved by storing variable attributes (<code>name</code>, <code>unit</code>, etc.) and all other static information not needed for model evaluation in a separate text file (= Model Description File) that is not needed on the microprocessor where the executable might run.</p>
</div>
</dd>
<dt class="hdlist1">Hide data structure</dt>
<dd>
<p>The FMI for Model Exchange does not prescribe a data structure (e.g., a C struct) to represent a model.</p>
<div class="paragraph">
<p>Reason: the FMI standard shall not unnecessarily restrict or prescribe a certain implementation of FMUs or simulators (whichever contains the model data) to ease implementation by different tool vendors.</p>
</div>
</dd>
<dt class="hdlist1">Support many and nested FMUs</dt>
<dd>
<p>A simulator may run many FMUs in a single simulation run and/or multiple instances of one FMU.
The inputs and outputs of these FMUs can be connected with direct feedthrough.
Moreover, an FMU may contain nested FMUs.</p>
</dd>
<dt class="hdlist1">Numerical Robustness</dt>
<dd>
<p>The FMI standard allows problems which are numerically critical (for example, <a href="#time-event"><code>time</code></a> and <a href="#state-event"><code>state events</code></a>, multiple sample rates, stiff problems) to be treated in a robust way.</p>
</dd>
<dt class="hdlist1">Hide cache</dt>
<dd>
<p>A typical FMU will cache computed results for later reuse.
To simplify usage and to reduce error possibilities by a simulator, the caching mechanism is hidden from the usage of the FMU.</p>
<div class="paragraph">
<p>Reason: First, the FMI should not force an FMU to implement a certain caching policy.
Second, this helps to keep the FMI simple.
To help implement this cache, the FMI provides explicit methods (called by the FMU environment) for setting properties that invalidate cached data.
An FMU that chooses to implement a cache may maintain a set of "dirty" flags, hidden from the simulator.
A get method, for example to a state, will then either trigger a computation, or return cached data, depending on the value of these flags.</p>
</div>
</dd>
<dt class="hdlist1">Support numerical solvers</dt>
<dd>
<p>A typical importer will use numerical solvers.
These solvers require vectors for <a href="#state"><code>states</code></a>, <a href="#derivative"><code>derivatives</code></a> and zero-crossing functions.
The FMU directly fills the values of such vectors provided by the solvers.</p>
<div class="paragraph">
<p>Reason: minimize execution time.
The exposure of these vectors conflicts somewhat with the "hide data structure" requirement, but the efficiency gain justifies this.</p>
</div>
</dd>
<dt class="hdlist1">Explicit signature</dt>
<dd>
<p>The intended operations, arguments, and return types are made explicit in the signature.
For example, an operator (such as <code>compute_derivatives</code>) is not passed as an int argument but a special function is called for this.
The <code>const</code> prefix is used for any pointer that should not be changed, including <code>const char*</code> instead of <code>char*</code>.</p>
<div class="paragraph">
<p>Reason: the correct use of the FMI can be checked at compile time and allows calling of the C code in a C++ environment (which is much stricter on <code>const</code> than C is).
This will help to develop FMUs that use the FMI in the intended way.</p>
</div>
</dd>
<dt class="hdlist1">Few functions</dt>
<dd>
<p>The FMI consists of a few, "orthogonal" functions, avoiding redundant functions that could be defined in terms of others.</p>
<div class="paragraph">
<p>Reason: This leads to a compact, easy-to-use, and hence attractive API with a compact documentation.</p>
</div>
</dd>
<dt class="hdlist1">Error handling</dt>
<dd>
<p>All FMI methods use a common set of methods to communicate errors.</p>
</dd>
<dt class="hdlist1">Allocator must free</dt>
<dd>
<p>All memory (and other resources) allocated by the FMU are freed (released) by the FMU.
Likewise, resources allocated by the importer are released by the importer.</p>
<div class="paragraph">
<p>Reason: this helps to prevent memory leaks and run-time errors due to incompatible run-time environments for different components.</p>
</div>
</dd>
<dt class="hdlist1">Immutable strings</dt>
<dd>
<p>All strings passed as arguments or returned are read-only and must not be modified by the receiver.</p>
<div class="paragraph">
<p>Reason: This eases the reuse of strings.</p>
</div>
</dd>
<dt class="hdlist1">Named list elements</dt>
<dd>
<p>All lists defined in the <code>fmi3ModelDescription.xsd</code> XML schema file have a string attribute <code>name</code> to a list element.
This attribute must be unique with respect to all other <code>name</code> attributes of the same list.</p>
</dd>
<dt class="hdlist1">Use C</dt>
<dd>
<p>The FMI is encoded using C, not C++.
Reasons: Avoid problems with compiler and linker dependent behavior, and run the FMU on embedded systems.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This version of the FMI standard does not have the following desirable properties.
They might be added in a future version.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The FMI for Model Exchange is for ordinary differential equations (ODEs) in state space form.
It is not for a general differential-algebraic equation system.
However, algebraic equation systems inside the FMU are supported (for example, the FMU can report to the environment to re-run the current step with a smaller step size since a solution could not be found for an algebraic equation system).</p>
</li>
<li>
<p>Special features that might be useful for multibody system programs are not included.</p>
</li>
<li>
<p>The interface is for simulation and for embedded systems.
Properties that might be additionally needed for trajectory optimization, for example, derivatives of the model with respect to parameters during continuous integration are not included.</p>
</li>
<li>
<p>No explicit definition of the variable hierarchy in the XML file.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_read_this_document">1.4. How to Read This Document</h3>
<div class="paragraph">
<p>The core of this document is the description of the state machines and their states for each of the three FMI interface types, each interface type in its own section.
Each state description starts with a brief state&#8217;s purpose, then the mathematical model in a table linking formulas with C-API functions, and finally descriptions of all allowed functions for this particular state.</p>
</div>
<div class="paragraph">
<p>To keep the descriptions brief and redundancy low, <a href="#fmi-common-concepts">common concepts</a> are described in the central section, including <a href="#common-state-machine">common parts of the state machines</a>, <a href="#fmi-description-schema">XML schema</a> and <a href="#fmu-distribution">ZIP-file content description</a>.</p>
</div>
<div class="paragraph">
<p>The standard document is in HTML allowing heavy use of in-document links: all state names, function names, many function arguments, XML elements and attributes are links to definitions or descriptions.
By pressing "t", the table of contents can be displayed on the left side or hidden.</p>
</div>
<div class="paragraph">
<p>Conventions used in this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-normative text is given in square brackets in italic font: <em>[Especially examples are defined in this style.]</em></p>
</li>
<li>
<p>The key words <strong>MUST</strong>, <strong>MUST NOT</strong>, <strong>REQUIRED</strong>, <strong>SHALL</strong>, <strong>SHALL NOT</strong>, <strong>SHOULD</strong>, <strong>SHOULD NOT</strong>, <strong>RECOMMENDED</strong>, <strong>NOT RECOMMENDED</strong>, <strong>MAY</strong>, and <strong>OPTIONAL</strong> in this document are to be interpreted as described in <a href="https://tools.ietf.org/html/rfc2119">RFC 2119</a>.</p>
</li>
<li>
<p><code>{VariableType}</code> is used as a placeholder for all variable type names without the <code>fmi3</code> prefix (e.g. <code>fmi3Get{VariableType}</code> stands for <code>fmi3GetUInt8</code>, <code>fmi3GetBoolean</code>, <code>fmi3GetFloat64</code>, etc.).</p>
</li>
<li>
<p>State machine states are formatted in <strong>bold</strong>, e.g. <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-common-concepts">2. Common Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The FMI defines the following interface types: FMI for Model Exchange, Co-Simulation, and Scheduled Execution.
The concepts defined in this chapter are common to at least two of these interface types.
The definitions that are specific to the particular cases are defined in <a href="#fmi-for-model-exchange">Section 3</a>, <a href="#fmi-for-co-simulation">Section 4</a>, and <a href="#fmi-for-scheduled-execution">Section 5</a>.</p>
</div>
<div class="paragraph">
<p>The term <em>FMU</em> (Functional Mock-Up Unit) denotes an implementation (or any mix) of interface types.</p>
</div>
<div class="paragraph">
<p>In the following, we assume that the reader is familiar with the basics of the C programming language and the basics of numerical simulation.
Please refer to <a href="#glossary">Appendix A</a> for the most commonly used terms.</p>
</div>
<div class="sect2">
<h3 id="mathematical-definitions">2.1. Mathematical Definitions</h3>
<div class="paragraph">
<p>This section introduces the mathematical notation used throughout this document.
It is used to describe</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ordinary differential equations in state-space representations with discontinuities (events),</p>
</li>
<li>
<p>algebraic equation systems,</p>
</li>
<li>
<p>discrete-time equations (sampled-data systems).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FMU and importer use variables to exchange information.
The properties and semantics of variables are described in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
Access is possible via appropriate API functions.</p>
</div>
<div class="paragraph">
<p>The <a href="#independent"><code>independent</code></a> variable \(\mathbf{t} \in \mathbb{T}\) <em>[typically: time]</em> is a tuple \(\mathbf{t} = (\mathbf{t}_R,\mathbf{t}_I)\), where \(\mathbf{t}_R \in \mathbb{R},\ \mathbf{t}_{I} \in \mathbb{N} = \{0, 1, 2, \ldots\}\).
The real part \(\mathbf{t}_R\) of this tuple is the <a href="#independent"><code>independent</code></a> variable of the FMU for describing the continuous-time behavior of the model between events.
During continuous-time integration \(\mathbf{t}_I = 0\).
The integer part \(\mathbf{t}_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(\mathbf{t}_R\).
This time definition is also called "super-dense time" in literature, see, for example, <a href="#LZ07">[LZ07]</a>.
An ordering is defined on \(\mathbb{\text{T}}\) that leads to the notation in <a href="#table-model-exchange-math-notation">Table 2</a>.
<em>[The notation \(^{\bullet}\mathbf{t}\) is from <a href="#BCP10">BCP10</a>, adapted from non-standard analysis to super-dense time, in order to precisely define the value from the previous event iteration.]</em></p>
</div>
<table id="table-model-exchange-math-notation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Conventions and notation used.</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 58.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mathematical meaning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{t}_1 &lt; \mathbf{t}_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((\mathbf{t}_{\mathit{R1}},\mathbf{t}_{\mathit{I1}}) &lt; (\mathbf{t}_{\mathit{R2}}, \mathbf{t}_{\mathit{I2}})\ \Leftrightarrow \ \mathbf{t}_{\mathit{R1}} &lt; \mathbf{t}_{\mathit{R2}}\ \textbf{or} \ \mathbf{t}_{\mathit{R1}}= \mathbf{t}_{\mathit{R2}} \ \textbf{and} \ \mathbf{t}_{\mathit{I1}} &lt; \mathbf{t}_{\mathit{I2}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{t}_1\) is before \(\mathbf{t}_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{t}_1 = \mathbf{t}_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((\mathbf{t}_{\mathit{R1}},\mathbf{t}_{\mathit{I1}}) = (\mathbf{t}_{\mathit{R2}},\mathbf{t}_{\mathit{I2}}) \ \Leftrightarrow  \mathbf{t}_{\mathit{R1}}= \mathbf{t}_{\mathit{R2}}\ \textbf{and} \ \mathbf{t}_{\mathit{I1}} = \mathbf{t}_{\mathit{I2}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{t}_1\) is identical to \(\mathbf{t}_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{t}^{+}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({(\mathbf{t}_R,\mathbf{t}_I)}^{+} \Leftrightarrow (\lim_{\mathit{\epsilon \rightarrow 0}}{\left(\mathbf{t}_R + \varepsilon \right),\mathbf{t}_{\mathit{Imax}})}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">right limit at \(\mathbf{t}\).
\(\mathbf{t}_{\mathit{Imax}}\) is the largest occurring integer index of super-dense time</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^-\mathbf{t}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{-}{(\mathbf{t}_R,\mathbf{t}_I)} \Leftrightarrow (\lim_{\mathit{\epsilon \rightarrow 0}}{\left( \mathbf{t}_R - \varepsilon \right),0)}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left limit at \(\mathbf{t}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}\mathbf{t}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{\bullet}{\left( \mathbf{t}_R,\mathbf{t}_I \right)\ } \Leftrightarrow \left\{ \begin{matrix} ^-t \ &amp; \mathbf{if} \ \mathbf{t}_I = 0 \\ (\mathbf{t}_R, \mathbf{t}_I - 1) \ &amp; \mathbf{if} \ \mathbf{t}_I &gt; 0 \\ \end{matrix} \right.\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">previous time instant (= either left limit or previous event instant).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v^+(\mathbf{t})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(\mathbf{t}^+)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the right limit of \(\mathbf{t}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{-}v(\mathbf{t})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^-\mathbf{t})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the left limit of \(\mathbf{t}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}v(\mathbf{t})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^{\bullet}\mathbf{t})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">previous value (= either left limit or value from the previous super-dense time instant)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Assume that an FMU has an event at \(\mathbf{t}_R=2.1s\) and here a variable changes discontinuously.</em>
<em>If no event iteration occurs, the time instant when the event occurs is defined as (2.1, 0), and the time instant when the integration is restarted is defined as (2.1, 1).]</em></p>
</div>
<div class="paragraph">
<p>The hybrid differential equations exposed by FMI for Model Exchange or wrapped by FMI for Co-Simulation are described as piecewise continuous-time systems.
Discontinuities can occur at time instants \(\mathbf{t}_0, \mathbf{t}_1, \ldots, \mathbf{t}_n\) where \(\mathbf{t}_i &lt; \mathbf{t}_{i+1}\).
These time instants are called <code>events</code>.
Events can be known beforehand (= <a href="#time-event"><code>time events</code></a>), or are defined implicitly (= <a href="#state-event"><code>state</code></a> and <a href="#step-event"><code>step events</code></a>), see below.
Between events, variables are either <a href="#continuous"><code>continuous</code></a> or do not change their value.
A variable is called discrete-time, if it changes its value only at an event instant.
Otherwise the variable is called continuous-time.
Only floating point variables can be continuous-time.
The following variable subscripts are used to describe the timing behavior of the corresponding variable (for example, \(\mathbf{v}_d\) is a discrete-time variable):</p>
</div>
<table id="table-subscripts" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Conventions and notation used for variable subscripts.</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A continuous-time variable is a floating-point variable representing a continuous function of time inside each interval \(\mathbf{t}_i^+ &lt; \ ^-\mathbf{t}_{i+1}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A discrete-time variable changes its value only at an event instant \(\mathbf{t} = (\mathbf{t}_i,n)\).
Such a variable can change multiple times at the same continuous-time instant, but only at subsequent super-dense time instants \(n \in \mathbb{N} = \{0, 1, 2, \ldots\}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="#clocked-variable">clocked variable</a> is a discrete-time variable associated with a <a href="#clock"><code>clock</code></a>. Clock variables synchronize events with the importer and across FMUs, they carry the information that a specific event happens.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c</code>+<code>d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of continuous-time and discrete-time variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intermediate variables: a set of variables accessible in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>. In Co-simulation, these variables are continuous-time variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable at the start time of the simulation as defined by the argument <a href="#startTime"><code>startTime</code></a> of <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>attribute=value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of variables which have an XML attribute-value combination as defined.
<em>[Example:</em> \(\mathbf{v}_{\mathit{initial=exact}}\) <em>are variables defined with attribute <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> (see <a href="#definition-of-model-variables">Section 2.4.7</a>).]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At every event instant \(\mathbf{t}_i\), continuous-time variables might change discontinuously (see <a href="#figure-piecewise-continuous-variables">Figure 2</a>).</p>
</div>
<div id="figure-piecewise-continuous-variables" class="imageblock">
<div class="content">
<img src="images/PieceWiseContinuousVariables.svg" alt="PieceWiseContinuousVariables" width="40%">
</div>
<div class="title">Figure 2. Piecewise-continuous variables of an FMU: continuous-time (\(\mathbf{v}_c\)), discrete-time (\(\mathbf{v}_d\)) and clocked (\(\mathbf{v}_k\)).</div>
</div>
<div class="paragraph">
<p>The mathematical description of an FMU uses the following variables:</p>
</div>
<table id="table-variable-types" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Symbols for specific variable types.</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>\(\mathbf{t}\)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#independent"><code>independent</code></a> variable <em>[typically: time]</em> \(\in \mathbb{T}\).
This variable is defined with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>.
All other variables are functions of this independent variable.</p>
</div>
<div class="paragraph">
<p>For Co-Simulation and Scheduled Execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The i-th communication point is denoted as \(\mathbf{t}_i\).<br></p>
</li>
<li>
<p>The communication step size is denoted as \(\mathbf{h}_i = \mathbf{t}_{i+1} - \mathbf{t}_i\).<br></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{v}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of all exposed variables (all variables defined in element <code>&lt;ModelVariables&gt;</code>, see <a href="#definition-of-model-variables">Section 2.4.7</a>).
A subset of the variables is selected via a subscript.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{p}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters.
The symbol without a subscript references <a href="#parameter"><code>parameters</code></a> (variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a>).
A subset of the variables is selected via a subscript.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{u}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input variables.
The values of these variables are defined outside of the model.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{y}\)<br>
\(\mathbf{y^{(j)}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output variables.
The values of these variables are computed in the FMU and they are designed to be used outside the FMU.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a>.
For CS and SE: Also j-th derivatives \(\mathbf{y}^{(j)}(\mathbf{t}_{i+1})\) can be provided if supported by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{w}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local variables of the FMU that must not be used for FMU connections.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#local"><code>local</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{z}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of floating point continuous-time variables representing the event indicators used to define <a href="#state-event"><code>state events</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_c\)<br>
\(\mathbf{\dot{x}}_c\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of floating point continuous-time variables representing the continuous-time <a href="#state"><code>states</code></a>.<br>
A vector of floating point continuous-time variables representing the first derivatives of the continuous-time <a href="#state"><code>states</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d\)<br>
\(^{\bullet}\mathbf{x}_d\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d\) is a vector of (internal) discrete-time variables (of any type) representing the discrete-time states.<br>
\({}^{\bullet}\mathbf{x}_d\) is the value of \(\mathbf{x}_d\) at the previous super-dense time instant.<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{T}_{\mathit{next}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At an event instant, an FMU can define the next time instant \(\mathbf{T}_{\mathit{next}}\), at which the next time event occurs (see also the definition of <a href="#EventMode">events</a>).
Every event removes automatically a previous definition of \(\mathbf{T}_{\mathit{next}}\), and it must be explicitly defined again, even if a previously defined \(\mathbf{T}_{\mathit{next}}\) was not yet reached (see <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="relations"></a> \(\mathbf{r}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of Boolean variables representing relations: \(\mathbf{r}_j := \mathbf{z}_j &gt; 0\).
When entering <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> all relations reported via the event indicators \(\mathbf{z}\) are fixed and during this mode these relations are replaced by \(^{\bullet}\mathbf{r}\).
Only during <a href="#InitializationMode"><strong>Initialization Mode</strong></a> or <a href="#EventMode"><strong>Event Mode</strong></a> the domains \(\mathbf{z}_j &gt; 0\) can change.
<em>[For more details, see <a href="#frozen-relations">Remark 3</a> below.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="buffers"></a> \(\mathbf{b}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A number of hidden data the FMU for Model Exchange needs to manage during <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>. <em>[For example, delay buffers]</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="general-mechanisms">2.2. General Mechanisms</h3>
<div class="paragraph">
<p>This section contains the common interface definitions that allow a C program to invoke the FMU functions.</p>
</div>
<div class="paragraph">
<p>Note that the following general properties hold for an FMU:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI functions of one instance do not need to be thread-safe.<br>
<em>[For example, if the functions of one instance of an FMU are accessed from more than one thread;
the multi-threaded simulation environment that uses the FMU must guarantee that there are no race conditions while invoking the FMI functions.
The FMU itself does not implement any services to support this.]</em></p>
</li>
<li>
<p>FMI functions must not change global settings which affect other processes/threads.
An FMI function may change settings of the thread in which it is called (such as floating point control registers), provided these changes are restored before leaving the function or before a callback function is called.<br>
<em>[This property ensures that functions of different FMU instances can be called safely in any order.</em>
<em>Additionally, they can be called in parallel provided the functions are called in different processes.</em>
<em>If an FMI function changes for example the floating point control word of the CPU, it must restore the previous value before return of the function.</em>
<em>For x86 CPUs, the floating point control word is set using the <code>fldcw</code> instruction.</em>
<em>This can be used to switch on additional exceptions such as floating point division by zero.</em>
<em>An FMU might temporarily change the floating point control word and get notified on floating point exceptions internally, but has to restore the flag and clear the floating point status word before return of the respective FMI function.]</em></p>
</li>
<li>
<p>In general, FMI function arguments are not allowed to be NULL, unless explicitly allowed by the standard document where NULL will be assigned a specific semantic.<br>
<em>[For an example of NULL being explicitly allowed see <a href="#resourceLocation"><code>resourceLocation</code></a>.</em>
<em>Careful implementations should still guard against NULL pointers.]</em></p>
</li>
<li>
<p>The FMI Standard does not provide a run-time platform or portability layer.
Access to operating system resources and services, such as memory and file system, must be implemented with special care because the availability of such resources and services is not guaranteed.
If some resource is required by the FMU but is not available, the FMU must log what resource failed and return with error.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="header-files-and-naming-of-functions">2.2.1. Header Files and Naming of Functions</h4>
<div class="paragraph">
<p>Three header files are provided that define the interface of an FMU.
In all header files the convention is used that all C function and type definitions start with the prefix <code>fmi3</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3PlatformTypes.h</code></dt>
<dd>
<p>contains the type definitions of the input and output arguments of the functions as well as some C preprocessor macro definitions for constants.
This header file must
be used both by the FMU and by the importer.<br>
<em>[Example of a definition in this header file:</em></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef double fmi3Float64;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</dd>
<dt class="hdlist1"><code>fmi3FunctionTypes.h</code></dt>
<dd>
<p>contains <code>typedef</code> definitions of all function prototypes of an FMU as well as enumerations for constants.
This header file includes <code>fmi3PlatformTypes.h</code>.
When dynamically loading an FMU, these definitions can be used to type-cast the function pointers to the respective function definition.
For simplicity, the function type for each function is composed of the function name itself with the suffix <code>TYPE</code>.<br>
<em>[Example of a definition in this header file:</em></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetTimeTYPE(fmi3Instance, fmi3Float64);</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</dd>
<dt class="hdlist1"><code>fmi3Functions.h</code></dt>
<dd>
<p>contains the function prototypes of an FMU that can be accessed in simulation environments.</p>
<div class="paragraph">
<p>This header file includes <code>fmi3PlatformTypes.h</code> and <code>fmi3FunctionTypes.h</code>.
The header file version number for which the model was compiled, can be inquired by the importer with <a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a> (see <a href="#inquire-version-number">Section 2.2.4</a>).<br></p>
</div>
<div class="paragraph">
<p><em>[Example of a definition in this header file:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">FMI3_Export fmi3SetTimeTYPE fmi3SetTime;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>For Microsoft and Cygwin compilers <code>FMI3_Export</code> is defined as</em> <code>__declspec(dllexport)</code> <em>and for Gnu-Compilers as</em> <code>__attribute__ ( ( visibility("default") ) )</code> <em>in order to export the name for dynamic loading.</em>
<em>Otherwise it is an empty definition.]</em></p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The goal is that both source code and binary representations of FMUs are supported and that several FMUs might be present at the same time in an executable (for example, FMU A may use an FMU B).
In order for this to be possible, the names of the functions in different FMUs must be different, or function pointers must be used.
To support the source code representation of FMUs, macros are provided in <code>fmi3Functions.h</code> to build the actual function names by using a function prefix that depends on how the FMU is shipped.</p>
</div>
<div class="paragraph">
<p><em>[These macros can be defined differently in a target specific variant of <code>fmi3Functions.h</code> to adjust them to the requirements of the supported compilers and platforms of the importing tool.]</em></p>
</div>
<div class="paragraph">
<p>An FMU C-file must include at the beginning a <code>define</code> of <code>FMI3_FUNCTION_PREFIX</code> with the same value as the value of the <a href="#modelIdentifier"><code>modelIdentifier</code></a> attribute defined in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange&gt;</code>, <code>&lt;fmiModelDescription&gt;&lt;CoSimulation&gt;</code> or <code>&lt;fmiModelDescription&gt;&lt;ScheduledExecution&gt;</code> together with <code>_</code> at the end (see <a href="#model-exchange-schema">Section 3.4</a>, <a href="#co-simulation-schema">Section 4.4</a>, <a href="#scheduled-execution-schema">Section 5.4</a>).</p>
</div>
<div class="paragraph">
<p>This <code>define</code> must be directly followed with an <code>#include "fmi3Functions.h"</code> statement.</p>
</div>
<div class="paragraph">
<p>Typically, FMU functions are used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">// FMU is shipped with C source code, or with static link library
#define FMI3_FUNCTION_PREFIX MyModel_
#include "fmi3Functions.h"
&lt; usage of the FMU functions e.g. MyModel_fmi3SetTime &gt;

// FMU is shipped with DLL/SharedObject
#include "fmi3FunctionTypes.h"
fmi3SetTimeTYPE *myname_setTime = &lt; load symbol "fmi3SetTime" from DLL/SharedObject &gt;;
&lt; usage of the FMU function pointers, e.g. myname_setTime &gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function that is defined as <code>fmi3GetFloat64</code> is changed by the macros to a function name as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the FMU is shipped with C source code or with static link library:<br>
The constructed function name is <code>MyModel_fmi3GetFloat64</code>.
In other words the function name is prefixed with the model name and an <code>_</code>.
A simulation environment can therefore construct the relevant function names by generating code for the actual function call.
In case of a static link library, the name of the library is <code>MyModel.lib</code> on Windows and <code>libMyModel.a</code> on Linux; in other words the <a href="#modelIdentifier"><code>modelIdentifier</code></a> attribute is used to create the library name.</p>
</li>
<li>
<p>If the FMU is shipped with DLL/SharedObject:<br>
The constructed function name is <code>fmi3GetFloat64</code>, in other words, it is not changed.
<em>[This can be realized in the case of a source code FMU with a target-specific version of <code>fmi3Functions.h</code> that does not use FMI3_FUNCTION_PREFIX to construct the function names.]</em>
A simulation environment will then dynamically load this library and will explicitly import the function symbols by providing the FMI function names as strings.
The name of the library is <code>MyModel.dll</code> on Windows or <code>MyModel.so</code> on Linux; in other words the <a href="#modelIdentifier"><code>modelIdentifier</code></a> attribute is used as library name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[An FMU can be optionally shipped so that it basically contains only the communication to another simulation tool (<code>needsExecutionTool = true</code>, see <a href="#fmi-for-co-simulation">Section 4</a>).</em>
<em>This is particularly common for co-simulation tasks.</em>
<em>In this tool coupling case one DLL/Shared Object can be used for all models due to no function prefixing.]</em></p>
</div>
<div class="paragraph">
<p>Since <a href="#modelIdentifier"><code>modelIdentifier</code></a> is used as prefix of a C-function name it must fulfill the restrictions on C-function
names (only letters, digits and/or underscores are allowed).
<em>[For example, if <code>modelName = "A.B.C"</code>, then <a href="#modelIdentifier"><code>modelIdentifier</code></a> might be "A_B_C".]</em>
Since <a href="#modelIdentifier"><code>modelIdentifier</code></a> is also used as name in a file system, it must also fulfill the restrictions of the targeted operating system.
Basically, this means that it should be short.
These restrictions apply to all interface types and for binary and source-code FMUs.
<em>[For example, the Windows API only supports full path-names of a file up to 260 characters (see: <a href="http://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx" class="bare">http://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx</a>).]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_platform_dependent_definitions">2.2.2. Platform Dependent Definitions</h4>
<div class="paragraph">
<p>To simplify porting, no C types are used in the function interfaces, but the alias types are defined in this section.
All definitions in this section are provided in the header file <code>fmi3PlatformTypes.h</code>.
It is required to use this definition for all binary FMUs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void*           fmi3Instance;             /* Pointer to FMU instance */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to an FMU specific data structure that contains the information needed to process the model equations or to process the co-simulation of the model/subsystem represented by the FMU.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void*           fmi3InstanceEnvironment;  /* Pointer to FMU environment */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to a data structure in the importer.
Using this pointer, data can be transferred between the importer and callback functions it provides (see <a href="#FMUStateSetable"><strong>FMU State Setable</strong></a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void*           fmi3FMUState;             /* Pointer to internal FMU state */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to a data structure in the FMU that saves the internal FMU state of the actual or a previously saved time instant.
This allows to restart a simulation from a saved FMU state (see <a href="#get-set-fmu-state">Section 2.2.6.4</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef unsigned int    fmi3ValueReference;       /* Handle to the value of a variable */</code></pre>
</div>
</div>
<div id="fmi3ValueReference" class="paragraph">
<p>This is a handle to a (base type) variable value of the model.
A <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> uniquely identifies the value and other properties of a variable, except for the variable name and the display unit that may differ for <a href="#alias"><code>alias</code></a> variable definitions.</p>
</div>
<div class="paragraph">
<p>Structured entities, such as records, must be flattened into a set of values (scalars or arrays) of type <code>fmi3Float64</code>, <code>fmi3Int32</code>, etc.
Arrays may be flattened into a set of scalars or represented directly as array values.
An <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> references one such value (scalar or array).
The coding of <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> is a "secret" of the environment that generated the FMU.
The interface to the equations only provides access to variable values via <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a>.
Extracting concrete information about a variable can be done by reading the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> in which the <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> are defined.
If a function in the following sections is called with a wrong <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> value <em>[for example, setting a constant with a call to <code>fmi3SetFloat64</code>]</em>, then the function must return with an error ( <a href="#fmi3Error"><code>fmi3Status == fmi3Error</code></a>, see <a href="#status-returned-by-functions">Section 2.2.3</a>).</p>
</div>
<div class="paragraph">
<p>Listing <a href="#code-base-types">Base types</a> shows the base types used in the interfaces of the C functions.</p>
</div>
<div id="code-base-types" class="listingblock">
<div class="title">Base types</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef           float fmi3Float32;  /* Single precision floating point (32-bit) */
typedef          double fmi3Float64;  /* Double precision floating point (64-bit) */
typedef          int8_t fmi3Int8;     /* 8-bit signed integer */
typedef         uint8_t fmi3UInt8;    /* 8-bit unsigned integer */
typedef         int16_t fmi3Int16;    /* 16-bit signed integer */
typedef        uint16_t fmi3UInt16;   /* 16-bit unsigned integer */
typedef         int32_t fmi3Int32;    /* 32-bit signed integer */
typedef        uint32_t fmi3UInt32;   /* 32-bit unsigned integer */
typedef         int64_t fmi3Int64;    /* 64-bit signed integer */
typedef        uint64_t fmi3UInt64;   /* 64-bit unsigned integer */
typedef            char fmi3Boolean;  /* Data type to be used with fmi3True and fmi3False */
typedef            char fmi3Char;     /* Data type for one character */
typedef const fmi3Char* fmi3String;   /* Data type for character strings
                                         ('\0' terminated, UTF-8 encoded) */
typedef            char fmi3Byte;     /* Smallest addressable unit of the machine
                                         (typically one byte) */
typedef const fmi3Byte* fmi3Binary;   /* Data type for binary data
                                         (out-of-band length terminated) */
typedef            char fmi3Clock;    /* Data type to be used with fmi3ClockActive and
                                         fmi3ClockInactive */

/* Values for fmi3Boolean */
#define fmi3True  1
#define fmi3False 0

/* Values for fmi3Clock */
#define fmi3ClockActive   1
#define fmi3ClockInactive 0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="status-returned-by-functions">2.2.3. Status Returned by Functions</h4>
<div class="paragraph">
<p>This section defines the <code>status</code> flag (an enumeration of type <code>fmi3Status</code> defined in file <code>fmi3FunctionTypes.h</code>) that is returned by functions to indicate the success of the function call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {
    fmi3OK,
    fmi3Warning,
    fmi3Discard,
    fmi3Error,
    fmi3Fatal,
} fmi3Status;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The status has the following meaning:</p>
</div>
<div id="fmi3OK" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3OK</code></dt>
<dd>
<p>The call was successful.
The output argument values are defined.</p>
</dd>
</dl>
</div>
<div id="fmi3Warning" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3Warning</code></dt>
<dd>
<p>A non-critical problem was detected, but the computation can continue.
The output argument values are defined.
Function <a href="#logMessage"><code>logMessage</code></a> was called by the FMU and the user is expected to handle the problem.<br>
<em>[In certain applications, e.g. in a prototyping environment, warnings may be acceptable.</em>
<em>For production environments warnings should be treated like errors unless they can be safely ignored.]</em></p>
</dd>
</dl>
</div>
<div id="fmi3Discard" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3Discard</code></dt>
<dd>
<p>The call was not successful and the FMU is in the same state as before the call.
The output argument values are not defined, but the computation can continue.
When debug logging is enabled (<code>loggingOn == fmi3True</code>) the function <a href="#logMessage"><code>logMessage</code></a> was called by the FMU.
Advanced simulation algorithms can try alternative approaches to drive the simulation by calling the function with different arguments or calling another function.
Otherwise the simulation algorithm has to treat this return code like <a href="#fmi3Error"><code>fmi3Error</code></a> and has to terminate the simulation.<br>
<em>[Examples for usage of <a href="#fmi3Discard"><code>fmi3Discard</code></a> are</em></p>
<div class="ulist">
<ul>
<li>
<p><em>handling of <a href="#min-max-violations">min/max violation</a>, or</em></p>
</li>
<li>
<p><em>signal numerical problems during model evaluation forcing smaller step sizes.]</em></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="fmi3Error" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3Error</code></dt>
<dd>
<p>The call failed.
The output argument values are undefined and the simulation cannot be continued.
Function <a href="#logMessage"><code>logMessage</code></a> was called by the FMU and the FMU is in state <a href="#Terminated"><strong>Terminated</strong></a>.
If a function returns <a href="#fmi3Error"><code>fmi3Error</code></a>, it is possible to restore a previously retrieved FMU state by calling <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>.
Otherwise <a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a> or <a href="#fmi3Reset"><code>fmi3Reset</code></a> must be called.
When detecting illegal arguments or a function call not allowed in the current state according to the respective state machine, the FMU must return <a href="#fmi3Error"><code>fmi3Error</code></a>.
Other instances of this FMU are not affected by the error.</p>
</dd>
</dl>
</div>
<div id="fmi3Fatal" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3Fatal</code></dt>
<dd>
<p>The state of all instances of the model is irreparably corrupted.
<em>[For example, due to a run-time exception such as access violation or integer division by zero during the execution of an FMI function.]</em>
Function <a href="#logMessage"><code>logMessage</code></a> was called by the FMU.
It is not allowed to call any other function for any instance of the FMU.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="inquire-version-number">2.2.4. Inquire Version Number of Header Files</h4>
<div id="fmi3GetVersion" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef const char* fmi3GetVersionTYPE(void);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns <code>fmi3Version</code> of the <code>fmi3Functions.h</code> header file which was used to compile the functions of the FMU.
This function call is allowed always and in all interface types.</p>
</div>
<div class="paragraph">
<p>The standard header file as documented in this specification has version <code>"3.0"</code>, so this function returns <code>"3.0"</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="advancing-time">2.2.5. Advancing Time</h4>
<div class="paragraph">
<p>This section highlights the differences of the concept of time (in general the independent variable) for the three different FMI types, ME, CS and SE.
Depending on the instantiated FMI type, the importer is restricted in what functions it is allowed to call in order to drive the simulation.</p>
</div>
<div class="paragraph">
<p>In Model Exchange, time is under the sole control of the importer and its integration algorithm.
The model itself receives the current time to be used in its computation with <a href="#fmi3SetTime"><code>fmi3SetTime</code></a>.
In fact, time is not necessarily always advancing as solvers might need to jump back and forth in time to localize events using zero-crossings of <a href="#eventIndicator">event indicators</a>.</p>
</div>
<div class="paragraph">
<p>In Co-Simulation, time advances in (possibly variable) steps negotiated between the co-simulation algorithm of the importer and the FMU.
The importer calls <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with the <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> and a target <a href="#communicationStepSize"><code>communicationStepSize</code></a> (required to be larger than 0.0).
During this <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, both importer and FMU might encounter events (or other situations) that require reduction of the <a href="#communicationStepSize"><code>communicationStepSize</code></a> (potentially even down to 0.0).
The FMU may use <a href="#earlyReturn"><code>earlyReturn</code></a> argument of the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> function to tell the importer that the FMU needs to return earlier, and the importer may use the callback <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> to signal the FMU that the latter should return earlier.
The output argument <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> allows the FMU to signal the importer its current internal time.</p>
</div>
<div class="paragraph">
<p>In Scheduled Execution, time has a more discrete form.
The scheduler of the importer activates specific tasks according to the time of the importer.
The time itself is communicated to the FMU as <a href="#activationTime"><code>activationTime</code></a> argument of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="fmu-variables">2.2.6. Variables</h4>
<div class="paragraph">
<p>FMU and importer use variables to exchange information.
All variables are listed in the <a href="#definition-of-model-variables"><code>modelDescription.xml</code></a> as elements of <code>&lt;fmiModelDescription&gt;&lt;ModelVariables&gt;</code>.</p>
</div>
<div class="paragraph">
<p>They are identified with a unique handle called <a href="#valueReference">value reference</a>.</p>
</div>
<div class="paragraph">
<p>The attribute <a href="#causality"><code>causality</code></a> defines the direction of the information flow with respect to the FMU (e.g. <a href="#input"><code>input</code></a>, <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a>).</p>
</div>
<div class="paragraph">
<p>A variable can be a scalar or a multi-dimensional array.</p>
</div>
<div class="sect4">
<h5 id="serialization-of_variables">2.2.6.1. Serialization of Array Variables</h5>
<div class="paragraph">
<p>When getting or setting the values of array variables, the serialization of array variable values used in C-API function calls, as well as in the XML <a href="#start"><code>start</code></a> attributes, is defined as row major, i.e., dimension order from left to right for the C-API (e.g. <code>array[dim1][dim2]&#8230;&#8203;[dimN]</code>), and the document order in the XML attributes for the respective dimensions.
For this serialization of array variables the sparsity pattern of the array is not taken into account.
All elements of the array, including structural zeros, are serialized.</p>
</div>
<div class="paragraph">
<p><em>[Example: A 2D matrix</em></p>
</div>
<div class="stemblock">
<div class="content">
\[A = \left( \begin{array}{cc} a_{11}&amp;a_{12}\\
                             a_{21}&amp;a_{22}\\
                             a_{31}&amp;a_{32}\\
            \end{array} \right)\]
</div>
</div>
<div class="paragraph">
<p><em>is serialized as follows:</em></p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[0][0]=a11</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[0][1]=a12</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+1</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[1][0]=a21</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+2</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[1][1]=a22</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+3</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[2][0]=a31</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+4</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[2][1]=a32</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="get-and-set-variable-values">2.2.6.2. Getting and Setting Variable Values</h5>
<div class="paragraph">
<p>Restrictions for setting and getting of variables with certain types, causalities and variabilities are described in the state machine and state descriptions (see <a href="#common-state-machine">Section 2.3</a>, <a href="#state-machine-model-exchange">Section 3.2</a> in case of Model Exchange, <a href="#state-machine-co-simulation">Section 4.2</a> for Co-Simulation and <a href="#state-machine-scheduled-execution">Section 5.2</a> for Scheduled Execution).</p>
</div>
<div class="paragraph">
<p>The value of a variable must be accessed with the respective <code>fmi3Get/Set{VariableType}</code> for the <a href="#definition-of-model-variables">type defined</a> in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
For variables of type <a href="#figure-schema-Enumeration"><code>Enumeration</code></a>, <code>fmi3SetInt64</code> and <code>fmi3GetInt64</code> must be used.</p>
</div>
<div class="paragraph">
<p>The current values of the variables can be inquired with the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetFloat32TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Float32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetFloat64TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Float64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt8TYPE   (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt8TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt16TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt16TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt32TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt32TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt64TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt64TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetBooleanTYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Boolean values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetStringTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3String values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetBinaryTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      size_t sizes[],
                                      fmi3Binary values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetClockTYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Clock values[],
                                      size_t nValues);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is a vector of <code>nValueReferences</code> value handles that define the variables that shall be inquired.</p>
</li>
<li>
<p><code>values</code> is a vector with the actual values of these variables.</p>
</li>
<li>
<p><code>sizes</code> is a vector with the actual sizes of the values for binary variables.</p>
</li>
<li>
<p><code>nValues</code> provides the number of values in the <code>values</code> vector (and <code>sizes</code> vector, where applicable) which is only equal to <code>nValueReferences</code> if all <a href="#valueReference"><code>valueReference</code></a>s point to scalar variables.
<em>[<code>nValues</code> and <code>nValueReferences</code> is, strictly speaking, redundant information, but is added to ensure memory safety and other sanity checks.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The strings returned by <code>fmi3GetString</code>, as well as the binary values returned by <code>fmi3GetBinary</code>, must be copied by the importer because the allocated memory for these strings might be deallocated or overwritten by the next call of an FMU function.</p>
</div>
<div class="paragraph">
<p>It is possible to set the values of variables using the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetFloat32TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Float32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetFloat64TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Float64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt8TYPE   (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt8TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt16TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt16TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt32TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt32TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt64TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt64TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetBooleanTYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Boolean values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetStringTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3String values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetBinaryTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const size_t sizes[],
                                      const fmi3Binary values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetClockTYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Clock values[],
                                      size_t nValues);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is a vector of <code>nValueReferences</code> value handles that define the variables that shall be set.</p>
</li>
<li>
<p><code>values</code> is a vector with the actual values of these variables.</p>
</li>
<li>
<p><code>sizes</code> is a vector with the actual sizes of the values of binary variables.</p>
</li>
<li>
<p><code>nValues</code> provides the number of values in the <code>values</code> vector (and <code>sizes</code> vector, where applicable) which is only equal to <code>nValueReferences</code> if all <a href="#valueReference"><code>valueReference</code></a>s point to scalar variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With two exceptions, all variables that are allowed to be set with <code>fmi3Set{VariableType}</code> keep their respective values until the next call to <code>fmi3Set{VariableType}</code>.
Exceptions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Variables of type clock must be deactivated during <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> by the FMU.</p>
</li>
<li>
<p>By setting the complete <a href="#get-set-fmu-state">FMU state</a> using <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, all variables are potentially changed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All strings passed as arguments to <code>fmi3SetString</code>, as well as all binary values passed as arguments to <code>fmi3SetBinary</code>, must be copied during these function calls, because there is no guarantee of the lifetime of strings or binary values, when these functions return.</p>
</div>
</div>
<div class="sect4">
<h5 id="min-max-violations">2.2.6.3. Handling min/max Range Violations</h5>
<div class="paragraph">
<p><a href="#min-max">Attributes <code>min</code> and <code>max</code></a> can be defined for variables of float, integer or enumeration types.
The question is how <code>fmi3Set{VariableType}</code>, <code>fmi3Get{VariableType}</code> shall utilize this definition.
There are several conflicting requirements:<br>
Avoiding forbidden regions (for example, if <code>u</code> is an <a href="#input"><code>input</code></a> and "sqrt(u)" is computed in the FMU, <code>min = 0</code> on <code>u</code> shall guarantee that only values of <code>u</code> in the allowed regions are provided).
Numerical algorithms (solvers or optimizers) do not guarantee constraints.
If a variable is outside of the bounds, the solver tries to bring it back into the bounds.
As a consequence, calling <code>fmi3Get{VariableType}</code> during an iteration of such a solver might return values that are not in the defined min/max region.
After the iteration is finalized, it is only guaranteed that a value is within its bounds up to a certain numerical precision.<br>
During system creation and prototyping, checks on min/max should be performed.
For maximum performance on production or real-time systems, these checks might not be performed.<br>
The approach in FMI is therefore that min/max definitions are an information from the FMU to the environment defining the region in which the FMU is designed to operate.
In any case, it is expected that the FMU handles variables appropriately where the region definition is critical.
For example, dividing by an <a href="#input"><code>input</code></a> (so the <a href="#input"><code>input</code></a> should not be in a small range of zero) or taking the square root of an <a href="#input"><code>input</code></a> (so the <a href="#input"><code>input</code></a> should not be negative) may either result in returning <a href="#fmi3Discard"><code>fmi3Discard</code></a> or <a href="#fmi3Error"><code>fmi3Error</code></a>, or the FMU is able to handle this situation in other ways.</p>
</div>
<div class="paragraph">
<p>If the FMU is generated so that min/max shall be checked whenever meaningful (for example, for debug purposes), then the following strategy should be used:</p>
</div>
<div class="paragraph">
<p>If <code>fmi3Set{VariableType}</code> is called violating the min/max attribute settings of the corresponding variable, the following actions are performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On a <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a> <a href="#fmi3Discard"><code>fmi3Status == fmi3Discard</code></a> is returned.</p>
</li>
<li>
<p>On an <a href="#input"><code>input</code></a>, the FMU decides what to return (If no computation is possible, it could return <a href="#fmi3Discard"><code>fmi3Status == fmi3Discard</code></a>, in other situations it may return <a href="#fmi3Warning"><code>fmi3Warning</code></a> or <a href="#fmi3Error"><code>fmi3Error</code></a>, or <a href="#fmi3OK"><code>fmi3OK</code></a>, if it is uncritical).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an FMU defines min/max values for integer types and <code>&lt;Enumeration&gt;</code> variables (<a href="#local"><code>local</code></a> and <a href="#output"><code>output</code></a> variables), then the expected behavior of the FMU is that <code>fmi3Get{VariableType}</code> functions return values in the defined range.</p>
</div>
<div class="paragraph">
<p>If an FMU defines min/max values, then the expected behavior of the FMU is that <code>fmi3Get{VariableType}</code> returns values at the solution (accepted steps of the integrators) in the defined range with a certain uncertainty related to the tolerances of the numerical algorithms.]</p>
</div>
</div>
<div class="sect4">
<h5 id="get-set-fmu-state">2.2.6.4. Getting and Setting the Complete FMU State</h5>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The FMU has an internal state consisting of all values that are needed to continue a simulation.
This internal state consists especially of the values of the continuous states, iteration variables, <a href="#parameter"><code>parameter</code></a> values, <a href="#input"><code>input</code></a> values, delay buffers, file identifiers, and FMU internal status information.
With the functions of this section, the internal FMU state can be copied and the pointer to this copy is returned to the environment.
The FMU state copy can be set as actual FMU state, in order to continue the simulation from it.</p>
</div>
<div class="paragraph">
<p><em>[Examples for using this feature:</em></p>
</div>
<div class="paragraph">
<p><em>For variable step-size control of co-simulation algorithms (get the FMU state for every accepted communication step; if the follow-up step is not accepted, restart co-simulation from this FMU state).</em></p>
</div>
<div class="paragraph">
<p><em>For nonlinear Kalman filters (get the FMU state just before initialization; in every sample period, set new continuous states from the Kalman filter algorithm based on measured values; integrate to the next sample instant and inquire the predicted continuous states that are used in the Kalman filter algorithm as basis to set new continuous states).</em></p>
</div>
<div class="paragraph">
<p><em>For nonlinear model predictive control (get the FMU state just before initialization; in every sample period, set new continuous states from an observer, initialize and get the FMU state after initialization.</em>
<em>From this state, perform many simulations that are restarted after the initialization with new input variables proposed by the optimizer).]</em></p>
</div>
<div class="paragraph">
<p>Furthermore, the FMU state can be serialized and copied in a byte vector.
<em>[This can be, for example, used to perform an expensive steady-state initialization, copy the received FMU state in a byte vector and store this vector on file.</em>
<em>Whenever needed, the byte vector can be loaded from file and deserialized, and the simulation can be restarted from this FMU state, in other words, from the steady-state initialization.]</em></p>
</div>
<div id="fmi3GetFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetFMUStateTYPE (fmi3Instance instance, fmi3FMUState* FMUState);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="FMUState"></a>This function makes a copy of the internal FMU state and returns a pointer to this copy in <a href="#FMUState"><code>FMUState</code></a>.
If on entry <code>*FMUState == NULL</code>, a new allocation is required.
If <code>*FMUState != NULL</code>, then <code>*FMUState</code> points to a previously returned <a href="#FMUState"><code>FMUState</code></a> that has not been modified since.
In particular, <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a> had not been called with this <a href="#FMUState"><code>FMUState</code></a> as an argument.
<em>[Function <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a> typically reuses the memory of this <a href="#FMUState"><code>FMUState</code></a> in this case and returns the same pointer to it, but with the actual <a href="#FMUState"><code>FMUState</code></a>.]</em></p>
</div>
<div id="fmi3SetFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetFMUStateTYPE (fmi3Instance instance, fmi3FMUState  FMUState);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function copies the content of the previously copied <a href="#FMUState"><code>FMUState</code></a> back and uses it as actual new FMU state.
The <a href="#FMUState"><code>FMUState</code></a> copy still exists.
<em>[The simulation is restarted at this state, when calling <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> with <a href="#FMUState"><code>FMUState</code></a>.]</em></p>
</div>
<div id="fmi3FreeFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3FreeFMUStateTYPE(fmi3Instance instance, fmi3FMUState* FMUState);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function frees all memory and other resources allocated with the <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a> call for this <a href="#FMUState"><code>FMUState</code></a>.
The argument to this function is the <a href="#FMUState"><code>FMUState</code></a> to be freed.
If a null pointer is provided, the call is ignored.
The function returns a null pointer in argument <a href="#FMUState"><code>FMUState</code></a>.</p>
</div>
<div class="paragraph">
<p>These functions can be called, if the optional capability flag <a href="#canGetAndSetFMUState"><code>canGetAndSetFMUState</code></a> is set to <code>true</code>.</p>
</div>
<div id="fmi3SerializedFMUStateSize" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SerializedFMUStateSizeTYPE(fmi3Instance instance,
                                                  fmi3FMUState  FMUState,
                                                  size_t* size);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the <code>size</code> of the byte vector, in order that <a href="#FMUState"><code>FMUState</code></a> can be stored in it.
With this information, the environment has to allocate an <code>fmi3Byte</code> vector of the required length <code>size</code>.</p>
</div>
<div id="fmi3SerializeFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SerializeFMUStateTYPE     (fmi3Instance instance,
                                                  fmi3FMUState  FMUState,
                                                  fmi3Byte serializedState[],
                                                  size_t size);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function serializes the data which is referenced by pointer <a href="#FMUState"><code>FMUState</code></a> and copies this data in to the byte vector <code>serializedState</code> of length <code>size</code>, that must be provided by the environment.</p>
</div>
<div id="fmi3DeSerializeFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3DeSerializeFMUStateTYPE   (fmi3Instance instance,
                                                  const fmi3Byte serializedState[],
                                                  size_t size,
                                                  fmi3FMUState* FMUState);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function deserializes the byte vector <code>serializedState</code> of length <code>size</code>, constructs a copy of the FMU state and returns <a href="#FMUState"><code>FMUState</code></a>, the pointer to this copy.</p>
</div>
<div class="paragraph">
<p>These functions are only supported by the FMU, if the optional capability flags <a href="#canGetAndSetFMUState"><code>canGetAndSetFMUState</code></a> and <a href="#canSerializeFMUState"><code>canSerializeFMUState</code></a> in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange|CoSimulation|ScheduledExecution&gt;</code> in the XML file are explicitly set to <code>true</code> (see <a href="#fmi-for-model-exchange">Section 3</a>, <a href="#fmi-for-co-simulation">Section 4</a>, <a href="#fmi-for-scheduled-execution">Section 5</a>).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selectiv-computation">2.2.7. Selective Computation of Variables</h4>
<div class="paragraph">
<p>Depending on the phase of the solver algorithm, different FMU variables need to be computed.
FMI allows selective retrieval of FMU variables with specific get functions (e.g. <code>fmi3Get{VariableType}</code>, <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>, <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a>).
This enables computation on demand with subsequent calls returning the same value until some set operation requires re-computation.</p>
</div>
<div class="paragraph">
<p>For example, during the iteration of an integrator step, only the state derivatives need to be computed, provided the <a href="#output"><code>output</code></a> of a model is not connected.
When localizing <a href="#state-event">state events</a>, only the computation of event indicators might be required.</p>
</div>
<div class="paragraph">
<p>Because specific set functions exist (<code>fmi3Set{VariableType}</code>, <a href="#fmi3SetTime"><code>fmi3SetTime</code></a>, <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>), caching algorithms can be applied to reuse already computed values.</p>
</div>
<div class="paragraph">
<p>In all tables describing the mathematical model of a state (e.g. <a href="#table-math-model-exchange">&lt;&lt;ContinuousTimeMode</a>&gt;&gt;), for notational convenience one function (e.g. \(\mathbf{f}_\mathit{cont}\)) is defined to compute all output arguments from all inputs arguments.
In an FMU, every output argument can be computed by its specific get function.
Additionally, the output argument need not be a function of all input arguments, but of only a subset from it, as defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> under <code>&lt;ModelStructure&gt;</code>.</p>
</div>
<div class="paragraph">
<p><em>[The functions above have the slight drawback that values must always be copied.</em>
<em>For example, a call to</em> <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a> <em>will provide the actual states in a vector, and this function has to copy the values in to the internal model data structure so that subsequent evaluation calls can utilize these values.</em>
<em>If this turns out to be an efficiency issue, a future release of FMI might provide additional functions to provide the address of a memory area where the variable values are present.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="algebraic-loops">2.2.8. Algebraic Loops</h4>
<div class="paragraph">
<p>When connecting FMUs, loop structures can occur that might lead to linear or non-linear algebraic systems of equations, involving continuous and discrete-time variables.
In order to detect and solve such systems of equations efficiently, information which <a href="#output"><code>output</code></a> depends directly on which <a href="#input"><code>inputs</code></a> is needed.
This data is optionally provided in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> under element <code>&lt;ModelStructure&gt;</code>.
If this data is not provided, the worst case must be assumed: all <a href="#output"><code>output</code></a> variables depend algebraically on all <a href="#input"><code>input</code></a> variables.</p>
</div>
<div class="paragraph">
<p><em>[Example: In <a href="#figure-connected-fmus">Figure 3</a> two different types of connected FMUs are shown (the "dotted lines" characterize the dependency information):</em></p>
</div>
<div id="figure-connected-fmus" class="imageblock text-center">
<div class="content">
<img src="images/ArtificialAlgebraicLoops.svg" alt="ArtificialAlgebraicLoops" width="80%">
</div>
<div class="title">Figure 3. Calling sequences for FMUs that are connected in a loop.</div>
</div>
<div class="paragraph">
<p><em>Since different variables are computed in every mode and the causality of variable computation can be different in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> as with respect to the other two modes, it might be necessary to solve different kinds of loops in the different modes.</em>
<em>Artificial algebraic loops (see left diagram of <a href="#figure-connected-fmus">Figure 3</a>) can be solved in the modes <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a>, and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> by an appropriate sequence of <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> calls:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi3Instance FMI1, FMI2;
fmi3ValueReference vr_FMU1_u, vr_FMU1_y, vr_FMU2_u1, vr_FMU2_u2, vr_FMU2_y1, vr_FMU2_y2;
fmi3Float64 s=0.1, FMU2_y1, FMU1_y, FMU2_y2;
...
fmi3SetFloat64(FMU2, &amp;vr_FMU2_u1, 1, &amp;s,        1);
fmi3GetFloat64(FMU2, &amp;vr_FMU2_y1, 1, &amp;FMU2_y1,  1);
fmi3SetFloat64(FMU1, &amp;vr_FMU1_u,  1, &amp;FMU2_y1,  1);
fmi3GetFloat64(FMU1, &amp;vr_FMU1_y,  1, &amp;FMU1_y,   1);
fmi3SetFloat64(FMU2, &amp;vr_FMU2_u2, 1, &amp;FMU1_y,   1);
fmi3GetFloat64(FMU2, &amp;vr_FMU2_y1, 1, &amp;FMU2_y2,  1);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>In the right diagram, FMU3 and FMU4 are connected in such a way that a real algebraic loop is formed.</em>
<em>This loop might be solved iteratively, for example with a Newton method.</em>
<em>In every iteration the iteration variable FMU4_u is provided by the solver, and via the shown sequence of <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> calls, the residual is computed and used by the solver to determine a new value of FMU4_u.</em>
<em>The iteration is terminated when the residual is small enough.</em>
<em>This method works for <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a>, and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>.</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi3Instance FMU3, FMU4;
fmi3ValueReference vr_FMU3_u, vr_FMU3_y, vr_FMU4_u, vr_FMU4_y;
fmi3Float64 s, FMU3_y, FMU4_y, residual;
bool converged = false;

while (!converged) { // start iteration
  // s determined by the solver
  ...
  fmi3SetFloat64(FMU4, &amp;vr_FMU4_u, 1, &amp;s,   1);
  fmi3GetFloat64(FMU4, &amp;vr_FMU4_y, 1, &amp;FMU4_y,  1);
  fmi3SetFloat64(FMU3, &amp;vr_FMU3_u, 1, &amp;FMU4_y,  1);
  fmi3GetFloat64(FMU3, &amp;vr_FMU3_y, 1, &amp;FMU3_y,  1);
  residual=s-FMU3_y; // provided to the solver
  converged=residual&lt;tolerance;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>In <a href="#StepMode"><strong>Step Mode</strong></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> is required to restore the FMU state before the next iteration with <code>fmi3Set{VariableType}</code>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, and <code>fmi3Get{VariableType}</code> is executed.</em></p>
</div>
<div class="paragraph">
<p><em>In <a href="#EventMode"><strong>Event Mode</strong></a>, the algorithms from above must be embedded in an event iteration:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi3Instance FMUx, FMUy;
bool newDiscreteStatesNeededx;
bool newDiscreteStatesNeededy;

fmi3EnterEventMode(FMUx,...);
fmi3EnterEventMode(FMUy,...);
do { // start event iteration
    // solve algebraic loop as described in the sample codes above

    // introduce new instant of super-dense time
    fmi3NewDiscreteStates(FMUx, newDiscreteStatesNeededx, ...);
    fmi3NewDiscreteStates(FMUy, newDiscreteStatesNeededy, ...);
} while (newDiscreteStatesNeededx || newDiscreteStatesNeededy);

fmi3EnterStepMode(FMUx); // for CS
fmi3EnterStepMode(FMUy); // for CS
// or for ME: fmi3EnterContinuousTimeMode(FMUx);
// or for ME: fmi3EnterContinuousTimeMode(FMUy);</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>When solving algebraic loops in <a href="#EventMode"><strong>Event Mode</strong></a>, limitations to variable manipulations declared with XML attribute <a href="#canHandleMultipleSetPerTimeInstant"><code>canHandleMultipleSetPerTimeInstant</code></a> must be considered.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="clocks">2.2.9. Clocks</h4>
<div class="paragraph">
<p>FMI 3.0 specifies the behavior of a clocked FMU.
FMI 3.0 does not specify how the importer uses this functionality.
This allows different use cases to be implemented with different semantics.</p>
</div>
<div class="sect4">
<h5 id="_motivation">2.2.9.1. Motivation</h5>
<div class="paragraph">
<p>Clock variables synchronize events between importer and across FMUs, by</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>communicating exactly which specific event happens and</p>
</li>
<li>
<p>exactly at which time instant, independent from continuous time specified by the arguments of <code>fmi3SetTime</code> or <code>fmi3DoStep</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first point solves the issue that an FMU must know exactly which event happens during an <a href="#EventMode"><strong>Event Mode</strong></a> if several events are very close to one another.</p>
</div>
<div class="paragraph">
<p>The second point solves the issue that computing exactly when an event happens is impossible to guarantee across importer and FMUs when using floating point computations.</p>
</div>
</div>
<div class="sect4">
<h5 id="_clock_types">2.2.9.2. Clock Types</h5>
<div class="paragraph">
<p>Clocks are <a href="#discrete"><code>discrete</code></a> <a href="#fmu-variables">variables</a> with a special semantic.</p>
</div>
<div class="paragraph">
<p>The following clock types are described in detail after the table.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Input clocks</dt>
</dl>
</div>
<div id="inputClock" class="paragraph">
<p>denote all clocks with <a href="#causality"><code>causality</code></a> <a href="#input"><code>input</code></a>.
The importer will activate <a href="#inputClock"><code>input clocks</code></a> using <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> or <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.
Contrary to the importer being the source of the clock activation, the definition of the clock timing comes from the FMU, either through the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> or calling <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Output clocks</dt>
</dl>
</div>
<div id="outputClock" class="paragraph">
<p>denote the <a href="#triggered"><code>triggered</code></a> <a href="#outputClock"><code>output clock</code></a>.
There is only one such <a href="#clock"><code>clock</code></a> type.
We still refer to it as <a href="#outputClock"><code>output clock</code></a> for simplicity.
The importer calls <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> to inquire the clock activation state.</p>
</div>
<table id="table-overview-clocks" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Overview of Clock Types.</caption>
<colgroup>
<col style="width: 7.317%;">
<col style="width: 7.317%;">
<col style="width: 13.0081%;">
<col style="width: 7.317%;">
<col style="width: 32.5203%;">
<col style="width: 32.5206%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Clock Type</th>
<th class="tableblock halign-left valign-top">Attribute <a href="#causality"><code>causality</code></a></th>
<th class="tableblock halign-left valign-top">Attribute <a href="#interval"><code>interval</code></a></th>
<th class="tableblock halign-left valign-top">Related API Calls and Arguments</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock">time-based</p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><a id="periodic"></a>periodic clock</p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>constant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="constantClock"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> and <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clocked PI-controller with a defined constant interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fixed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="fixedClock"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
<a href="#fmi3SetInterval"><code>fmi3SetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clocked PI-controller with an adaptable interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>calculated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="calculateClock"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> and <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clocked PI-controller with interval defined by fixed parameter(s) of the FMU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tunable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="tunableClock"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
<a href="#fmi3GetShift"><code>fmi3GetShift</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a> and in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clocked PI-controller with interval defined by tunable parameter(s) of the FMU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><a id="aperiodic"></a>aperiodic clock</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="changing"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in both <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> if and only if this clock ticked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simulation of the behavior of a control algorithm with variable execution time, generation of pulse sequences</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>countdown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="countdown"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> and in every <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> after every call to <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time-delayed actions after an event, for example, ignition signal some time after specific crank shaft angle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">triggered</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">input clock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>triggered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="triggered"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
arguments <a href="#clocksAboutToTick"><code>clocksAboutToTick</code></a> (<a href="#fmi3DoStep"><code>fmi3DoStep</code></a>) and <a href="#clocksTicked"><code>clocksTicked</code></a> (<a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">triggered by a hardware interrupt of an embedded system, e.g. a control algorithm, triggered by a crankshaft angle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">output clock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>output</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>triggered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetClock"><code>fmi3GetClock</code></a> in both <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>,
arguments <a href="#clocksAboutToTick"><code>clocksAboutToTick</code></a> (<a href="#fmi3DoStep"><code>fmi3DoStep</code></a>) and <a href="#clocksTicked"><code>clocksTicked</code></a> (<a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>),</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">crankshaft angle sensor ticking several times per revolution</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1"><a id="time-based-clocks"></a>Time-based clocks</dt>
<dd>
<p>are in a sense predictable and help the importer to take these clock ticks into account a priori.
All time-based clocks are defined to be input clocks because the importer calls <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> or <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> on these clocks.
The importer queries the FMU about when a time-based clock should be activated.
The importer will then activate the clock by calling <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> with <code>values == fmi3ClockActive</code>.</p>
<div class="paragraph">
<p>The mathematical descriptions of <a href="#time-based-clocks">time-based clocks</a> will use the following notations:</p>
</div>
<table id="table-notation-description" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Mathematical Notation Description.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{t}_0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time instant at which the <a href="#clock"><code>clock</code></a> is activated the first time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{t}_\mathit{i-1}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The previous time instant, where the <a href="#clock"><code>clock</code></a> ticked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{T}_{\mathit{shift}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delay for the first clock activation relative to \(\mathbf{t}_{\mathit{start}}\). \(\mathbf{T}_{\mathit{shift}}\) is defined differently for the different clock types, and can be retrieved from the FMU with <a href="#fmi3GetShiftDecimal"><code>fmi3GetShiftDecimal</code></a> as floating point value, or with <a href="#fmi3GetShiftFraction"><code>fmi3GetShiftFraction</code></a> as rational number: \(\mathit{shiftCounter} / \mathit{resolution}\) (see <a href="#resolution"><code>resolution</code></a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{T}_{interval, i}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval until the next <a href="#clock"><code>clock</code></a> tick, defined differently for the different clock types.
\(\mathbf{T}_{interval, i}\) can be set with <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> or retrieved with <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> as floating point value, or as rational number using <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a> or <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a>: \(\mathit{intervalCounter} / \mathit{resolution}\) (see <a href="#resolution"><code>resolution</code></a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{t}_\mathit{event}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current event time in <a href="#EventMode"><strong>Event Mode</strong></a>, or the current time in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> in SE.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1"><a id="periodic-clock-ticks"></a>Periodic clocks</dt>
<dd>
<p>are time-based clocks which have a constant interval, except when <code>interval = tunable</code> which indicates that the interval can change when <a href="#tunable"><code>tunable</code></a> parameters change.
The time instant of the first clock activation is defined by a <a href="#shift"><code>shift</code></a>.</p>
<div class="paragraph">
<p>The next <a href="#clock"><code>clock</code></a> activation at time instant \(t_i\) is defined as:<br>
\(\begin{align*}
\mathbf{t}_0 &amp;:= \mathbf{t}_{\mathit{start}} + \mathbf{T}_{\mathit{shift}} \\
\mathbf{t}_i &amp;:= \mathbf{t}_{i-1} + \mathbf{T}_{interval, i} \qquad i = 1,2,3,{...}
\end{align*}\)</p>
</div>
<table id="periodic-clock-restrictions" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Restrictions.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{T}_{interval, i} &gt; 0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from the previous <a href="#clock"><code>clock</code></a> tick to the current <a href="#clock"><code>clock</code></a> tick, specified differently for the different clock types.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Constant periodic clocks</dt>
<dd>
<p>are time-based periodic clocks that define their <a href="#interval"><code>interval</code></a> and <a href="#shift"><code>shift</code></a> in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</p>
</dd>
<dt class="hdlist1"><a id="fixed-periodic-clocks"></a>Fixed periodic clocks</dt>
<dd>
<p>are time-base periodic clocks which can be activated by the importer with an arbitrary, but constant interval starting after an arbitrary <a href="#shift"><code>shift</code></a>.
The importer informs the FMU about the interval using <a href="#fmi3SetInterval"><code>fmi3SetInterval</code></a>.</p>
</dd>
<dt class="hdlist1">Calculated periodic clocks</dt>
<dd>
<p>are time-base periodic clocks where the interval and <a href="#shift"><code>shift</code></a> depend on <a href="#fixed"><code>fixed</code></a> <a href="#parameter">parameters</a>.
The importer must use <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> and <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> to retrieve the clock interval and <a href="#shift"><code>shift</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</dd>
<dt class="hdlist1">Tunable periodic clocks</dt>
<dd>
<p>are time-base periodic clocks where the interval depends on <a href="#tunable"><code>tunable</code></a> <a href="#parameter">parameters</a>.
The importer must use <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> to retrieve the clock interval in <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>, if any of the <a href="#tunable"><code>tunable</code></a> <a href="#parameter">parameters</a> it depends on was changed.
<a href="#shift"><code>shift</code></a> may only depend on <a href="#fixed"><code>fixed</code></a> <a href="#parameter">parameters</a>.
The importer must use <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> to retrieve the clock <a href="#shift"><code>shift</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</dd>
<dt class="hdlist1"><a id="aperiodic-clocks"></a>Aperiodic clocks</dt>
<dd>
<p>are time-based clocks which have a nonconstant interval.
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> must be called to retrieve the first interval in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.
Calling <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> is not allowed.</p>
</dd>
<dt class="hdlist1"><a id="changing-aperiodic-clocks"></a>Changing aperiodic clocks</dt>
<dd>
<p>are time-based clocks where the next interval is unchangeably known right after the clock just ticked.</p>
<div class="paragraph">
<p>The next <a href="#clock"><code>clock</code></a> activation at time instant \(t_i\) is defined as:<br>
\(\begin{align*}
\mathbf{t}_0 &amp;:= \mathbf{t}_{\mathit{start}} + \mathbf{T}_{interval, 0} \\
\mathbf{t}_i &amp;:= \mathbf{t}_{i-1} + \mathbf{T}_{interval, i} \qquad i = 1,2,3,{...}
\end{align*}\)</p>
</div>
<table id="changing-clock-restrictions" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Restrictions.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{T}_{interval, 0} \geq 0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from \(\mathbf{t}_{\mathit{start}}\) to first <a href="#clock"><code>clock</code></a> tick.
Must be retrieved in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{T}_{interval, i} &gt; 0, \qquad i = 1,2,3,{...}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from the current <a href="#clock"><code>clock</code></a> tick to the next <a href="#clock"><code>clock</code></a> tick.
Must be retrieved in <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> if and only if the corresponding clock ticked.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1"><a id="countdown-aperiodic-clocks"></a>Countdown aperiodic clocks</dt>
<dd>
<p>are time-based clocks where the next interval is not yet known right after the clock just ticked, forcing the importer to call <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in every <a href="#EventMode"><strong>Event Mode</strong></a> and after every call to <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>.
The return argument <a href="#qualifier"><code>qualifier</code></a> of <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> is used to indicate if the next interval is already known.</p>
<div class="paragraph">
<p>The next <a href="#clock"><code>clock</code></a> activation at time instant \(t_i\) is defined as:<br>
\(\begin{align*}
\mathbf{t}_0 &amp;:= \mathbf{t}_{\mathit{start}} + \mathbf{T}_{interval, 0} \\
\mathbf{t}_i &amp;:= \mathbf{t}_{event} + \mathbf{T}_{interval, i} \qquad i = 1,2,3,{...}
\end{align*}\)</p>
</div>
<table id="countdown-clock-restrictions" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Restrictions.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{T}_{interval, 0} \geq 0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from \(\mathbf{t}_\mathit{start}\) to the first <a href="#clock"><code>clock</code></a> tick.
Must be retrieved in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{T}_{interval, i} \geq 0, \qquad i = 1,2,3,{...}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from the event time at which the argument <a href="#qualifier"><code>qualifier == fmi3NewInterval</code></a> of <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> to the next <a href="#clock"><code>clock</code></a> tick.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Triggered clocks</dt>
<dd>
<p>tick unpredictably.</p>
</dd>
<dt class="hdlist1">Triggered input clocks</dt>
<dd>
<p>are activated with <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> by the importer in <a href="#EventMode"><strong>Event Mode</strong></a>, or with <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>.</p>
<div class="paragraph">
<p>The next <a href="#clock"><code>clock</code></a> activation at time instant \(t_i\) is defined as:<br>
\(\begin{align*}
\mathbf{t}_i &amp;:= \mathbf{t}_{event} + \mathbf{T}_{interval, i} \qquad i = 1,2,3,{...}
\end{align*}\)</p>
</div>
<table id="triggered-input-clock-restrictions" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Restrictions.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{T}_{interval, i} \geq 0, \qquad i = 1,2,3,{...}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from the event time to the next <a href="#clock"><code>clock</code></a> tick.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Triggered output clocks</dt>
<dd>
<p>are activated within the FMU and the importer must call <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a> or in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.
There are two mechanisms for an FMU to communicate to the importer that a triggered output clock is about to tick:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#early-return">early return</a> from a <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with <a href="#clocksAboutToTick"><code>clocksAboutToTick == fmi3True</code></a>, and</p>
</li>
<li>
<p>calling <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> with <a href="#clocksTicked"><code>clocksTicked == fmi3True</code></a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="clocked-variable">2.2.9.3. Model Partitions and Clocked Variables</h5>
<div class="paragraph">
<p>A <a href="#clock"><code>clock</code></a> activates its specific <a href="#model-partition">model partition</a>.</p>
</div>
<div class="paragraph">
<p><em>[Such a model partition may represent a task or an interrupt service routine of an embedded system, or a discretized part of a plant model.]</em></p>
</div>
<div class="paragraph">
<p>Discrete-time variables computed in such a model partition are called <a href="#clocked-variable">clocked variables</a>.
Therefore, the value of a <a href="#clocked-variable">clocked variable</a> changes only when its clock is active.
Model partitions are initialized at their first clock activation, not in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>In some clock semantics (e.g. <a href="#MLS12">[MLS12]</a>), a clocked variable has a value only when its associated clock is active.
However, <code>fmi3Get{VariableType}</code> will return the value computed at the last clock activation time.
Before the first clock tick, clocked variables have their initial value.</p>
</div>
<div class="paragraph">
<p>The association between <a href="#clocked-variable">clocked variables</a> and their <a href="#clock">clocks</a> is defined by the <a href="#model-dependencies">model dependencies</a>.
<a href="#clocked-variable">Clocked variables</a> can only depend on one clock.</p>
</div>
</div>
<div class="sect4">
<h5 id="_scheduled_execution">2.2.9.4. Scheduled Execution</h5>
<div class="paragraph">
<p>An FMU may inform the external scheduler that a <a href="#triggered"><code>triggered</code></a> <a href="#inputClock"><code>input clock</code></a> depends on a <a href="#triggered"><code>triggered</code></a> <a href="#outputClock"><code>output clock</code></a> of the same FMU.
When the <a href="#outputClock"><code>output clock</code></a> ticks, the scheduler will trigger the corresponding <a href="#inputClock"><code>input clock</code></a> according to all other scheduling constraints.
The <a href="#triggeredBy"><code>triggeredBy</code></a> attribute of an <a href="#inputClock"><code>input clock</code></a> defines such a relationship.</p>
</div>
<div class="paragraph">
<p>In case more than one clock has to be activated at the same time instant, the scheduler needs a priority to define the activation sequence.
This ordering is defined by the <a href="#priority"><code>priority</code></a> attributes of the <a href="#inputClock"><code>input clock</code></a>.</p>
</div>
<div class="paragraph">
<p><em>[For real-time computation use cases, the priority information is used also for task preemption configurations.</em>
<em>It is therefore important to restrict the number of distinct priority levels for an FMU to available priority levels on the target platform and/or to avoid unnecessary computational overhead.</em>
<em>A common number of different priority levels is, e.g., 100 (0 to 99), as defined in Linux based operating systems.]</em></p>
</div>
<div class="paragraph">
<p><em>[The clock priorities are local to an FMU.</em>
<em>It is not possible for an FMU exporting tool to know in advance the priorities of other FMUs that will be connected to an FMU in a simulation setup.</em>
<em>It is the task of the importer to derive a computational order for the computation of two or more distinct FMUs based on the local FMU clock priorities and input-output relationships of connected FMUs.]</em></p>
</div>
<div class="paragraph">
<p><em>[For periodic <a href="#clock"><code>clocks</code></a> it is recommended to derive the priorities based on a rate monotonic scheduling scheme (smallest period leads to highest priority, that is, has the smallest priority value.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_api">2.2.9.5. <a id="fmi3SetInterval"></a> API</h5>
<div class="paragraph">
<p>For some <a href="#clock"><code>clock</code></a> types, the interval <a id="fmi3SetInterval"></a> is set by the environment for the current time instant by the function <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> or <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>.
The values of the arguments <code>interval</code>, <code>intervalCounter</code>, <code>resolution</code>, <code>shift</code> and <code>shiftCounter</code> refer to the unit of the <a href="#independent"><code>independent</code></a> variable.</p>
</div>
<div class="paragraph">
<p>The attribute <a href="#supportsFraction"><code>supportsFraction</code></a> of a <a href="#clock"><code>clock</code></a> declares, if the <code>fmi3SetXXXFraction</code> and/or <code>fmi3GetXXXFraction</code> functions are allowed to be called.</p>
</div>
<div id="fmi3SetIntervalDecimal" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetIntervalDecimalTYPE(fmi3Instance instance,
                                              const fmi3ValueReference valueReferences[],
                                              size_t nValueReferences,
                                              const fmi3Float64 interval[],
                                              size_t nValues);</code></pre>
</div>
</div>
<div id="fmi3SetIntervalFraction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetIntervalFractionTYPE(fmi3Instance instance,
                                               const fmi3ValueReference valueReferences[],
                                               size_t nValueReferences,
                                               const fmi3UInt64 intervalCounter[],
                                               const fmi3UInt64 resolution[],
                                               size_t nValues);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>interval</code> is a vector of size <code>nValues</code> containing the clock interval to be set.</p>
</li>
<li>
<p><code>intervalCounter</code> and <code>resolution</code> are vectors of size <code>nValues</code> containing the clock intervals specified in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>, see <a href="#resolution"><code>resolution</code></a>.</p>
</li>
</ul>
</div>
<div id="fmi3GetInterval" class="paragraph">
<p>For other clock types, the importer calls <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> or <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a> to query the next clock interval:</p>
</div>
<div id="fmi3GetIntervalDecimal" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetIntervalDecimalTYPE(fmi3Instance instance,
                                              const fmi3ValueReference valueReferences[],
                                              size_t nValueReferences,
                                              fmi3Float64 interval[],
                                              fmi3IntervalQualifier qualifier[],
                                              size_t nValues);</code></pre>
</div>
</div>
<div id="fmi3GetIntervalFraction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetIntervalFractionTYPE(fmi3Instance instance,
                                               const fmi3ValueReference valueReferences[],
                                               size_t nValueReferences,
                                               fmi3UInt64 intervalCounter[],
                                               fmi3UInt64 resolution[],
                                               fmi3IntervalQualifier qualifier[],
                                               size_t nValues);</code></pre>
</div>
</div>
<div id="qualifier" class="ulist">
<ul>
<li>
<p><code>qualifier</code> describes how to treat the <code>interval</code> and <code>intervalCounter</code> arguments and is defined as:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>typedef enum {
    fmi3NewInterval,
    fmi3NoChange,
    fmi3NotYetKnown,
} fmi3IntervalQualifier;</pre>
</div>
</div>
<div id="shift" class="paragraph">
<p>For <a href="#table-overview-clocks">some clocks</a>, the importer has to query the delay to the first clock tick from the FMU using the following functions<a id="fmi3GetShift"></a>:</p>
</div>
<div id="fmi3GetShiftDecimal" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetShiftDecimalTYPE(fmi3Instance instance,
                                              const fmi3ValueReference valueReferences[],
                                              size_t nValueReferences,
                                              fmi3Float64 shift[],
                                              size_t nValues);</code></pre>
</div>
</div>
<div id="fmi3GetShiftFraction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetShiftFractionTYPE(fmi3Instance instance,
                                               const fmi3ValueReference valueReferences[],
                                               size_t nValueReferences,
                                               fmi3UInt64 shiftCounter[],
                                               fmi3UInt64 resolution[],
                                               size_t nValues);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>shift</code> and <code>shiftCounter</code> define the time of the first clock activation, as defined in <a href="#shiftCounter"><code>shiftCounter</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="model-dependencies">2.2.10. Dependencies of Variables</h4>
<div class="paragraph">
<p>Dependencies between variables of an FMU:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>are helpful to classify <a href="#algebraic-loops">algebraic loops</a> across inputs and outputs when connecting FMUs.</p>
</li>
<li>
<p>associate continuous states and derivatives with each other and variables.</p>
</li>
<li>
<p>associate event indicators with variables.</p>
</li>
<li>
<p>define the sparseness when computing <a href="#partial-derivatives">partial derivatives</a>, avoiding unnecessary calls to <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> and <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</li>
<li>
<p>assign <a href="#clocked-variable">clocked variables</a> to <a href="#clock">clocks</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The dependencies are encoded in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> with the element <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a> up to <a href="#valueReference"><code>valueReference</code></a> resolution, not individual elements of array variables.</p>
</div>
<div class="paragraph">
<p>The variable dependency information in the XML description:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>does not resolve to dependencies of individual array elements,</p>
</li>
<li>
<p>does not take changing dependencies due to resizing of arrays via <a href="#structuralParameter"><code>structural parameters</code></a> into account,</p>
</li>
<li>
<p>is independent of the FMUs current operating point and parameter settings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An FMU can indicate via the <code>providesPerElementDependencies</code> capability flag that it is able to provide detailed dependency information at runtime through the following C-API.
The dependency information returned by these functions depend on the current operating point and parameter settings.</p>
</div>
<div class="paragraph">
<p>The number of dependencies of a given variable, which may change if <a href="#structuralParameter"><code>structural parameters</code></a> are changed, can be retrieved by calling the following function:</p>
</div>
<div id="fmi3GetNumberOfVariableDependencies" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNumberOfVariableDependenciesTYPE(fmi3Instance instance,
                                                           fmi3ValueReference valueReference,
                                                           size_t* nDependencies);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of <a href="#dependencies"><code>dependencies</code></a> for a given variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReference</code> specifies the <a href="#valueReference"><code>valueReference</code></a> of the variable for which the number of <a href="#dependencies"><code>dependencies</code></a> should be returned.</p>
</li>
<li>
<p><code>nDependencies</code> points to the <code>size_t</code> variable that will receive the number of <a href="#dependencies"><code>dependencies</code></a>.</p>
</li>
</ul>
</div>
<div id="fmi3GetVariableDependencies" class="paragraph">
<p>The actual <a href="#dependencies"><code>dependencies</code></a> (of type <a href="#dependenciesKind"><code>dependenciesKind</code></a>) can be retrieved by calling the function <a href="#fmi3GetVariableDependencies"><code>fmi3GetVariableDependencies</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {
    fmi3Independent = 0,
    fmi3Constant    = 1,
    fmi3Fixed       = 2,
    fmi3Tunable     = 3,
    fmi3Discrete    = 4,
    fmi3Dependent   = 5
} fmi3DependencyKind;

typedef fmi3Status fmi3GetVariableDependenciesTYPE(fmi3Instance instance,
                                                   fmi3ValueReference dependent,
                                                   size_t elementIndicesOfDependent[],
                                                   fmi3ValueReference independents[],
                                                   size_t elementIndicesOfIndependents[],
                                                   fmi3DependencyKind dependencyKinds[],
                                                   size_t nDependencies);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the dependency information for a single variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dependent</code> specifies the <a href="#valueReference"><code>valueReference</code></a> of the variable for which the dependencies should be returned.</p>
</li>
<li>
<p><code>nDependencies</code> specifies the number of dependencies that the calling environment allocated space for in the result buffers, and should correspond to value obtained by calling <a href="#fmi3GetNumberOfVariableDependencies"><code>fmi3GetNumberOfVariableDependencies</code></a>.</p>
</li>
<li>
<p><code>elementIndicesOfDependent</code> must point to a buffer of <code>size_t</code> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the element index of the dependent variable that dependency information is provided for.
The element indices start with 1. Using the element index 0 means all elements of the variable.
(Note: If an array has more than one dimension the indices are serialized in the same order as defined for values in <a href="#serialization-of_variables">Section 2.2.6.1</a>.)</p>
</li>
<li>
<p><code>independents</code> must point to a buffer of <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the value reference of the <a href="#independent"><code>independent</code></a> variable that this dependency entry is dependent upon.</p>
</li>
<li>
<p><code>elementIndicesIndependents</code> must point to a buffer of <code>size_t</code> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the element index of the <a href="#independent"><code>independent</code></a> variable that this dependency entry is dependent upon.
The element indices start with 1.
Using the element index 0 means all elements of the variable.
(Note: If an array has more than one dimension the indices are serialized in the same order as defined for values in <a href="#serialization-of_variables">Section 2.2.6.1</a>.)</p>
</li>
<li>
<p><code>dependencyKinds</code> must point to a buffer of <a href="#dependenciesKind"><code>dependenciesKind</code></a> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the enumeration value describing the dependency of this dependency entry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this function is called before the <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> call, it returns the initial dependencies.
If this function is called after the <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> call, it returns the run-time dependencies.
The retrieved dependency information of one variable becomes invalid as soon as a <a href="#structuralParameter"><code>structural parameter</code></a> linked to the variable or to any of its depending variables are set.
As a consequence, if you change <a href="#structuralParameter"><code>structural parameters</code></a> affecting B or A, the dependency of B becomes invalid.
The dependency information must change only if <a href="#structuralParameter"><code>structural parameters</code></a> are changed.</p>
</div>
</div>
<div class="sect3">
<h4 id="partial-derivatives">2.2.11. Getting Partial Derivatives</h4>
<div class="paragraph">
<p>Partial derivatives can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in Newton algorithms to solve <a href="#algebraic-loops">algebraic loops</a>,</p>
</li>
<li>
<p>in implicit integration algorithms in Model Exchange, and</p>
</li>
<li>
<p>in iterative co-simulation algorithms.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To avoid expensive numeric approximations of these derivatives, FMI offers dedicated functions to retrieve partial derivatives for an FMU.
For Model Exchange, this means computing the partial derivatives at any time instant, whereas for Co-Simulation, this means computing the partial derivatives at a communication point.</p>
</div>
<div class="paragraph">
<p>An FMU has different states and in every state an FMU might be described by different equations and different unknowns.
The precise definitions are given in the mathematical descriptions of Model Exchange (<a href="#state-machine-model-exchange">Section 3.2</a>) and Co-Simulation (<a href="#state-machine-co-simulation">Section 4.2</a>).
In every state, the general form of the FMU equations are:</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{v}_{\mathit{unknown}} = \mathbf{f}(\mathbf{v}_{\mathit{known}}, \mathbf{v}_{\mathit{rest}}),\]
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\mathbf{v}_{\mathit{unknonwn}}\) is the vector of unknown variables computed in the actual state:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#InitializationMode"><strong>Initialization Mode</strong></a>: The exposed unknowns listed as elements <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> in <code>&lt;ModelStructure&gt;</code> that have a floating point type.</p>
</li>
<li>
<p><a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> (Model Exchange): The continuous-time outputs and state derivatives (= the variables listed as elements <a href="#Output"><code>&lt;Output&gt;</code></a> of <code>&lt;ModelStructure&gt;</code> with a floating point type and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a> and the variables listed as elements <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> in <code>&lt;ModelStructure&gt;</code>).</p>
</li>
<li>
<p><a href="#EventMode"><strong>Event Mode</strong></a> (Model Exchange): The same variables as in the <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> and additionally variables listed as elements <a href="#Output"><code>&lt;Output&gt;</code></a> of <code>&lt;ModelStructure&gt;</code> with a floating point type and <a href="#variability"><code>variability</code></a> = <a href="#discrete"><code>discrete</code></a>.</p>
</li>
<li>
<p><a href="#StepMode"><strong>Step Mode</strong></a> (Co-Simulation): The variables listed as elements <a href="#Output"><code>&lt;Output&gt;</code></a> of <code>&lt;ModelStructure&gt;</code> with a floating point type and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a> or <a href="#discrete"><code>discrete</code></a>.
Each state derivative variable listed as elements <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> in <code>&lt;ModelStructure&gt;</code>, if present.</p>
</li>
</ul>
</div>
</li>
<li>
<p>\(\mathbf{v}_{\mathit{known}}\) is the vector of known <a href="#input"><code>input</code></a> variables of function <strong>f</strong> that changes its value in the actual state.
Details about which variables are in \(\mathbf{v}_{\mathit{known}}\) are given in the description of element <a href="#dependencies"><code>dependencies</code></a> in <a href="#ModelStructure">Section 2.4.8</a>.</p>
</li>
<li>
<p>\({\mathbf{v}_{\mathit{rest}}}\) is the set of <a href="#input"><code>input</code></a> variables of function <strong>f</strong> that either changes its value in the actual state, or do not change their values in this state, but change their values in other states <em>[for example, discrete-time <a href="#input"><code>inputs</code></a> in <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>]</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[The variable relationships are different in different states.</em>
<em>For example, during <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>, a continuous-time output y does not depend on discrete-time <a href="#input"><code>inputs</code></a> (because they are held constant between events).</em>
<em>However, at <a href="#EventMode"><strong>Event Mode</strong></a>, y depends on discrete-time <a href="#input"><code>inputs</code></a>.</em>
<em>The function may compute the directional derivatives by numerical differentiation taking into account the sparseness of the equation system, or (preferred) by analytic derivatives.]</em></p>
</div>
<div class="paragraph">
<p>There are two access functions for partial derivatives:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> to compute the directional derivatives \(\mathbf{v}_{\mathit{sensitivity}} = \mathbf{J} \cdot \mathbf{v}_{\mathit{seed}}\), and</p>
</li>
<li>
<p><a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a> to calculate the adjoint derivatives \(\mathbf{v}_{\mathit{sensitivity}}^T = \mathbf{v}_{\mathit{seed}}^T \cdot \mathbf{J}\)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>with the Jacobian</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{J}
=
\begin{bmatrix}
\frac{\partial h_1}{\partial v_{\mathit{known},1}} &amp; \cdots &amp; \frac{\partial h_1}{\partial v_{\mathit{known},n}} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial h_m}{\partial v_{\mathit{known},1}} &amp; \cdots &amp; \frac{\partial h_m}{\partial v_{\mathit{known},n}}
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p>where \(\mathbf{v}_{\mathit{known}}\) are the \(n\) knowns, and \(\mathbf{h}\) are the \(m\) functions to calculate the \(m\) unknwon variables \(\mathbf{v}_{\mathit{unknwon}}\)  from the knowns.</p>
</div>
<div class="paragraph">
<p>Both functions can also be used to construct the partial derivative matrices.
The functions may only be called if their availability is indicated by the attributes <a href="#providesDirectionalDerivatives"><code>providesDirectionalDerivatives</code></a> and <a href="#providesAdjointDerivatives"><code>providesAdjointDerivatives</code></a> respectively.</p>
</div>
<div id="fmi3GetDirectionalDerivative" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetDirectionalDerivativeTYPE(fmi3Instance instance,
                                                    const fmi3ValueReference unknowns[],
                                                    size_t nUnknowns,
                                                    const fmi3ValueReference knowns[],
                                                    size_t nKnowns,
                                                    const fmi3Float64 seed[],
                                                    size_t nSeed,
                                                    fmi3Float64 sensitivity[],
                                                    size_t nSensitivity);</code></pre>
</div>
</div>
<div id="fmi3GetAdjointDerivative" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetAdjointDerivativeTYPE(fmi3Instance instance,
                                                const fmi3ValueReference unknowns[],
                                                size_t nUnknowns,
                                                const fmi3ValueReference knowns[],
                                                size_t nKnowns,
                                                const fmi3Float64 seed[],
                                                size_t nSeed,
                                                fmi3Float64 sensitivity[],
                                                size_t nSensitivity);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both functions have the same arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>unknowns</code> contains value references to the unknowns.</p>
</li>
<li>
<p><code>nUnknowns</code> contains the length of argument <code>unknowns</code>.</p>
</li>
<li>
<p><code>knowns</code> contains value references of the knowns.</p>
</li>
<li>
<p><code>nKnowns</code> contains the length of argument <code>knowns</code>.</p>
</li>
<li>
<p><code>seed</code> contains the components of the seed vector.</p>
</li>
<li>
<p><code>nSeed</code> contains the length of <code>seed</code>.</p>
</li>
<li>
<p><code>sensitivity</code> contains the components of the sensitivity vector.</p>
</li>
<li>
<p><code>nSensitivity</code> contains the length of <code>sensitivity</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[Note that array variables will be serialized, so <code>nSeed</code> is only equal to <code>nKnowns</code> in the case of directional derivatives (resp., equal to <code>nUnknowns</code> in the case of adjoint derivatives) if all value references of <code>knowns</code> (resp., <code>unknowns</code>) point to scalar variables.</em>
<em>Likewise <code>nSensitivity</code> is only equal to <code>nUnknowns</code> (resp., <code>nKnowns</code>) if all value references of <code>unknowns</code> (resp., <code>knowns</code>) point to scalar variables.]</em></p>
</div>
<div class="sect4">
<h5 id="directionDerivatives">2.2.11.1. Directional Derivatives</h5>
<div id="example-directional-derivatives" class="paragraph">
<p><em>[Example:</em><br>
<em>Assume an FMU has the output equations</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{bmatrix}
y_1
\\
y_2
\end{bmatrix}
=
\begin{bmatrix}
g_1(x, u_1, u_3, u_4)
\\
g_2(x, u_1)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>and this FMU is connected, so that \({y_1, u_1, u_3}\) appear in an algebraic loop.</em>
<em>Then the nonlinear solver needs a Jacobian and this Jacobian can be computed (without numerical differentiation) provided the partial derivative of \({y_1}\) with respect to \({u_1}\) and \({u_3}\) is available.</em>
<em>Depending on the environment where the FMUs are connected, these <a href="#derivative"><code>derivatives</code></a> can be provided:</em></p>
</div>
<div class="paragraph">
<p>(a) <em>with one wrapper function around function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> to compute the directional derivatives with respect to these two variables (in other words, \({v_{\mathit{unknown}} = y_1}\), \({v_{\mathit{known}} = \left \{ u_1, u_3 \right \}}\)), and then the environment calls this wrapper function with \({v_{\mathit{seed}} = \left \{ 1, 0 \right \}}\) to compute the partial derivative with respect to \({u_1}\) and \({v_{\mathit{seed}} = \left \{ 0, 1 \right \}}\) to compute the partial derivative with respect to \({u_3}\), or</em></p>
</div>
<div class="paragraph">
<p>(b) <em>with two direct function calls of <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> (in other words, \({v_{\mathit{unknown}} = y_1, v_{\mathit{known}} = u_1, v_{\mathit{seed}} = 1}\); and \({v_{\mathit{unknown}} = y_1, v_{\mathit{known}} = u_3, v_{\mathit{seed}} = 1}\)).</em></p>
</div>
<div class="paragraph">
<p><em>Note that a direct implementation of this function with analytic derivatives:</em></p>
</div>
<div class="paragraph">
<p>(a) <em>Provides the directional derivative for all <a href="#input"><code>input</code></a> variables; so in the <a href="#example-directional-derivatives">above example</a>: \({\Delta y_1 = \frac{\partial g_1}{\partial x} \cdot \Delta x + \frac{\partial g_1}{\partial u_1} \cdot \Delta u_1 + \frac{\partial g_1}{\partial u_3} \cdot \Delta u_3 + \frac{\partial g_1}{\partial u_4} \cdot \Delta u_4}\)</em></p>
</div>
<div class="paragraph">
<p>(b) <em>Initializes all seed-values to zero; so in the <a href="#example-directional-derivatives">above example</a>: \({\Delta x = \Delta u_1 = \Delta u_3 = \Delta u_4 = 0}\)</em></p>
</div>
<div class="paragraph">
<p>(c) <em>Computes the directional derivative with the seed-values provided in the function arguments; so in the <a href="#example-directional-derivatives">above example</a>: \({v_{\mathit{sensitivity}} = \Delta y_1 (\Delta x = 0, \Delta u_1 = 1, \Delta u_3 = 0, \Delta u_4 = 0)}\)] and \({v_{\mathit{sensitivity}} = \Delta y_1 (\Delta x = 0, \Delta u_1 = 0, \Delta u_3 = 1, \Delta u_4 = 0)}\)]</em></p>
</div>
<div class="paragraph">
<p><em>[Note, function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> can be utilized for the following purposes:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Numerical integrators of stiff methods need matrix \({\frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\).</em></p>
</li>
<li>
<p><em>If the FMU is connected with other FMUs, the partial derivatives of the state derivatives and outputs with respect to the continuous states and the <a href="#input"><code>inputs</code></a> are needed in order to compute the Jacobian for the system of the connected FMUs.</em></p>
</li>
<li>
<p><em>If the FMU shall be linearized, the same <a href="#derivative"><code>derivatives</code></a> as in the previous item are needed.</em></p>
</li>
<li>
<p><em>If the FMU is used as the model for an extended Kalman filter, \({\frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\) and \({\frac{\partial \mathbf{g}}{\partial \mathbf{x}}}\) are needed.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>If a dense matrix shall be computed, the columns of the matrix can be easily constructed by successive calls of <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</em>
<em>For example, constructing the system Jacobian \({\mathbf{A} = \frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\) as dense matrix can be performed in the following way:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    //   c[]      column vector

    // set time, states and inputs
    CHECK_STATUS(fmi3SetTime(m, time))
    CHECK_STATUS(fmi3SetContinuousStates(m, x, nx))
    // fmi3Set{VariableType}(m, ...)

    // if required at this step, compute the Jacobian as a dense matrix
    for (i = 0; i &lt; nx; i++) {
        // construct the Jacobian matrix column wise
        CHECK_STATUS(fmi3GetDirectionalDerivative(m, vr_dx, nx, &amp;vr_x[i], 1, &amp;dk, 1, c, nx))
        for (j = 0; j &lt; nx; j++) {
            J[j][i] = c[j];
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>If the sparsity of a matrix shall be taken into account, then the matrix can be constructed in the following way:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>The incidence information of the matrix (whether an element is zero or not zero) is extracted from the XML file from element <code>&lt;ModelStructure&gt;</code>.</em></p>
</li>
<li>
<p><em>A so called graph coloring algorithm is employed to determine the columns of the matrix that can be computed by one call of <code>fmi3GetDirectionalDerivative</code>.</em>
<em>Efficient graph coloring algorithms are freely available, such as library <a href="https://cscapes.cs.purdue.edu/coloringpage/">ColPack</a> written in C/C++ (LGPL), or the routines by <a href="#CGM84">[CGM84]</a>.</em>
<em>See e.g. <a href="http://www.netlib.org/toms/618" class="bare">http://www.netlib.org/toms/618</a>.</em></p>
</li>
<li>
<p><em>For the columns determined in (2), one call to <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> is made.</em>
<em>After each such call, the elements of the resulting directional derivative vector are copied into their correct locations of the partial derivative matrix.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>More details and implementational notes are available from <a href="#ABL12">[ABL12]</a>.</em></p>
</div>
<div class="paragraph">
<p><em>Example:</em></p>
</div>
<div class="paragraph">
<p><em>Directional derivatives for higher dimension variables are almost treated in the same way.
Consider, for example, an FMU which calculates its output \({Y}\) by multiplying its 2x2 input \({U}\) with a 3x2 constant gain \({K}\), with</em></p>
</div>
<div class="stemblock">
<div class="content">
\[K=
\begin{bmatrix}
a, b
\\
c, d
\\
e, f
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>The output \({Y=K U}\) is a matrix of size 3x2.</em>
<em>The directional derivative of an output element \({Y(i,j)}\) with respect to the input \({U}\) and the seed \({\Delta U}\) is:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\Delta Y(i,j) =
\frac{\partial Y(i,j)}{\partial U(1,1)} \cdot \Delta U(1,1) +
\frac{\partial Y(i,j)}{\partial U(1,2)} \cdot \Delta U(1,2) +
\frac{\partial Y(i,j)}{\partial U(2,1)} \cdot \Delta U(2,1) +
\frac{\partial Y(i,j)}{\partial U(2,2)} \cdot \Delta U(2,2)\]
</div>
</div>
<div class="stemblock">
<div class="content">
\[\Delta \mathbf{Y} =
\begin{bmatrix}
a \Delta U(1,1)+b \Delta U(2,1), a \Delta U(1,2)+ b \Delta U(2,2)
\\
c \Delta U(1,1)+d \Delta U(2,1), c \Delta U(1,2)+ d \Delta U(2,2)
\\
e \Delta U(1,1)+f \Delta U(2,1), e \Delta U(1,2)+ f \Delta U(2,2)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>To get the directional derivative of \({Y}\) with respect to \({U(2,1)}\) the command <code>fmi3GetDirectionalDerivative(m, vr_Y, 1, vr_U, 1, {0.0, 0.0, 1.0, 0.0}, 4, dd, 6)</code> can be used where <code>vr_Y</code> and <code>vr_U</code> are references of the variable \({Y}\) and \({U}\), respectively.</em>
<em>Note that in order to get the directional derivative of \({Y}\) with respect to \({U(2,1)}\), the seed value <code>{0, 0, 1.0, 0}</code> has been used.</em>
<em>The retrieved directional derivative <code>dd</code> is stored in a matrix of size 3x2, so <code>nSensitivity</code> is 6.</em></p>
</div>
</div>
<div class="sect4">
<h5 id="adjointDerivatives">2.2.11.2. Adjoint Derivatives</h5>
<div class="paragraph">
<p><em>[Adjoint derivatives are beneficial in several contexts:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>in artificial intelligence (AI) frameworks the adjoint derivatives are called "vector gradient products" (VJPs).</em>
<em>There adjoint derivatives are used in the backpropagation process to perform gradient-based optimization of parameters using reverse mode automatic differentiation (AD), see, e.g., <a href="#BPRS15">[BPRS15]</a>.</em></p>
</li>
<li>
<p><em>in parameter estimation (see <a href="#BKF17">[BKF17]</a>)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Typically, reverse mode automatic differentiation (AD) is more efficient for these use cases than forward mode AD, as explained in the cited references.</em></p>
</div>
<div class="paragraph">
<p><em>If one would like to construct the full Jacobian matrix, one can use either <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> (to column-wise construct it) or <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a> (to row-wise construct it, possibly improved with coloring methods as mentioned above).</em>
<em>However in the applications motivating the adjoint derivatives, one does not need the full Jacobian matrix \(\mathbf{J}\), but vector  \(\mathbf{v}^T\) multiplied from the left to the Jacobian, i.e. \(\mathbf{v}^T\mathbf{J}\).</em>
<em>For computing the full Jacobian matrix, the column-wise construct is generally more efficient.]</em></p>
</div>
<div class="paragraph">
<p><em>Example:</em><br>
<em>Assume an FMU has the output equations</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{bmatrix}
y_1
\\
y_2
\end{bmatrix}
=
\begin{bmatrix}
h_1(u_1, u_2)
\\
h_2(u_1, u_2)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>and \(\left( w_1,  w_2 \right)^T \cdot \mathbf{ \frac{\partial h}{\partial u} }\) for some vector \(\left( w_1,  w_2 \right)^T\) is needed.</em>
<em>Then one can get this with one function call of <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a> (with arguments</em> \(\mathbf{v}_{\mathit{unknown}} = \text{valueReferences of} \left \{ y_1, y_2 \right \},  \mathbf{v}_{\mathit{known}} = \text{valueReferences of} \left \{ u_1, u_2 \right \},  \mathbf{v}_{\mathit{seed}} = \left( w_1, w_2 \right)^T\) <em>), while with <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> at least two calls would be necessary to first construct the Jacobian column-wise and then multiplying from the right with</em> \(\left( w_1,  w_2 \right)^T\) <em>.</em></p>
</div>
<div class="paragraph">
<p><em>If a dense matrix shall be computed, the rows of the matrix can be easily constructed by successive calls of <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</em>
<em>For example, constructing the system Jacobian \({\mathbf{A} = \frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\) as a dense matrix can be performed in the following way:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    for (i = 0; i &lt; nx; i++) {
        // construct the Jacobian matrix column wise
        CHECK_STATUS(fmi3GetAdjointDerivative(m, &amp;vr_dx[i], 1, vr_x, nx, &amp;dk, 1, &amp;J[i][0], nx))
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="getting-output-derivatives">2.2.12. Getting Derivatives of Continuous Outputs</h4>
<div class="paragraph">
<p>In FMI for Co-Simulation, the n-th <a href="#derivative"><code>derivatives</code></a> with respect to time of continuous <a href="#output"><code>outputs</code></a> can be retrieved with <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a> to allow interpolation/extrapolation of connected input variables between communication points by the importer in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.<br></p>
</div>
<div class="paragraph">
<p>Whether the FMU is able to provide the <a href="#derivative"><code>derivatives</code></a> of <a href="#output"><code>outputs</code></a> is given by the unsigned integer capability flag <a href="#maxOutputDerivativeOrder"><code>maxOutputDerivativeOrder</code></a> that represents the maximum order of the <a href="#output"><code>output</code></a> <a href="#derivative"><code>derivatives</code></a>.
If the actual order is lower (because the order of integration algorithm is low), the retrieved value is 0.</p>
</div>
<div class="paragraph">
<p>Restrictions on calling the function are the same as for the <code>fmi3Get{VariableType}</code> function for <a href="#continuous"><code>continuous</code></a> <a href="#output"><code>outputs</code></a>.
The returned values correspond to the current time of the FMU.
For example, after a successful call to <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, the returned values are related to the end of the communication step.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></dt>
</dl>
</div>
<div id="fmi3GetOutputDerivatives" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetOutputDerivativesTYPE(fmi3Instance instance,
                                                const fmi3ValueReference valueReferences[],
                                                size_t nValueReferences,
                                                const fmi3Int32 orders[],
                                                fmi3Float64 values[],
                                                size_t nValues);</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is a vector of value references that define the variables whose <a href="#derivative"><code>derivatives</code></a> shall be retrieved.
If multiple derivatives of a variable shall be retrieved, list the value reference multiple times.</p>
</li>
<li>
<p><code>nValueReferences</code> is the dimension of the arguments <code>valueReferences</code> and <code>orders</code>.</p>
</li>
<li>
<p><code>orders</code> contains the orders of the respective <a href="#derivative"><code>derivative</code></a> (1 means the first <a href="#derivative"><code>derivative</code></a>, 2 means the second <a href="#derivative"><code>derivative</code></a>, &#8230;&#8203;, 0 is not allowed).
If multiple derivatives of a variable shall be retrieved, provide a list of them in the <code>orders</code> array, corresponding to a multiply occurring value reference in the <code>valueReferences</code> array.</p>
</li>
<li>
<p><code>values</code> is a vector with the values of the <a href="#derivative"><code>derivatives</code></a>.
The order of the <code>values</code> elements is derived from a twofold serialization: the outer level corresponds to the combination of a value reference (e.g., <code>valueReferences[k]</code>) and order (e.g., <code>orders[k]</code>), and the inner level to the serialization of variables as defined in <a href="#serialization-of_variables">Section 2.2.6.1</a>.
The inner level does not exist for scalar variables.</p>
</li>
<li>
<p><code>nValues</code> is the size of the argument <code>values</code>.
<code>nValues</code> only equals <code>nValueReferences</code> if all corresponding output variables are scalar variables.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p><em>[ Example:</em><br>
<em>Assuming an FMU has outputs \(y_1\)[2*3] with value reference 1, \(y_2\) with value reference 2, \( y_3\)[2] value reference 3, \(y_4\) with value reference 4 and <code>maxOutputDerivativeOrder</code>=2.</em><br>
<em>With <code>valueReferences</code>= [1, 1, 3, 3, 4, 4], and <code>orders</code>= [1, 2, 1, 2, 1, 2], <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a> will provide first and second time derivatives of the outputs y1, y3, y4, which in <code>values</code> are serialized in the following way:</em>
<em>((array serialization of \(\dot y_1\)), (array serialization of \(\ddot y_1\)), (array serialization of \(\dot y_3\)), (array serialization of \(\ddot y_3\)), \(\dot y_4\), \(\ddot y_4\))</em><br>
<em>If the internal polynomial is of order 1 and the importer inquires the second <a href="#derivative"><code>derivative</code></a> of an <a href="#output"><code>output</code></a>, the FMU will return zero.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common-state-machine">2.3. State Machine and Semantics</h3>
<div class="paragraph">
<p>To define allowed calling sequences of FMI functions, state machines are used.
Each state of the state machine corresponds to a certain phase of a simulation.
All FMI interface types share a number of states in their respective state machines.
This chapter describes these common states used in at least two of the interface types.
State-machine states specific to a single FMI interface type will be described in their respective chapters.</p>
</div>
<div id="each-state-description" class="paragraph">
<p>Each state description lists the governing equations and actions and the corresponding API functions influencing these equations in a table (not defining the calling order), and also lists the allowed function calls and usage restrictions.</p>
</div>
<div id="figure-common-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machines-common-states.svg" alt="state machines common states" width="80%">
</div>
<div class="title">Figure 4. Common calling sequence for C functions of common states for all three FMI types.</div>
</div>
<div class="paragraph">
<p>The state machine is given here as UML 2.0 state machine.
If a transition is labeled with one or more function names (for example, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>), the transition is taken if the function call returns successfully (not <code>NULL</code> for <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a> or <a href="#fmi3OK"><code>fmi3OK</code></a> and <a href="#fmi3Warning"><code>fmi3Warning</code></a> for all other functions).
This way, importer and FMU can determine in which state the FMU is.</p>
</div>
<div class="sect3">
<h4 id="FMUStateSetable">2.3.1. Super State: FMU State Setable</h4>
<div class="paragraph">
<p>The state <a href="#FMUStateSetable"><strong>FMU State Setable</strong></a> is entered when any of the following functions is called: <a href="#fmi3InstantiateModelExchange"><code>fmi3InstantiateModelExchange</code></a>, <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> and <a href="#fmi3InstantiateScheduledExecution"><code>fmi3InstantiateScheduledExecution</code></a>.
The state is left by either calling <a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a> or when any of the functions called during <a href="#FMUStateSetable"><strong>FMU State Setable</strong></a> returns <a href="#fmi3Fatal"><code>fmi3Fatal</code></a>.
If any function called in super state <a href="#FMUStateSetable"><strong>FMU State Setable</strong></a> returns <a href="#fmi3Error"><code>fmi3Error</code></a>, the FMU enters state <a href="#Terminated"><strong>Terminated</strong></a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls to enter this Super State</dt>
</dl>
</div>
<div id="fmi3InstantiateModelExchange" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3InstantiateModelExchange</code></dt>
<dd>
<p>This function instantiates a Model Exchange FMU (see <a href="#fmi-for-model-exchange">Section 3</a>).
It is allowed to call this function only if <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> includes a <code>&lt;ModelExchange&gt;</code> element.</p>
</dd>
</dl>
</div>
<div id="fmi3InstantiateCoSimulation" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3InstantiateCoSimulation</code></dt>
<dd>
<p>This function instantiates a Co-Simulation FMU (see <a href="#fmi-for-co-simulation">Section 4</a>).
It is allowed to call this function only if <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> includes a <code>&lt;CoSimulation&gt;</code> element.</p>
</dd>
</dl>
</div>
<div id="fmi3InstantiateScheduledExecution" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3InstantiateScheduledExecution</code></dt>
<dd>
<p>This function instantiates a Scheduled Execution FMU (see <a href="#fmi-for-scheduled-execution">Section 5</a>).
It is allowed to call this function only if <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> includes a <code>&lt;ScheduledExecution&gt;</code> element.</p>
<div id="fmi3Instantiate" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Instance fmi3InstantiateModelExchangeTYPE(
    fmi3String                 instanceName,
    fmi3String                 instantiationToken,
    fmi3String                 resourceLocation,
    fmi3Boolean                visible,
    fmi3Boolean                loggingOn,
    fmi3InstanceEnvironment    instanceEnvironment,
    fmi3CallbackLogMessage     logMessage);

typedef fmi3Instance fmi3InstantiateCoSimulationTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourceLocation,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    fmi3Boolean                    eventModeUsed,
    fmi3Boolean                    earlyReturnAllowed,
    const fmi3ValueReference       requiredIntermediateVariables[],
    size_t                         nRequiredIntermediateVariables,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3CallbackLogMessage         logMessage,
    fmi3CallbackIntermediateUpdate intermediateUpdate);

typedef fmi3Instance fmi3InstantiateScheduledExecutionTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourceLocation,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    const fmi3ValueReference       requiredIntermediateVariables[],
    size_t                         nRequiredIntermediateVariables,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3CallbackLogMessage         logMessage,
    fmi3CallbackIntermediateUpdate intermediateUpdate,
    fmi3CallbackLockPreemption     lockPreemption,
    fmi3CallbackUnlockPreemption   unlockPreemption);</code></pre>
</div>
</div>
<div class="paragraph">
<p>These functions return a new instance of an FMU with the respective interface type.
If a null pointer is returned, then instantiation failed.
In that case, <a href="#logMessage"><code>logMessage</code></a> is called with detailed information about the reason.
An FMU can be instantiated many times (provided capability flag <code>canBeInstantiatedOnlyOncePerProcess = false</code>).</p>
</div>
<div class="paragraph">
<p>The arguments of the instantiation functions are detailed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceName</code> is a unique identifier for the FMU instance.
It is used to name the instance, for example, in error or information messages generated by one of the <code>fmi3XXX</code> functions.
The argument <code>instanceName</code> must be a non empty string (in other words, must have at least one character that is not a white space).
<em>[If only one FMU is simulated, as <code>instanceName</code> attribute <code>modelName</code> or <code>&lt;ModelExchange|CoSimulation|ScheduledExecution modelIdentifier=".."&gt;</code> from the XML schema <code>fmi3ModelDescription</code> might be used.]</em></p>
</li>
<li>
<p><a href="#instantiationToken"><code>instantiationToken</code></a> can be used by the FMU to check that the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file (see <a href="#fmu-distribution">Section 2.5</a>) is compatible with the implementation of the FMU.
It is an opaque string generated by the FMU exporter that is stored in the xml file as mandatory attribute <a href="#instantiationToken"><code>instantiationToken</code></a> (see <a href="#fmiModelDescription">Section 2.4.1</a>).
It must be passed unchanged to the FMU.
This argument must not be a null pointer.</p>
</li>
<li>
<p><a id="resourceLocation"></a> <code>resourceLocation</code> is a URI according to the <a href="http://datatracker.ietf.org/doc/rfc3986/">IETF RFC3986</a> syntax to indicate the location to the <code>resources</code> directory of the unzipped FMU archive.
The following schemes must be understood by the FMU:</p>
<div class="ulist">
<ul>
<li>
<p>Mandatory&#8201;&#8212;&#8201;<code>file</code> with absolute path (either including or omitting the authority component);<br></p>
</li>
<li>
<p>Optional&#8201;&#8212;&#8201;<code>http</code>, <code>https</code>, <code>ftp</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[Example: An FMU is unzipped in directory <code>C:\temp\MyFMU</code>, then <a href="#resourceLocation"><code>resourceLocation</code></a> = <code><a href="file:///C:/temp/MyFMU/resources" class="bare">file:///C:/temp/MyFMU/resources</a></code> or <code>file:/C:/temp/MyFMU/resources</code>.</em><br>
<em>The <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a> functions are then able to read all needed resources from this directory, for example maps or tables used by the FMU.]</em><br>
A NULL pointer is supplied for <a href="#resourceLocation"><code>resourceLocation</code></a>, if no resource location can be provided to the FMU, which may occur</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the FMU does not contain a resources folder, or</p>
</li>
<li>
<p>if the environment is not able to provide an URI to the resources folder <em>[e.g., if the environment does not have a file system.</em>
<em>If the FMU in such a case cannot be simulated, as it depends on the resources folder, it shall terminate with an error.]</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>visible == fmi3False</code> defines that the interaction with the user should be reduced to a minimum (no application window, no plotting, no animation, etc.).
In other words, the FMU is executed in batch mode.
If <code>visible == fmi3True</code>, the FMU is executed in interactive mode, and the FMU might require to explicitly acknowledge start of simulation / instantiation / initialization (acknowledgment is non-blocking).</p>
</li>
<li>
<p>If <code>loggingOn == fmi3False</code>, then any logging is disabled and the <a href="#logMessage"><code>logMessage</code></a> callback function is not called by the FMU.
If <code>loggingOn == fmi3True</code>, the FMU enables a vendor defined set of <code>&lt;LogCategories&gt;</code>.
This set should typically contain categories for messages that explain execution errors, like <a href="#fmi3Discard"><code>fmi3Discard</code></a>, <a href="#fmi3Error"><code>fmi3Error</code></a> and <a href="#fmi3Fatal"><code>fmi3Fatal</code></a>.
The function <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> gives more detailed control about required <code>&lt;LogCategories&gt;</code> (see <a href="#definition-of-log-categories">Section 2.4.5</a>).</p>
</li>
<li>
<p><a id="eventModeUsed"></a>If <code>eventModeUsed == fmi3True</code> the importer can handle events, otherwise <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> must not be called.
The flag may only be <code>fmi3True</code>, if <a href="#hasEventMode"><code>hasEventMode == true</code></a>, otherwise the FMU must raise an error.
For FMUs that have clocks, <code>eventModeUsed == fmi3True</code> is required.</p>
</li>
<li>
<p><a id="earlyReturnAllowed"></a>If <code>earlyReturnAllowed == fmi3True</code> the importer can handle <a href="#early-return">early return</a>.
Only in this case, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> may return with <a href="#earlyReturn"><code>earlyReturn == fmi3True</code></a>.</p>
</li>
<li>
<p><code>instanceEnvironment</code> is a pointer that can be passed to the <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> function in order that the simulation environment can provide an efficient way to identify the FMU that called <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.</p>
</li>
<li>
<p><a id="requiredIntermediateVariables"></a> <code>requiredIntermediateVariables</code> is an array of the value references of all <a href="#input"><code>input</code></a> variables that the simulation algorithm intends to set and all <a href="#output"><code>output</code></a> variables it intends to get during intermediate updates.
This set may be empty (<a href="#nRequiredIntermediateVariables"><code>nRequiredIntermediateVariables</code></a> == 0) when the simulation algorithm does not intend to use intermediate update.
Only the variables in <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> may be accessed by the simulation algorithm using <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> during <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> callbacks.
All variables referenced in this set must be marked with the attribute <a href="#intermediateUpdate"><code>intermediateUpdate = "true"</code></a> in the model description.
For Co-Simulation, these intermediate variables must be continuous-time variables.</p>
</li>
<li>
<p><a id="nRequiredIntermediateVariables"></a> <code>nRequiredIntermediateVariables</code> gives the number of entries in <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a>.
If <a href="#nRequiredIntermediateVariables"><code>nRequiredIntermediateVariables</code></a> is zero <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> is not defined.</p>
</li>
<li>
<p><a id="logMessage"></a>Callback function <code>logMessage</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void  (*fmi3CallbackLogMessage)     (fmi3InstanceEnvironment instanceEnvironment,
                                             fmi3String instanceName,
                                             fmi3Status status,
                                             fmi3String category,
                                             fmi3String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pointer to a function that is called in the FMU <em>[usually if an <code>fmi3XXX</code> function does not behave as desired]</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceName</code> is the instance name of the model that calls this function.</p>
</li>
<li>
<p><code>status</code> contains the severity of the message, see <code>fmi3Status</code>.
If <a href="#logMessage"><code>logMessage</code></a> is called with <a href="#fmi3OK"><code>status == fmi3OK</code></a>, then the message is a pure information message.</p>
</li>
<li>
<p><code>category</code> is the category of the message.
The meaning of <code>category</code> is defined by the modeling environment that generated the FMU.
Depending on this modeling environment, none, some, or all, allowed values of <code>category</code> for this FMU are defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file via element <code>&lt;fmiModelDescription&gt;&lt;LogCategories&gt;</code>, see <a href="#definition-of-log-categories">Section 2.4.5</a>.
Only messages are provided by function <a href="#logMessage"><code>logMessage</code></a> that have a category according to a call to <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a>.</p>
</li>
<li>
<p><code>message</code> is a string that contains the message.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All string-valued arguments passed by the FMU to the <a href="#logMessage"><code>logMessage</code></a> may be deallocated by the FMU directly after function <a href="#logMessage"><code>logMessage</code></a> returns.
The simulation environment must therefore create copies of these strings if it needs to access these strings later.<br>
The <a href="#logMessage"><code>logMessage</code></a> function will append a line break to each message when writing messages after each other to a terminal or a file (the messages may also be shown in other ways, for example, as separate text-boxes in a GUI).
The caller may include line-breaks (using "\n") within the message, but should avoid trailing line breaks.<br>
Variables can be referenced in a message with <code>#&lt;ValueReference&gt;#</code>.
If the character <code>#</code> shall be included in the message, it has to be prefixed with <code>#</code>, so <code>#</code> is an escape character.<br>
<em>[Example: The message <code>#1365# must be larger than zero (used in IO channel ##4)</code> might be changed by the <a href="#logMessage"><code>logMessage</code></a> function to <code>body.m must be larger than zero (used in IO channel #4)</code> if <code>body.m</code> is the name of the variable with value reference 1365.]</em></p>
</div>
</li>
<li>
<p>Callback function <code>intermediateUpdate</code><br>
See <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> for details.</p>
</li>
<li>
<p>Callback function <code>lockPreemption</code> and <code>unlockPreemption</code><br>
See <a href="#preemption-support">Section 5.1.1</a> for details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The arguments <a href="#logMessage"><code>logMessage</code></a>, <a href="#intermediateUpdate"><code>intermediateUpdate</code></a>, <a href="#preemption-support"><code>lockPreemption</code></a>, and <a href="#preemption-support"><code>unlockPreemption</code></a>, are function pointers provided by the simulation environment to be used by the FMU.
It is not allowed to change these functions between <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a> and <a href="#fmi3Terminate"><code>fmi3Terminate</code></a> calls.
Additionally, a pointer to the environment is provided (<code>instanceEnvironment</code>) that needs to be passed to all of the callback functions, in order that those functions can utilize data from the environment, such as mapping a <a href="#valueReference"><code>valueReference</code></a> to a string, or assigning memory to a certain FMU instance.</p>
</div>
</dd>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1"><a id="fmi3SetDebugLogging"></a>Function <code>fmi3SetDebugLogging</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status  fmi3SetDebugLoggingTYPE(fmi3Instance instance,
                                            fmi3Boolean loggingOn,
                                            size_t nCategories,
                                            const fmi3String categories[]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function controls debug logging that is output via the <a href="#logMessage"><code>logMessage</code></a> callback function.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>loggingOn == fmi3True</code>, debug logging is enabled, otherwise it is switched off.</p>
</li>
<li>
<p><code>nCategories</code> defines the length of the next argument <code>categories</code>
If <code>loggingOn == fmi3True</code> and <code>nCategories == 0</code>, then all debug messages shall be output.
If <code>loggingOn == fmi3True</code> and <code>nCategories &gt; 0</code>, then only debug messages according to the <code>categories</code> argument shall be printed via the <a href="#logMessage"><code>logMessage</code></a> function.</p>
</li>
<li>
<p><code>categories</code> is a vector with <code>nCategories</code> elements.
The allowed values of <code>categories</code> are defined by the modeling environment that generated the FMU.
Depending on the generating modeling environment, none, some or all allowed values for <code>categories</code> for this FMU are defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file via element <code>&lt;fmiModelDescription&gt;&lt;LogCategories&gt;</code>, see <a href="#definition-of-log-categories">Section 2.4.5</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a id="fmi3Reset"></a>Function <code>fmi3Reset</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ResetTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Is called by the environment to reset the FMU after a simulation run.
The FMU goes into the same state as if <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a> would have been called.
All variables have their default values.
Before starting a new run <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> has to be called.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3FreeInstance" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3FreeInstance</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void fmi3FreeInstanceTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Disposes the given instance, unloads the loaded model, and frees all the allocated memory and other resources that have been allocated by the functions of the FMU interface.
If a null pointer is provided for argument <code>instance</code>, the function call is ignored (does not have an effect).</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3GetNominalsOfContinuousStates" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNominalsOfContinuousStatesTYPE(fmi3Instance instance,
                                                         fmi3Float64 nominals[],
                                                         size_t nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the nominal values of the continuous <a href="#state"><code>states</code></a>.
This function can only be called in Model Exchange.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Return argument <code>nominals</code> contains the nominal values for each <a href="#state">continuous state</a> with the same convention for the order as defined for <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>.
If the FMU does not have information about the nominal value of a continuous <a href="#state"><code>state</code></a> <code>i</code>, a nominal value <code>nominals[i] == 1.0</code> should be returned.
It is required that <code>nominals[i] &gt; 0.0</code>.</p>
</li>
<li>
<p>Argument <code>nContinuousStates</code> is the size of the <code>nominals</code> vector.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This function should always be called after calling function <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>, if <code>nominalsOfContinuousStatesChanged == fmi3True</code>, since then the nominal values of the continuous <a href="#state"><code>states</code></a> have changed <em>[for example, because the mapping of the continuous <a href="#state"><code>states</code></a> to variables has changed because of internal <a href="#dynamic-state-selection">dynamic state selection</a>]</em>.</p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a></dt>
<dd>
<p>All these allowed functions are described in <a href="#get-set-fmu-state">Section 2.2.6.4</a>.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="Instantiated">2.3.1.1. State: Instantiated</h5>
<div class="paragraph">
<p>In the state <a href="#Instantiated"><strong>Instantiated</strong></a> the FMU can do one-time initializations and allocate memory.</p>
</div>
<table id="table-math-instantiated" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \((\mathbf{v}_{\mathit{initial=exact}}\) or \(\mathbf{v}_{\mathit{initial=approx}})\) and \(\mathbf{v}_{\mathit{variability \neq constant}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get variable <a href="#start"><code>start</code></a> values as defined in <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Get{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>\(\mathbf{t}_{\mathit{start}} := (\)<a href="#startTime"><code>startTime</code></a>\(,0)\)</p>
</li>
<li>
<p>Activate initialization equations \(\mathbf{f}_{\mathit{init}}\).</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <code>fmi3Set{VariableType}</code></dt>
<dd>
<p>This function can be called for variables with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> and with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a>.
The intention is to set <a href="#start"><code>start</code></a> and guess values for these variables.</p>
</dd>
</dl>
</div>
<div id="fmi3EnterConfigurationMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3EnterConfigurationMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterConfigurationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the importer needs to change <a href="#structuralParameter"><code>structural parameters</code></a>, it must move the FMU into <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> using <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3GetNumberOfContinuousStates" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3GetNumberOfContinuousStates"><code>fmi3GetNumberOfContinuousStates</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNumberOfContinuousStatesTYPE(fmi3Instance instance,
                                                       size_t* nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of <a href="#state">continuous states</a>.<br>
This function can only be called in Model Exchange.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>nContinuousStates</code> points to the <code>size_t</code> variable that will receive the number of <a href="#state">states</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The number of <a href="#state">continuous states</a> can change during simulation if they are an array with a <code>&lt;Dimension&gt;</code> depending on one or more <a href="#structuralParameter"><code>structural parameters</code></a>.
This dependency is defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file by the <code>&lt;Dimension&gt;</code> element pointing to a <a href="#structuralParameter"><code>structuralParameter</code></a>.
<a href="#fmi3GetNumberOfContinuousStates"><code>fmi3GetNumberOfContinuousStates</code></a> must be called after such <a href="#structuralParameter"><code>structural parameters</code></a> changed.<br>
As long as no <a href="#structuralParameter"><code>structural parameters</code></a> changed, the number of states is given in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>, alleviating the need to call this function.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3GetNumberOfEventIndicators" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3GetNumberOfEventIndicators"><code>fmi3GetNumberOfEventIndicators</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNumberOfEventIndicatorsTYPE(fmi3Instance instance,
                                                      size_t* nEventIndicators);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of <a href="#state-event">event indicators</a>.<br>
This function can only be called in Model Exchange.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>nEventIndicators</code> points to the <code>size_t</code> variable that will receive the number of event indicators.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The number of <a href="#state-event">event indicators</a> can change during simulation if they are an array with a <code>&lt;Dimension&gt;</code> depending on one or more <a href="#structuralParameter"><code>structural parameters</code></a>.
This dependency is defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file by the <code>&lt;Dimension&gt;</code> element pointing to a <a href="#structuralParameter"><code>structuralParameter</code></a>.
<a href="#fmi3GetNumberOfEventIndicators"><code>fmi3GetNumberOfEventIndicators</code></a> must be called after such <a href="#structuralParameter"><code>structural parameters</code></a> changed.<br>
As long as no <a href="#structuralParameter"><code>structural parameters</code></a> changed, the number of event indicators is given in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>, alleviating the need to call this function.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3EnterInitializationMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3EnterInitializationMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterInitializationModeTYPE(fmi3Instance instance,
                                                   fmi3Boolean toleranceDefined,
                                                   fmi3Float64 tolerance,
                                                   fmi3Float64 startTime,
                                                   fmi3Boolean stopTimeDefined,
                                                   fmi3Float64 stopTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changes state to <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="toleranceDefined"></a><code>toleranceDefined</code> and</p>
</li>
<li>
<p><a id="tolerance"></a><code>tolerance</code> depend on the interface type:</p>
<div class="ulist">
<ul>
<li>
<p>Model Exchange: If <a href="#toleranceDefined"><code>toleranceDefined == fmi3True</code></a>, then the model is called with a numerical integration scheme where the step size is controlled by using <a href="#tolerance"><code>tolerance</code></a> for error estimation (usually as relative tolerance).
In such a case all numerical algorithms used inside the model (for example, to solve non-linear algebraic equations) should also operate with an error estimation of an appropriate smaller relative tolerance.</p>
</li>
<li>
<p>Co-Simulation: If <a href="#toleranceDefined"><code>toleranceDefined == fmi3True</code></a>, then the communication step size of the FMU is controlled by error estimation.
In case the FMU utilizes a numerical integrator with variable step size and error estimation, it is suggested to use <a href="#tolerance"><code>tolerance</code></a> for the error estimation of the integrator (usually as relative tolerance).<br>
An FMU for Co-Simulation might ignore this argument.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="startTime"></a><code>startTime</code> and</p>
</li>
<li>
<p><a id="stopTime"></a><code>stopTime</code> can be used to check whether the model is valid within the given boundaries, or to allocate the necessary memory for storing results.
<a href="#startTime"><code>startTime</code></a> is the <a href="#fixed"><code>fixed</code></a> <a href="#initial"><code>initial</code></a> value of the <a href="#independent"><code>independent</code></a> variable and inherits its unit.</p>
<div class="paragraph">
<p><em>[It is defined with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a> in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</em>
<em>If the <a href="#independent"><code>independent</code></a> variable is <code>time</code>, <a href="#startTime"><code>startTime</code></a> is the starting time of initialization.]</em></p>
</div>
</li>
<li>
<p><a id="stopTimeDefined"></a> If <code>stopTimeDefined == fmi3True</code>, then <a href="#stopTime"><code>stopTime</code></a> is the final value of the <a href="#independent"><code>independent</code></a> variable and inherits its unit.
If the environment tries to compute past <a href="#stopTime"><code>stopTime</code></a>, the FMU has to return <a href="#fmi3Error"><code>fmi3Status == fmi3Error</code></a>.
If <a href="#stopTimeDefined"><code>stopTimeDefined == fmi3False</code></a>, then no final value of the <a href="#independent"><code>independent</code></a> variable is defined and argument <a href="#stopTime"><code>stopTime</code></a> is meaningless.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="InitializationMode">2.3.1.2. State: Initialization Mode</h5>
<div class="paragraph">
<p>The <a href="#InitializationMode"><strong>Initialization Mode</strong></a> is used by the simulation algorithm to compute consistent initial conditions for the overall system.
Equations are active to determine the initial FMU state, as well as all <a href="#output"><code>outputs</code></a> (and optionally other variables exposed by the exporting tool).
Artificial or real algebraic loops over connected FMUs in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> may be handled by using appropriate numerical algorithms.</p>
</div>
<div class="paragraph">
<p>In <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, the FMU computes initial values at the start time \(\mathbf{t}_\mathit{start}\) using function \(\mathbf{f}_\mathit{init}\), not present in the other modes, for example, equations to define the <a href="#start"><code>start</code></a> value for a <a href="#state"><code>state</code></a> or for the derivative of a <a href="#state"><code>state</code></a>.</p>
</div>
<table id="table-math-initializationMode" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{\mathit{initial=exact}}\)<br>
<em>[<a href="#parameter"><code>parameters</code></a> \(\mathbf{p}\) and
continuous-time <a href="#state"><code>states</code></a> \(\mathbf{x}_{c,\mathit{initial=exact}}\) are included here]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time <a href="#input"><code>inputs</code></a>  \(\mathbf{u}_{c+d}(\mathbf{t}_{start})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{x}_{c+d}, ^{\bullet}\mathbf{x}_d, \mathbf{z}, \mathbf{r}, \mathbf{w}_{c+d}, \mathbf{b}, \mathbf{T}_{\mathit{shift}}, \mathbf{T}_\mathit{interval}) := \mathbf{f}_{\mathit{init}}(\mathbf{u}_{c+d}, \mathbf{t}_{start}, \mathbf{v}_{\mathit{initial=exact}})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Get{VariableType}</code>, <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a>, <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>, <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>, <a href="#fmi3GetShift"><code>fmi3GetShift</code></a>, <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Evaluate \(\mathbf{f}_{\mathit{init}}\), if no <code>fmi3GetXXX</code> function was called</p>
</li>
<li>
<p>Deactivate initialization equations \(\mathbf{f}_{\mathit{init}}\)</p>
</li>
<li>
<p>Update previous values of <a href="#buffers">buffers</a>: \({}^\bullet\mathbf{b}:=\mathbf{b}\)</p>
</li>
<li>
<p>Model Exchange:</p>
<div class="ulist">
<ul>
<li>
<p>Activate event equations \(\mathbf{f}_{\mathit{event}}\)</p>
</li>
<li>
<p>\(\mathbf{t}:=(\mathbf{t}_{\mathit{start}}, 0)\)</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <code>fmi3Set{VariableType}</code></dt>
<dd>
<p>This function can be called for variables with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> and with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selectiv-computation">computations</a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a> for Model Exchange only.</p>
</dd>
</dl>
</div>
<div id="fmi3GetContinuousStates" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a></dt>
<dd>
<p>In Model Exchange only:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetContinuousStatesTYPE(fmi3Instance instance,
                                               fmi3Float64 continuousStates[],
                                               size_t nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the current continuous state vector.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Return argument <code>continuousStates</code> contains the values for each <a href="#state">continuous state</a> with the same convention for the order as defined for <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>.</p>
</li>
<li>
<p>Argument <code>nContinuousStates</code> is the size of the <code>continuousStates</code> vector.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a></dt>
<dd>
<p>See <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetShiftDecimal"><code>fmi3GetShiftDecimal</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetShiftFraction"><code>fmi3GetShiftFraction</code></a></dt>
<dd>
<p>See <a href="#fmi3GetShift"><code>fmi3GetShift</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a></dt>
<dd>
<p>See <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a></dt>
<dd>
<p>One of these functions must be called for all <a href="#fixed-periodic-clocks">fixed periodic clocks</a>.</p>
</dd>
</dl>
</div>
<div id="fmi3ExitInitializationMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3ExitInitializationMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ExitInitializationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Changes the state to <a href="#EventMode"><strong>Event Mode</strong></a> (ME), <a href="#StepMode"><strong>Step Mode</strong></a> (CS) or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> (SE).</p>
</div>
</div>
<div class="sect4">
<h5 id="ConfigurationMode">2.3.1.3. State: Configuration Mode</h5>
<div class="paragraph">
<p>The <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> allows setting <a href="#structuralParameter"><code>structural parameters</code></a> for example to resize array variables.
<a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> must not be called if the FMU contains no <a href="#structuralParameter"><code>structural parameter</code></a>.</p>
</div>
<table id="table-math-configurationMode" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set \(\mathbf{v}_{\mathit{causality=structuralParameter}}\)<br>
<em>[<a href="#structuralParameter"><code>structuralParameters</code></a> with</em> \(\mathbf{p}_{\mathit{variability=fixed}}\) <em>or</em> \(\mathbf{p}_{\mathit{variability=tunable}}\) <em>are included here]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resize arrays with dimensions that just changed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <code>fmi3Set{VariableType}</code></dt>
<dd>
<p>Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#fixed"><code>fixed</code></a> or <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.</p>
</dd>
</dl>
</div>
<div id="fmi3ExitConfigurationMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3ExitConfigurationMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ExitConfigurationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exits the <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> and returns to state <a href="#Instantiated"><strong>Instantiated</strong></a>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="Terminated">2.3.1.4. State: Terminated</h5>
<div class="paragraph">
<p>In this state, the final values of all variables at the final time of a simulation can be retrieved.</p>
</div>
<table id="table-math-terminated" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{x}_{c+d}, \mathbf{z}, \mathbf{w}_{c+d}) := \mathbf{f}_{\mathit{term}}({}^\bullet\mathbf{x}_{c+d}, \mathbf{u}_{c+d}, \mathbf{p}, \mathbf{t})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Get{VariableType}</code>, <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a>, <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>, <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selectiv-computation">computations</a>.
<em>[If <a href="#Terminated"><strong>Terminated</strong></a> is entered because of an <code>fmi3Error</code> return value, retrieved values should only be used for debugging purposes.]</em></p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a></dt>
<dd>
<p>No restrictions.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></dt>
<dd>
<p>Not allowed in Model Exchange.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Initialized">2.3.2. Super State: Initialized</h4>
<div class="paragraph">
<p>This super state is entered by the FMU when <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called.</p>
</div>
<table id="table-math-initialized" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate termination equations \(\mathbf{f}_{\mathit{term}}\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Terminate"><code>fmi3Terminate</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
</dl>
</div>
<div id="fmi3Terminate" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3Terminate</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3TerminateTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Changes state to <a href="#Terminated"><strong>Terminated</strong></a>.</p>
</div>
<div class="sect4">
<h5 id="EventMode">2.3.2.1. State: Event Mode</h5>
<div class="paragraph">
<p><a href="#EventMode"><strong>Event Mode</strong></a> is only available in Model Exchange and Co-Simulation.
In <a href="#EventMode"><strong>Event Mode</strong></a> all continuous-time, discrete-time equations and active model partitions are evaluated.</p>
</div>
<div class="paragraph">
<p>There are multiple kinds of events that require a transition to <a href="#EventMode"><strong>Event Mode</strong></a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#time-event">Time events</a>: The time instant of such an event is signaled to the importer by</p>
<div class="ulist">
<ul>
<li>
<p>the argument <a href="#nextEventTime"><code>nextEventTime</code></a> of <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>, or</p>
</li>
<li>
<p>the arguments of <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> and <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#state-event">State events</a></p>
</li>
<li>
<p><a href="#input-event">Input events</a></p>
</li>
<li>
<p><a href="#step-event">Step events</a></p>
</li>
<li>
<p>Co-Simulation: <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> returns with <a href="#eventEncountered"><code>eventEncountered == fmi3True</code></a> or <a href="#clocksAboutToTick"><code>clocksAboutToTick == fmi3True</code></a>.</p>
</li>
</ul>
</div>
<table id="table-math-event-mode" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 62.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{\mathit{variability == tunable}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c+d}(\mathbf{t})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Activate clocks and respective model partitions in \(\mathbf{f}_{\mathit{event}}\)</p>
</li>
<li>
<p>Deactivate clocks and</p>
<div class="ulist">
<ul>
<li>
<p>Reset respective clocked variables to their previous values: \(\mathbf{v}_{\mathit{d}} := {}^\bullet\mathbf{v}_{\mathit{d}}\)</p>
</li>
<li>
<p>Deactivate respective model partitions in \(\mathbf{f}_{\mathit{event}}\)</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetClock"><code>fmi3SetClock</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Activate output clocks and respective model partitions in \(\mathbf{f}_{\mathit{event}}\)<br></p>
</li>
<li>
<p>\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{x}_{c+d}, \mathbf{z}, \mathbf{r}, \mathbf{w}_{c+d}, \mathbf{b}, \mathbf{T}_{\mathit{next}}, \mathbf{T}_\mathit{interval}) := \mathbf{f}_{\mathit{event}}({}^\bullet\mathbf{x}_{c+d}, \mathbf{u}_{c+d}, \mathbf{p}, {}^\bullet\mathbf{b}, \mathbf{t})\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetClock"><code>fmi3GetClock</code></a>,<br>
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a>,<br>
<code>fmi3Get{VariableType}</code>,<br>
<a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a>,<br>
<a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>,<br>
<a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Evaluate \(\mathbf{f}_{\mathit{event}}\), if no <code>fmi3GetXXX</code> function was called in this instant of super-dense time</p>
</li>
<li>
<p>Update previous values of discrete states: \({}^\bullet\mathbf{x}_d:=\mathbf{x}_d\)</p>
</li>
<li>
<p>Update previous values of <a href="#buffers">buffers</a>: \({}^\bullet\mathbf{b}:=\mathbf{b}\)</p>
</li>
<li>
<p>Deactivate active clocks and respective model partitions in \(\mathbf{f}_{\mathit{event}}\)</p>
</li>
<li>
<p>Increment super-dense time: \(\mathbf{t}:=(\mathbf{t}_\mathit{R}, \mathbf{t}_\mathit{I} + 1)\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><a id="updateRelations"></a>Update previous values of <a href="#relations">relations</a>: \({}^\bullet\mathbf{r}:=\mathbf{r}\)</p>
</li>
<li>
<p>Deactivate event equations \(\mathbf{f}_\mathit{event}\)</p>
</li>
<li>
<p>Model Exchange: Activate continuous-time equations \(\mathbf{f}_\mathit{cont}\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterContinuousTimeMode"><code>fmi3EnterContinuousTimeMode</code></a>,
<a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <code>fmi3Set{VariableType}</code></dt>
<dd>
<p>This function can be called for variables with <a href="#causality"><code>causality == input</code></a> and for variables with <a href="#causality"><code>causality == parameter</code></a> and <a href="#variability"><code>variability == tunable</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selectiv-computation">computations</a>.</p>
</dd>
<dt class="hdlist1"><a id="fmi3SetClock"></a>Function <a href="#fmi3SetClock"><code>fmi3SetClock</code></a></dt>
<dd>
<p>For <a href="#inputClock"><code>input clocks</code></a>, <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> is called to set the activation status of <a href="#clock"><code>clocks</code></a> to <code>fmi3ClockActive</code> or <code>fmi3ClockInactive</code>.
During the solution of algebraic loops, the activation condition of triggered input clocks may change and therefore <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> can be called multiple times per super-dense time instant.
Only <a href="#time-based-clocks">Time-based clocks</a> must not be active for more than one call of <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> per <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</dd>
<dt class="hdlist1"><a id="fmi3GetClock"></a>Function <a href="#fmi3GetClock"><code>fmi3GetClock</code></a></dt>
<dd>
<p>is used to inquire the status of <a href="#clocks">clocks</a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a></dt>
<dd>
<p>For <a href="#clock"><code>input clocks</code></a> it is allowed to call these functions to query the next activation interval.<br>
For <a href="#changing-aperiodic-clocks">changing aperiodic clocks</a>, these functions must be called in every <a href="#EventMode"><strong>Event Mode</strong></a> where this clock was activated.<br>
For <a href="#countdown-aperiodic-clocks">countdown aperiodic clocks</a>, these functions must be called in every <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a></dt>
<dd>
<p>This function must be called if <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> returned with <a href="#valuesOfContinuousStatesChanged"><code>valuesOfContinuousStatesChanged == fmi3True</code></a>.
Can only be called in Model Exchange.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetNumberOfContinuousStates"><code>fmi3GetNumberOfContinuousStates</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3GetNumberOfEventIndicators"><code>fmi3GetNumberOfEventIndicators</code></a></dt>
<dd>
<p>Can only be called in Model Exchange.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a></dt>
<dd>
<p>When the importer converges on a solution for event handling at the current super-dense time step it calls <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> to determine if another event iteration is required (introducing a new super-dense time instant) or <a href="#EventMode"><strong>Event Mode</strong></a> can be exited.</p>
<div id="fmi3UpdateDiscreteStates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3UpdateDiscreteStatesTYPE(fmi3Instance instance,
                                             fmi3Boolean *discreteStatesNeedUpdate,
                                             fmi3Boolean *terminateSimulation,
                                             fmi3Boolean *nominalsOfContinuousStatesChanged,
                                             fmi3Boolean *valuesOfContinuousStatesChanged,
                                             fmi3Boolean *nextEventTimeDefined,
                                             fmi3Float64 *nextEventTime);</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div id="discreteStatesNeedUpdate" class="ulist">
<ul>
<li>
<p>When <code>discreteStatesNeedUpdate == fmi3True</code>, the importer must stay in <a href="#EventMode"><strong>Event Mode</strong></a> for another event iteration.</p>
</li>
</ul>
</div>
<div id="terminateSimulationUDS" class="ulist">
<ul>
<li>
<p>When <a href="#terminateSimulationUDS"><code>terminateSimulation == fmi3True</code></a>, the FMU requests to stop the simulation and the importer must call <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>.</p>
</li>
</ul>
</div>
<div id="nominalsOfContinuousStatesChanged" class="ulist">
<ul>
<li>
<p>If argument <code>nominalsOfContinuousStatesChanged == fmi3True</code>, then at least one nominal value of the <a href="#state"><code>states</code></a> has changed and can be inquired with <a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a>.<br>
This argument is only valid in Model Exchange.</p>
</li>
</ul>
</div>
<div id="valuesOfContinuousStatesChanged" class="ulist">
<ul>
<li>
<p>If argument <code>valuesOfContinuousStatesChanged == fmi3True</code>, then at least one continuous state has changed its value.<br></p>
</li>
</ul>
</div>
<div id="state" class="paragraph">
<p>The new values of the <a href="#state"><code>states</code></a> can be inquired with <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a> or individually for each state for which <a href="#reinit"><code>reinit = true</code></a> by calling <code>fmi3GetFloat64</code>.<br>
This argument is only valid in Model Exchange.</p>
</div>
<div id="nextEventTimeDefined" class="ulist">
<ul>
<li>
<p>When <a href="#nextEventTimeDefined"><code>nextEventTimeDefined == fmi3True</code></a>, the next time event is known and <a href="#nextEventTime"><code>nextEventTime</code></a> has a valid value.</p>
</li>
</ul>
</div>
<div id="nextEventTime" class="ulist">
<ul>
<li>
<p>The return argument <a href="#nextEventTime"><code>nextEventTime</code></a> contains the absolute time of the next time event \(\mathbf{T}_\mathit{next}\) if <a href="#nextEventTimeDefined"><code>nextEventTimeDefined == fmi3True</code></a>.
The importer must compute up to <a href="#nextEventTime"><code>nextEventTime</code></a> (or if needed slightly further) and then enter <a href="#EventMode"><strong>Event Mode</strong></a> using <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> with argument <a href="#timeEvent"><code>timeEvent == fmi3True</code></a>.
The FMU must handle this time event at the first call to <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> with <a href="#timeEvent"><code>timeEvent == fmi3True</code></a> at or after <a href="#nextEventTime"><code>nextEventTime</code></a>.<br>
<em>[This might be needed if, for example, the time resolution of the importer does not allow hitting the precise <a href="#nextEventTime"><code>nextEventTime</code></a>.</em>
<em>If the time offset proves to be too large, the FMU could issue a log message and return fmi3Error.</em>
<em>The user can improve time settings of the importer to alleviate the issues.]</em><br>
If another (e.g. <a href="#state-event">state event</a>) event happens before that <a href="#nextEventTime"><code>nextEventTime</code></a>, the previous definition of <a href="#nextEventTime"><code>nextEventTime</code></a> becomes obsolete.</p>
</li>
</ul>
</div>
<div id="dummy1" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a></dt>
<dd>
<p><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> changes state to <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> in Model Exchange.
<a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> must not be called if the FMU contains no <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a> (i.e. with <a href="#causality"><code>causality</code></a>= <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>).</p>
</dd>
</dl>
</div>
<div id="fmi3EnterContinuousTimeMode" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3EnterContinuousTimeMode"><code>fmi3EnterContinuousTimeMode</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterContinuousTimeModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function must be called to change from <a href="#EventMode"><strong>Event Mode</strong></a> into <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> in Model Exchange.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3EnterStepMode" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterStepModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function must be called to change from <a href="#EventMode"><strong>Event Mode</strong></a> into <a href="#StepMode"><strong>Step Mode</strong></a> in Co-Simulation.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="ReconfigurationMode">2.3.2.2. State: Reconfiguration Mode</h5>
<div class="paragraph">
<p>The <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> allows setting <a href="#structuralParameter"><code>structural parameters</code></a> for example to resize array variables.
This state must not be entered, if the FMU contains no <a href="#structuralParameter"><code>structural parameters</code></a>.</p>
</div>
<table id="table-math-reconfigurationMode" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set \(\mathbf{v}_{\mathit{causality=structuralParameter}}\)<br>
<em>[<a href="#structuralParameter"><code>structuralParameters</code></a> with</em> \(\mathbf{p}_{\mathit{variability=tunable}}\) <em>are included here]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resize arrays with dimensions that just changed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a></dt>
<dd>
<p><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a> returns back to <a href="#EventMode"><strong>Event Mode</strong></a> (ME), <a href="#StepMode"><strong>Step Mode</strong></a> (CS) or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> (SE).</p>
</dd>
<dt class="hdlist1">Function <code>fmi3Set{VariableType}</code></dt>
<dd>
<p>Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="IntermediateUpdateMode">2.3.3. State: Intermediate Update Mode</h4>
<div class="paragraph">
<p>This state is only available in Co-Simulation and Scheduled Execution.</p>
</div>
<div class="paragraph">
<p><em>[The following use cases are enabled:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Access to intermediate variables enables advanced Co-Simulation with interpolation/extrapolation techniques (such as polynomial extrapolation, Transmission Line Modeling (TLM) co-simulation, anti-alias filtering, smoothing of input among others).</em></p>
</li>
<li>
<p><em><a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> enables the same input approximation that was possible in FMI 2.0 with <code>fmi2SetInputDerivatives</code>, by evaluation of the approximation polynomial by the importer and not within the FMU as in FMI 2.0</em></p>
</li>
<li>
<p><em>FMUs can inform the importer about an event, which occurs during an <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> in case of CS (see <a href="#fmi-for-co-simulation">Section 4</a>).</em></p>
</li>
<li>
<p><em>The Co-Simulation algorithm can request an <a href="#early-return">early return</a> from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, because of an event between communication points (see <a href="#early-return">Section 4.1.2</a>).</em></p>
</li>
<li>
<p><em>A model partition of a Scheduled Execution FMU calls <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> to signal clock activations with <code>clocksTicked == fmi3True</code>.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Note that the call to <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> and thus entering the <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> can only be triggered by the FMU itself.</em>
<em>The importer cannot actively trigger this and hence for some use cases (e.g. cooperative multitasking and setting of intermediate input values) it relies on the callbacks from the FMUs to be able to realize these use cases properly.]</em></p>
</div>
<div class="paragraph">
<p>A Co-Simulation FMU can provide values for its <a href="#output"><code>output</code></a> variables at intermediate points between two consecutive communication points, and is able to receive new values for <a href="#input"><code>input</code></a> variables at these intermediate points.
This is typically required when the FMU uses a numerical solver to integrate the FMU&#8217;s internal state between communication points in <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.
This numerical solver assumes that the inputs are continuous in the integration interval, dictated by <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.
In FMI 2.0 Co-simulation, the intermediate inputs are provided by the use of extrapolations.
The intermediate update functions allow FMUs to receive inputs, and provide outputs, directly to the co-simulation algorithm, in those intermediate time points.</p>
</div>
<div class="paragraph">
<p>Intermediate values for <a href="#continuous"><code>continuous</code></a> inputs are computed by the importer for example by an extrapolation polynomial build with the output derivatives of connected FMUs.
FMUs can signal with the optional attribute <a href="#recommendedIntermediateInputSmoothness"><code>recommendedIntermediateInputSmoothness</code></a> of value \(k\) to the co-simulation algorithm that best convergence rates can be achieved if these approximation functions are of smoothness \(C^{k}([\mathbf{t}_i, \mathbf{t}_{i+1}])\), that is k-time continuously differentiable, with \(C^{0}\) meaning continuous.<br>
<em>[This can increase simulation speed for higher order multi-step solvers that in this case do not have to reset at communication points.]</em></p>
</div>
<div class="paragraph">
<p>The importer must ensure that the input approximation function \(\mathbf{u}_u\) is consistent with the values of the input variable (\(\mathbf{u}_u(\mathbf{t}_{i+1})= \mathbf{u}(\mathbf{t}_{i+1})\)).</p>
</div>
<div class="paragraph">
<p>Due to the way numerical solvers estimate and correct the approximation error, these intermediate <a href="#output"><code>output</code></a> values may be tentative or may be final.
It is possible for the FMU to inform the co-simulation algorithm whether the internal solver is in a tentative state, meaning that the output values computed from that state are also tentative, or if the internal solver has successfully completed the integration step, meaning that the FMU&#8217;s internal state is final, and will never be changed in the current execution of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.
If the internal integration step has been successfully completed, the co-simulation algorithm can forward intermediate outputs to other FMUs, where they can be used, for e.g., for extrapolation, interpolation, filtering or asynchronous co-simulation.</p>
</div>
<div class="paragraph">
<p><a href="#figure-IntermediateUpdateMode">Figure 5</a> summarizes the above description.
It illustrates multiple intermediate internal solver steps, distinguishing between the final ones (with black-filled circles) and tentative ones (with white-filled circles).
It distinguishes the level of trust that can be placed in the tentative outputs (with dashed arrows) and in final outputs (with solid arrows).</p>
</div>
<div id="figure-IntermediateUpdateMode" class="imageblock text-center">
<div class="content">
<img src="images/intermediateupdate.svg" alt="intermediateupdate" width="65%">
</div>
<div class="title">Figure 5. Overview of solver states and intermediate update during a communication step</div>
</div>
<div class="paragraph">
<p>The FMU signals the support of <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> via the capability flag <a href="#providesIntermediateUpdate"><code>providesIntermediateUpdate</code></a>.
The co-simulation algorithm signals the support for <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> by providing a non-NULL callback-function pointer for <a href="#fmi3CallbackIntermediateUpdate"><code>intermediateUpdate</code></a>.</p>
</div>
<div class="paragraph">
<p>The FMU enters <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> by calling <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> within <a href="#StepMode"><strong>Step Mode</strong></a> (CS) or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> (SE) and leaves the state towards <a href="#StepMode"><strong>Step Mode</strong></a> (CS) or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> (SE) when the function returns.</p>
</div>
<div id="fmi3CallbackIntermediateUpdate" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void (*fmi3CallbackIntermediateUpdate) (
    fmi3InstanceEnvironment instanceEnvironment,
    fmi3Float64 intermediateUpdateTime,
    fmi3Boolean clocksTicked,
    fmi3Boolean intermediateVariableSetRequested,
    fmi3Boolean intermediateVariableGetAllowed,
    fmi3Boolean intermediateStepFinished,
    fmi3Boolean canReturnEarly,
    fmi3Boolean *earlyReturnRequested,
    fmi3Float64 *earlyReturnTime);</code></pre>
</div>
</div>
<div id="intermediateUpdateTime" class="ulist">
<ul>
<li>
<p><a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> is the internal value of the <a href="#independent"><code>independent</code></a> variable <em>[typically simulation time]</em> of the FMU at which the callback has been called for intermediate and final steps.
If an event happens or an <a href="#outputClock"><code>output clock</code></a> ticks, <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> is the time of event or <a href="#outputClock"><code>output clock</code></a> tick.
In Co-Simulation, <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> is restricted by the arguments to <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> as follows:<br>
<a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> \(\leq\) <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> \(\leq\) (<a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> + <a href="#communicationStepSize"><code>communicationStepSize</code></a>).<br>
The FMU must not call the callback function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> with an <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> that is smaller than the <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> given in a previous call of <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> with <code>intermediateStepFinished == fmi3True</code>.</p>
</li>
</ul>
</div>
<div id="clocksTicked" class="ulist">
<ul>
<li>
<p>The <a href="#clocksTicked"><code>clocksTicked</code></a> parameter is only used in Scheduled Execution and is ignored in Co-Simulation.
When <a href="#clocksTicked"><code>clocksTicked == fmi3True</code></a>, it means that <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> function must be called for gathering all <a href="#clock"><code>clock</code></a> related information about ticking <a href="#outputClock"><code>output clocks</code></a> and then activate the given model partitions accordingly.<br>
<em>[In Co-Simulation, the FMU must return from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with <a href="#clocksAboutToTick"><code>clocksAboutToTick == fmi3True</code></a> in this case.]</em></p>
</li>
</ul>
</div>
<div id="intermediateVariableSetRequested" class="ulist">
<ul>
<li>
<p>If <a href="#intermediateVariableSetRequested"><code>intermediateVariableSetRequested == fmi3True</code></a>, the co-simulation algorithm may provide intermediate values for continuous <a href="#input"><code>input</code></a> variables with <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a> by calling <code>fmi3Set{VariableType}</code>.
The set of variables for which the co-simulation algorithm will provide intermediate values is declared through the <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> argument to <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a>.
If a co-simulation algorithm does not provide a new value for any of the variables contained in the set it registered, the last value set remains.</p>
</li>
</ul>
</div>
<div id="intermediateVariableGetAllowed" class="ulist">
<ul>
<li>
<p>If <a href="#intermediateVariableGetAllowed"><code>intermediateVariableGetAllowed == fmi3True</code></a>, the co-simulation algorithm may collect intermediate output variables by calling <code>fmi3Get{VariableType}</code> for variables with <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a>.
The set of variables for which the co-simulation algorithm can get values is supplied through the <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> argument to <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a>.</p>
</li>
</ul>
</div>
<div id="intermediateStepFinished" class="ulist">
<ul>
<li>
<p>If <a href="#intermediateStepFinished"><code>intermediateStepFinished == fmi3False</code></a>, the intermediate outputs of the FMU that the co-simulation algorithm inquires with <code>fmi3Get{VariableTypes}</code> resulting from tentative internal solver states and may still change for the same <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> <em>[e.g., if the solver deems the tentative state to cause a too high approximation error, it may go back in time and try to re-estimate the state using smaller internal time steps]</em>.<br>
If <a href="#intermediateStepFinished"><code>intermediateStepFinished == fmi3True</code></a>, intermediate outputs inquired by the co-simulation algorithm with <code>fmi3Get{VariableTypes}</code> correspond to accepted internal solver step.</p>
</li>
</ul>
</div>
<div id="canReturnEarly" class="ulist">
<ul>
<li>
<p>When <a href="#canReturnEarly"><code>canReturnEarly == fmi3True</code></a> the FMU signals to the co-simulation algorithm its ability to return early from the current <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.<br>
This argument is ignored in Scheduled Execution.</p>
</li>
</ul>
</div>
<div id="earlyReturnRequested" class="ulist">
<ul>
<li>
<p><code>earlyReturnRequested</code>: If and only if <a href="#canReturnEarly"><code>canReturnEarly == fmi3True</code></a>, the co-simulation algorithm may request the FMU to return early from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> by setting <code>earlyReturnRequested == fmi3True</code>.<br>
This argument is ignored in Scheduled Execution.</p>
</li>
</ul>
</div>
<div id="earlyReturnTime" class="ulist">
<ul>
<li>
<p><code>earlyReturnTime</code> is used to signal the FMU at which time to return early from the current <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, if the return value of <a href="#earlyReturnRequested"><code>earlyReturnRequested == fmi3True</code></a>.
If the <a href="#earlyReturnTime"><code>earlyReturnTime</code></a> is greater than the last signaled <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a>, the FMU may integrate up to the time instant <a href="#earlyReturnTime"><code>earlyReturnTime</code></a>.<br>
This argument is ignored in Scheduled Execution.</p>
</li>
</ul>
</div>
<table id="table-math-intermediateUpdateMode" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Mathematical description of <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get intermediate variable values \(\mathbf{v}_u(\mathbf{t}_u)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Get{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get time derivatives of <a href="#continuous"><code>continuous</code></a> <a href="#output"><code>outputs</code></a> \(\mathbf{y}_\mathit{c,u}^{(j)}(\mathbf{t_\mathit{u}})\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Co-Simulation: Set continuous intermediate input variables \(\mathbf{u}_{\mathit{c,u}}(\mathbf{t}_u)\)</p>
</li>
<li>
<p>Scheduled Execution: Set intermediate input variables \(\mathbf{u}_u(\mathbf{t}_u)\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <code>fmi3Get{VariableType}</code></dt>
<dt class="hdlist1">Function <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></dt>
<dd>
<p>These functions can be called for intermediate variables, if <a href="#intermediateVariableGetAllowed"><code>intermediateVariableGetAllowed == fmi3True</code></a>.
Intermediate variables are variables that are marked with attribute <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a> in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> and have been included in the <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> argument to <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a>.</p>
<div class="paragraph">
<p>For details on <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a> see <a href="#getting-output-derivatives">Section 2.2.12</a>.</p>
</div>
</dd>
<dt class="hdlist1">Function <code>fmi3Set{VariableType}</code></dt>
<dd>
<p>This function can be called for intermediate input variables, if <a href="#intermediateVariableSetRequested"><code>intermediateVariableSetRequested == fmi3True</code></a>.
Intermediate input variables are input variables that are marked with attribute <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a> in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> and have been included in the <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> argument of <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a>.
In Co-Simulation, <a href="#discrete"><code>discrete</code></a> <a href="#input"><code>inputs</code></a> must not be set.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There is a defined order of calling these functions: first all <code>fmi3Get{VariableType}</code> calls must be performed, then <code>fmi3Set{VariableType}</code> may be called.<br>
<em>[This is analogous to the calling sequence of</em> <code>fmi3Get{VariableType}</code> <em>and</em> <code>fmi3Set{VariableType}</code> <em>calls at communication points.]</em></p>
</div>
<div class="paragraph">
<p>Additionally to the functions listed above, Scheduled Execution allows calling the following functions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3GetClock"><code>fmi3GetClock</code></a></dt>
<dd>
<p>The scheduling algorithm uses <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> to determine which clock is active.<br>
<em>[For efficiency, <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> should only be called if <a href="#clocksTicked"><code>clocksTicked == fmi3True</code></a>.]</em><br>
Depending on the clock activation state, the scheduling algorithm can call <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> for variables associated with the corresponding <a href="#clock"><code>clock</code></a>.
If an <a href="#outputClock"><code>output clock</code></a> with an attribute <a href="#triggeredBy"><code>triggeredBy</code></a> is active, the scheduling algorithm schedules the model partition associated with the corresponding <a href="#inputClock"><code>input clock</code></a>.<br>
For an <a href="#outputClock"><code>output clock</code></a> only the first call of <code>fmi3GetClock</code> for a specific activation of this <a href="#clock"><code>clock</code></a> signals <code>fmi3ClockActive</code>.
The FMU sets the reported activation state immediately back to <code>fmi3ClockInactive</code> for following <code>fmi3GetClock</code> calls for that <a href="#clock"><code>clock</code></a> until this <a href="#outputClock"><code>output clock</code></a> is activated again.</p>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> &amp; <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a></dt>
<dd>
<p>These function calls are allowed for <a href="#inputClock">input clocks</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>[In Scheduled Execution it cannot be determined which model partition has called <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>, because multiple model partitions can be active at the same time.</em>
<em>Since all information about which model partition to activate is coded into its corresponding clock, there is no need to know which potentially other model partition activated this clock.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fmi-description-schema">2.4. FMI Description Schema</h3>
<div id="modelDescription.xml" class="paragraph">
<p>All static information related to the core functionality of an FMU is stored in the text file <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> in XML format as specified by the XML schema file <code>fmi3ModelDescription.xsd</code>.
Especially, the FMU variables and their attributes such as <code>name</code>, <code>unit</code>, default <a href="#initial"><code>initial</code></a> value, etc. are stored in this file.</p>
</div>
<div class="paragraph">
<p>Additional optional information about the graphical representation and the grouping of FMU variables into terminals is stored in the optional text file <code>icons/terminalsAndIcons.xml</code> in XML format as specified by the XML schema file <code>fmi3TerminalsAndIcons.xsd</code>.</p>
</div>
<div class="paragraph">
<p>Build information for source code FMUs is provided together with a <code>buildDescription.xml</code> file in the <code>sources</code> directory that adheres to the <code>fmi3BuildDescription.xsd</code> schema file.</p>
</div>
<div class="paragraph">
<p>It is not allowed to change the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file.
<em>[Reason: The <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file has to be consistent with the binary or source code implementations.</em>
<em>Specifically, changes to the start values are not allowed.]</em></p>
</div>
<div class="paragraph">
<p>The structure of the XML files is defined with the schema file <code>fmi3ModelDescription.xsd</code> and the optional <code>fmi3TerminalsAndIcons.xsd</code> and <code>fmi3BuildDescription.xsd</code> files.
These schema files utilize several helper schema files.</p>
</div>
<div class="paragraph">
<p>In this section these schema files are discussed.
The normative definition are the above mentioned schema files.
In the graphical representation of the schema, optional elements are marked with a dashed box (e.g., see <a href="#figure-schema-Annotations">Figure 6</a>).
The required data types (like: <code>xs:normalizedString</code>) are defined in <a href="https://www.w3.org/TR/xmlschema-2/">XML Schema Part 2: Datatypes Second Edition</a>.
The types used in the FMI schema files are:</p>
</div>
<table id="table-types-in-schema" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Types used in the FMI 3.0 schema files.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 16.6666%;">
<col style="width: 16.6668%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description (<a href="http://www.w3.org/TR/xmlschema-2/" class="bare">http://www.w3.org/TR/xmlschema-2/</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mapping to C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mapping to FMI 3.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE 754 double-precision 64-bit floating point type <em>[An IEEE 754 double-precision floating point value can have up to 17 significant digits in its decimal representation.
In order to not loose precision, either an appropriate minimal printer algorithm should be used, or alternatively a number of this type should be stored in XML files with at least 17 significant digits.]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Float64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>single</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE 754 single-precision 32-bit floating point type <em>[An IEEE 754 single-precision floating point value can have up to 9 significant digits in its decimal representation.
In order to not loose precision, either an appropriate minimal printer algorithm should be used, or alternatively a number of this type should be stored in XML files with at least 9 significant digits.]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>float</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Float32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 127 and minimum value -128 (8 bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int8_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Int8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedByte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 255 and minimum value 0 (8 bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint8_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3UInt8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>short</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 32767 and minimum value -32768 (16 bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int16_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Int16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedShort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 65535 and minimum value 0 (16 bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint16_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3UInt16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 2147483647 and minimum value -2147483648 (32 bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int32_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Int32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedInt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 4294967295 and minimum value 0 (32 bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint32_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3UInt32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 9223372036854775807 and minimum value -9223372036854775808 (64 bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int64_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Int64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedLong</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 18446744073709551615 and minimum value 0 (64 bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint64_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3UInt64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean number.
Legal literals: <code>false</code>, <code>true</code>, <code>0</code>, <code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any number of characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>normalizedString</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String without carriage return, line feed, and tab characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hexBinary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary hex-encoded binary data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Binary</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date, time and time zone (for details see <a href="https://www.w3.org/TR/xmlschema-2/">XML Schema Part 2: Datatypes Second Edition</a>).
Example: <code>2002-10-23T12:00:00Z</code> (noon on October 23, 2002, Greenwich Mean Time)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tool specific</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not defined</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first line of an XML file, such as <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>, must contain the encoding scheme of the XML file.
It is required that the encoding scheme is always UTF-8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMI schema files (<code>fmi3*.xsd</code>) are also stored in UTF-8.<br>
<em>[Note that the definition of an encoding scheme is a prerequisite in order for the XML file to contain letters outside of the 7 bit ANSI ASCII character set, such as German umlauts, or Asian characters.</em>
<em>Furthermore, note the FMI calling interface requires that strings are encoded in UTF-8.</em>
<em>Since the XML files are also required to be encoded in UTF-8, string variables need not to be transformed when reading from the XML files in to C string variables.].</em></p>
</div>
<div class="paragraph">
<p><em>[Note that child information items, such as elements in a sequence are ordered lists according to document order, whereas attribute information items are unordered sets (see <a href="http://www.w3.org/TR/XML-infoset/#infoitem.element" class="bare">http://www.w3.org/TR/XML-infoset/#infoitem.element</a>).</em>
<em>The FMI schema is based on ordered lists in a sequence and therefore parsing must preserve this order.</em>
<em>For example, the information stored in <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> in <code>&lt;ModelStructure&gt;</code> is only correct if this property is fulfilled.]</em></p>
</div>
<div class="paragraph">
<p>All XML-based file formats defined in this standard allow optional <code>Annotation</code> elements to be inserted in all XML elements that represent entities of the underlying data model.
This is achieved through the <code>Annotations</code> element:</p>
</div>
<div id="figure-schema-Annotations" class="imageblock">
<div class="content">
<img src="images/schema/Annotations.png" alt="Annotations" width="80%">
</div>
<div class="title">Figure 6. Annotations Element.</div>
</div>
<div class="paragraph">
<p>Each <code>Annotation</code> element contains a required <code>type</code> attribute, which contains the namespace for that annotation.
The content of the <code>Annotation</code> element can be arbitrary XML data, and can make use of XML namespaces and XML schemas for combined validation where appropriate.</p>
</div>
<div class="paragraph">
<p>The namespace mechanism for the <code>type</code> attribute is based on reverse domain notation:
The originator of a specification for additional data specifies a domain name under their control as the namespace for the additional data, in order to avoid conflicts due to name collisions.
The namespace is used in reverse domain notation.
All namespaces under both the <code>org.modelica</code> and <code>org.fmi-standard</code> domains are reserved for use in future layered standards.</p>
</div>
<div class="paragraph">
<p><em>[For example, extensions defined by the Modelica Association might make use of the <code>org.modelica.fmi</code> namespace.</em>
<em>This could lead to annotations with a <code>type</code> attribute of <code>org.modelica.fmi.something</code>, and/or extra files under the <code>extra/org.modelica.ssp.something</code> sub-directory.]</em></p>
</div>
<div class="paragraph">
<p>Annotations are intended to allow structured extensions of the FMI XML files, without creating conflicting extensions, or leaving ambiguities in interpretation.
All annotations can safely be ignored by implementations that just implement the base FMI standard.</p>
</div>
<div class="sect3">
<h4 id="fmiModelDescription">2.4.1. Definition of an FMU</h4>
<div class="paragraph">
<p>This is the root-level schema file and is illustrated in <a href="#system_overview">Figure 7</a>.
The figure contains all elements in the schema file.
Data is defined by attributes to these elements.</p>
</div>
<div id="system_overview" class="imageblock">
<div class="content">
<img src="images/schema/fmiModelDescription.png" alt="fmiModelDescription" width="70%">
</div>
<div class="title">Figure 7. fmiModelDescription element.</div>
</div>
<div class="paragraph">
<p>On the top level, the schema consists of the elements detailed in <a href="#table-schema-fmiModelDescription">Table 13</a>.
<em>[If an optional element is present and defines a list (such as <code>&lt;UnitDefinitions&gt;</code>), the list must have at least one element (such as <code>&lt;Unit&gt;</code>).]</em></p>
</div>
<table id="table-schema-fmiModelDescription" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. fmiModelDescription element details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;ModelExchange&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Model Exchange (<a href="#fmi-for-model-exchange">Section 3</a>) <em>[(in other words, the FMU includes the model or the communication to a tool that provides the model, and the environment provides the simulation engine)]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;CoSimulation&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Co-Simulation (<a href="#fmi-for-co-simulation">Section 4</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;ScheduledExecution&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Scheduled Execution (<a href="#fmi-for-scheduled-execution">Section 5</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;UnitDefinitions&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of unit and display unit definitions <em>[for example, used to convert display units into the units used in the model equations]</em>.
These definitions are used in the XML element <code>&lt;ModelVariables&gt;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;TypeDefinitions&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of type definitions that are utilized in <code>&lt;ModelVariables&gt;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;LogCategories&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of log categories that can be set to define the log information that is supported from the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;DefaultExperiment&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Providing default settings for the integrator, such as stop time and relative tolerance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;ModelVariables&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The central FMU data structure defining all variables of the FMU that are visible/accessible via the FMU functions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;ModelStructure&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the structure of the model.
Especially, the ordered lists of <a href="#output"><code>outputs</code></a>, continuous-time <a href="#state"><code>states</code></a>, initial unknowns (the unknowns during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>) and the event indicators are defined here.
For more details on <code>&lt;ModelStructure&gt;</code>, see <a href="#ModelStructure">Section 2.4.8</a>.
Furthermore, the dependency of the unknowns from the knowns can be optionally defined for <a href="#output"><code>outputs</code></a>, continuous-time <a href="#state"><code>states</code></a> and initial unknowns.
<em>[This information can be, for example, used to compute efficiently a sparse Jacobian for simulation, or to utilize the <a href="#input"><code>input</code></a> / <a href="#output"><code>output</code></a> dependency in order to detect that in some cases there are actually no algebraic loops when connecting FMUs together]</em>.
Dependencies for event indicators are not provided.
<em>[The calculation of derivatives of event indicators is not provided.]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;Annotations&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional annotations for the top-level element.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At least one element of <code>&lt;ModelExchange&gt;</code>, <code>&lt;CoSimulation&gt;</code> or <code>&lt;ScheduledExecution&gt;</code> must be present to identify the type of the FMU.
If multiple elements are defined, different types of models are included in the FMU.
The details of these elements are defined in <a href="#fmi-for-model-exchange">Section 3</a>, <a href="#fmi-for-co-simulation">Section 4</a> or <a href="#fmi-for-scheduled-execution">Section 5</a>.</p>
</div>
<div class="paragraph">
<p>The XML attributes of <code>&lt;fmiModelDescription&gt;</code> are:</p>
</div>
<table id="table-schema-fmiModelDescription-attributes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. fmiModelDescription attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of FMI that was used to generate the XML file.
The value for this version is <code>3.0</code>.
Future minor revisions are denoted as <code>3.1</code>, <code>3.2</code> &#8230;&#8203;</p>
<p class="tableblock"><em>[During development prototype FMU implementations can indicate compliance with a certain development version based on the tags available at <a href="https://github.com/modelica/fmi-standard/tags" class="bare">https://github.com/modelica/fmi-standard/tags</a>.</em>
<em>For example the value for the FMI 3.0 Alpha 2 release is <code>3.0-alpha.2</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the model as used in the modeling environment that generated the XML file, such as <code>Modelica.Mechanics.Rotational.Examples.CoupledClutches</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="instantiationToken"></a><code>instantiationToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="#instantiationToken"><code>instantiationToken</code></a> is a string that can be used by the FMU to check that the XML file is compatible with the implementation of the FMU.
For this purpose the importing tool must pass the <a href="#instantiationToken"><code>instantiationToken</code></a> from the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> to the <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a> function call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with a brief description of the model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>author</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with the name and organization of the model author.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional version of the model <em>[for example <code>1.0</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>copyright</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property copyright for this FMU <em>[for example <code>&#169; My Company 2011</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>license</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property licensing
for this FMU <em>[for example <code>BSD license &lt;license text or link to license&gt;</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional name of the tool that generated the XML file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationDateAndTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional date and time when the XML file was generated.
The format is a subset of <code>dateTime</code> and should be: <code>YYYY-MM-DDThh:mm:ssZ</code> (with one <code>T</code> between date and time; <code>Z</code> characterizes the Zulu time zone, in other words, Greenwich meantime) <em>[for example <code>2009-12-08T14:33:22Z</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="variableNamingConvention"></a><a href="#variableNamingConvention"><code>variableNamingConvention</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines whether the variable names in <code>&lt;ModelVariables&gt;</code> and in <code>&lt;TypeDefinitions&gt;</code> follow a particular convention.
For the details, see <a href="#namingSection">Section 2.4.7.1</a>.
Currently standardized are:</p>
<p class="tableblock"><code>= flat</code>: A list of strings (the default).</p>
<p class="tableblock"><code>= structured</code>: Hierarchical names with <code>.</code> as hierarchy separator, and with array elements and derivative characterization.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="common-capability-flags">2.4.2. Definition of Capability Flags</h4>
<div class="paragraph">
<p>The elements <code>&lt;ModelExchange&gt;</code>, <code>&lt;CoSimulation&gt;</code> and <code>&lt;ScheduledExecution&gt;</code> contain attributes representing capability flags describing which optional functionalities the FMU supports.</p>
</div>
<div class="paragraph">
<p>The following table contains capability flags common to all three interface types.</p>
</div>
<table id="table-common-capability-flags" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Common capability flags.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>needsExecutionTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, a tool is needed to execute the model and the FMU just contains the communication to this tool.
<em>[Typically, this information is only utilized for information purposes.</em>
<em>For example, when loading an FMU with <code>needsExecutionTool = true</code>, the environment can inform the user that a tool has to be available on the computer where the model is instantiated.</em>
<em>The name of the tool can be taken from attribute <code>generationTool</code> in <code>&lt;fmiModelDescription&gt;</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canBeInstantiatedOnlyOncePerProcess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This flag indicates cases (especially for embedded code), where only one instance per FMU is possible (multiple instantiation is default = <code>false</code>; if multiple instances are needed and the flag <code>canBeInstantiatedOnlyOncePerProcess = true</code>, the FMUs must be instantiated in different processes).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="canGetAndSetFMUState"></a><code>canGetAndSetFMUState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can inquire the internal FMU state and can restore it.
That is, functions <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, and <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a> are supported by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="canSerializeFMUState"></a><code>canSerializeFMUState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can serialize the internal FMU state, in other words, functions <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a>, <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a>, <a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a> are supported by the FMU.
If this is the case, then flag <a href="#canGetAndSetFMUState"><code>canGetAndSetFMUState</code></a> must be <code>true</code> as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="providesDirectionalDerivatives"></a><code>providesDirectionalDerivatives</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the directional derivative of the equations can be computed with <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="providesAdjointDerivatives"></a><code>providesAdjointDerivatives</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the adjoint derivatives of the equations can be computed with <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesPerElementDependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The FMU is able to provide detailed dependency information at run time using <a href="#fmi3GetNumberOfVariableDependencies"><code>fmi3GetNumberOfVariableDependencies</code></a> and <a href="#fmi3GetVariableDependencies"><code>fmi3GetVariableDependencies</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="maxOutputDerivativeOrder"></a> <code>maxOutputDerivativeOrder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The FMU is able to provide <a href="#derivative"><code>derivatives</code></a> of <a href="#output"><code>outputs</code></a> with maximum order.
Calling of <code>fmi3GetOutputDerivatives</code> is allowed up to the order defined by <code>maxOutputDerivativeOrder</code>.
This flag is ignored in <code>ModelExchange</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="providesIntermediateUpdate"></a> <code>providesIntermediateUpdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The FMU supports <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> and will call <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>, if provided.
This flag is ignored in <code>ModelExchange</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="recommendedIntermediateInputSmoothness"></a> <code>recommendedIntermediateInputSmoothness</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value of \(k\) with \(k&gt;0\) signals to the co-simulation algorithm, that it is beneficial for the solver to receive intermediate inputs that are k-time continuously differentiable (\(C^k\)) on the current communication interval.
\(k=0\) means continuous (see <a href="#smoothness">Section 4.1.1</a>).<br>
This flag is not supported in <code>ModelExchange</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_definition_of_units">2.4.3. Definition of Units</h4>
<div class="paragraph">
<p>In this section, the units of the variables are defined.</p>
</div>
<div class="paragraph">
<p><em>[Unit support is important for technical systems since otherwise it is very easy for errors to occur.</em>
<em>Unit handling is a difficult topic, and there seems to be no method available that is really satisfactory for all applications, such as unit check, unit conversion, unit propagation or dimensional analysis.</em>
<em>In FMI, a pragmatic approach is used that takes into account that every software system supporting units has potentially its own specific technique to describe and utilize units.]</em></p>
</div>
<div class="paragraph">
<p>Element <code>&lt;fmiModelDescription&gt;&lt;UnitDefinitions&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-UnitDefinitions" class="imageblock">
<div class="content">
<img src="images/schema/UnitDefinitions.png" alt="UnitDefinitions" width="90%">
</div>
<div class="title">Figure 8. UnitDefinitions element.</div>
</div>
<div class="paragraph">
<p>It contains one or more <code>Unit</code> definitions.
If no units are defined, element <code>&lt;UnitDefinitions&gt;</code> must not be present.</p>
</div>
<div class="paragraph">
<p>The <code>name</code> of a <code>Unit</code> must be unique with respect to all other <code>&lt;Unit&gt;</code> elements.
If a variable is associated with a <code>Unit</code>, the value passed to <code>fmi3Set{VariableType}</code> (resp. retrieved with <code>fmi3Get{VariableType}</code>) has this unit.
<em>[The purpose of the name is to uniquely identify a unit and, for example, use it to display the unit in menus or in plots.</em>
<em>Since there is no standard to represent units in strings, and there are different ways how this is performed in different tools, no specific format for the string representation of the unit is required.]</em></p>
</div>
<div class="paragraph">
<p>The <code>Unit</code> definition consists of the exponents of the 7 SI base units <code>kg</code>, <code>m</code>, <code>s</code>, <code>A</code>, <code>K</code>, <code>mol</code>, <code>cd</code>, the exponent of the SI derived unit <code>rad</code>, and optionally a <code>factor</code> and an <code>offset</code>.
<em>[The additional <code>rad</code> base unit helps to handle the often occurring quantities in technical systems that depend on an angle.]</em></p>
</div>
<div id="figure-schema-BaseUnit" class="imageblock text-center">
<div class="content">
<img src="images/schema/BaseUnit.png" alt="BaseUnit" width="50%">
</div>
<div class="title">Figure 9. BaseUnit element.</div>
</div>
<div class="paragraph">
<p>A value \(v_{unit}\) in <code>Unit</code> is converted to the base unit \(v_{base}\) by the equation</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{base} = \texttt{factor} * v_{unit} + \texttt{if relativeQuantity then 0 else offset}\]
</div>
</div>
<div class="paragraph">
<p>where <code>factor</code> and <code>offset</code> are attributes of the <code>&lt;BaseUnit&gt;</code>, and  <code>relativeQuantity</code> an attrinbute of the <code>TypeDefinition</code> of a variable.</p>
</div>
<div class="paragraph">
<p><em>[For example, if</em> \({p_{\mathit{bar}}}\) <em>is a pressure value in unit <code>bar</code>, and</em> \({p_{\mathit{Pa}}}\) <em>is the pressure value in <code>&lt;BaseUnit&gt;</code>, then</em></p>
</div>
<div class="stemblock">
<div class="content">
\[{p_{\mathit{Pa}} = 10^5 p_{\mathit{bar}}}\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.0e5</code> and <code>offset = 0.0</code>.</em></p>
</div>
<div class="paragraph">
<p><em>In the following table several unit examples are given.</em>
<em>Note that if in column <code>exponents</code> the definition</em> \(\frac{kg \cdot m^2}{s^2}\) <em>is present, then the attributes of <code>&lt;BaseUnit&gt;</code> are  <code>kg=1, m=2, s=-2</code>.</em></p>
</div>
<table id="table-unit-examples" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Unit examples.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Quantity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Unit.name<br>
(examples)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Unit.BaseUnit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exponents</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">factor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Torque</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>N.m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Energy</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>J</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Pressure</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({\frac{kg}{m \cdot s^2}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0e5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Angle</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.01745329251994330 (= pi/180)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.1047197551196598 (= 2*pi/60)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Frequency</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Hz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6.283185307179586 (= 2*pi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Temperature</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#176;F</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>K</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.5555555555555556 (= 5/9)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.3722222222222 (= 273.15-32*5/9)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Per cent by length</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%/m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1/m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.01</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Parts per million</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ppm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0e-6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>km</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.9144</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Note that <code>Hz</code> is typically used as <code>Unit.name</code> for a frequency quantity, but it can also be used as <code>&lt;DisplayUnit&gt;</code> for an angular velocity quantity (since <code>revolution/s</code>).]</em></p>
</div>
<div class="paragraph">
<p><em>The <code>&lt;BaseUnit&gt;</code> definitions can be utilized for different purposes (the following application examples are optional and a tool may also completely ignore the <code>Unit</code> definitions):</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unit check when connecting variables of different FMUs</dt>
<dd>
<div class="paragraph">
<p><em>When only one of <a href="#input"><code>input</code></a> <code>v2</code> and <a href="#output"><code>output</code></a> <code>v1</code>, connected with equation <code>v2 = v1</code>, defines a <code>&lt;BaseUnit&gt;</code> element, <code>fmi3Get{VariableType}</code> must be used to get the value of <code>v1</code>  to then set it with <code>fmi3Set{VariableType}</code> for <code>v2</code>.</em></p>
</div>
<div class="paragraph">
<p><em>When two variables v1 and v2 are connected and for both of them <code>&lt;BaseUnit&gt;</code> elements are defined, then they must have identical exponents of their <code>&lt;BaseUnit&gt;</code>.</em>
<em>If <code>factor</code> and <code>offset</code> are also identical, again the connection equation <code>v2 = v1</code> holds.</em>
<em>If <code>factor</code> and <code>offset</code> are not identical, the tool may either trigger an error or, if supported, perform a conversion; in other words, use the connection equation (in this case the <code>relativeQuantity</code> of the <code>&lt;TypeDefinition&gt;</code>, see below, has to be taken into account in order to determine whether <code>offset</code> shall or shall not be utilized):</em></p>
</div>
<div class="paragraph">
<p><code>factor(v1) * v1 + (if relativeQuantity(v1) then 0 else offset(v1)) = factor(v2) * v2 + (if relativeQuantity(v2) then 0 else offset(v2))</code><br>
<em>where</em> <code>relativeQuantity(v1) = relativeQuantity(v2)</code> <em>is required</em>.</p>
</div>
<div class="paragraph">
<p><em>As a result, wrong connections can be detected (for example, connecting a force with an angle-based variable would trigger an error) and conversions between, say, US and SI units can be either automatically performed or, if not supported, an error is triggered as well.</em></p>
</div>
<div class="paragraph">
<p><em>This approach is not satisfactory for variables belonging to different quantities that have, however, the same <code>&lt;BaseUnit&gt;</code>, such as quantities <code>Energy</code> and <code>Torque</code>, or <code>AngularVelocity</code> and <code>Frequency</code>.</em>
<em>To handle such cases, quantity definitions have to be taken into account (see <code>&lt;TypeDefinitions&gt;</code>) and quantity names need to be standardized.</em></p>
</div>
<div class="paragraph">
<p><em>This approach allows a general treatment of units, without being forced to standardize the grammar and allowed values for units (for example, in FMI 1.0, a unit could be defined as <code>N.m</code> in one FMU and as <code>N*m</code> in another FMU, and a tool would have to reject a connection, since the units are not identical.</em>
<em>In FMI 2.0, the connection would be accepted, provided both elements have the same <code>&lt;BaseUnit&gt;</code> definition).</em></p>
</div>
</dd>
<dt class="hdlist1">Dimensional analysis of equations</dt>
<dd>
<div class="paragraph">
<p><em>In order to check the validity of equations in a modeling language, the defined units can be used for dimensional analysis, by using the <code>&lt;BaseUnit&gt;</code> definition of the respective unit.</em>
<em>For this purpose, the <code>&lt;BaseUnit&gt;</code> <code>rad</code> has to be treated as <code>1</code>.</em>
<em>Example:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
J \cdot \alpha = \tau \rightarrow [kg.m^2]*[rad/s^2] = [kg.m^2/s^2] &amp; \quad \text{// o.k. ("rad" is treated as "1")} \\
J \cdot \alpha = f \rightarrow [kg.m^2]*[rad/s^2] = [kg.m/s^2] &amp; \quad \text{// error, since dimensions do not agree}
\end{align*}\]
</div>
</div>
</dd>
<dt class="hdlist1">Unit propagation</dt>
<dd>
<div class="paragraph">
<p><em>If unit definitions are missing for variables, they might be deduced from the equations where the variables are used.</em>
<em>If no unit computation is needed, <code>rad</code> is propagated.</em>
<em>If a unit computation is needed and one of the involved units has <code>rad</code> as a <code>&lt;BaseUnit&gt;</code>, then unit propagation is not possible.</em>
<em>Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>a = b + c, and <code>Unit</code> of c is provided, but not <code>Unit</code> of a and b:</em><br>
<em>The Unit definition of <code>c</code> (in other words, <code>Unit.name</code>, <code>&lt;BaseUnit&gt;</code>, <code>&lt;DisplayUnit&gt;</code>) is also used for <code>a</code> and <code>b</code>.</em>
<em>For example, if BaseUnit(c) = <code>rad/s</code>, then BaseUnit(a) = BaseUnit(b) = <code>rad/s</code>.</em></p>
</li>
<li>
<p><em>a = b*c, and <code>Unit</code> of a and of c is provided, but not <code>Unit</code> of b:</em><br>
<em>If <code>rad</code> is either part of the <code>&lt;BaseUnit&gt;</code> of <code>a</code> and/or of <code>c</code>, then the <code>&lt;BaseUnit&gt;</code> of <code>b</code> cannot be deduced (otherwise it can be deduced).</em>
<em>Example: If <code>BaseUnit(a) = kg.m/s2</code> and <code>BaseUnit(c) = m/s2</code>, then the <code>BaseUnit(b) can be deduced to be `kg</code>.</em>
<em>In such a case <code>Unit.name</code> of b cannot be deduced from the <code>Unit.name</code> of <code>a</code> and <code>c</code>, and a tool would typically construct the <code>Unit.name</code> of <code>b</code> from the deduced <code>&lt;BaseUnit&gt;</code>.]</em></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A <code>&lt;Unit&gt;</code> can contain any number of <code>&lt;DisplayUnit&gt;</code> elements.</p>
</div>
<div id="figure-schema-DisplayUnit" class="imageblock text-center">
<div class="content">
<img src="images/schema/DisplayUnit.png" alt="DisplayUnit" width="70%">
</div>
<div class="title">Figure 10. DisplayUnit element.</div>
</div>
<div class="paragraph">
<p>A <code>&lt;DisplayUnit&gt;</code> is defined by <code>name</code>, <code>factor</code>, <code>offset</code>, and <code>inverse</code>.
The attribute <code>name</code> must be unique with respect to all other names of the <code>&lt;DisplayUnit&gt;</code> definitions of the same <code>Unit</code>.
<em>[Different <code>Unit</code> elements may have the same <code>&lt;DisplayUnit&gt;</code> names].</em><br>
<code>inverse == true</code> is only allowed if <code>offset == 0</code>.<br>
<em>[Reason: no use case is known for the combination of inverse and offset, which would also be more complicated.]</em></p>
</div>
<div class="paragraph">
<p>A value \(v_{unit}\) in <code>Unit</code> is converted to a value \(v_{display}\) in <code>DisplayUnit</code> by the equation:</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{display} =
\left\{\begin{array}{ll}
\texttt{factor} *          v_{unit}  + \texttt{offset} &amp;\text{if} \; \texttt{inverse == false} \\
\texttt{factor} * \frac{1}{v_{unit}}  &amp;\text{if} \; \texttt{inverse == true}
\end{array}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>[<code>offset</code> is needed for temperature units like <code>F</code> (Fahrenheit), <code>inverse</code> for inverse display units like <code>mpg</code> (miles per gallon) or <code>S</code> (Siemens).</em></p>
</div>
<div class="paragraph">
<p><em>For example, if \({T_K}\) is the temperature value of <code>Unit.name</code> (in <code>K</code>) and \({T_F}\) is the temperature value of <code>&lt;DisplayUnit&gt;</code> (in <code>&#176;F</code>), then</em></p>
</div>
<div class="stemblock">
<div class="content">
\[T_F = (9/5) * (T_K - 273.15) + 32\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.8 (=9/5)</code> and <code>offset = -459.67 (= 32 - 273.15*9/5)</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Both the <code>DisplayUnit.name</code> definitions as well as the <code>Unit.name</code> definitions are used in the variable elements.</em></p>
</div>
<div class="paragraph">
<p><em>Example of a definition:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;UnitDefinitions&gt;
  &lt;Unit name="rad/s"&gt;
    &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;DisplayUnit name="deg/s" factor="57.29577951308232"/&gt;
    &lt;DisplayUnit name="rev/min" factor="9.549296585513721"/&gt;
  &lt;/Unit&gt;
  &lt;Unit name="bar"&gt;
    &lt;BaseUnit kg="1" m="-1" s="-2" factor="1e5" offset="0"/&gt;
  &lt;/Unit&gt;
  &lt;Unit name="L/100km"&gt;
    &lt;BaseUnit m="2" factor="1e-8"/&gt;
    &lt;DisplayUnit name="mpg" inverse="true" factor="235.214583"/&gt;
  &lt;/Unit&gt;
  &lt;Unit name="Re"&gt;
    &lt;BaseUnit/&gt; &lt;!-- unit="1" --&gt;
                &lt;!-- (dimensionless, all exponents of BaseUnit are zero) --&gt;
  &lt;/Unit&gt;
  &lt;Unit name="Euro/PersonYear"/&gt;  &lt;!-- no mapping to BaseUnit defined --&gt;
&lt;/UnitDefinitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="definition-of-types">2.4.4. Definition of Types</h4>
<div class="paragraph">
<p>Element <code>&lt;fmiModelDescription&gt;&lt;TypeDefinitions&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-TypeDefinitions" class="imageblock text-center">
<div class="content">
<img src="images/schema/TypeDefinitions.png" alt="TypeDefinitions" width="70%">
</div>
<div class="title">Figure 11. TypeDefinitions element.</div>
</div>
<div class="paragraph">
<p>This element consists of a set of <code>&lt;TypeDefinition&gt;</code> elements according to schema <code>fmi3TypeDefinition</code> in file <code>fmi3Type.xsd</code>.
Each <code>&lt;TypeDefinition&gt;</code> has attributes <code>name</code> and <code>description</code>.
Attribute <code>name</code> must be unique with respect to all other elements of the <code>&lt;TypeDefinitions&gt;</code> list.
Furthermore, <code>name</code> of a <code>&lt;TypeDefinition&gt;</code> must be different to all <code>name</code> attributes of variables <em>[if the same names would be used, then this would nearly always give problems when importing the FMU in an environment such as Modelica, where a type name cannot be used as instance name]</em>.</p>
</div>
<div class="paragraph">
<p>Additionally, one variable type element must be present.
Each variable type has its own attributes which can be consulted in the schema.
<a href="#figure-schema-Float64Type">Figure 12</a>, <a href="#figure-schema-Int32Type">Figure 13</a>, <a href="#figure-schema-BooleanType">Figure 14</a>, <a href="#figure-schema-BinaryType">Figure 15</a>, and <a href="#figure-schema-EnumerationType">Figure 16</a>, are representative examples.</p>
</div>
<div id="figure-schema-Float64Type" class="imageblock text-center">
<div class="content">
<img src="images/schema/Float64Type.png" alt="Float64Type" width="90%">
</div>
<div class="title">Figure 12. Float64Type element.</div>
</div>
<div id="figure-schema-Int32Type" class="imageblock text-center">
<div class="content">
<img src="images/schema/Int32Type.png" alt="Int32Type" width="90%">
</div>
<div class="title">Figure 13. Int32Type element.</div>
</div>
<div id="figure-schema-BooleanType" class="imageblock text-center">
<div class="content">
<img src="images/schema/BooleanType.png" alt="BooleanType" width="90%">
</div>
<div class="title">Figure 14. BooleanType element.</div>
</div>
<div id="figure-schema-BinaryType" class="imageblock text-center">
<div class="content">
<img src="images/schema/BinaryType.png" alt="BinaryType" width="100%">
</div>
<div class="title">Figure 15. BinaryType element.</div>
</div>
<div id="figure-schema-EnumerationType" class="imageblock text-center">
<div class="content">
<img src="images/schema/EnumerationType.png" alt="EnumerationType" width="100%">
</div>
<div class="title">Figure 16. EnumerationType element.</div>
</div>
<div id="figure-schema-ClockType" class="imageblock text-center">
<div class="content">
<img src="images/schema/ClockType.png" alt="ClockType" width="100%">
</div>
<div class="title">Figure 17. ClockType element.</div>
</div>
<div class="paragraph">
<p>The type elements are referred to in variable elements to declare their type.
<em>[The alternative would be to define a type per variable.</em>
<em>However, this would lead to a situation where, e.g., the definition of a <code>Torque</code> type would have to be repeated over and over.]</em>
The attributes and elements have the following meaning:</p>
</div>
<table id="table-type-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Type element and attribute details.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute or Elements</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quantity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical quantity of the variable.
<em>[For example, <code>Angle</code>, or <code>Energy</code>.</em>
<em>The quantity names are not standardized]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit of the variable defined with attribute <code>name</code> of <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;</code> that is used for the model equations.
<em>[For example, <code>N.m</code>: in this case a <code>Unit.name = `N.m</code> must be present under <code>&lt;UnitDefinitions&gt;</code>.]</em>
<em>[Note that for variables that are without a unit, the element should not have a <code>unit</code> attribute.]</em>
<em>[Giving an empty string as a <code>unit</code> attribute specifies a valid unit that needs to be defined among the unit definitions.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="displayUnit"></a> <code>displayUnit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default display unit.
The conversion to the <code>unit</code> is defined with the element <code>&lt;fmiModelDescription&gt;&lt;UnitDefinitions&gt;</code>.
If the corresponding <code>displayUnit</code> is not defined under <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;&lt;DisplayUnit&gt;</code>, then <code>displayUnit</code> is ignored.
It is an error if <code>displayUnit</code> is defined as variable type element, but <code>unit</code> is not, or unit is not defined under <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mimeType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the type of data passed as a binary.
Defaults to <code>application/octet-stream</code>, which is unspecific.
Implementations can use this information to provide guidance to the user about valid/useful connections.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relativeQuantity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this attribute is <code>true</code>, then the <code>offset</code> of <code>BaseUnit</code> and <code>displayUnit</code> must be ignored.
<em>[For example, 10 degree Celsius = 10 Kelvin if <code>relativeQuantity = true</code> and not 283.15 Kelvin.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum value of variable (variable value \(\geq\) <code>min</code>).
If not defined, the minimum is the largest negative number that can be represented on the machine.
The <code>min</code> definition is information from the FMU to the environment defining the region in which the FMU is designed to operate, see also comment after this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum value of variable (variable value \(\leq\) <code>max</code>).
If not defined, the maximum is the largest positive number that can be represented on the machine.
The <code>max</code> definition is information from the FMU to the environment defining the region in which the FMU is designed to operate, see also comment after this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nominal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nominal value of variable.
If not defined and no other information about the nominal value is available, then <code>nominal = 1</code> is assumed.<br>
<em>[The nominal value of a variable can be, for example, used to determine the absolute tolerance for this variable as needed by numerical algorithms:</em><br>
<code>absoluteTolerance = nominal * tolerance * 0.01</code><br>
<em>where <code>tolerance</code> is, for example, the relative tolerance defined in <a href="#DefaultExperiment">Section 2.4.6</a>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unbounded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, indicates that during time integration, the variable gets a value much larger than its nominal value <code>nominal</code>.
<em>[Typical examples are the monotonically increasing rotation angles of crank shafts and the longitudinal position of a vehicle along the track in long distance simulations.</em>
<em>This information can, for example, be used to increase numerical stability and accuracy by setting the corresponding bound for the relative error to zero (relative tolerance = 0.0), if the corresponding variable is a continuous <a href="#state"><code>state</code></a> variable.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Item</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;Item&gt;</code> of an enumeration has a sequence of <code>name</code> and <code>value</code> pairs.
The values can be any integer number but must be unique within the same enumeration (in order that the mapping between <code>name</code> and <code>value</code> is bijective).
An <code>&lt;Enumeration&gt;</code> element must have at least one <code>&lt;Item&gt;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Attributes for <code>ClockType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>triggeredBy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="triggeredBy"></a>
The optional attribute <a href="#triggeredBy"><code>triggeredBy</code></a> of an <a href="#inputClock"><code>input clock</code></a> is used to define a tick relationship from this clock to a triggered <a href="#outputClock"><code>output clock</code></a>.</p>
<p class="tableblock">An <a href="#outputClock"><code>output clock</code></a> can be referenced by more than one <a href="#triggeredBy"><code>triggeredBy</code></a> attribute of <a href="#inputClock"><code>input clocks</code></a>.</p>
<p class="tableblock">This attribute is only considered in Scheduled Execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>priority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="priority"></a>
<a href="#clock"><code>Clocks</code></a> that have to be activated at the same time instant are ordered according to this attribute.
Smaller values signal higher priorities.
No ordering is defined for multiple <a href="#clock"><code>clocks</code></a> with the same <a href="#priority"><code>priority</code></a>.</p>
<p class="tableblock">This attribute is only considered in Scheduled Execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="interval"></a>
The attribute <code>interval</code> declares the clock type, see <a href="#table-overview-clocks">Table 5</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">The values of the following float and integer attributes refer to the unit of the <a href="#independent"><code>independent</code></a> variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intervalDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="intervalDecimal"></a>
The time interval \(\mathbf{T}_{interval}\) between consecutive <a href="#clock"><code>clock</code></a> ticks.</p>
<p class="tableblock">This value must be greater than 0.0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shiftDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="shiftDecimal"></a>
This value defines the delay of the first clock activation relative to \(\mathbf{t}_{\mathit{start}}\) (<a href="#startTime"><code>startTime</code></a>).</p>
<p class="tableblock">This value must be equal or greater than 0.0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>supportsFraction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="supportsFraction"></a>
This attribute defines, if the functions <code>fmi3GetXXXFraction</code> and <code>fmi3SetXXXFraction</code> are allowed to be called for all <a href="#time-based-clocks">time-based clocks</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="resolution"></a><code>resolution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instead of defining clock timing using floating point numbers, FMI allows the definition of rational numbers using <a href="#intervalCounter"><code>intervalCounters</code></a> and <a href="#shiftCounter"><code>shiftCounters</code></a>.
The <code>resolution</code> defines the minimal quanta clock timing can be resolved by.</p>
<p class="tableblock">This attribute is required for <a href="#periodic-clock-ticks">time-based periodic clocks</a> if <a href="#supportsFraction"><code>supportsFraction = true</code></a> and either <a href="#intervalCounter"><code>intervalCounter</code></a> or <a href="#shiftCounter"><code>shiftCounter</code></a> is present.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="intervalCounter"></a><code>intervalCounter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This attribute defines (together with <a href="#resolution"><code>resolution</code></a>) the interval between consecutive clock ticks:</p>
<p class="tableblock">\(\mathbf{T}_{interval} = \) <code>intervalCounter / resolution</code>.</p>
<p class="tableblock"><code>intervalCounter</code> and <code>resolution</code> have no default value.</p>
<p class="tableblock">This value must be greater than 0.</p>
<p class="tableblock">This attribute is allowed if <a href="#supportsFraction"><code>supportsFraction = true</code></a> and is required if <a href="#interval">interval == <code>constant</code></a> or <a href="#interval">interval == <code>fixed</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="shiftCounter"></a><code>shiftCounter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This value defines (together with <a href="#resolution"><code>resolution</code></a>) the delay of the first clock activation relative to \(\mathbf{t}_{\mathit{start}}\) (<a href="#startTime"><code>startTime</code></a>):</p>
<p class="tableblock">\(\mathbf{T}_{shift} = \) <code>shiftCounter / resolution</code>.</p>
<p class="tableblock">This value must be greater than 0.</p>
<p class="tableblock">This attribute is allowed if <a href="#supportsFraction"><code>supportsFraction = true</code></a> and is required if <a href="#interval">interval == <code>constant</code></a> or <a href="#interval">interval == <code>fixed</code></a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="definition-of-log-categories">2.4.5. Definition of Log Categories</h4>
<div class="paragraph">
<p>Element <code>&lt;fmiModelDescription&gt;&lt;LogCategories&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-LogCategories" class="imageblock text-center">
<div class="content">
<img src="images/schema/LogCategories.png" alt="LogCategories" width="80%">
</div>
<div class="title">Figure 18. LogCategories element.</div>
</div>
<div class="paragraph">
<p><code>&lt;LogCategories&gt;</code> defines an unordered set of category strings that can be utilized to define the log output via function <a href="#logMessage"><code>logMessage</code></a>, see <a href="#FMUStateSetable"><strong>FMU State Setable</strong></a>.
A tool is free to use any <code>normalizedString</code> for a category value.
The <code>name</code> attribute of <code>&lt;Category&gt;</code> must be unique with respect to all other elements of the <code>&lt;LogCategories&gt;</code> list.</p>
</div>
<div class="paragraph">
<p><a href="#table-standard-categories">Table 18</a> shows the standardized names for <code>&lt;Category&gt;</code>.
These names should be used if a tool supports the corresponding log category.
If a tool supports one of these log categories and wants to expose it, then an element <code>&lt;Category&gt;</code> with this name should be added to <code>&lt;LogCategories&gt;</code>.
<em>[To be clear, only the <code>&lt;Category&gt;</code> names listed under <code>&lt;LogCategories&gt;</code> in the XML file are known to the importer of the FMU.]</em></p>
</div>
<table id="table-standard-categories" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Standard names for <code>&lt;Category&gt;</code>.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logEvents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log all events (during initialization and simulation).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logSingularLinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of linear systems of equations if the solution is singular (and the tool picked one solution of the infinitely many solutions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logNonlinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of nonlinear systems of equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logDynamicStateSelection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the dynamic selection of <a href="#state"><code>states</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusWarning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <a href="#fmi3Warning"><code>fmi3Warning</code></a> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusDiscard</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <a href="#fmi3Discard"><code>fmi3Discard</code></a> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <a href="#fmi3Error"><code>fmi3Error</code></a> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusFatal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <a href="#fmi3Fatal"><code>fmi3Fatal</code></a> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log all messages.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The optional attribute <code>description</code> shall contain a description of the respective log category.
<em>[Typically, this string can be shown by a tool if more details for a log category are presented.]</em></p>
</div>
<div class="paragraph">
<p><em>[This approach to define <code>&lt;LogCategories&gt;</code> has the following advantages:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>A simulation environment can present the possible log categories in a menu and the user can select the desired one (in the FMI 1.0 approach, there was no easy way for a user to figure out from a given FMU what log categories could be provided).</em><br>
<em>Note that since element <code>&lt;LogCategories&gt;</code> is optional, an FMU does not need to expose its log categories.</em></p>
</li>
<li>
<p><em>The log output is drastically reduced, because via <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> exactly the categories are set that shall be logged and therefore the FMU only has to print the messages with the corresponding categories to the <a href="#logMessage"><code>logMessage</code></a> function.</em>
<em>In FMI 1.0, it was necessary to provide all log output of the FMU to the <a href="#logMessage"><code>logMessage</code></a> and then a filter in the <a href="#logMessage"><code>logMessage</code></a> could select what to show to the end-user.</em>
<em>The approach introduced in FMI 2.0 is therefore much more efficient.]</em></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="DefaultExperiment">2.4.6. Definition of a Default Experiment</h4>
<div class="paragraph">
<p>Element <code>&lt;fmiModelDescription&gt;&lt;DefaultExperiment&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-DefaultExperiment" class="imageblock text-center">
<div class="content">
<img src="images/schema/DefaultExperiment.png" alt="DefaultExperiment" width="60%">
</div>
<div class="title">Figure 19. DefaultExperiment element.</div>
</div>
<div class="paragraph">
<p><a id="stepSize"></a><code>&lt;DefaultExperiment&gt;</code> consists of the optional default start time, stop time, relative tolerance, and step size for the first simulation run.
A tool may ignore this information.
However, it is convenient for a user that <a href="#startTime"><code>startTime</code></a>, <a href="#stopTime"><code>stopTime</code></a>, <a href="#tolerance"><code>tolerance</code></a> and <a href="#stepSize"><code>stepSize</code></a> have already a meaningful default value for the model at hand.
Furthermore, for Co-Simulation FMUs the <a href="#stepSize"><code>stepSize</code></a> defines the preferred <a href="#communicationStepSize"><code>communicationStepSize</code></a>.
<a href="#startTime"><code>startTime</code></a>, <a href="#stopTime"><code>stopTime</code></a> and <a href="#stepSize"><code>stepSize</code></a> refer to the unit of the <a href="#independent"><code>independent</code></a> variable.</p>
</div>
</div>
<div class="sect3">
<h4 id="definition-of-model-variables">2.4.7. Definition of Model Variables</h4>
<div class="paragraph">
<p>The element of <code>&lt;fmiModelDescription&gt;&lt;ModelVariables&gt;</code> is the central part of the model description.
It provides the static information of all exposed variables and is defined as follows.</p>
</div>
<div id="figure-schema-ModelVariables" class="imageblock text-center">
<div class="content">
<img src="images/schema/ModelVariables.png" alt="ModelVariables" width="60%">
</div>
<div class="title">Figure 20. ModelVariables element.</div>
</div>
<div class="paragraph">
<p>The <code>&lt;ModelVariables&gt;</code> element consists of an ordered set of variable elements (see <a href="#figure-schema-ModelVariables">Figure 20</a>).
Variable elements can uniformly represent variables of primitive (atomic) types, like single floating point or integer variables, as well as arrays of an arbitrary (but fixed) number of dimensions.
The schema definition is present in a separate file <code>fmi3Variable.xsd</code>.</p>
</div>
<div class="paragraph">
<p>Variable elements representing array variables must contain at least one <code>&lt;Dimension&gt;</code> element.
Each <code>&lt;Dimension&gt;</code> element specifies the size of one dimension of the array:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <a href="#start"><code>start</code></a> attribute of the <code>&lt;Dimension&gt;</code> element is present, it defines a constant unsigned 64-bit integer size for this dimension.
The <a href="#variability"><code>variability</code></a> of the dimension size is <a href="#constant"><code>constant</code></a> in this case.</p>
</li>
<li>
<p>If the <a href="#valueReference"><code>valueReference</code></a> attribute of the <code>&lt;Dimension&gt;</code> element is present, it defines the size of this dimension to be the value of the variable with the value reference given by the <a href="#valueReference"><code>valueReference</code></a> attribute.
The referenced variable must be a variable of type <code>&lt;UInt64&gt;</code>, and must either be a constant (i.e. with <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>) or a <a href="#structuralParameter"><code>structural parameter</code></a>(i.e. with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a>).
The <a href="#variability"><code>variability</code></a> of the dimension size is in this case the <a href="#variability"><code>variability</code></a> of the referenced variable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two options are mutually exclusive, i.e., for each <code>&lt;Dimension&gt;</code> element either a <a href="#start"><code>start</code></a> attribute or a <a href="#valueReference"><code>valueReference</code></a> attribute can be supplied, but not both.
However different dimension sizes can be specified using different mechanisms and can have differing <a href="#variability"><code>variability</code></a> attributes.</p>
</div>
<div class="paragraph">
<p>All initial dimension sizes (i.e. prior to any configuration or reconfiguration) must be positive integers (i.e. not zero), so that no dimension is initially vanished.</p>
</div>
<div class="paragraph">
<p><em>[This allows importing tools to ignore <a href="#structuralParameter"><code>structural parameters</code></a> because that <a href="#start"><code>start</code></a> value reflects the internal default setting of that <a href="#structuralParameter"><code>structural parameter</code></a>.</em>
<em>The rationale for requiring positive start values for <a href="#structuralParameter"><code>structural parameters</code></a> is that this avoids importers having to deal with vanishing dimensions if they do not want to deal with them (or even with changing sizes at all).</em>
<em>If we allowed 0 dimension sizes for initial values, tools that do not even care about changing dimension sizes must be prepared to handle vanishing dimensions.]</em></p>
</div>
<div class="paragraph">
<p>Changes to dimension sizes are constrained by the <code>min</code>/<code>max</code> attributes of the referenced <a href="#structuralParameter"><code>structural parameters</code></a>, which can be any non-negative integer, including zero.
Specifying a minimum size of zero on a <a href="#structuralParameter"><code>structural parameter</code></a> allows any related dimension sizes to be changed to zero in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>, thus causing the respective array size to go to zero, which leaves the respective array variable without any active elements.</p>
</div>
<div class="paragraph">
<p>The actual dimension sizes of arrays are also constrained by the FMU platform, due to memory and addressing constraints:
Since the API functions to access variables and their values are constrained to <code>size_t</code> individual elements, platforms with addresses of less than 64-bit width will not be able to access elements beyond their addressing limits, neither will they be able to allocate enough memory or address space to represent such arrays.
For these reasons implementations must take platform-specific constraints into account when changing dimension sizes, and must be prepared to handle the inability of the FMU to adjust to the desired sizes during <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>Changing any dimension of a variable in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> invalidates the variable&#8217;s current value (including its <a href="#start"><code>start</code></a> value).
It should be noted that changing a <a href="#structuralParameter"><code>structural parameter</code></a> might affect dimension sizes of several variables.</p>
</div>
<div id="alias" class="paragraph">
<p>A variable can have any number of <code>&lt;Alias&gt;</code> elements that define a variable alias.
Each variable alias has a required attribute <code>name</code> whose value must be unique among all variables and variable aliases, and an optional attribute <code>description</code>.
Variable aliases of floating point variables may additionally have a <a href="#displayUnit"><code>displayUnit</code></a> that follows the same rules as for variables.</p>
</div>
<div class="paragraph">
<p><em>[ Example:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;Float64 name="engine.torque" valueReference="1" unit="N.m"&gt;
   &lt;Alias name="engine.torqueLbfFt" description="Engine torque in pound-foot"
     displayUnit="lbf.ft"/&gt;
 &lt;/Float64&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>The attributes of variables are:</p>
</div>
<div id="figure-schema-fmi3VariableBase" class="imageblock text-center">
<div class="content">
<img src="images/schema/fmi3VariableBase.png" alt="fmi3VariableBase" width="80%">
</div>
<div class="title">Figure 21. fmi3VariableBase element.</div>
</div>
<table id="table-variableBase-attributes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. fmi3VariableBase attribute details.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The full, unique name of the variable.
Every variable is uniquely identified within an FMU instance by this name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueReference</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="valueReference" class="paragraph">
<p>A handle of the variable to efficiently identify the variable value in the model interface and for references within the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
This handle is a secret of the tool that generated the C functions.
It is required to be unique for an FMU.
This attribute is <code>required</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional description string describing the meaning of the variable.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>causality</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="causality" class="paragraph">
<p>Enumeration that defines the causality of the variable.
Allowed values of this enumeration:</p>
</div>
<div id="parameter" class="paragraph">
<p><code>= parameter</code>: A data value that is constant during the simulation (except for <a href="#tunable"><code>tunable</code></a> parameters, see there) and is provided by the environment and cannot be used in connections, except for parameter propagation in terminals as described in <a href="#GeneralRemarkOnSignal">Section 2.4.9.2.6</a>.
<a href="#variability"><code>variability</code></a> must be <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a>.
These parameters can be changed independently, unlike <a href="#calculatedParameter">calculated parameters</a>.
<a href="#initial"><code>initial</code></a> must be <a href="#exact"><code>exact</code></a> or not present (meaning <a href="#exact"><code>exact</code></a>).</p>
</div>
<div id="calculatedParameter" class="paragraph">
<p><code>= calculatedParameter</code>: A data value that is constant during the simulation and is computed during initialization or when <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> change.
<a href="#variability"><code>variability</code></a> must be <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a>.
<a href="#initial"><code>initial</code></a> must be <a href="#approx"><code>approx</code></a>, <a href="#calculated"><code>calculated</code></a> or not present (meaning <a href="#calculated"><code>calculated</code></a>).</p>
</div>
<div id="input" class="paragraph">
<p><code>= input</code>: The variable value can be provided by the importer.<br>
<em>[For example, the importer could forward the output of another FMU into this input.]</em></p>
</div>
<div id="output" class="paragraph">
<p><code>= output</code>: The variable value can be used by the importer.<br>
<em>[For example, this value can be forwarded to an input of another FMU.]</em><br>
The algebraic relationship to the <a href="#input"><code>inputs</code></a> can be defined via the <a href="#dependencies"><code>dependencies</code></a> attribute of <a href="#Output"><code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;&lt;Output&gt;</code></a>.</p>
</div>
<div id="local" class="paragraph">
<p><code>= local</code>: Local variables are:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>continuous <a href="#state"><code>states</code></a> and their <a href="#StateDerivative"><code>StateDerivative</code>s</a>, <a href="#DiscreteTimeState"><code>DiscreteTimeState</code>s</a>, <a href="#EventIndicator"><code>EventIndicator</code>s</a> or <a href="#InitialUnknown"><code>InitialUnknown</code>s</a>.
These variables are listed in the <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;</code>.<br></p>
</li>
<li>
<p><a id="localClock"></a> internal, intermediate variables or local clocks which can be read for debugging purposes and are not listed in the <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Setting of local variables:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>In <a href="#InitializationMode"><strong>Initialization Mode</strong></a> and before, local variables need to be set if they do have start values or are listed as <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a>.</p>
</li>
<li>
<p>In super state <a href="#Initialized"><strong>Initialized</strong></a>, <code>fmi3Set{VariableType}</code> must not be called on any of the local variables.
Only in Model Exchange, continuous <a href="#state"><code>states</code></a> can be set with <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>.
Local variable values must not be used as input to another model or FMU.</p>
</li>
</ul>
</div>
<div id="independent" class="paragraph">
<p><code>= independent</code>: The independent variable (usually <code>time</code> <em>[but could also be, for example, <code>angle</code>]</em>).
All variables are a function of this <a href="#independent"><code>independent</code></a> variable.
<a href="#variability"><code>variability</code></a> must be <a href="#continuous"><code>continuous</code></a>.
Exactly one variable of an FMU must be defined as <a href="#independent"><code>independent</code></a>.
If the unit for the independent variable is not defined, it is implicitely`unit = s`.
If one variable is defined as <a href="#independent"><code>independent</code></a>, it must be defined with a floating point type without a <a href="#start"><code>start</code></a> attribute.
It is not allowed to call function <code>fmi3Set{VariableType}</code> on an <a href="#independent"><code>independent</code></a> variable.
Instead, its value is initialized with <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> and after initialization set by <a href="#fmi3SetTime"><code>fmi3SetTime</code></a> for Model Exchange and by arguments <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> and <a href="#communicationStepSize"><code>communicationStepSize</code></a> of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> for Co-Simulation FMUs.
<em>[The actual value can be inquired with <code>fmi3Get{VariableType}</code>.]</em></p>
</div>
<div id="structuralParameter" class="paragraph">
<p><code>= structuralParameter</code>: Parameters that can only be changed in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.
These parameters may be referenced in <code>&lt;Dimension&gt;</code> elements.
<a href="#variability"><code>variability</code></a> must be <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a>.
<a href="#initial"><code>initial</code></a> must be <a href="#exact"><code>exact</code></a> or not present (meaning <a href="#exact"><code>exact</code></a>).
A <code>structuralParameter</code> must nor have a <code>&lt;Dimension&gt;</code> element.</p>
</div>
<div class="paragraph">
<p><em>[</em>
<em>Example:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">   &lt;UInt64 name="spD"      valueReference= "100"
     description="Dimension" causality="structuralParameter"
     variability="fixed" start="7"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p><a href="#structuralParameter"><code>structural parameters</code></a> that are referenced in <code>&lt;Dimension&gt;</code> elements may have a <code>min</code> attribute with 0 but the <a href="#start"><code>start</code></a> attribute, which is mandatory for <a href="#structuralParameter"><code>structural parameters</code></a>, must have a value larger than 0 for <a href="#structuralParameter"><code>structural parameters</code></a> used in <code>&lt;Dimension&gt;</code> elements.</p>
</div>
<div class="paragraph">
<p>The default of <a href="#causality"><code>causality</code></a> is <a href="#local"><code>local</code></a>.<br>
A continuous-time <a href="#state"><code>state</code></a> or an event indicator must have <a href="#causality"><code>causality</code></a> = <a href="#local"><code>local</code></a> or <a href="#output"><code>output</code></a>, see also <a href="#ModelStructure">Section 2.4.8</a>.</p>
</div>
<div class="paragraph">
<p><em>[<a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a> and <a href="#causality"><code>causality</code></a> = <a href="#local"><code>local</code></a> with <a href="#variability"><code>variability</code></a> = <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> are similar.</em>
<em>The difference is that a <a href="#calculatedParameter"><code>calculatedParameter</code></a> can be used in another model or FMU, whereas a <a href="#local"><code>local</code></a> variable cannot.</em>
<em>For example, when importing an FMU in a Modelica environment, a <a href="#calculatedParameter"><code>calculatedParameter</code></a> should be imported in a <code>public</code> section as <code>final parameter</code>, whereas a <a href="#local"><code>local</code></a> variable should be imported in a <code>protected</code> section of the model.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>variability</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="variability" class="paragraph">
<p>Enumeration that defines the time dependency of the variable, in other words, it defines the time instants when a variable can change its value.
<em>[The purpose of this attribute is to define when a result value needs to be inquired and to be stored.</em>
<em>For example, <a href="#discrete"><code>discrete</code></a> variables change their values only at event instants (ME) or at a communication point (CS and SE) and it is therefore only necessary to inquire them with <code>fmi3Get{VariableType}</code> and store them at event times.]</em>
Allowed values of this enumeration:</p>
</div>
<div id="constant" class="paragraph">
<p><code>= constant</code>: The value of the variable never changes.</p>
</div>
<div id="fixed" class="paragraph">
<p><code>= fixed</code>: The value of the variable is fixed after initialization, in other words, after <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> was called the variable value does not change anymore.</p>
</div>
<div id="tunable" class="paragraph">
<p><code>= tunable</code>: The value of the variable is constant between events (ME) and between communication points (CS and SE) due to changing variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.
Whenever a <a href="#parameter"><code>parameter</code></a> with <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> changes, an event is triggered externally (ME or CS if events are supported), or the change is performed at the next communication point (CS and SE) and the variables with <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> and <a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a> or <a href="#output"><code>output</code></a> must be newly computed.
<em>[<a href="#tunable"><code>tunable</code></a> <a href="#input">inputs</a> are not allowed, see <a href="#table-allowed-variability-causality-combinations">Table 21</a>.]</em></p>
</div>
<div id="discrete" class="paragraph">
<p><code>= discrete</code>:<br>
Model Exchange: The value of the variable is constant between external and internal events (= <a href="#time-event"><code>time</code></a>, <a href="#state-event"><code>state</code></a>, <a href="#step-event"><code>step events</code></a> defined implicitly in the FMU).<br>
Co-Simulation: By convention, the variable is from a real sampled data system and its value is only changed at communication points (including event handling).
During <a href="#intermediateUpdate"><code>intermediateUpdate</code></a>, <a href="#discrete"><code>discrete</code></a> variables are not allowed to change.
<em>[If the simulation algorithm notices a change in a discrete variable during <a href="#intermediateUpdate"><code>intermediateUpdate</code></a>, the simulation algorithm will delay the change, raise an event with <a href="#earlyReturnRequested"><code>earlyReturnRequested == fmi3True</code></a> and during the communication point it can change the <a href="#discrete"><code>discrete</code></a> variable, followed by event handling.]</em></p>
</div>
<div id="continuous" class="paragraph">
<p><code>= continuous</code>: Only a variable of <code>type == fmi3GetFloat32</code> or <code>type == fmi3GetFloat64</code> can be <a href="#continuous"><code>continuous</code></a>.<br>
Model Exchange: No restrictions on value changes (see <a href="#smoothness">Section 4.1.1</a>).</p>
</div>
<div id="clock" class="paragraph">
<p><code>= clock</code>: Only a variable of type <code>&lt;Clock&gt;</code> can have this variability.</p>
</div>
<div class="paragraph">
<p>The default is <a href="#continuous"><code>continuous</code></a> for variables of type <code>&lt;Float32&gt;</code> and <code>&lt;Float64&gt;</code>, and <a href="#discrete"><code>discrete</code></a> for all other types.</p>
</div>
<div class="paragraph">
<p><em>[Note that the information about continuous <a href="#state"><code>states</code></a> is defined with elements <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> in <code>&lt;ModelStructure&gt;</code>.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initial</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="initial" class="paragraph">
<p>Enumeration that defines how the variable is initialized, i.e. if a <code>fmi3Set{VariableType}</code> is allowed and how the FMU internally treats this value in <a href="#Instantiated"><strong>Instantiated</strong></a> and <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>For the variable with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>, the attribute <a href="#initial"><code>initial</code></a> must not be provided, because its start value is set with the <a href="#startTime"><code>startTime</code></a> parameter of <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>.</p>
</div>
<div class="paragraph">
<p>The attribute <a href="#initial"><code>initial</code></a> for other variables can have the following values and meanings:</p>
</div>
<div id="exact" class="paragraph">
<p><code>= exact</code>: The variable is initialized with the <a href="#start"><code>start</code></a> value (provided under the variable type element).</p>
</div>
<div id="approx" class="paragraph">
<p><code>= approx</code>: The <a href="#start"><code>start</code></a> value provides an approximation that may be modified during initialization, e.g., if the FMU is part of an algebraic loop where the variable might be an iteration variable and <a href="#start"><code>start</code></a> value is taken as initial value for an iterative solution process.</p>
</div>
<div id="calculated" class="paragraph">
<p><code>= calculated</code>: The variable is calculated from other variables during initialization.
It is not allowed to provide a <a href="#start"><code>start</code></a> value.</p>
</div>
<div class="paragraph">
<p>If <a href="#initial"><code>initial</code></a> is not present, it is defined by <a href="#table-definition-initial">Table 20</a> based on <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a>.
If <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a>, or <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, a <a href="#start"><code>start</code></a> value must be provided.
If <a href="#initial"><code>initial</code></a> = <a href="#calculated"><code>calculated</code></a>, or <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>, it is not allowed to provide a <a href="#start"><code>start</code></a> value.</p>
</div>
<div class="paragraph">
<p><em>[The environment decides when to use the <a href="#start"><code>start</code></a> value of a variable with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>.
Examples: (a) automatic tests of FMUs are performed, and the FMU is tested by providing the <a href="#start"><code>start</code></a> value as <a href="#constant"><code>constant</code></a> <a href="#input"><code>input</code></a>.
(b) For a Model Exchange FMU, the FMU might be part of an algebraic loop.
If the <a href="#input"><code>input</code></a> variable is iteration variable of this algebraic loop, then initialization starts with its <a href="#start"><code>start</code></a> value.]</em></p>
</div>
<div class="paragraph">
<p>If <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#clock"><code>clock</code></a>, that is, the variable is an <a href="#inputClock"><code>input clock</code></a>, it is required to provide a <a href="#start"><code>start</code></a> value for describing the expected initial condition of the <a href="#inputClock"><code>input clock</code></a> for that FMU.
If an <a href="#inputClock"><code>input clock</code></a> has <code>fmi3True</code> as a <a href="#start"><code>start</code></a> value, the environment should activate the <a href="#clock"><code>clock</code></a> the first time it enters <a href="#EventMode"><strong>Event Mode</strong></a>.
The environment can nevertheless choose different <a href="#start"><code>start</code></a> values if it is not possible to fulfill the conditions in a simulation setup.</p>
</div>
<div class="paragraph">
<p>If <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> the <a href="#initial"><code>initial</code></a> attribute value is set to <a href="#calculated"><code>calculated</code></a> and no <a href="#start"><code>start</code></a> value is provided.</p>
</div>
<div class="paragraph">
<p>If <code>fmi3Set{VariableType}</code> is not called on a variable with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, then the FMU must use the <a href="#start"><code>start</code></a> value as value of this <a href="#input"><code>input</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canHandleMultipleSetPerTimeInstant</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="canHandleMultipleSetPerTimeInstant" class="paragraph">
<p>Only for variables with <a href="#variability"><code>variability</code></a> = <a href="#input"><code>input</code></a>.<br>
The default value is <code>true</code>.
If <code>canHandleMultipleSetPerTimeInstant = false</code>, then only one <code>fmi3Set{VariableType}</code> call is allowed for this variable per super-dense time instant in <a href="#EventMode"><strong>Event Mode</strong></a>.
<em>[This flag can be set to <code>false</code> for variables where discrete-time states are directly updated when assigned (</em> \(\mathbf{x}_\mathit{d} := f(\mathbf{x}_\mathit{d},\mathbf{u}_\mathit{c+d})\) <em>instead of</em> \(\mathbf{x}_\mathit{d} := f({}^\bullet\mathbf{x}_\mathit{d},\mathbf{u}_\mathit{c+d})\) <em>).</em>
<em>If an <a href="#output"><code>output</code></a> depends on this <a href="#input"><code>input</code></a> and on discrete-time states, then an algebraic loop could be formed with such an <a href="#input"><code>input</code></a>.</em>
<em>Such loops cannot be solved iteratively because of the limitation on <code>fmi3Set{VariableType}</code>.</em>
<em>Therefore, such an <a href="#input"><code>input</code></a> should not appear in an algebraic loop.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intermediateUpdate</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="intermediateUpdate" class="paragraph">
<p>If this boolean attribute is <code>true</code>, the variable can be accessed in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.
Variables with <a href="#causality"><code>causality</code></a> <a href="#parameter"><code>parameter</code></a> must not be marked with <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a>.</p>
</div>
<div class="paragraph">
<p>This attribute is ignored in Model Exchange.
The default value of this attribute is <code>false</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If <a href="#initial"><code>initial</code></a> is not present, its value is defined by <a href="#table-definition-initial">Table 20</a> based on the values of <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a> (default <span class="underline">underlined</span>):</p>
</div>
<table id="table-definition-initial" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Definition of <a href="#initial"><code>initial</code></a>.</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2" rowspan="2"></td>
<td class="tableblock halign-center valign-top" colspan="7"><p class="tableblock"><a href="#causality"><code>causality</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#structuralParameter"><code>structural Parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#calculatedParameter"><code>calculated Parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#output"><code>output</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#local"><code>local</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#independent"><code>independent</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="6"><p class="tableblock"><a href="#variability"><code>variability</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#constant"><code>constant</code></a> data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#fixed"><code>fixed</code></a> data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span>, approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span>, approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#tunable"><code>tunable</code></a> data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span>, approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span>, approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#discrete"><code>discrete</code></a> variables</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span>, exact, approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span>, exact, approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#continuous"><code>continuous</code></a> variables</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span>, exact, approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span>, exact, approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#clock"><code>clocks</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Note: For local and output variables and <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>, then the variable is explicitly set in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</em>
<em>The value of the variable is either the <a href="#start"><code>start</code></a> value stored in a variable element <code>&lt;XXX start=YYY/&gt;</code> or the value set with <code>fmi3Set{VariableType}</code> during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.]</em></p>
</div>
<div class="paragraph">
<p><a href="#table-allowed-variability-causality-combinations">Table 21</a> shows the combinations of <a href="#variability"><code>variability</code></a>/<a href="#causality"><code>causality</code></a> settings that are allowed.</p>
</div>
<table id="table-allowed-variability-causality-combinations" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Allowed combinations of <a href="#variability"><code>variability</code></a>/<a href="#causality"><code>causality</code></a>.</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2" rowspan="2"></td>
<td class="tableblock halign-center valign-top" colspan="7"><p class="tableblock"><a href="#causality"><code>causality</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#structuralParameter"><code>structural Parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#calculatedParameter"><code>calculated Parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#output"><code>output</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#local"><code>local</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#independent"><code>independent</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="6"><p class="tableblock"><a href="#variability"><code>variability</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#constant"><code>constant</code></a> data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(a)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(a)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(a)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(a)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(7)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(10)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(c)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#fixed"><code>fixed</code></a> data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(16)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(d)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(e)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(11)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(c)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#tunable"><code>tunable</code></a> data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(17)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(4)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(d)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(e)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(12)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(c)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#discrete"><code>discrete</code></a> variables</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(5)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(8)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(13)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(c)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#continuous"><code>continuous</code></a> variables</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(6)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(9)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(14)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(15)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#clock"><code>clocks</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(18)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(18)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(18)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Discussion of the combinations that are not allowed:</em></p>
</div>
<table id="table-Combinations-not-allowed" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Combinations of variability and causality that are not allowed and why.</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><em>Explanation why this combination is not allowed</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(a)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <a href="#constant"><code>constant</code></a> / <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#constant"><code>constant</code></a> / <a href="#parameter"><code>parameter</code></a>, <a href="#constant"><code>constant</code></a> / <a href="#calculatedParameter"><code>calculatedParameter</code></a> and <a href="#constant"><code>constant</code></a> / <a href="#input"><code>input</code></a> do not make sense, since <a href="#parameter"><code>parameters</code></a> and <a href="#input"><code>inputs</code></a> are set from the environment, whereas <a href="#constant"><code>constant</code></a> variables have an unchangeable value.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(b)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <a href="#discrete"><code>discrete</code></a> / <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#discrete"><code>discrete</code></a> / <a href="#parameter"><code>parameter</code></a>, <a href="#discrete"><code>discrete</code></a> / <a href="#calculatedParameter"><code>calculatedParameter</code></a> , <a href="#continuous"><code>continuous</code></a> / <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#continuous"><code>continuous</code></a> / <a href="#parameter"><code>parameter</code></a> and <a href="#continuous"><code>continuous</code></a> / <a href="#calculatedParameter"><code>calculatedParameter</code></a> do not make sense, since <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a> define variables that do not depend on time, whereas <a href="#discrete"><code>discrete</code></a> and <a href="#continuous"><code>continuous</code></a> define variables where the values can change during simulation.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(c)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>For an <a href="#independent"><code>independent</code></a> variable only <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a> makes sense.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(d)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#input"><code>input</code></a> has exactly the same properties as a <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a>.</em>
<em>For simplicity, only <a href="#fixed"><code>fixed</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> shall be defined.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(e)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#output"><code>output</code></a> has exactly the same properties as a <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a>.</em>
<em>For simplicity, only <a href="#fixed"><code>fixed</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameters</code></a> shall be defined.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Discussion of the combinations that are allowed</em>:</p>
</div>
<table id="table-Combinations-allowed" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Combinations of variability and causality that are allowed and why.</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 25%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><em>Setting</em></th>
<th class="tableblock halign-left valign-top"><em>Example</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(1)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-<a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(2)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>Tunable</code></a> <a href="#parameter"><code>parameter</code></a> (changing such a <a href="#parameter"><code>parameter</code></a> triggers event handling (ME) or takes effect at the next communication point (CS and SE), and <a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a>/<a href="#output"><code>output</code></a>/<a href="#local"><code>local</code></a> variables might change their values).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(3)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-<a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a> (variable that is computed directly or indirectly from constants or <a href="#parameter"><code>parameters</code></a>).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(4)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>Tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a> (changing a <a href="#parameter"><code>parameter</code></a> triggers event handling (ME) or takes effect at the next communication point (CS and SE), and <a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#local"><code>local</code></a> variables might change their values).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(5)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>discrete</code></a> <a href="#input"><code>input</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>Discrete</code></a> <a href="#input"><code>input</code></a> variable from another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(6)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#input"><code>input</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>Continuous</code></a> <a href="#input"><code>input</code></a> variable from another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(7)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#constant"><code>constant</code></a> <a href="#output"><code>output</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable where the value never changes and that can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(8)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>discrete</code></a> <a href="#output"><code>output</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>Discrete</code></a> variable that is computed in the FMU.</em>
<em>Can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(9)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#output"><code>output</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>Continuous</code></a> variable that is computed in the FMU and can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(10)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#constant"><code>constant</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable where the value never changes.</em>
<em>Cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(11)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on <a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameters</code></a> only and is computed in the FMU.</em>
<em>Cannot be used in another model.</em>
<em>After initialization, the value of this <a href="#local"><code>local</code></a> variable cannot change.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(12)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> only and is computed in the FMU.</em>
<em>Cannot be used in another model.</em>
<em>The value of this <a href="#local"><code>local</code></a> variable can only change during initialization and at event instants, provided a <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a> was changed.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(13)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>discrete</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>Discrete</code></a> variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(14)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>Continuous</code></a> variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(15)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#independent"><code>independent</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>All variables are a function of the continuous-time variable marked as <a href="#independent"><code>independent</code></a>.</em>
<em>Usually, this is <code>time</code>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(16)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#structuralParameter"><code>structuralParameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#parameter"><code>Parameter</code></a> used in  <code>&lt;Dimension&gt;</code> element;  can be changed before initialization in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(17)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structuralParameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#parameter"><code>Parameter</code></a> used in  <code>&lt;Dimension&gt;</code> element;  can be changed before initialization in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> and in <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(18)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#clock"><code>clock</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable that defines a <a href="#clock"><code>clock</code></a>.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>How to treat <a href="#tunable"><code>tunable</code></a> variables:</em></p>
</div>
<div class="paragraph">
<p><em>A <a href="#parameter"><code>parameter</code></a> p is a variable that does not change its value during simulation, in other words, dp/dt = 0.</em>
<em>If the <a href="#parameter"><code>parameter</code></a> p is changing, then Dirac impulses are introduced since dp/dt of a discontinuous <a href="#constant"><code>constant</code></a> variable <code>p</code> is a Dirac impulse.</em>
<em>Even if this Dirac impulse would be modeled correctly by the modeling environment, it would introduce unwanted <code>vibrations</code>.</em>
<em>Furthermore, in many cases the model equations are derived under the assumption of a <a href="#constant"><code>constant</code></a> value (like mass or capacity), and the model equations would be different if <code>p</code> would be time varying.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Model Exchange:</em><br>
<em>Therefore, "tuning a (structural) <a href="#parameter"><code>parameter</code></a>" during simulation does not mean to "change the parameter online" during simulation.</em>
<em>Instead, this is a short hand notation for:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Stop the simulation at an event instant (usually, a <a href="#step-event">step event</a>, in other words, after a successful integration step).</em></p>
</li>
<li>
<p><em>Change the values of the <a href="#tunable"><code>tunable</code></a> (structural) <a href="#parameter"><code>parameters</code></a>.</em>
<em>For <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a>, the <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> must be entered before and left afterwards.</em></p>
</li>
<li>
<p><em>Compute all <a href="#parameter"><code>parameters</code></a> (and sizes of variables, <a href="#state"><code>states</code></a>, <a href="#derivative"><code>derivatives</code></a>, event indicators, &#8230;&#8203;) that depend on the <a href="#tunable"><code>tunable</code></a> (structural) <a href="#parameter"><code>parameters</code></a>.</em></p>
</li>
<li>
<p><em>Newly start the simulation using as initial values previously stored values and the new values of the <a href="#parameter"><code>parameters</code></a>.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Basically this means that a new simulation run is started from the previous FMU state with changed <a href="#parameter"><code>parameter</code></a> values.</em>
<em>With this interpretation, changing <a href="#parameter"><code>parameters</code></a> online is "clean", as long as these changes appear at an event instant.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Co-Simulation:</em>
<em>Changing of <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> is allowed before an <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> call (so, whenever an <a href="#input"><code>input</code></a> can be set with <code>fmi3Set{VariableType}</code>) and before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called (that is before and during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>).</em>
<em>The FMU internally carries out event handling if necessary.]</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Scheduled Execution:</em>
<em>Changing of <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> is allowed before an <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call (so, whenever an <a href="#input"><code>input</code></a> can be set with <code>fmi3Set{VariableType}</code>) and before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called (that is before and during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>).</em></p>
</div>
<div class="paragraph">
<p>Type specific properties are defined in the required choice element, where exactly one float, integer or enumeration must be present in the XML file:
<a href="#figure-schema-Float64">Figure 22</a>, <a href="#figure-schema-Int32">Figure 23</a>, <a href="#figure-schema-Boolean">Figure 24</a>, <a href="#figure-schema-Binary">Figure 25</a>, <a href="#figure-schema-Enumeration">Figure 26</a> and <a href="#figure-schema-Clock">Figure 27</a>, are representative examples.</p>
</div>
<div id="figure-schema-Float64" class="imageblock text-center">
<div class="content">
<img src="images/schema/Float64.png" alt="Float64" width="70%">
</div>
<div class="title">Figure 22. Float64 element.</div>
</div>
<div id="figure-schema-Int32" class="imageblock text-center">
<div class="content">
<img src="images/schema/Int32.png" alt="Int32" width="70%">
</div>
<div class="title">Figure 23. Int32 element.</div>
</div>
<div id="figure-schema-Boolean" class="imageblock text-center">
<div class="content">
<img src="images/schema/Boolean.png" alt="Boolean" width="70%">
</div>
<div class="title">Figure 24. Boolean element.</div>
</div>
<div id="figure-schema-Binary" class="imageblock text-center">
<div class="content">
<img src="images/schema/Binary.png" alt="Binary" width="70%">
</div>
<div class="title">Figure 25. Binary element.</div>
</div>
<div id="figure-schema-Enumeration" class="imageblock text-center">
<div class="content">
<img src="images/schema/Enumeration.png" alt="Enumeration" width="70%">
</div>
<div class="title">Figure 26. Enumeration element.</div>
</div>
<div id="figure-schema-Clock" class="imageblock text-center">
<div class="content">
<img src="images/schema/Clock.png" alt="Clock" width="70%">
</div>
<div class="title">Figure 27. Clock element.</div>
</div>
<div class="paragraph">
<p>The attributes are defined in <a href="#definition-of-types">Section 2.4.4</a> (<code>&lt;TypeDefinitions&gt;</code>), except:</p>
</div>
<table id="table-type-attributes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. TypeDefinition attribute details.</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>declaredType</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If present, name of type defined with <code>&lt;TypeDefinitions&gt;&lt;TypeDefinition&gt;</code>.
The value defined in the corresponding <code>&lt;TypeDefinition&gt;</code> (see <a href="#definition-of-types">Section 2.4.4</a>) is used as default.
<em>[For example, if <code>min</code> is present both in variable type element of <code>&lt;TypeDefinition&gt;</code> and in the concrete variable type element of the variable, then the <code>min</code> of the variable is actually used.]</em>
For <code>&lt;Enumeration&gt;</code> the attribute <code>declaredType</code> is required because the <code>&lt;Enumeration&gt;</code> items are defined in <code>&lt;TypeDefinitions&gt;&lt;TypeDefinition&gt;</code>.
For all other types, this attribute is optional.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="start" class="paragraph">
<p>Initial or guess value of variable.
This value is also stored in the C functions.
<em>[Therefore, calling</em> <code>fmi3Set{VariableType}</code> <em>to set <a href="#start"><code>start</code></a> values is only necessary, if a different value as stored in the XML file is desired.</em>
<em>It is not allowed to change the start values in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file of an FMU, as this would break the consistency with the hard-coded start values in the C-Code.</em>
<em>This could lead to unpredictable behavior of the FMU in different importing tools, as it is not mandatory to call <code>fmi3Set{VariableType}</code> to set start values during initialization.</em>
<em>Instead it is recommended to use the SSP Standard (<a href="https://ssp-standard.org/" class="bare">https://ssp-standard.org/</a>) to handle modified parameters of FMUs or different parameter sets.]</em></p>
</div>
<div class="paragraph">
<p>The <a href="#start"><code>start</code></a> is either a single value or a list of values.
The serialization of a multi-dimensional array variable is described in <a href="#serialization-of_variables">Section 2.2.6.1</a>.
If only a single value is given for a multi-dimensional array, all values of the multi-dimensional array are equal to this value.</p>
</div>
<div class="paragraph">
<p>The interpretation of <a href="#start"><code>start</code></a> is defined by variable attribute <a href="#initial"><code>initial</code></a>.
A different <a href="#start"><code>start</code></a> value can be provided with an <code>fmi3Set{VariableType}</code> function before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called (but not for variables with <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>).</p>
</div>
<div class="paragraph">
<p><em>[The standard approach is to set the <a href="#start"><code>start</code></a> value before <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>.</em>
<em>However, if the initialization shall be modified in the calling environment (for example, changing from initialization of states to steady-state initialization), it is also possible to use the <a href="#start"><code>start</code></a> value as iteration variable of an algebraic loop: using an additional condition in the environment, such as</em> \({\dot{x} = 0}\) <em>, the actual <a href="#start"><code>start</code></a> value is determined.]</em></p>
</div>
<div class="paragraph">
<p>If <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a> or <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, a <a href="#start"><code>start</code></a> value must be provided.</p>
</div>
<div class="paragraph">
<p>If <a href="#initial"><code>initial</code></a> = <a href="#calculated"><code>calculated</code></a> or <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>, it is not allowed to provide a <a href="#start"><code>start</code></a> value.</p>
</div>
<div class="paragraph">
<p>Variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> or <a href="#input"><code>input</code></a>, as well as variables with <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>, must have a <a href="#start"><code>start</code></a> value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a>, the <a href="#start"><code>start</code></a> value is the value of it.</p>
</li>
<li>
<p>If <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, the <a href="#start"><code>start</code></a> value is used by the model as value of the <a href="#input"><code>input</code></a>, if the <a href="#input"><code>input</code></a> is not set by the environment.</p>
</li>
<li>
<p>If <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>, the <a href="#start"><code>start</code></a> value is the value of the constant.</p>
</li>
<li>
<p>If <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> or <a href="#local"><code>local</code></a>, then the <a href="#start"><code>start</code></a> value is either an <a href="#initial"><code>initial</code></a> or a <code>guess</code> value, depending on the setting of attribute <a href="#initial"><code>initial</code></a>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>derivative</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="derivative" class="paragraph">
<p>If present, this variable is the derivative of variable with value reference <code>derivative</code>.
<em>[For example, if there are 10 variables and <code>derivative = 3</code> for variable 8, then variable 8 is the derivative of variable 3 with respect to the <a href="#independent"><code>independent</code></a> variable (usually time).</em>
<em>This information might be especially used if an <a href="#input"><code>input</code></a> or an <a href="#output"><code>output</code></a> is the derivative of another <a href="#input"><code>input</code></a> or <a href="#output"><code>output</code></a>, or to define the <a href="#state"><code>states</code></a>.]</em></p>
</div>
<div class="paragraph">
<p>The <a href="#state"><code>state</code></a> <a href="#derivative"><code>derivatives</code></a> of an FMU are listed as elements <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> in <code>&lt;ModelStructure&gt;</code>.
All variables listed in this element must have attribute <code>derivative</code> (in order that the continuous-time <a href="#state"><code>states</code></a> are uniquely defined).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reinit</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="reinit" class="paragraph">
<p>Only for Model Exchange (if only a Co-Simulation FMU, this attribute must not be present.
If both Model Exchange and a Co-Simulation FMU, this attribute is ignored for co-simulation):<br>
Can only be present for a continuous-time <a href="#state"><code>state</code></a>.<br>
If <code>true</code>, <a href="#state"><code>state</code></a> can be reinitialized at an event by the FMU.<br>
If <code>false</code>, <a href="#state"><code>state</code></a> will not be reinitialized at an event by the FMU.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min / max</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="min-max" class="paragraph">
<p>The <code>min / max</code> definitions are information from the FMU to the environment defining the region in which the FMU is designed to operate (see <a href="#min-max-violations">Section 2.2.6.3</a>).<br>
<em>[If, for example, an <code>&lt;Enumeration&gt;</code> is defined with <code>name1 = -4</code>, <code>name2 = 1</code>, <code>name3 = 5</code>, <code>name4 = 11</code> and <code>min = -2</code>, <code>max = 5</code>, then only <code>name2</code> and <code>name3</code> are allowed.]</em></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="namingSection">2.4.7.1. Variable Naming Conventions</h5>
<div class="paragraph">
<p>With attribute <a href="#variableNamingConvention"><code>variableNamingConvention</code></a> in <code>&lt;fmiModelDescription&gt;</code>, the convention is defined how the variable names have been constructed.
If this information is known, the environment may be able to represent the names in a better way (for example, as a tree and not as a linear list).</p>
</div>
<div class="paragraph">
<p>In the following definitions, the <a href="http://en.wikipedia.org/wiki/Extended_BNF">EBNF</a> is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=   production rule
[ ] optional
{ } repeat zero or more times
|   or</pre>
</div>
</div>
<div class="paragraph">
<p>The names must be unique, non-empty strings.<br>
<em>[It is recommended that the names are visually clearly different from each other; but it is not required.]</em></p>
</div>
<div class="paragraph">
<p>The following conventions for scalar names are defined:</p>
</div>
<div class="paragraph">
<p><strong><a href="#variableNamingConvention"><code>variableNamingConvention = flat</code></a></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>name = Unicode-char { Unicode-char } // identical to xs:normalizedString
Unicode-char = any Unicode character without carriage return (#xD),
line feed (#xA) nor tab (#x9)</pre>
</div>
</div>
<div class="paragraph">
<p><strong><a href="#variableNamingConvention"><code>variableNamingConvention = structured</code></a></strong></p>
</div>
<div class="paragraph">
<p>Structured names are hierarchical using "." as a separator between hierarchies.
A name consists of "_", letters and digits or may consist of any characters enclosed in single apostrophes.
A name may identify an array element on every hierarchical level using "[&#8230;&#8203;]" to identify the respective array index.
If an array is a leaf node of the variable hierarchy then the array can also be represented as a single variable of type array.
A <a href="#derivative"><code>derivative</code></a> of a variable is defined with <code>der(name)</code> for the first time derivative and <code>der(name,N)</code> for the N-th derivative.
Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.engine.speed
resistor12.u
v_min
robot.axis.'motor #234'
der(pipe[3,4].T[14],2) // second time derivative of pipe[3,4].T[14]</pre>
</div>
</div>
<div class="paragraph">
<p>The precise syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>name            = identifier | "der(" identifier ["," unsignedInteger ] ")"
identifier      = B-name [ arrayIndices ] {"." B-name [ arrayIndices ] }
B-name          = nondigit { digit | nondigit } | Q-name
nondigit        = "pass:[_]" | letters "a" to "z" | letters "A" to "Z"
digit           = "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"
Q-name          = "'" ( Q-char | escape ) { Q-char | escape } "'"
Q-char          = nondigit | digit | "!" | "#" | "$" | "%" | "&amp;" | "(" | ")" |
                                     "*" | "+" | "," | "-" | "." | "/" | ":" |
                                     ";" | "&lt;" | "&gt;" | "=" | "?" | "@" | "[" |
                                     "]" | "^" | "{" | "}" | "|" | "~" | " "
escape          = "\'" | "\"" | "\?" | "\\" | "\a" | "\b" |
                  "\f" | "\n" | "\r" | "\t" | "\v"
arrayIndices    = "[" unsignedInteger {"," unsignedInteger} "]"
unsignedInteger = digit { digit }</pre>
</div>
</div>
<div class="paragraph">
<p><em>[This definition is identical to the syntax of an identifier in Modelica version 3.2.]</em></p>
</div>
<div class="paragraph">
<p>The tree of names is mapped to an ordered list of variable names in <a href="http://en.wikipedia.org/wiki/Depth-first_search">depth-first</a> order.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle
  transmission
    ratio
    outputSpeed
  engine
    inputSpeed
    temperature</pre>
</div>
</div>
<div class="paragraph">
<p>is mapped to the following list of variable names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.transmission.ratio
vehicle.transmission.outputSpeed
vehicle.engine.inputSpeed
vehicle.engine.temperature</pre>
</div>
</div>
<div class="paragraph">
<p>All flattened array elements are given in a consecutive sequence of variables.
Elements of multi-dimensional arrays are ordered according to "row major" order that is elements of the last index are given in sequence.</p>
</div>
<div class="paragraph">
<p><em>[For example, the vector <code>centerOfMass</code> in body <code>arm1</code> is mapped to the following variables:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>robot.arm1.centerOfMass[1]
robot.arm1.centerOfMass[2]
robot.arm1.centerOfMass[3]</pre>
</div>
</div>
<div class="paragraph">
<p><em>[For example, a controller might receive 3 rpm sensors mapped to the following variables:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>transmission.rpms[0]
transmission.rpms[1]
transmission.rpms[2]</pre>
</div>
</div>
<div class="paragraph">
<p><em>For example, a table <code>T[4,3,2]</code> (first dimension 4 entries, second dimension 3 entries, third dimension 2 entries) is mapped to the following variables:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>T[1,1,1]
T[1,1,2]
T[1,2,1]
T[1,2,2]
T[1,3,1]
T[1,3,2]
T[2,1,1]
T[2,1,2]
T[2,3,1]
...</pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>It might be that not all elements of an array are present.
If they are present, they are given in consecutive order in the XML file.</p>
</div>
<div class="paragraph">
<p>The <a href="#variableNamingConvention"><code>variableNamingConvention</code></a> <code>structured</code> does not define if arrays are 0-based or 1-based.</p>
</div>
<div class="paragraph">
<p><em>[FMI 3.0 introduces arrays of variables to improve handling of arrays.]</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ModelStructure">2.4.8. Definition of the Model Structure</h4>
<div class="paragraph">
<p>The structure of the model is defined in element <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;</code>.
It defines the <a href="#model-dependencies">dependencies</a> between variables.</p>
</div>
<div class="paragraph">
<p>The required part of the model structure defines an ordering of the <a href="#output"><code>outputs</code></a>, the (exposed) <a href="#derivative"><code>derivatives</code></a>, the event indicators, and the unknowns that are available during Initialization.
A Model Exchange FMU must expose all <a href="#derivative"><code>derivatives</code></a> of its continuous-time <a href="#state"><code>states</code></a> in <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> in <code>&lt;ModelStructure&gt;</code> elements and must expose all event indicators in <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a> elements.</p>
</div>
<div class="paragraph">
<p>The optional part of the model structure defines in which way <a href="#derivative"><code>derivatives</code></a>, <a href="#output"><code>outputs</code></a>, and initial unknowns depend on <a href="#input"><code>inputs</code></a> and/or <a href="#parameter"><code>parameters</code></a>, and continuous-time <a href="#state"><code>states</code></a>, at the current super-dense time instant (ME) or at the current communication point (CS and SE).
The listed <a href="#dependencies"><code>dependencies</code></a> declare the dependencies between whole (multi-dimensional-)variables and not individual elements of the variables.
<em>[Dependencies of individual array elements can be retrieved during runtime using <a href="#fmi3GetVariableDependencies"><code>fmi3GetVariableDependencies</code></a>.]</em></p>
</div>
<div class="paragraph">
<p><a href="#figure-schema-ModelStructure">Figure 28</a> shows the definition of <code>&lt;ModelStructure&gt;</code>.</p>
</div>
<div id="figure-schema-ModelStructure" class="imageblock">
<div class="content">
<img src="images/schema/ModelStructure.png" alt="ModelStructure" width="90%">
</div>
<div class="title">Figure 28. ModelStructure element.</div>
</div>
<div class="paragraph">
<p>Note that attribute <a href="#dependenciesKind"><code>dependenciesKind</code></a> for element <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> has less enumeration values as <a href="#dependenciesKind"><code>dependenciesKind</code></a> in the other lists, as detailed in <a href="#table-model-structure-elements">Table 25</a>.</p>
</div>
<div class="paragraph">
<p><code>&lt;ModelStructure&gt;</code> consists of the elements detailed in <a href="#table-model-structure-elements">Table 25</a> (see also <a href="#figure-schema-ModelStructure">Figure 28</a>; the symbols of the mathematical equations describing the dependency are defined in <a href="#concepts-model-exchange">Section 3.1</a>):</p>
</div>
<table id="table-model-structure-elements" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. ModelStructure elements.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Output</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="Output"></a>
Ordered list of all outputs, in other words, a list of value references where every corresponding variable must have <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> (and every variable with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> must be listed here).
<em>[Note that all <a href="#output"><code>output</code></a> variables are listed here, especially <a href="#discrete"><code>discrete</code></a> and <a href="#continuous"><code>continuous</code></a> <a href="#output"><code>outputs</code></a>.</em>
<em>The ordering of the variables in this list is defined by the exporting tool.</em>
<em>Usually, it is best to order according to the declaration order in the source model, since then the <a href="#Output"><code>&lt;Output&gt;</code></a> list does not change if the declaration order of <a href="#output"><code>outputs</code></a> in the source model is not changed.</em>
<em>This is for example, important for linearization, in order that the interpretation of the output vector does not change for a re-exported FMU.]</em>
Attribute <a href="#dependencies"><code>dependencies</code></a> defines the dependencies of the <a href="#output"><code>outputs</code></a> from the knowns at the current super-dense time instant in Event and in <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> (ME) and at the current communication point (CS and SE).
Attribute <a href="#dependencies"><code>dependencies</code></a> for output clocks (variables with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#clock"><code>clock</code></a>) lists all known variables (including input clocks) that contribute to trigger a clock tick for that output clock.
Beside the knowns, the <a href="#output"><code>outputs</code></a> also depend on "frozen" variables (= variables which cannot be changed in the current mode) but these "frozen" variables are not listed as <a href="#dependencies"><code>dependencies</code></a>.
The functional dependency is defined as (dependencies of variables that are fixed in Event and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> and at communication points are not shown):<br>
\({(\mathbf{y}_c, \mathbf{y}_d) := \mathbf{f}_{\mathit{output}}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p}_{\mathit{tune}})}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StateDerivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="StateDerivative"></a>
Ordered list of all state derivatives, in other words, a list of value references where every corresponding variable must be a state derivative.
<em>[Note that only <a href="#continuous"><code>continuous</code></a> floating point variables are listed here.</em>
<em>If a <a href="#state"><code>state</code></a> or a <a href="#derivative"><code>derivative</code></a> of a <a href="#state"><code>state</code></a> shall not be exposed from the FMU, or if states are not statically associated with a variable (due to <a href="#dynamic-state-selection">dynamic state selection</a>), then dummy variables have to be introduced, for example, <code>x[4]</code>, or <code>xDynamicStateSet2[5]</code>.</em>
<em>The ordering of the variables in this list is defined by the exporting tool.</em>
<em>Usually, it is best to order according to the declaration order of the <a href="#state"><code>states</code></a> in the source model, since then the <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> list does not change if the declaration order of states in the source model is not changed.</em>
<em>This is for example, important for linearization, in order that the interpretation of the state vector does not change for a re-exported FMU.]</em></p>
<p class="tableblock">The corresponding continuous-time <a href="#state"><code>states</code></a> are defined by attribute <a href="#derivative"><code>derivative</code></a> of the corresponding variable state derivative element.
<em>[Note that higher order derivatives must be mapped to first order derivatives but the mapping definition can be preserved due to attribute <a href="#derivative"><code>derivative</code></a>.</em>
<em>Example: if</em> \({\frac{\text{ds}}{\text{dt}} = v,\ \frac{\text{dv}}{\text{dt}} =f(..)}\) <em>,then</em> \({\left\{ v,\ \frac{\text{dv}}{\text{dt}} \right\}}\) <em>is the vector of state derivatives and attribute <a href="#derivative"><code>derivative</code></a> of</em> \({v}\) <em>references</em> \({s}\) <em>, and attribute <a href="#derivative"><code>derivative</code></a> of</em> \({\frac{\text{dv}}{\text{dt}}}\) <em>references</em> \({v}\) <em>.]</em><br>
For Co-Simulation, elements <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> are ignored if capability flag <a href="#providesDirectionalDerivatives"><code>providesDirectionalDerivatives</code></a> has a value of <code>false</code>, in other words, it cannot be computed.
<em>[This is the default.</em>
<em>If an FMU supports more than Model Exchange , then the <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> elements might be present, since it is needed for Model Exchange.</em>
<em>If the above flag is set to <code>false</code> for the Co-Simulation cases, then the <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> elements are ignored for Co-Simulation.</em>
<em>If "inline integration" is used for a co-simulation FMU, then the model still has continuous-time <a href="#state"><code>states</code></a> and just a special solver is used (internally the implementation results in a discrete-time system, but from the outside, it is still a continuous-time system).]</em><br>
Attribute <a href="#dependencies"><code>dependencies</code></a> defines the dependencies of the state derivatives from the knowns at the current super-dense time instant in Event and in <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> (ME) and at the current communication point (CS and SE).
Beside the knowns the derivatives also depend on the "frozen" variables (= variables which cannot be changed in the current mode) but these "frozen" variables are not listed as <a href="#dependencies"><code>dependencies</code></a>.
The functional dependency is defined as (dependencies of variables that are fixed in Event and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> and at communication points are not shown):<br>
\({\dot{\mathbf{x}_c} := \mathbf{f}_{\mathit{der}}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p}_{\mathit{tune}})}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DiscreteTimeState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="DiscreteTimeState"></a>
XXX // TODO: Add description, see #1287 on github.<br>
XXX // TODO: This should likely be Locals (ask ZIrina), to allow dependency definitions for modelPartitions (to input clocks) for all local variables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitialUnknown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="InitialUnknown"></a>
Ordered list of all exposed unknowns in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.
This list consists of all variables with</p>
<p class="tableblock">- <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> and (<a href="#initial"><code>initial</code></a> = <a href="#approx"><code>approx</code></a> or <a href="#calculated"><code>calculated</code></a>), and</p>
<p class="tableblock">- <a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a> and</p>
<p class="tableblock">- all continuous-time <a href="#state"><code>states</code></a> and all state derivatives (defined with elements <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a>) with <a href="#initial"><code>initial</code></a> = <a href="#approx"><code>approx</code></a> or <a href="#calculated"><code>calculated</code></a> <em>[if a Co-Simulation FMU does not define the <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> elements, (3) cannot be present]</em>.</p>
<p class="tableblock">The resulting list is not allowed to have duplicates (for example, if a <a href="#state"><code>state</code></a> is also an <a href="#output"><code>output</code></a>, it is included only once in the list).<br>
Attribute <a href="#dependencies"><code>dependencies</code></a> defines the dependencies of the unknowns from the knowns in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> at the initial time.
Beside the knowns the initial unknowns also depend on the "frozen" variables (= variables which cannot be changed in the current mode) but these "frozen" variables are not listed as <a href="#dependencies"><code>dependencies</code></a>.
The functional dependency is defined as:</p>
<p class="tableblock">\({\mathbf{v}_{\mathit{initialUnknowns}} := \mathbf{f}_{\mathit{init}}(\mathbf{u}_c, \mathbf{u}_d, t_0, \mathbf{v}_{\mathit{initial=exact}})}\)</p>
<p class="tableblock">Since, <a href="#output"><code>outputs</code></a>, continuous-time <a href="#state"><code>states</code></a> and state derivatives are either present as knowns (if <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>) or as unknowns (if <a href="#initial"><code>initial</code></a> = <a href="#approx"><code>approx</code></a> or <a href="#calculated"><code>calculated</code></a>), they can be inquired with <code>fmi3Get{VariableType}</code> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
<p class="tableblock"><em>[Example: Assume an FMU is defined in the following way:</em></p>
<p class="tableblock">\({(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{\mathit{init}}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_0, \mathbf{p})}\)<br></p>
<p class="tableblock">\({(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{\mathit{sim}}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_i, \mathbf{p})}\)<br></p>
<p class="tableblock"><em>Therefore, the initial state \({\mathbf{x}_c(t_0)}\) has <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> and the initial state derivative \({\dot{\mathbf{x}}_c(t_0)}\) has <a href="#initial"><code>initial</code></a> = <a href="#calculated"><code>calculated</code></a>.</em>
<em>The environment can still initialize this FMU in steady-state, by using \({\mathbf{x}_c(t_0)}\) as iteration variables and adding the equations \({\dot{\mathbf{x}}_c(t_0) = \mathbf{0}}\) in the environment.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EventIndicator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="EventIndicator"></a>
Ordered list of all event indicators, in other words, a list of value references where every corresponding variable must be an event indicator.
<em>[Note that only <a href="#continuous"><code>continuous</code></a> floating point variables are listed here.</em>
<em>If an event indicator shall not be exposed from the FMU, or if event indicators are not statically associated with a variable (due to dynamic event indicator selection), then dummy variables have to be introduced, for example, <code>eventIndicator[4]</code>.</em>
<em>The ordering of the variables in this list is defined by the exporting tool.]</em></p>
<p class="tableblock">For Co-Simulation, elements <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a> are ignored.
<em>[If an FMU supports both Model Exchange and Co-Simulation, then the <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a> elements might be present, since it is needed for Model Exchange.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Elements <a href="#Output"><code>&lt;Output&gt;</code></a>, <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a>, <a href="#DiscreteTimeState"><code>&lt;DiscreteTimeState&gt;</code></a> and <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> have the following attributes:</p>
</div>
<table id="table-output-der-initialUknown-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. <a href="#Output"><code>&lt;Output&gt;</code></a>, <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a>, <a href="#DiscreteTimeState"><code>&lt;DiscreteTimeState&gt;</code></a> and <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> attribute details.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueReference</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value reference of the unknown \({v_{\mathit{unknown}}}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="dependencies"></a>
Optional attribute defining the dependencies of the unknown \({v_{\mathit{unknown}}}\) (directly or indirectly via auxiliary variables) with respect to \({\mathbf{v}_{\mathit{known}}}\).
If not present, it must be assumed that the unknown depends on all knowns.
If present as empty list, the unknown depends on none of the knowns.
Otherwise the unknown depends on the knowns defined by the given value references.<br>
Knowns \({\mathbf{v}_{\mathit{known}}}\) in <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> (ME) and at communication points (CS and SE) for <a href="#Output"><code>&lt;Output&gt;</code></a> and <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> elements:</p>
<p class="tableblock">* inputs (variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>),</p>
<p class="tableblock">* continuous states and discrete-time states,</p>
<p class="tableblock">* parameters (variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a>),</p>
<p class="tableblock">* <a href="#independent"><code>independent</code></a> variable (usually time; <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>).</p>
<p class="tableblock"><em>[The list of dependencies may include input clocks (variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#clock"><code>clock</code></a>).</em>
<em>If an <a href="#outputClock"><code>output clock</code></a> depends on an <a href="#inputClock"><code>input clock</code></a>, then clock ticks of the <a href="#inputClock"><code>input clock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> may create <a href="#outputClock"><code>output clock</code></a> ticks during this event handling.]</em></p>
<p class="tableblock">Knowns \({\mathbf{v}_{\mathit{known}}}\) in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> (for elements <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a>):</p>
<p class="tableblock">* inputs (variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>),</p>
<p class="tableblock">* variables with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>, <em>[for example, <a href="#parameter"><code>parameters</code></a> or initial <a href="#state"><code>states</code></a>]</em></p>
<p class="tableblock">* <a href="#independent"><code>independent</code></a> variable (usually time; <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>).</p>
<p class="tableblock">For Co-Simulation, if the capability flag <a href="#providesDirectionalDerivatives"><code>providesDirectionalDerivatives</code></a> has a value of <code>false</code>, then <a href="#dependencies"><code>dependencies</code></a> does not list the dependency on continuous-time.
In other words, the respective partial derivatives cannot be computed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependenciesKind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="dependenciesKind"></a>
If <a href="#dependenciesKind"><code>dependenciesKind</code></a> is present, <a href="#dependencies"><code>dependencies</code></a> must be present and must have the same number of list elements.
If not present, it must be assumed that the unknown \({\mathbf{v}_{\mathit{unknow}}}\) depends on the knowns \({\mathbf{v}_{\mathit{known}}}\) without a particular structure.
Otherwise, the corresponding known \({\mathbf{f}_{\mathit{known},i}}\) enters the equation as:</p>
<p class="tableblock"><code>= dependent</code>: no particular structure, \({{\mathbf{f}(..,\ v}_{\mathit{known},i}}\),..)</p>
<p class="tableblock">Only for floating point type unknowns \({\mathbf{v}_{\mathit{unknown}}}\):</p>
<p class="tableblock"><code>=</code> <a href="#constant"><code>constant</code></a>: constant factor, \({c \cdot \mathbf{v}_{\mathit{known},i}}\) where \({c}\) is an expression that is evaluated before <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> is called.</p>
<p class="tableblock">Only for floating point type unknowns \({\mathbf{v}_{\mathit{unknown}}}\) in Event and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> (ME) and at communication points (CS and SE), and not for <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> for <a href="#InitializationMode"><strong>Initialization Mode</strong></a>:</p>
<p class="tableblock"><code>=</code> <a href="#fixed"><code>fixed</code></a>: fixed factor, \({p \cdot \mathbf{v}_{\mathit{known},i}}\) where \({p}\) is an expression that is evaluated before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called.</p>
<p class="tableblock"><code>=</code> <a href="#tunable"><code>tunable</code></a>: tunable factor, \({p \cdot \mathbf{v}_{\mathit{known},i}}\) where \({p}\) is an expression that is evaluated before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called and in <a href="#EventMode"><strong>Event Mode</strong></a> due to event handling (ME) or at a communication point (CS and SE)</p>
<p class="tableblock"><code>=</code> <a href="#discrete"><code>discrete</code></a>: discrete factor, \({d \cdot \mathbf{v}_{\mathit{known},i}}\) where \({d}\) is an expression that is evaluated before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called and in <a href="#EventMode"><strong>Event Mode</strong></a> due to an external or internal event or at a communication point (CS and SE).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Example 1:</em></p>
</div>
<div class="paragraph">
<p><em>An FMU is defined by the following equations:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}

\frac{d}{\text{dt}}\begin{bmatrix}
x_{1} \\
x_{2} \\
x_{3} \\
\end{bmatrix}

&amp;=

\begin{bmatrix}
f_{1}\left( x_{2} \right) \\
f_{2}\left( x_{1} \right) + 3 \cdot p^{2} \cdot x_{2} + 2 \cdot u_{1} + 3 \cdot u_{3} \\
f_{3}\left( x_{1},x_{3},u_{1},u_{2},u_{3} \right) \\
\end{bmatrix}

\\

y &amp;= g_1(x_2, x_3)

\end{align*},\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \({u_{1}}\) <em>is a continuous-time <a href="#input"><code>input</code></a> (<a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a>),</em> \({u_{2}}\) <em>is any type of <a href="#input"><code>input</code></a>,</em> \({u_{3}}\) <em>is a floating point discrete-time <a href="#input"><code>input</code></a> (<a href="#variability"><code>variability</code></a> = "discrete"`), and</em> \({p}\) <em>is a <a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameter</code></a> (<a href="#variability"><code>variability</code></a> = <a href="#fixed"><code>fixed</code></a>).</em>
<em>The initialization is defined by:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[x_1 = 1.1, \frac{dx_2}{dt} = 0, y = 3.3,\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, the initialization equations are:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
x_{2} &amp;= \frac{1}{3 \cdot p^{2}} \cdot ( f_{2}\left( x_{1} \right) + 2 \cdot u_{1} + 3 \cdot u_{3} )
\\
x_{3} &amp;= g_{1}^{- 1}( x_{2}, y)
\end{align*}\]
</div>
</div>
<div class="paragraph">
<p><em>This equation system can be defined as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelVariables&gt;
   &lt;Float64 name="p"       valueReference= "1"/&gt;
   &lt;Float64 name="u1"      valueReference= "2"/&gt;
   &lt;Float64 name="u2"      valueReference= "3"/&gt;
   &lt;Float64 name="u3"      valueReference= "4"/&gt;
   &lt;Float64 name="x1"      valueReference= "5"/&gt;
   &lt;Float64 name="x2"      valueReference= "6"/&gt;
   &lt;Float64 name="x3"      valueReference= "7"/&gt;
   &lt;Float64 name="der(x1)" valueReference= "8" derivative="5"/&gt;
   &lt;Float64 name="der(x2)" valueReference= "9" derivative="6"/&gt;
   &lt;Float64 name="der(x3)" valueReference="10" derivative="7"/&gt;
   &lt;Float64 name="y"       valueReference="11" causality="output"/&gt;
&lt;/ModelVariables&gt;
&lt;ModelStructure&gt;
   &lt;Output valueReference="11" dependencies="6 7"/&gt;
   &lt;StateDerivative valueReference="8"  dependencies="6"/&gt;
   &lt;StateDerivative valueReference="9"  dependencies="2 4 5 6" dependenciesKind="constant constant dependent fixed"/&gt;
   &lt;StateDerivative valueReference="10" dependencies="2 3 4 5 6" /&gt;
   &lt;InitialUnknown valueReference="6" dependencies="2 4 5"/&gt;
   &lt;InitialUnknown valueReference="7" dependencies="2 4 5 11"/&gt;
   &lt;InitialUnknown valueReference="8"/&gt;
   &lt;InitialUnknown valueReference="10"/&gt;
   &lt;InitialUnknown valueReference="11"/&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Example 2:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[y = \left\{ \begin{matrix}
2 \cdot u \ \mathrm{if} \ u &gt; 0 \\
3 \cdot u \ \mathrm{else} \\
\end{matrix}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \({u}\) <em>is a continuous-time <a href="#input"><code>input</code></a> with <a href="#valueReference"><code>valueReference</code></a> = <code>1</code> and</em> \({y}\) <em>is a continuous-time <a href="#output"><code>output</code></a> with <a href="#valueReference"><code>valueReference</code></a> = <code>2</code>.</em>
<em>The definition of the model structure is then:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelStructure&gt;
  &lt;Output valueReference="2" dependencies="1" dependenciesKind="discrete"/&gt;
  &lt;InitialUnknown valueReference="2"/&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>[Note that</em> \({y = d \cdot u}\) <em>where</em> \({d}\) <em>changes only during <a href="#EventMode"><strong>Event Mode</strong></a> (</em> \({d = 2 \cdot u}\) <em>or</em> \({3 \cdot u\ }\) <em>depending on relation</em> \({u &gt; 0}\) <em>that changes only at <a href="#EventMode"><strong>Event Mode</strong></a>).</em>
<em>Therefore <a href="#dependenciesKind"><code>dependenciesKind</code></a> = <a href="#discrete"><code>discrete</code></a>.]</em></p>
</div>
<div class="paragraph">
<p><em>Example 3:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[y = \left\{ \begin{matrix}
2\ \ \mathrm{if}\ \ u &gt; 0 \\
3\ \ \mathrm{else} \\
\end{matrix}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \({u}\) <em>is a continuous-time <a href="#input"><code>input</code></a> with <a href="#valueReference"><code>valueReference</code></a> = <code>1</code> and</em> \({y}\) <em>is a continuous-time <a href="#output"><code>output</code></a> with <a href="#valueReference"><code>valueReference</code></a> = <code>2</code>.</em>
<em>The definition of the model structure is then:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelStructure&gt;
  &lt;Output valueReference="2" dependencies="1" dependenciesKind="dependent"/&gt;
  &lt;InitialUnknown valueReference="2"/&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>[Note that</em> \({y = c}\) <em>where</em> \({c}\) <em>changes only during <a href="#EventMode"><strong>Event Mode</strong></a> (</em> \({c = 2}\) <em>or</em> \({3\ }\) <em>depending on relation</em> \({u &gt; 0}\) <em>that changes only at <a href="#EventMode"><strong>Event Mode</strong></a>).</em>
<em>Therefore <a href="#dependenciesKind"><code>dependenciesKind</code></a> = <a href="#dependenciesKind"><code>dependent</code></a> because it is not a linear relationship on</em> \({u}\). <em>]</em></p>
</div>
<div class="paragraph">
<p><em>Example 4:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{dx}{dt}=u, y=x\]
</div>
</div>
<div class="paragraph">
<p>where <code>u</code> is continuous-time input value reference <code>1</code>, <code>y</code> is a continuous-time output with value reference <code>2</code> and <code>dxdt</code> is a continuous-time derivative with value reference <code>4</code>.
The definition of the model structure is then:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelVariables&gt;
   &lt;Float64 name="u" valueReference= "1"/&gt;
   &lt;Float64 name="y" valueReference= "2" causality="output"/&gt;
   &lt;Float64 name="x" valueReference= "3"/&gt;
   &lt;Float64 name="dxdt" valueReference= "4"/&gt;
&lt;/ModelVariables&gt;
&lt;ModelStructure&gt;
  &lt;Output valueReference="2" dependencies="3" dependenciesKind="constant"/&gt;
  &lt;StateDerivative valueReference="4" dependencies="1" dependenciesKind="constant"/&gt;
  &lt;InitialUnknown valueReference="2" dependencies="3"/&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Defining FMU features with the</em> <a href="#dependencies"><code>dependencies</code></a> <em>list:</em></p>
</div>
<div class="paragraph">
<p><em>[Note that via the <a href="#dependencies"><code>dependencies</code></a> list the supported features of the FMU can be defined.</em>
<em>Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>If a state derivative <code>der_x</code> is a function of a <a href="#parameter"><code>parameter</code></a> p (so of a <a href="#start"><code>start</code></a> value of a variable with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#fixed"><code>fixed</code></a>), and the FMU does not support an iteration over <code>p</code> during <a href="#InitializationMode"><strong>Initialization Mode</strong></a> (for example, to iterate over p such that the state derivative <code>der_x</code> is zero), then the <a href="#dependencies"><code>dependencies</code></a> list of <code>der_x</code> should not include <code>p</code>.</em>
<em>If an FMU is imported in an environment and such an iteration is set up, then the tool can figure out that the resulting algebraic system of equations is structurally singular and therefore can reject such a definition.</em></p>
</li>
<li>
<p><em>For Co-Simulation FMUs, it is common that no algebraic loops over the <a href="#input"><code>input</code></a> / <a href="#output"><code>output</code></a> variables nor over <a href="#start"><code>start</code></a> values is supported.</em>
<em>In such a case, all <a href="#dependencies"><code>dependencies</code></a> lists for <a href="#output"><code>output</code></a> variables under the <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> element should be defined as empty lists defining that the setting of <a href="#input"><code>inputs</code></a> and/or of <a href="#start"><code>start</code></a> values does not influence the <a href="#output"><code>outputs</code></a>.</em>
<em>As a result, it is not possible to formulate algebraic loops of connected FMUs during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.]</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="fmiTerminalsAndIcons">2.4.9. Definition of Terminals and Icons</h4>
<div class="paragraph">
<p>Terminals define semantic groups of variables to ease connecting compatible signals on the system level.
Icons define a graphical representation of an FMU and its terminals.</p>
</div>
<div class="paragraph">
<p>Both can be defined in the separate XML file <code>icons/terminalsAndIcons.xml</code>:</p>
</div>
<div id="terminals_and_icons_overview" class="imageblock text-center">
<div class="content">
<img src="images/schema/fmiTerminalsAndIcons.png" alt="fmiTerminalsAndIcons" width="60%">
</div>
<div class="title">Figure 29. fmiTerminalsAndIcons element.</div>
</div>
<div class="paragraph">
<p>On the top level, the schema consists of the following elements (see <a href="#terminals_and_icons_overview">Figure 29</a>).</p>
</div>
<table id="table-terminal-and-icon-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. fmiTerminalAndIcons element details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;GraphicalRepresentation&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, contains information for importers of FMUs to draw graphical representations of the FMU in a system view.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;Terminals&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, this allows combining input and output variables into logical groups to ease connections on a system level.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="graphicalRepresentation">2.4.9.1. Definition of a Graphical Representation</h5>
<div class="sect5">
<h6 id="_overview_2">2.4.9.1.1. Overview</h6>
<div class="paragraph">
<p>The graphical representation of the FMU and terminals are needed in order to more easily comprehend the meaning of connected FMUs and to help an importing tool to display the terminals and the FMU icon in the way the exporter intended.</p>
</div>
<div class="paragraph">
<p>The graphical representation is fully optional.
The graphical representation of terminals is separate from the terminal definitions in the <code>&lt;Terminals&gt;</code> element.</p>
</div>
<div class="paragraph">
<p>There are two optional elements in the <code>&lt;GraphicalRepresentation&gt;</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>&lt;CoordinateSystem&gt;</code> defines the extent of the whole icon (graphical items may exceed that rectangle).</p>
</li>
<li>
<p>The <code>&lt;Icon&gt;</code> defines an image source for the FMU.</p>
</li>
</ol>
</div>
<div id="figure-schema-GraphicalRepresentation" class="imageblock text-center">
<div class="content">
<img src="images/schema/GraphicalRepresentation.png" alt="GraphicalRepresentation" width="100%">
</div>
<div class="title">Figure 30. GraphicalRepresentation element.</div>
</div>
</div>
<div class="sect5">
<h6 id="_coordinatesystem">2.4.9.1.2. CoordinateSystem</h6>
<div id="figure-schema-CoordinateSystem" class="imageblock text-center">
<div class="content">
<img src="images/schema/CoordinateSystem.png" alt="CoordinateSystem" width="70%">
</div>
<div class="title">Figure 31. CoordinateSytem element.</div>
</div>
<div class="paragraph">
<p>The <code>&lt;CoordinateSystem&gt;</code> element and its defined extent is used as reference for other graphical items.
It also provides a scaling factor to millimeter.</p>
</div>
<div class="paragraph">
<p>The coordinate system is defined by the coordinates of two points, the lower left (<code>x1</code>, <code>y1</code>) corner and the upper right (<code>x2</code>, <code>y2</code>) corner, where the coordinates of the first point shall be less than the coordinates of the second point <em>[a first quadrant coordinate system]</em>.
The x-axis is directed to the right, the y-axis is directed upwards.</p>
</div>
<div class="paragraph">
<p><em>[The exporting tool should define how the coordinate system unit relates to mm display or print out size.</em>
<em>However, an importing tool might choose to use the factor from the default coordinate system extent to the actual coordinate system extent to calculate a scaling factor, to match the default icon size in the importing tool.</em></p>
</div>
<div class="paragraph">
<p><em>The area defined by the coordinate system is suggested to be used as "clickable icon size" in other tools.</em>
<em>A <code>&lt;Terminal&gt;</code> might be placed outside of this area, so the visible bounding box has to be determined by the importing tool.]</em></p>
</div>
<div class="paragraph">
<p>The coordinate system default is <code>x1=-100, y1=-100, x2=100, y2=100</code>.
This extent is used if the <code>&lt;CoordinateSystem&gt;</code> element is missing.
The default <code>suggestedScalingFactorTo_mm</code> is 0.1.
So the default coordinate system display size should be 20 mm width and 20 mm height.</p>
</div>
<div class="paragraph">
<p>The FMU icon and all graphical representations provide the position and extent with the attributes <code>x1</code>, <code>y1</code>, <code>x2</code>, <code>y2</code>.
The values of these attributes directly relate to this coordinate system and are not normalized.
Flipping of the FMU icon or a terminal can be realized by setting its attributes <code>x2 &lt; x1</code> or <code>y2 &lt; y1</code> without changing the coordinate system.</p>
</div>
</div>
<div class="sect5">
<h6 id="_icon">2.4.9.1.3. Icon</h6>
<div id="figure-schema-Icon" class="imageblock text-center">
<div class="content">
<img src="images/schema/Icon.png" alt="Icon" width="40%">
</div>
<div class="title">Figure 32. Icon element.</div>
</div>
<div class="paragraph">
<p>The extent and position of the FMU icon are defined in the <code>&lt;Icon&gt;</code> element.
The optional image file of the FMU icon is placed at the path <code>icons/icon.png</code> in the ZIP archive of the FMU.
The terminals should not be visible in the image.
Optionally an SVG file can be provided if also the PNG file is present.
This enables high quality rendering and printing in importing tools.
This SVG file has to be placed at the path <code>icons/icon.svg</code> in the ZIP archive.</p>
</div>
<div class="paragraph">
<p>The point (<code>x1</code>, <code>y1</code>) maps to the left lower corner of the PNG image or SVG viewport.
The point (<code>x2</code>, <code>y2</code>) maps to the right upper corner of the PNG image or SVG viewport.</p>
</div>
</div>
<div class="sect5">
<h6 id="_placement_extent_and_painting_order_of_graphical_items">2.4.9.1.4. Placement, Extent, and Painting Order of Graphical Items</h6>
<div class="imageblock text-center">
<div class="content">
<img src="images/GraphicalRepresentation.svg" alt="GraphicalRepresentation" width="70%">
</div>
</div>
<div class="paragraph">
<p>The clickable icon size is defined by the <code>&lt;CoordinateSystem&gt;</code> element.
The FMU icon itself may exceed this extent (or bounding box).
The bounding box of the terminals is given by the extent in the terminals element.
Their location is neither limited to the extent of the icon nor the extent of the coordinate system.
<em>[An importing tool has to determine the outer bounding box enclosing all graphical items.]</em></p>
</div>
<div class="paragraph">
<p>Transparent SVG or PNG files are allowed and wanted.
The order of the elements in the XML file defines the order of painting.
The first element in the <code>&lt;TerminalGraphicalRepresentation&gt;</code> is painted first and therefore behind the others, the last element is painted on top of the others and because of that in front of them.
<em>[So the FMU icon should be placed first in the XML file, terminal below.]</em></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="definitionOfTerminals">2.4.9.2. Definition of Terminals</h5>
<div class="sect5">
<h6 id="_overview_3">2.4.9.2.1. Overview</h6>
<div class="paragraph">
<p>Terminals are fully optional and can be ignored by any importing tool.</p>
</div>
<div class="paragraph">
<p>Definition <code>&lt;Terminal&gt;</code>: A terminal is&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a structured interface for connections to other models</p>
</li>
<li>
<p>intended to be used for signal flow between models, parameter propagation, and compatibility checks of the model configuration</p>
</li>
<li>
<p>a sequence of references to variables with connection meta data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Predefined rules for variable matching in a connection are given in <a href="#table-predefined-matching-rules">Table 28</a>.
Predefined variable kinds are used to describe how the member variables have to be handled.
Domain specific connection rules, terminals and their member variables can be provided by other standards.</p>
</div>
<div class="paragraph">
<p><em>[Co-simulation errors are not addressed by the terminals.</em>
<em>The co-simulation algorithm has to be chosen and implemented by the importing tool.</em>
<em>Features that might be required for specific co-simulation algorithms had to be implemented by the FMU exporting tool.</em></p>
</div>
<div class="paragraph">
<p><em>Algebraic loops in systems of connected Model Exchange FMUs are not addressed or resolved by the terminals.</em>
<em>It is not required that the <a href="#causality"><code>causality</code></a> of the terminal member variables in connected terminals match.</em></p>
</div>
<div class="paragraph">
<p><em>The SSP standard refers to a <code>connectorKind</code>.</em>
<em>This <code>connectorKind</code> is not related to the <code>terminalKind</code> or <code>variableKind</code> described in <a href="#section-terminals">Section 2.4.9.2.2</a> and <a href="#section-terminalvars">Section 2.4.9.2.3</a>.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="section-terminals">2.4.9.2.2. Terminals</h6>
<div class="paragraph">
<p>Element <code>&lt;fmiTerminalsAndIcons&gt;&lt;Terminals&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-Terminals" class="imageblock text-center">
<div class="content">
<img src="images/schema/Terminals.png" alt="Terminals" width="80%">
</div>
<div class="title">Figure 33. Terminals element.</div>
</div>
<div class="paragraph">
<p>All instances of <code>&lt;Terminal&gt;</code> have the type <code>fmi3Terminal</code> and are listed in the <code>&lt;Terminals&gt;</code> sequence.</p>
</div>
<div class="paragraph">
<p>The normalized string attribute <code>name</code> of the <code>&lt;Terminal&gt;</code> element is the instance name of the terminal.
The terminal name must be unique on each level.</p>
</div>
<div class="paragraph">
<p>The normalized string attribute <code>matchingRule</code> describes the rules for variable matching in a connection.
As detailed in <a href="#table-predefined-matching-rules">Table 28</a>, there are three predefined matching rules: plug, bus, and sequence.
Other standards may define new matching rules.
In order to avoid ambiguities and conflicts, rule names must follow the reverse domain notation of a domain that is controlled by the entity defining the semantics and content of the additional entries.
The rule names beginning with <code>org.modelica</code> and <code>org.fmi-standard</code> are explicitly reserved for use by MAP FMI-defined layered standards.</p>
</div>
<div class="paragraph">
<p>There is a sequence of terminal member variables, terminal stream member variables, nested terminals, and an optional <code>&lt;TerminalGraphicalRepresentation&gt;</code> element in the <code>&lt;Terminal&gt;</code> element.
The member variables are the exchanged variables.
The type of the nested terminals is <code>fmi3Terminal</code>, and they can be used to implement structured terminals.</p>
</div>
<table id="table-predefined-matching-rules" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. Predefined matching rules.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>matchingRule</code></th>
<th class="tableblock halign-left valign-top">Description

<a id="plug"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matching of the variables is based on <code>memberName</code>.
An importing tool should connect terminals only if all member variables are present and match.</p>
<p class="tableblock"><a id="bus"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matching of the variables is based on <code>memberName</code>.
An importing tool may connect terminals if some or no terminal member variables are present.</p>
<p class="tableblock"><a id="sequence"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sequence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matching of the variables is based on the order of the terminal member variables.
An importing tool should connect terminals only if the number of member variables matches.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The normalized string <code>terminalKind</code> is an optional attribute.
Other standards may define terminal kinds.
It is intended that the <code>terminalKind</code> is used to define domain specific member variable sequences, member names and order, or high level restrictions for connections.</p>
</div>
<div class="paragraph">
<p><em>[Other terminal kinds should refer to the predefined <code>matchingRule</code>.</em>
<em>Vendor specific terminal kinds should start with <code>_vendorName</code> or <code>_toolName</code> to avoid namespace clashes.</em></p>
</div>
<div class="paragraph">
<p><em>Examples for <code>terminalKind</code>: <code>StandardXXX_Mechanical_Translational</code>, <code>Modelica.Mechanics.Translational.Interfaces.Flange_a</code>, <code>vendorNameA_customTypeA</code>, <code>_vendorNameB_customLibrary_customTypeB</code>.</em></p>
</div>
<div class="paragraph">
<p><em>The structured naming convention of the <code>&lt;ModelVariables&gt;</code> is independent from the terminal names and member variable names.</em></p>
</div>
<div class="paragraph">
<p><em>A tool may choose to connect terminals with a different or unknown <code>terminalKind</code>, if the <code>matchingRule</code> matches.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="section-terminalvars">2.4.9.2.3. Terminal Member Variable</h6>
<div class="paragraph">
<p>The <code>&lt;TerminalMemberVariable&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-TerminalMemberVariable" class="imageblock text-center">
<div class="content">
<img src="images/schema/TerminalMemberVariable.png" alt="TerminalMemberVariable" width="70%">
</div>
<div class="title">Figure 34. TerminalMemberVariable element.</div>
</div>
<div class="paragraph">
<p>The normalized string <code>variableName</code> is used to identify the terminal member variable in the element <code>&lt;ModelVariables&gt;</code>.
The information about minimum, maximum, and nominal values is available in there.</p>
</div>
<div class="paragraph">
<p>One variable can be part of several terminals.</p>
</div>
<div class="paragraph">
<p>If the <code>matchingRule</code> <code>plug</code> and <code>bus</code> are used, then the normalized string <code>memberName</code> is used for member variable matching.
So the <code>memberName</code> attribute is required for <code>plug</code> and <code>bus</code> and it has to be unique for a terminal.
The <code>memberName</code> is not required for <code>matchingRule</code> <code>sequence</code>.</p>
</div>
<div class="paragraph">
<p>The normalized string <code>variableKind</code> is used to provide general information about the variable.
This information defines how the connection of this variable has to be implemented (e.g. Kirchhoff&#8217;s current law or common signal flow).</p>
</div>
<div class="paragraph">
<p>The predefined <code>variableKind</code> are:
.Predefined kinds of variables.</p>
</div>
<table id="table-variable-kinds" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>variableKind</code></th>
<th class="tableblock halign-left valign-top">Description

<a id="signal"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The values in connected terminals are intended to be equal.
Restricted to <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a>.
<em>[Example: Signal flow, parameter propagation, equality checks]</em></p>
<p class="tableblock"><a id="inoutflow"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inflow</code> / <code>outflow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variables which fulfill Kirchhoff&#8217;s current law.
Restricted to <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a>.
<em>[Example: Electric current]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[The suggested variable naming scheme for the structured naming convention is &lt;ModelVariable name&gt; = &lt;terminalName&gt;.&lt;memberName&gt;.</em></p>
</div>
<div class="paragraph">
<p><em>Not all <code>&lt;ModelVariables&gt;</code> which have the prefix "&lt;terminalName&gt;." are a member variable, and there may exist member variables which don&#8217;t have this prefix.</em></p>
</div>
<div class="paragraph">
<p><em>Example 1 (suggested scheme): &lt;ModelVariable name&gt; is <code>portA.U</code>, &lt;terminalName&gt; is <code>portA</code>, &lt;memberName&gt; is <code>U</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Example 2 (suggested scheme): &lt;ModelVariable name&gt; is <code>hierarchConn.innerConn.U</code>, &lt;outer terminal name&gt; is <code>hierarchConn</code>, &lt;inner terminal name&gt; is <code>innerConn</code>, &lt;memberName&gt; is <code>U</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Example 3 (no prefix): &lt;ModelVariable name&gt; is <code>u</code>, &lt;terminalName&gt; is <code>portA</code>, &lt;memberName&gt; is <code>u</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Example 4 (prefix but not a member): &lt;ModelVariable name&gt; is <code>portA.u</code>, there is a terminal with &lt;terminalName&gt; <code>portA</code>, but this variable is not a terminal member.</em></p>
</div>
<div class="paragraph">
<p><em>The suggested variable naming scheme for the non-structured naming convention is: &lt;ModelVariable name&gt; = &lt;memberName&gt;</em></p>
</div>
<div class="paragraph">
<p><em>Matching is not restricted by <a href="#variability"><code>variability</code></a>, <a href="#causality"><code>causality</code></a> or variable type.</em>
<em>Example: A <a href="#fixed"><code>fixed</code></a> variable may be connected to a <a href="#tunable"><code>tunable</code></a> variable, a variable of type <code>fmi3Float64</code> may be connected to a variable of type <code>fmi3Int32</code>.</em>
<em>However, it is recommended that the variable types and variabilities are equal.</em></p>
</div>
<div class="paragraph">
<p><em>The <code>matchingRule</code> refers to the <code>&lt;TerminalMemberVariable&gt;</code> on the same level only.</em>
<em>Nested terminals can have different `matchingRule`s.</em></p>
</div>
<div class="paragraph">
<p><em>There is no special handling of <a href="#derivative"><code>derivatives</code></a>.</em>
<em>If a <a href="#derivative"><code>derivative</code></a> is a terminal member variable then it is considered as normal member variable.</em>
<em>However, if a <a href="#derivative"><code>derivative</code></a> of a terminal member variable is not terminal member, then this <a href="#derivative"><code>derivative</code></a> information may be used by an importing tool.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="_terminal_stream_member_variable">2.4.9.2.4. Terminal Stream Member Variable</h6>
<div class="paragraph">
<p>The <code>&lt;TerminalStreamMemberVariable&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-TerminalStreamMemberVariable" class="imageblock text-center">
<div class="content">
<img src="images/schema/TerminalStreamMemberVariable.png" alt="TerminalStreamMemberVariable" width="80%">
</div>
<div class="title">Figure 35. TerminalStreamMemberVariable element.</div>
</div>
<div class="paragraph">
<p>This element is used for variables which fulfill the balance equation for transported quantities.
It is restricted to <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a>.</p>
</div>
<div class="paragraph">
<p>The Stream concept is described in the appendix D.3 of the Modelica specification.
Only one terminal member variable with the <code>variableKind</code> <code>inflow</code> or <code>outflow</code> per terminal is allowed, if a <code>&lt;TerminalStreamMemberVariable&gt;</code> is present.
<em>[More sophisticated structures can be implemented using hierarchical terminals.]</em></p>
</div>
<div class="paragraph">
<p>The attribute <code>inStreamVariableName</code> and <code>outStreamVariableName</code> are used to identify the <code>&lt;ModelVariables&gt;</code>.
If the referenced model variables are arrays, then the size of the <code>inStreamVariableName</code> and <code>outStreamVariableName</code> has to be equal.
A terminal may have more than one <code>&lt;TerminalStreamMemberVariable&gt;</code>.
The <code>inStreamMemberName</code> and <code>outStreamMemberName</code> describe the terminal member name for matching purposes, similar to the <code>memberName</code> attribute in the <code>&lt;TerminalMemberVariable&gt;</code>.</p>
</div>
<div class="paragraph">
<p><em>[An example of use for an array of stream variables is a gas mixture flow.</em>
<em>The gas composition could be implemented as a mass fraction vector.</em>
<em>The <code>outStreamVariableName</code> refers to</em> \(portA.q_\textit{outStream}\textit{[]}\) <em>and the <code>inStreamVariableName</code> refers to</em>  \(portA.q_\textit{inStream}\textit{[]}\) <em>.</em>
<em>The <code>inStreamMemberName</code> and <code>outStreamMemberName</code> are "</em> \(q_\textit{inStream}\textit{[]}\) <em>" and "</em> \(q_\textit{outStream}\textit{[]}\) <em>".</em></p>
</div>
<div class="paragraph">
<p><em>Balance equation for transported quantities:</em></p>
</div>
<div class="paragraph">
<p><em>\(0 = \sum{q_i\dot{m}_i}\)</em></p>
</div>
<div class="paragraph">
<p><em>\(0 = \sum{\dot{m}_i}\cdot
\left\{\begin{array}{ll}
q_{i, \mathit{outStream}} &amp;\textit{if $\dot{m}$ is outflowing through terminal $i$}\\
q_{i, \mathit{inStream}} &amp;\textit{if $\dot{m}$ is inflowing through terminal $i$}
\end{array}\right.\)</em></p>
</div>
<div class="paragraph">
<p><em>The</em> \(q_{i,\mathit{outStream}}\) <em>is the convective quantity in case the matter flows out of the FMU.</em>
\(q_{i,\mathit{inStream}}\) <em>is the convective quantity in case the matter flows into the FMU.</em>
<em>Both variables are present in the terminal.</em>
<em>The outStream variable has the <a href="#causality"><code>causality</code></a> <a href="#output"><code>output</code></a> or <a href="#calculatedParameter"><code>calculatedParameter</code></a> because this information has to be provided by each FMU.</em>
<em>The inStream variable has the <a href="#causality"><code>causality</code></a> <a href="#input"><code>input</code></a> or <a href="#parameter"><code>parameter</code></a>.</em>
<em>To display the actual value in an importing tool, this actual value has to be selected depending on the sign of the terminal member variable with <code>variableKind</code> <code>inflow</code> or <code>outflow</code>.</em>
<em>However, calculating the actual value is not necessary.</em></p>
</div>
<div class="paragraph">
<p><em>If only two terminals with a variable are connected and their <a href="#causality"><code>causality</code></a> matches, then the values of the outStream variables can be forwarded to the corresponding inStream values.</em></p>
</div>
<div class="paragraph">
<p><em>In Modelica the inStream variable is not directly visible, the value can only be accessed using "inStream()", therefore an additional model variable has to be added during the export.</em>
<em>It is suggested that Modelica tools exporting an FMU derive the member name for the inStream variable according to the scheme "&lt;outStream name&gt;_inStream".</em>
<em>E.g. if the outStream name is "h_outflow" then the inStream name should be "h_outflow_inStream".]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="_terminal_graphical_representation">2.4.9.2.5. Terminal Graphical Representation</h6>
<div class="paragraph">
<p>The <code>&lt;TerminalGraphicalRepresentation&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-TerminalGraphicalRepresenation" class="imageblock text-center">
<div class="content">
<img src="images/schema/TerminalGraphicalRepresentation.png" alt="TerminalGraphicalRepresentation" width="75%">
</div>
<div class="title">Figure 36. TerminalGraphicalRepresentation element.</div>
</div>
<div class="paragraph">
<p>The <code>iconBaseName</code> attribute is mandatory.
This attribute defines the base name of the image file as a relative URI according to RFC 3986.
The base URI that this relative URI is resolved against is the URI of the <code>icons/terminalsAndIcons.xml</code> file in the FMU ZIP archive.
Implementations are required to support relative URIs, excluding relative URIs that move beyond the baseURI (i.e. go "up" a level via ..).
Implementations are not required to support any absolute URIs and any specific URI schemes.
The PNG file with the extension '.png' has to be provided.
An additional SVG file with extension '.svg' is optional.</p>
</div>
<div class="paragraph">
<p><em>[Note that this specification is functionally equivalent to looking up image sources from the icons folder of the FMU ZIP archive after dot removal from the path as per section 5.2.4 of RFC 3986.]</em></p>
</div>
<div class="paragraph">
<p>The <code>defaultConnectionStrokeSize</code> and <code>defaultConnectionColor</code> can be provided to define the intended connection line layout in the importing tool.
The stroke size is given relative to the coordinate system extent.
The stroke color is given in RGB values from 0 to 255. E.g.: <code>255 255 0</code>.</p>
</div>
<div class="paragraph">
<p><em>[Nested terminals may have a <code>&lt;TerminalGraphicalRepresentation&gt;</code> element.</em>
<em>However, if and how nested terminals are displayed, is up to the importing tool.]</em></p>
</div>
<div class="paragraph">
<p><em>[The order of painting of the <code>&lt;TerminalGraphicalRepresentation&gt;</code> of terminals on each level is equal to the order of appearance in the <code>&lt;Terminal&gt;</code> element.</em>
<em>So graphical representations appearing first, are painted first, are behind graphical representations which appear below.]</em></p>
</div>
<div class="paragraph">
<p>The <code>Annotations</code> element can be used by vendors to store additional information for the graphical representation.
<em>[It is suggested that Modelica tools store the Modelica annotation of the connector under the <code>type</code> <code>org.modelica.Modelica4Annotation</code> in the annotations of an element <code>connector</code>.</em>
<em>The attribute <code>name</code> of the connector element is equal to the <code>name</code> attribute of the referenced <code>fmi3Terminal</code>.]</em></p>
</div>
<div class="paragraph">
<p><em>[If the graphical representation is used for an <a href="#input"><code>input</code></a> or <a href="#output"><code>output</code></a> (e.g. a <code>fmi3Float64</code> <a href="#input"><code>input</code></a> <code>u</code>), then a <code>&lt;Terminal&gt;</code> has to be added to the <code>&lt;Terminals&gt;</code> element which has one <code>&lt;TerminalMemberVariable&gt;</code>.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="GeneralRemarkOnSignal">2.4.9.2.6. General Remark on Signal</h6>
<div class="paragraph">
<p><em>[The signal <code>variableKind</code> can be applied for different use cases.</em>
<em>The first use case is a signal flow from an <a href="#output"><code>output</code></a> of one FMU to an <a href="#input"><code>input</code></a> of another FMU.</em>
<em>The <a href="#output"><code>output</code></a> value has to be forwarded to the <a href="#input"><code>input</code></a>.</em></p>
</div>
<div class="paragraph">
<p><em>The signal flow can cause algebraic loops.</em>
<em>If variables in connected terminals have the <a href="#causality"><code>causality</code></a> <a href="#output"><code>output</code></a>, then an importing tool may iterate an undefined <a href="#input"><code>input</code></a> of an FMU to ensure that the connected output values are equal.</em></p>
</div>
<div class="paragraph">
<p><em>Another use case is the parameter propagation.</em>
<em>If a variable in both connected terminals has the <a href="#causality"><code>causality</code></a> <a href="#parameter"><code>parameter</code></a>, then an importing tool could ask the user for the value of one of those <a href="#parameter"><code>parameters</code></a> only, and propagate this value to the other FMU.</em>
<em>If only one of the variables has <a href="#causality"><code>causality</code></a> <a href="#parameter"><code>parameter</code></a>, and the other is a <a href="#constant"><code>constant</code></a> <a href="#output"><code>output</code></a> or <a href="#calculatedParameter"><code>calculatedParameter</code></a>, then the importing tool could also propagate the <a href="#parameter"><code>parameter</code></a> value without presenting a parameter to the user.</em>
<em>One example of use would be the name of a substance flowing through a pipe.</em>
<em>If the fluid flows from one pipe FMU to another, the substance should be the same.</em>
<em>This substance name could be propagated over several FMUs.</em></p>
</div>
<div class="paragraph">
<p><em>Finally the <code>variableKind</code> <code>signal</code> can be applied to implement compatibility checks.</em>
<em>If for example the <a href="#variability"><code>variability</code></a> of the variables in connected terminals are <a href="#constant"><code>constant</code></a>, then the importing tool can implement an equality assertion.</em>
<em>This is also possible with <a href="#calculated"><code>calculated</code></a> <a href="#parameter"><code>parameters</code></a>.</em>
<em>One example of use would be the cross sectional flow area in pipes which is calculated from geometry parameters.</em>
<em>A change in the cross sectional flow area is relevant for the momentum equation, and therefore the connection has to be deemed incompatible if these variables are present and unequal.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="_general_remark_on_inflow_and_outflow">2.4.9.2.7. General Remark on Inflow and Outflow</h6>
<div class="paragraph">
<p><em>[Flow variables have a direction and must fulfill a zero sum constraint i.e. the sum of all flow variables connected must be zero (Kirchhoff&#8217;s current law).</em>
<em>In addition because different tools might have different direction definitions both, <code>inflow</code> and <code>outflow</code> are available as <code>variableKind</code>.</em>
<em>For variables with <code>inflow</code> a positive value means that the flow is inwards, and for <code>outflow</code> a positive value means that the flow is outwards.</em>
<em>For the sake of simplicity in the following \(\dot{m}_i\) denotes an inflowing quantity:</em></p>
</div>
<div class="paragraph">
<p><em>\(0 = \sum{\dot{m}_i}\)</em></p>
</div>
<div class="paragraph">
<p><em>[Connecting a single <a href="#output"><code>output</code></a> <code>outflow</code> to a single <a href="#input"><code>input</code></a> <code>inflow</code>, or vice versa automatically fulfills the flow constraint, while connecting two variables of the same flow type requires a negation of the variable value.</em></p>
</div>
<div class="paragraph">
<p><code>inflow</code> <em>and</em> <code>outflow</code> <em>is only used as a sign convention for scalar flow quantities which obey Kirchhoff&#8217;s current law (sum up to zero).</em>
<em>Other, nonscalar, quantities which also sum up to zero, like a mechanical force in 3D space according to D&#8217;Alembert&#8217;s principle, are not covered by this sign convention.</em>
<em>This is the case since Kirchhoff&#8217;s current law only holds for scalars where a sign convention is sufficient.</em>
<em>Other definitions are beyond the scope of this terminal specification and need clear definition in other specifications on top of this.]</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fmu-distribution">2.5. FMU Distribution</h3>
<div class="paragraph">
<p>An FMU consists of several files, that are stored in a ZIP file with a pre-defined structure.
The implementation of the simulation model represented by the FMU may be distributed in source code and/or in binary format.
The FMU must be distributed with at least one implementation, in other words, either sources or one of the binaries for a particular machine.
It is also possible to provide the sources and binaries for different target machines together in one ZIP file.
The FMU must implement all common API functions according to <a href="#general-mechanisms">Section 2.2</a> and the functions for at least one of the FMI interface types.
Especially it is required that all functions that are part of the specified FMI interface type are present, even if they are only needed for optional capabilities that the FMU does not support.
The behavior of those functions is unspecified, so while calling environments can rely on the functions being present, they cannot rely on any particular behavior for functions only needed for capabilities the FMU does not support.
The extension of the ZIP file must be <code>.fmu</code> <em>[, for example, <code>HybridVehicle.fmu</code>]</em>.
The compression method for all files stored in the ZIP archive must be either 8 (<code>deflate</code>), or 0 (<code>store</code>).
Only files stored using compression method 8 (<code>deflate</code>) may be stored with general purpose bit 3 set.
The field <code>version needed to extract</code> of the archive must not be higher than 2.0, and encryption must not be employed.
The archive may not be a split or spanned ZIP archive.
 <em>[These restrictions ensure broad compatibility of the archive with common ZIP processing tools and libraries.)]</em></p>
</div>
<div class="paragraph">
<p><em>[Note: especially section 4.4.17 of <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">the ZIP format specification</a> states that backslashes "\" are forbidden as path separator, only forward slashes "/" are allowed.</em><br>
<em>Non-ASCII directory names are not explicitly forbidden, but might pose a problem on different operating systems and are thus discouraged.]</em></p>
</div>
<div class="paragraph">
<p>Every FMU is distributed with its own ZIP file.</p>
</div>
<div class="sect3">
<h4 id="structure-of-zip">2.5.1. Structure of the ZIP file</h4>
<div id="figure-zip-structure" class="listingblock">
<div class="title">Structure of the ZIP file</div>
<div class="content">
<pre>// Structure of ZIP file of an FMU
modelDescription.xml          // description of FMU (required file)
documentation                 // directory containing the documentation (optional)
   index.html                 // entry point of the documentation
   diagram.png                // descriptive diagram view of the model (optional)
   diagram.svg                // if existing the diagram.png is required (optional)
   &lt;other documentation files&gt;
   licenses                   // directory for licenses (optional)
      license.{txt|html}      // Entry point for license information
      &lt;license files&gt;         // For example BSD licenses
icons                         // FMU and terminal icons (optional)
   terminalsAndIcons.xml      // description of terminals and icons (optional)
   icon.png                   // image file of icon without terminals (optional)
   icon.svg                   // if existing the icon.png is required (optional)
   // all terminal and fmu icons referenced in the graphical representation
sources                       // directory containing the C sources (optional)
   buildDescription.xml
   // All needed C sources and header files to compile and link the FMU
   // except fmi3PlatformTypes.h, fmi3FunctionTypes.h, and fmi3Functions.h.
   // The files to be compiled (but not the files included from these files)
   // have to be reported in the buildDescription.xml.
binaries                      // directory containing the binaries (optional)
   x86_64-windows             // binaries for Windows on Intel 64-bit
      &lt;modelIdentifier&gt;.dll   // shared library of the FMI implementation
      &lt;other DLLs&gt;            // the DLL can include other DLLs
   x86_64-windows-msvc140mt   // static libraries for 64-bit Windows generated
      &lt;modelIdentifier&gt;.lib   // with Visual Studio 2015 with /MT flag
   i686-linux                 // binaries for Linux on Intel 32-bit
      &lt;modelIdentifier&gt;.so    // shared library of the FMI implementation
   aarch32-linux              // binaries for Linux on ARM 32-bit
      &lt;modelIdentifier&gt;.so    // shared library of the FMI implementation
   x86_64-darwin              // binaries for macOS
      &lt;modelIdentifier&gt;.dylib // shared library of the FMI implementation
   // If an FMU is run through one of its binaries all items in that binary
   // folder are recommended to be unpacked at the same location as the binary
   // &lt; modelIdentifier &gt;.* is unpacked. If not it is likely that, if the FMU
   // has dependencies on those items, it will not be able to find them.
resources                     // resources used by the FMU (optional)
   // data in FMU specific files which will be read during initialization;
   // also more folders can be added under resources (tool/model specific).
   // In order for the FMU to access these resource files, the resource directory
   // shall be available in unzipped form and the absolute path to this directory
   // should be reported via argument "resourceLocation" of fmi3InstantiateXXX.
extra                         // Additional (meta-)data of the FMU (optional)
   // additional (meta-)data that is supposed to travel with the FMU;
   // see below for structure and content definition.</pre>
</div>
</div>
<div class="sect4">
<h5 id="documentation-directory">2.5.1.1. Directory Documentation</h5>
<div class="paragraph">
<p><a href="#figure-zip-structure">Structure of the ZIP file</a> defines the files expected in the <code>documentation</code> directory.</p>
</div>
<div class="sect5">
<h6 id="license-information">2.5.1.1.1. Directory Licenses</h6>
<div class="paragraph">
<p>This optional subdirectory can be used to bundle all license texts for the code, binaries or other material (documentation, content of resources folder) contained in the FMU.
If it is present, it must contain either a <a href="https://spdx.dev">license.spdx</a>, <code>license.txt</code> or <code>license.html</code> file as entry point.</p>
</div>
<div class="paragraph">
<p><em>[It is strongly recommended to include all license and copyright related information in the licenses folder of an FMU (especially but not only for contained open source software) - the <code>license.{txt|html}</code> file can serve as an entry point for describing the contained licenses.</em>
<em>This will help the users to comply with license conditions when passing source or binary code contained in an FMU to other persons or organizations.]</em></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Icons-directory">2.5.1.2. Directory Icons</h5>
<div class="paragraph">
<p>See <a href="#fmiTerminalsAndIcons">Section 2.4.9</a> for a definition of the directory <code>icons</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sources-directory">2.5.1.3. Directory Sources</h5>
<div id="BuildConfiguration" class="paragraph">
<p>A source code FMU contains the sources of the model in the <code>sources</code> directory together with a <code>buildDescription.xml</code> that contains at least one <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> element for the supported platforms.
Each <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> provides the necessary information to compile and link the sources of the model into a dynamic library or as part of an executable.
An FMU importing tool may not regard more than one <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> when building the FMU for a specific <a href="#platform"><code>platform</code></a>.
The importer chooses the matching <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> based on the <a href="#platform"><code>platform</code></a> and <a href="#modelIdentifier"><code>modelIdentifier</code></a> attributes.</p>
</div>
<table id="table-BuildConfiguration-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. BuildConfiguration attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="modelIdentifier"></a><code>modelIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The attribute <a href="#modelIdentifier"><code>modelIdentifier</code></a> of the <code>&lt;ModelExchange&gt;</code>, <code>&lt;CoSimulation&gt;</code> or <code>&lt;ScheduledExecution&gt;</code> elements this build configuration is associated with.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="platform"></a><code>platform</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Platform tuple of the platform the <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> is intended for (e.g. <code>x86_64-linux</code>).
All <a href="#platform"><code>platform</code></a> attributes defined in the <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> elements for the same <code>&lt;modelIdentifier&gt;</code> must be unique.
For each <a href="#platform"><code>platform</code></a> there can only be one matching <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a>.
This attribute is optional.
Thus there must not be more than one <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> without a <a href="#platform"><code>platform</code></a> attribute.
If a <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> without a <a href="#platform"><code>platform</code></a> attribute is provided this is the fallback <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> an importer can use if it cannot find any other <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> with a matching <a href="#platform"><code>platform</code></a> attribute.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the build configuration</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_sourcefileset">2.5.1.3.1. SourceFileSet</h6>
<div class="paragraph">
<p>The <code>&lt;SourceFileSet&gt;</code> element groups source files that can be compiled with the same compiler and compiler options.
Every build configuration must contain at least one <code>&lt;SourceFileSet&gt;</code>.
An importer of the FMU has to regard every <code>&lt;SourceFileSet&gt;</code> of the matching <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a>.</p>
</div>
<table id="table-SourceFileSet-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. SourceFileSet attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the <code>&lt;SourceFileSet&gt;</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>language</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Language of the source files (e.g. <code>C99</code>, <code>C++11</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compiler</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The compiler to compile the sources (e.g. <code>VisualC</code>, <code>gcc</code>, <code>clang++</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compilerOptions</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The compiler flags that have to be used when compiling the sources (e.g. <code>-fno-rtti</code>, <code>/Od</code>)</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_sourcefile">2.5.1.3.2. SourceFile</h6>
<table id="table-SourceFile-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. SourceFile attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Path of the source file relative to the <code>sources</code> directory</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_preprocessordefinition">2.5.1.3.3. PreprocessorDefinition</h6>
<div class="paragraph">
<p>The <code>&lt;PreprocessorDefinition&gt;</code> element defines a preprocessor definition that needs to be passed to the compiler when compiling the source files in the <code>&lt;SourceFileSet&gt;</code>.</p>
</div>
<table id="table-ProcessorDefinition-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. ProcessorDefintition attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the preprocessor definition</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Value of the preprocessor definition</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Determines wether the definition is optional (default is <code>false</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the preprocessor definition</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_preprocessordefinitionoption">2.5.1.3.4. PreprocessorDefinition/Option</h6>
<div class="paragraph">
<p>The <code>&lt;Option&gt;</code> element defines a possible value for the <code>&lt;PreprocessorDefinition&gt;</code>.
If a <code>&lt;PreprocessorDefinition&gt;</code> contains <code>&lt;Option&gt;</code> elements, its default value must be contained in the options.</p>
</div>
<table id="table-PreprocessorDefinition-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. PreprocessorDefintition attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Value of the preprocessor definition option</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the preprocessor definition option</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_includedirectory">2.5.1.3.5. IncludeDirectory</h6>
<div class="paragraph">
<p>The <code>&lt;IncludeDirectory&gt;</code> element defines the include directories that need to be passed to the compiler when compiling the source files in the <code>&lt;SourceFileSet&gt;</code>.</p>
</div>
<table id="table-IncludeDirectory-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. IncludeDirectory attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Path of the include directory relative to the <code>sources</code> directory</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Note that the header files <code>fmi3PlatformTypes.h</code> and <code>fmi3FunctionTypes.h/fmi3Functions.h</code> are not included in the FMU because:</em></p>
</div>
<div class="paragraph">
<p><em><code>fmi3PlatformTypes.h</code> makes no sense in the <code>sources</code> directory, because if sources are provided, then the importer defines this header file and not the FMU.</em><br>
<em>This header file is not included in the <code>binaries</code> directory, because it is implicitly defined by the platform directory (for example, <code>i686-windows</code> for a 32-bit machine or <code>x86_64-linux</code> for a 64-bit machine).</em></p>
</div>
<div class="paragraph">
<p><em><code>fmi3FunctionTypes.h</code> / <code>fmi3Functions.h</code> are not needed in the <code>sources</code> directory, because they are implicitly defined by attribute <code>fmiVersion</code> in file <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</em>
<em>Furthermore, in order that the C compiler can check for consistent function arguments, the header file from the importer should be used when compiling the C sources.</em>
<em>It would therefore be counter-productive (unsafe) if this header file was present.</em><br>
<em>These header files are not included in the <code>binaries</code> directory, since they are already utilized to build the executable of the simulation environment.</em>
<em>The version number of the header file used to construct the FMU can be deduced via attribute <code>fmiVersion</code> in file <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> or via function call <a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a>.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="_library">2.5.1.3.6. Library</h6>
<div class="paragraph">
<p>The <code>&lt;Library&gt;</code> element defines a static library required to link the model binary.
An importer of the FMU has to link every library of the matching <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a>.</p>
</div>
<table id="table-Library-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. Library attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the library</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Version specifier of the library as defined in <a href="https://www.python.org/dev/peps/pep-0440/#version-specifiers">PEP 440</a>.
The characters <code>&gt;</code> (greater-than) and <code>&lt;</code> (less-than) must be escaped as <code>&gt;</code> and <code>&lt;</code>.
 <em>[For example <code>2.5</code>, <code>&gt;=2.0,&lt;3.0</code> or <code>&gt;=1.0,!=1.2</code>]</em>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>external</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Boolean attribute that determines wether the library is contained in the <code>binaries/&lt;platform_tuple&gt;</code> directory (<code>false</code>) or if it has to be provided by the environment (<code>true</code>).
The default is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the library definition option</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_examples">2.5.1.3.7. Examples</h6>
<div class="listingblock">
<div class="title">A minimal build configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiBuildDescription fmiVersion="3.0-alpha.5"&gt;

  &lt;BuildConfiguration modelIdentifier="PIDContoller"&gt;
    &lt;SourceFileSet&gt;
      &lt;SourceFile name="all.c"/&gt;
    &lt;/SourceFileSet&gt;
  &lt;/BuildConfiguration&gt;

&lt;/fmiBuildDescription&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Multiple complex build configurations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiBuildDescription fmiVersion="3.0-alpha.5"&gt;

  &lt;BuildConfiguration modelIdentifier="PlantModel" description="Build configuration for desktop platforms"&gt;
    &lt;SourceFileSet language="C99"&gt;
      &lt;SourceFile name="fmi3Functions.c"/&gt;
      &lt;SourceFile name="solver.c"/&gt;
    &lt;/SourceFileSet&gt;
    &lt;SourceFileSet language="C++11"&gt;
      &lt;SourceFile name="model.c"/&gt;
      &lt;SourceFile name="logging/src/logger.c"/&gt;
      &lt;PreprocessorDefinition name="FMI_VERSION" value="3"/&gt;
      &lt;PreprocessorDefinition name="LOG_TO_FILE" optional="true"/&gt;
      &lt;PreprocessorDefinition name="LOG_LEVEL" value="0" optional="true"&gt;
        &lt;Option value="0" description="Log infos, warnings and errors"/&gt;
        &lt;Option value="1" description="Log warnings and errors"/&gt;
        &lt;Option value="2" description="Log only errors"/&gt;
      &lt;/PreprocessorDefinition&gt;
      &lt;IncludeDirectory name="logging/include"/&gt;
    &lt;/SourceFileSet&gt;
    &lt;Library name="hdf5" version="&amp;gt;=1.8,!=1.8.17,&amp;lt;1.10" external="true" description="HDF5"/&gt;
  &lt;/BuildConfiguration&gt;

  &lt;BuildConfiguration modelIdentifier="PlantModel" platform="aarch64-linux"&gt;
    &lt;SourceFileSet language="C99"&gt;
      &lt;SourceFile name="fmi3Functions.c"/&gt;
    &lt;/SourceFileSet&gt;
    &lt;SourceFileSet language="C++11" compiler="clang++" compilerOptions="-fno-rtti"&gt;
      &lt;SourceFile name="model.c"/&gt;
      &lt;PreprocessorDefinition name="NO_FILE_SYSTEM"/&gt;
    &lt;/SourceFileSet&gt;
    &lt;Library name="libm.a" description="OpenLibm math library"/&gt;
  &lt;/BuildConfiguration&gt;

&lt;/fmiBuildDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="binaries-directory">2.5.1.4. Directory Binaries</h5>
<div class="sect5">
<h6 id="platform-tupe-definition">2.5.1.4.1. Platform Tuple Definition</h6>
<div class="paragraph">
<p>The names of the binary directories are standardized by the "platform tuple".
Further names can be introduced by vendors.
Dynamic link libraries must include all referenced resources that are not available on a standard target machine <em>[for example, DLLs on Windows that are built with Visual Studio should be compiled with the <code>/MT</code> option to include the required symbols from the Visual C runtime in the DLL, and not use the option <code>/MD</code> where this is not the case]</em>.
When compiling a shared object on Linux, <code>RPATH="$ORIGIN"</code> has to be set when generating the shared object in order that shared objects used from it, can be dynamically loaded.</p>
</div>
<div class="paragraph">
<p>The binaries must be placed in the respective &lt;platformTuple&gt; directory with the general format <code>&lt;arch&gt;-&lt;sys&gt;{-&lt;abi&gt;{&lt;abi_ver&gt;}{&lt;abi_sub&gt;}}</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Architecture <code>&lt;arch&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM 32-bit Architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM 64-bit Architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i386</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel 3rd generation x86 32-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i586</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel 5th generation x86 32-bit w/o SSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i686</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel 6th generation x86 32-bit with SSE2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel/AMD x86 64-bit</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Operating system <code>&lt;sys&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">darwin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Darwin (macOS, iOS, watchOS, tvOS, audioOS)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Windows</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Application Binary Interface (ABI) <code>&lt;abi&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ELF file format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gnu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">android</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Android</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">macho</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mach object file format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msvc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Visual C</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">ABI version <code>&lt;abi_ver&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2005 (MSVC++ 8.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2008 (MSVC++ 9.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2010 (MSVC++ 10.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2012 (MSVC++ 11.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2013 (MSVC++ 12.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">140</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2015 (MSVC++ 14.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">141</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2017 (MSVC++ 15.x)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">142</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2019 (MSVC++ 16.x)</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Sub-ABI <code>&lt;abi_sub&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">md</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mdd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MDd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MTd</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>[Typical scenarios are to provide binaries only for one machine type (for example, on the machine where the importer is running and for which licenses of run-time libraries are available) or to provide only sources (for example, for translation and download for a particular micro-processor).]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="external-libraries">2.5.1.4.2. External Libraries</h6>
<div class="paragraph">
<p>If run-time libraries are needed by the FMU that have to be present on the target machine and cannot be shipped within the FMU (e.g., due to licensing issues), then automatic processing is likely impossible.
In such cases special handling is needed, for example, by providing the run-time libraries at appropriate places by the receiver.
The requirements and the expected processing should be documented in the <code>documentation</code> directory in this case.<br></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="resources-directory">2.5.1.5. Directory Resources</h5>
<div class="paragraph">
<p>In the optional directory <code>resources</code>, additional data can be provided in FMU specific formats, typically for tables and maps used in the FMU.
This data must be read into the model at the latest during initialization (that is, before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called).
The actual file names in the ZIP file to access the data files can either be hard-coded in the generated FMU functions, or the file names can be provided as string arguments via the <code>fmi3SetString</code> function.
<em>[Note that an URI pointing to the resources directory is provided by the initialization functions.</em>
<em>If the environment is not able to do so, a NULL pointer will be provided instead, and the FMU can react with an error, if it requires access to the content of the resources folder.]</em>
In the case of an FMU implementation of <code>needsExecutionTool = true</code> type, the <code>resources</code> directory can contain the model file in the tool specific file format.</p>
</div>
</div>
<div class="sect4">
<h5 id="extra-directory">2.5.1.6. Directory Extra</h5>
<div class="paragraph">
<p>The ZIP archive may contain additional entries with the prefix <code>extra/</code> that can be used to store additional data and meta-data.
In order to avoid ambiguities and conflicts, the extra files should be provided in subdirectories using a reverse domain notation of a domain that is controlled by the entity defining the semantics and content of the additional entries <em>[(for example <code>extra/com.example/SimTool/meta.xml</code> or <code>extra/org.example.stdname/data.asd</code>)]</em>.
The use of subdirectories beginning with <code>org.modelica</code> and <code>org.fmi-standard</code> is explicitly reserved for use by MAP FMI-defined layered standards, i.e. other uses must not use subdirectory names beginning with these prefixes.
It is explicitly allowed for tools and users other than the original creator of an FMU to modify, add or delete entries in the <code>extra/</code> directory without affecting the validity of the FMU in all other aspects.
Specifically all validation or digital signature schemes used to protect the content of the FMU should take the variability of extra file content into account <em>[(for example by having separate checksums or signatures for FMU core content and extra content, or not having signatures at all for extra content)]</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_interface_types">2.5.2. Multiple Interface Types</h4>
<div class="paragraph">
<p>Exporters may support multiple FMI types in one FMU, so it can be used in differently capable simulation algorithms and for different use cases.
To indicate support for a specific interface type, the <code>&lt;fmiModelDescription&gt;</code> must have the respective element present, irrespective if a specific interface is contained in binary or source format.</p>
</div>
<div class="paragraph">
<p><em>[The described multi-mode support is often based on wrapping functionality into the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> function by emulating missing features of the Model Exchange and Scheduled Execution interface types.]</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Example of different libraries:
   binaries
     x86_64-windows
        MyModel_ModelExchange.dll      // modelIdentifier of &lt;ModelExchange&gt; =
                                       //    "MyModel_ModelExchange"
        MyModel_CoSimulation.dll       // modelIdentifier of &lt;CoSimulation&gt; =
                                       //    "MyModel_CoSimulation"
]</pre>
</div>
</div>
<div class="paragraph">
<p>Support of multiple interface types in one FMU is possible only, if the interface variables are identical.</p>
</div>
</div>
<div class="sect3">
<h4 id="dependency-on-exteranl-tool">2.5.3. Dependency on Installed Tool</h4>
<div class="paragraph">
<p>FMI provides the means for two kinds of implementation: <code>needsExecutionTool = true</code> and <code>needsExecutionTool = false</code>.
In the first case, a tool specific wrapper DLL/SharedObject/Source is part of the FMU.
In the second case, all components necessary for execution of the FMU are included with the FMU.</p>
</div>
</div>
<div class="sect3">
<h4 id="_import_examples">2.5.4. Import Examples</h4>
<div class="paragraph">
<p>The following code examples demonstrate how to access the FMI functions of FMUs that are implemented as a shared library or static library / source code.</p>
</div>
<div class="sect4">
<h5 id="_accessing_fmi_functions_in_shared_libraries">2.5.4.1. Accessing FMI Functions in Shared Libraries</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">/* This example demonstrates how to import an FMU implemented as a shared library */

#ifdef _WIN32
#include &lt;Windows.h&gt;
#else
#include &lt;dlfcn.h&gt;
#endif

#include &lt;stdlib.h&gt;

// FMI function types
#include "fmi3FunctionTypes.h"

#define INSTANTIATION_TOKEN "{8c4e810f-3da3-4a00-8276-176fa3c9f000}"

#ifdef _WIN32
#define RESOURCE_LOCATION "file:/C:/tmp/VanDerPol"
#else
#define RESOURCE_LOCATION "file:///var/tmp/VanDerPol"
#endif

static void cb_logMessage(fmi3InstanceEnvironment instanceEnvironment, fmi3String instanceName, fmi3Status status, fmi3String category, fmi3String message) {
    // log message...
}

int main(int argc, char* argv[]) {

#if defined(_WIN32)
    HMODULE libraryHandle = LoadLibrary("VanDerPol\\binaries\\x86_64-windows\\VanDerPol.dll");
#elif defined(__APPLE__)
    void *libraryHandle = dlopen("VanDerPol/binaries/x86_64-darwin/VanDerPol.dylib", RTLD_LAZY);
#else
    void *libraryHandle = dlopen("VanDerPol/binaries/x86_64-linux/VanDerPol.so", RTLD_LAZY);
#endif

    if (!libraryHandle) {
        return EXIT_FAILURE;
    }

    fmi3InstantiateModelExchangeTYPE *instantiateModelExchange =
#ifdef _WIN32
        GetProcAddress(libraryHandle, "fmi3InstantiateModelExchange");
#else
        dlsym(libraryHandle, "fmi3InstantiateModelExchange");
#endif

    fmi3FreeInstanceTYPE *freeInstance =
#ifdef _WIN32
        GetProcAddress(libraryHandle, "fmi3FreeInstance");
#else
        dlsym(libraryHandle, "fmi3FreeInstance");
#endif

    // load remaining FMI functions...

    if (!instantiateModelExchange || !freeInstance) {
        return EXIT_FAILURE;
    }

    fmi3Instance m = instantiateModelExchange(
        "instance1",             // instance name
        INSTANTIATION_TOKEN,     // instantiation token (from XML)
        RESOURCE_LOCATION,       // resource location (extracted FMU)
        fmi3False,               // visible
        fmi3False,               // debug logging disabled
        NULL,                    // instance environment
        cb_logMessage);          // logger callback


    if (!m) {
        return EXIT_FAILURE;
    }

    // simulation...

    freeInstance(m);

    // unload shared library
#ifdef _WIN32
    FreeLibrary(libraryHandle);
#else
    dlclose(libraryHandle);
#endif

    return EXIT_SUCCESS;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_accessing_fmi_functions_in_static_libraries_and_source_code">2.5.4.2. Accessing FMI Functions in Static Libraries and Source Code</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">/* This example demonstrates how to import an FMU implemented as a static library or source code*/

// FMI function prefix (from XML)
#define FMI3_FUNCTION_PREFIX VanDerPol_
#include "fmi3Functions.h"
#undef FMI3_FUNCTION_PREFIX

#define INSTANTIATION_TOKEN "{8c4e810f-3da3-4a00-8276-176fa3c9f000}"


static void cb_logMessage(fmi3InstanceEnvironment instanceEnvironment, fmi3String instanceName, fmi3Status status, fmi3String category, fmi3String message) {
    // log message
}

int main(int argc, char* argv[]) {

    fmi3Instance m = VanDerPol_fmi3InstantiateModelExchange(
        "instance1",             // instance name
        INSTANTIATION_TOKEN,     // instantiation token (from XML)
        "file:///tmp/VanDerPol", // resource location (extracted FMU)
        fmi3False,               // visible
        fmi3False,               // debug logging disabled
        NULL,                    // instance environment
        cb_logMessage);          // logger callback

    // simulation ...

    VanDerPol_fmi3FreeInstance(m);

    return m ? EXIT_SUCCESS : EXIT_FAILURE;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="VersioningLayered">2.6. Versioning and Layered Standards</h3>
<div class="paragraph">
<p>The FMI standard uses semantic version numbers, as defined in <a href="#PW13">[PW13]</a>, where the standard version consists of a triple of version numbers, consisting of major version, minor version, and patch version numbers <em>[e.g. 1.2.3 for major version 1, minor version 2 and patch version 3]</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Major versions will introduce changes that are neither backward nor forward-compatible, including changes to the XML schemas to include new non-ignorable content.</p>
</li>
<li>
<p>Minor versions will only contain clarifications and include new layered standards, which may add new ignorable XML content, as defined below, into the core standard document, indicating that the standard needs to be supported by all conforming implementations.</p>
</li>
<li>
<p>Patch versions will only change explanatory text of the standard, make formerly defined content clearer, without any other changes to the XML schemas or other content definitions. For this reason, the version number attribute of all FMI files will only contain major and minor version numbers and not the patch version number: It should never be necessary for an importing tool to know the patch version number of the standard that the generating tool implemented.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to enable the backward-compatible extension of the FMI standard in minor releases and between minor releases, the FMI project intends the use of the layered standard mechanism to introduce new features in a fully backward-compatible and optional way.<br>
A layered standard defines extensions to the base FMI standard by specifying either standardized annotations, standardized extra files in the FMU, and/or support for additional MIME types/file formats, defined in <a href="#definition-of-types">Section 2.4.4</a>. <br>
A layered standard can include a single or combined set of extension mechanisms from this set.<br>
The layered standard is thus considered to be layered on top of the definitions and extensions mechanisms provided by this base standard.</p>
</div>
<div class="paragraph">
<p>Layered standards can fall into three categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Layered standards defined by third parties, without any representations by the FMI project for their suitability or content, or even knowledge by the FMI project about their existence.</p>
</li>
<li>
<p>Layered standards defined by third parties that are endorsed by the FMI project and listed on the FMI project website.</p>
</li>
<li>
<p>Layered standards can be defined/adopted and published by the FMI project itself, making them FMI project layered standards.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Layered standards that have achieved enough adoption or importance to be included into the base standard set could be incorporated into a new minor or major release version of the base standard as an optional or mandatory appendix, making support for this layered standard optional or required for conformance with the newly published minor release version of the base standard.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-model-exchange">3. FMI for Model Exchange</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FMI for Model Exchange provides a standardized interface for solving ordinary differential equations with events (abbreviated as "hybrid ODE").
In contrast to FMI for Co-Simulation, a Model Exchange FMU implements the model algorithm only, without the required solution method.</p>
</div>
<div class="paragraph">
<p>The importer controls the data exchange and the synchronization between FMUs.</p>
</div>
<div class="paragraph">
<p>The solver algorithm itself is not part of the FMI standard.</p>
</div>
<div class="paragraph">
<p>The solver algorithm is responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>advancing the overall simulation time,</p>
</li>
<li>
<p>exchange input and output data,</p>
</li>
<li>
<p>computation of continuous state variables by time integration,</p>
</li>
<li>
<p>triggering of input clocks, and</p>
</li>
<li>
<p>handling events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In contrast to Co-Simulation, the FMU is evaluated only at a specific time instant and not from one communication point to the next.
A Model Exchange FMU might consist of discrete-time equations only, for example, describing a sampled-data controller.</p>
</div>
<div class="paragraph">
<p>A schematic view of an FMU for Model Exchange is shown in <a href="#figure-model-exchange-data-flow">Figure 37</a>:</p>
</div>
<div id="figure-model-exchange-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/model-exchange-data-flow.svg" alt="model exchange data flow" width="80%">
</div>
<div class="title">Figure 37. Data flow between the solver of the importer and the FMU for Model Exchange</div>
</div>
<div class="paragraph">
<p>FMI for Model Exchange enables the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>fixed or variable step, explicit or implicit integration algorithms,</p>
</li>
<li>
<p>exact localization of <a href="#state-event">state events</a> using <a href="#fmi3GetEventIndicators">event indicators</a>,</p>
</li>
<li>
<p>dedicated <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, which allows computation of consistent initial conditions over <a href="#algebraic-loops">algebraic loops</a>,</p>
</li>
<li>
<p>handling of <a href="#clock">clocks</a> and <a href="#EventMode">events</a>,</p>
</li>
<li>
<p>solution of algebraic loops involving inputs and output variables of this FMU (see <a href="#algebraic-loops">algebraic loops</a>),</p>
</li>
<li>
<p>selective computation of FMU variables required by the solver algorithm, e.g. outputs, event indicators, derivatives (see <a href="#selectiv-computation">Section 2.2.7</a>),</p>
</li>
<li>
<p>the ability of the FMU to provide <a href="#directionDerivatives">directional</a> and <a href="#adjointDerivatives">adjoint</a> partial derivatives.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which of the features above are supported by a specific FMU is defined by capability flags of the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> (see <a href="#model-exchange-schema">Section 3.4</a>).</p>
</div>
<div class="sect2">
<h3 id="concepts-model-exchange">3.1. Concepts</h3>
<div class="sect3">
<h4 id="_event_handling">3.1.1. Event Handling</h4>
<div class="paragraph">
<p>Integration algorithms for differential equations assume continuous behavior of variables.
In hybrid ODEs, there are points during the simulation, when this assumption is violated.
A hybrid ODE solver must therefore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>locate exactly when such a discontinuity (event) happens and enter <a href="#EventMode"><strong>Event Mode</strong></a>.
This is trivial for <a href="#time-event">time events</a>.
For <a href="#state-event">state events</a> event indicators are used.</p>
</li>
<li>
<p>handle such events in <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</li>
<li>
<p>restart the integration algorithm when leaving <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="state-event"></a>An <a href="#fmi3GetEventIndicators">event indicator</a> signals a <a href="#state-event">state event</a> with the change from \(\mathbf{z}_j &gt; 0\) to \(\mathbf{z}_j \leq 0\) or vice versa.<br>
<em>[This definition is slightly different from the usual standard definition of state events:</em> \(\mathbf{z}(\mathbf{t}) \cdot \mathbf{z}(\mathbf{t}_\mathit{i-1}) \leq 0\) <em>which has the severe drawback that the value of the event indicator at the previous event instant,</em> \(\mathbf{z}(\mathbf{t}_\mathit{i-1}) \neq 0\), <em>must be non-zero and this condition cannot be guaranteed.</em>
<em>The often used term "zero crossing function" for \(\mathbf{z}\) is misleading (and is therefore not used in this document), since a state event is defined by a change of a domain and not by a zero crossing of a variable.]</em></p>
</div>
<div class="paragraph">
<p>The FMU must guarantee that after leaving <a href="#EventMode"><strong>Event Mode</strong></a> \(\mathbf{z}_j \neq 0\), for example, by shifting \(\mathbf{z}_j\) with a small value.<br>
<em>[All event indicators should be continuous between events.</em>
<em>Furthermore, \(\mathbf{z}_j\) should be scaled in the FMU with its nominal value (so all elements of the returned vector <code>eventIndicators</code> should be in the order of 1).]</em></p>
</div>
<div id="figure-events" class="imageblock text-center">
<div class="content">
<img src="images/Event.svg" alt="Event" width="60%">
</div>
<div class="title">Figure 38. An event occurs when the event indicator changes its domain from \(\mathbf{z}&gt;0\) to \(\mathbf{z} \leq 0\) or vice versa.</div>
</div>
<div id="frozen-relations" class="paragraph">
<p>During event localization the FMU might be evaluated after the switch of an event indicator.
Even when an event indicator switches, its corresponding relation must stay "frozen" to assure the continuity assumption of the integration algorithm.
This allows an integration algorithm to properly finish the current integration step.</p>
</div>
<div class="paragraph">
<p>In <a href="#table-variable-types">Table 4</a>, vector \(\mathbf{r}\) is used to label all relations.
In <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> all these relations are "frozen".
This is indicated in <a href="#updateRelations">the mathematical description</a> of <a href="#EventMode"><strong>Event Mode</strong></a> by computing_ \({}^\bullet\mathbf{r}\) when leaving <a href="#EventMode"><strong>Event Mode</strong></a> and using \({}^\bullet\mathbf{r}\) in the right-hand side of \({\mathbf{f}_{\mathit{cont}}}\) and \({\mathbf{f}_{\mathit{comp}}}\) in <a href="#table-math-model-exchange">mathematical description</a> of <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p><em>[Example:</em>
<em>An assignment of the form</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = ((x1 &gt; x2) || (x1 &lt; x3)) ? +1 : -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>can be implemented in the FMU as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>// event indicator computation:
z1 = x1 - x2;
z2 = x3 - x1;

// relations do not change in &lt;&lt;ContinuousTimeMode&gt;&gt;
if &lt;&lt;InitializationMode&gt;&gt; || &lt;&lt;EventMode&gt;&gt; {
  r1 = z1 &gt; 0;
  r2 = z2 &gt; 0;
}
y = (r1 || r2) ? +1 : -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>Therefore, the original if-clause is evaluated in this form only during <a href="#InitializationMode"><strong>Initialization Mode</strong></a> and <a href="#EventMode"><strong>Event Mode</strong></a>.</em>
<em>A hysteresis should be added for the event indicators to stabilize the event localization.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="state-machine-model-exchange">3.2. State Machine for Model Exchange</h3>
<div class="paragraph">
<p>The state machine in <a href="#figure-model-exchange-state-machine">Figure 39</a> defines the allowed calling sequences for FMI for Model Exchange.</p>
</div>
<div id="figure-model-exchange-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machine-model-exchange.svg" alt="state machine model exchange" width="60%">
</div>
<div class="title">Figure 39. Calling sequence of Model Exchange C functions.</div>
</div>
<div class="paragraph">
<p>Common states are defined in <a href="#common-state-machine">Section 2.3</a>, such as super states <a href="#FMUStateSetable"><strong>FMU State Setable</strong></a> and  <a href="#Initialized"><strong>Initialized</strong></a>, states <a href="#Instantiated"><strong>Instantiated</strong></a>, <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a>, <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>, <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#Terminated"><strong>Terminated</strong></a>.</p>
</div>
<div class="sect3">
<h4 id="ContinuousTimeMode">3.2.1. State: Continuous-Time Mode</h4>
<div class="paragraph">
<p>The <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> is used to compute the values of all continuous-time variables between events by numerically solving ordinary differential and algebraic equations.
All discrete-time variables are fixed during this phase and the corresponding discrete-time equations are not evaluated.</p>
</div>
<div class="paragraph">
<p>In this state, the continuous-time equations are active and integrator steps are performed.</p>
</div>
<table id="table-math-model-exchange" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 70%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{t} := (\)<a href="#time"><code>time</code></a>\(, 0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetTime"><code>fmi3SetTime</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c}(\mathbf{t})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time <a href="#state"><code>states</code></a> \(\mathbf{x}_{c}(\mathbf{t})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetFloat64</code>, <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>\((\mathbf{y}_{c}, \mathbf{\dot{x}}_c, \mathbf{z}, \mathbf{w}_{c}) := \mathbf{f}_{\mathit{cont}}(\mathbf{x}_{c}, {}^\bullet\mathbf{x}_{d}, \mathbf{u}_{c}, {}^\bullet\mathbf{u}_{d}, \mathbf{p}, {}^\bullet\mathbf{r}, {}^\bullet\mathbf{b}, \mathbf{t})\)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>fmi3Get{VariableType}</code>,
<a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a>,
<a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Evaluate model equations with valid values for the right-hand side:<br>
\((\mathbf{y}_{c}, \mathbf{\dot{x}}_c, \mathbf{z}, \mathbf{w}_{c}, \mathbf{b},\)<a href="#enterEventMode"><code>enterEventMode</code></a>\() := \mathbf{f}_{\mathit{comp}}(\mathbf{x}_{c}, {}^\bullet\mathbf{x}_{d}, \mathbf{u}_{c}, {}^\bullet\mathbf{u}_{d}, \mathbf{p}, {}^\bullet\mathbf{r}, {}^\bullet\mathbf{b}, \mathbf{t})\)</p>
</li>
<li>
<p>Update previous values of <a href="#buffers">buffers</a>: \({}^\bullet\mathbf{b}:=\mathbf{b}\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Evaluate \(\mathbf{f}_{\mathit{cont}}\), if no <code>fmi3GetXXX</code> function was called</p>
</li>
<li>
<p>Deactivate continuous-time equations \(\mathbf{f}_{\mathit{cont}}\)</p>
</li>
<li>
<p>Activate event equations \(\mathbf{f}_{\mathit{event}}\)</p>
</li>
<li>
<p>\(\mathbf{t}:=(\mathbf{t}_\mathit{R}, 0)\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
</dl>
</div>
<div id="fmi3SetTime" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3SetTime"><code>fmi3SetTime</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetTimeTYPE(fmi3Instance instance, fmi3Float64 time);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set a new value for the independent variable (typically a time instant).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="time"></a> Argument <code>time</code> is the new value for the real part \(\mathbf{t}_\mathit{R}\) of \(\mathbf{t} := (\mathbf{t}_\mathit{R}, 0)\).
It refers to the unit of the <a href="#independent"><code>independent</code></a> variable.
<a href="#time"><code>time</code></a> must be larger or equal to:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#startTime"><code>startTime</code></a>,</p>
</li>
<li>
<p>the time at the second last call to <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>,</p>
</li>
<li>
<p>the time at the last call to <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Function <code>fmi3Set{VariableType}</code></dt>
<dd>
<p>Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selectiv-computation">computations</a>.</p>
</dd>
</dl>
</div>
<div id="fmi3SetContinuousStates" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetContinuousStatesTYPE(fmi3Instance instance,
                                               const fmi3Float64 continuousStates[],
                                               size_t nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set new continuous state values.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>continuousStates</code> contains the new values for each <a href="#state">continuous state</a>.
The order of the <code>continuousStates</code> vector must be the same as the ordered list of elements <a href="#StateDerivative"><code>&lt;StateDerivative&gt;</code></a> in <code>&lt;ModelStructure&gt;</code>.
Array variables are serialized as defined in <a href="#serialization-of_variables">Section 2.2.6.1</a>.
This order is also used in the arguments of the following functions: <a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a>, <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>, and <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a>.</p>
</li>
<li>
<p>Argument <code>nContinuousStates</code> is the size of the <code>continuousStates</code> vector.</p>
<div class="paragraph">
<p><em>[<a href="#fmi3Discard"><code>fmi3Status == fmi3Discard</code></a> should be returned if the FMU rejects any of the state values because they, for example, violate min/max value restrictions.]</em></p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selectiv-computation">computations</a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a></dt>
<dd>
<p>Returns the current continuous state vector.</p>
</dd>
</dl>
</div>
<div id="fmi3GetDerivatives" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetDerivativesTYPE(fmi3Instance instance,
                                          fmi3Float64 derivatives[],
                                          size_t nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns the first-order derivatives with respect to the independent variable (usually time) of the continuous states.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Return argument <code>derivatives</code> contains the derivatives for each <a href="#state">continuous state</a> with the same convention for the order as defined for <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>.</p>
</li>
<li>
<p>Argument <code>nContinuousStates</code> is the size of the <code>derivatives</code> vector.</p>
<div class="paragraph">
<p><em>[<a href="#fmi3Discard"><code>fmi3Status == fmi3Discard</code></a> should be returned if the FMU was not able to compute the derivatives according to</em> \(\mathbf{f}_{\mathit{cont}}\) <em>because, for example, a numerical issue, such as division by zero, occurred.]</em></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="fmi3GetEventIndicators" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetEventIndicatorsTYPE(fmi3Instance instance,
                                              fmi3Float64 eventIndicators[],
                                              size_t nEventIndicators);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns the event indicators signaling <a href="#state-event">state events</a> by their sign changes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="eventIndicators"></a>Return argument <code>eventIndicators</code> contains the values for the event indicators in the order defined by the ordered list of elements <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a>.</p>
</li>
<li>
<p>Argument <code>nEventIndicators</code> is the size of the <code>eventIndicators</code> vector.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[<a href="#fmi3Discard"><code>fmi3Status == fmi3Discard</code></a> should be returned if the FMU was not able to compute the event indicators according to</em> \(\mathbf{f}_{\mathit{cont}}\) <em>because, for example, a numerical issue, such as division by zero, occurred.]</em></p>
</div>
</dd>
</dl>
</div>
<div id="fmi3CompletedIntegratorStep" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3CompletedIntegratorStepTYPE(fmi3Instance instance,
                                                   fmi3Boolean noSetFMUStatePriorToCurrentPoint,
                                                   fmi3Boolean* enterEventMode,
                                                   fmi3Boolean* terminateSimulation);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function is called after every completed step of the integrator provided the capability flag <code>completedIntegratorStepNotNeeded = false</code>.
The importer must have set valid values for <a href="#time"><code>time</code></a>, <a href="#continuous"><code>continuous</code></a> <a href="#input"><code>inputs</code></a> and <a href="#continuous"><code>continuous</code></a> <a href="#state"><code>states</code></a> prior to calling this function to evaluate \(\mathbf{f}_{\mathit{comp}}\) with valid right-hand side data.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>noSetFMUStatePriorToCurrentPoint == fmi3True</code> if <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> will no longer be called for time instants prior to current time in this simulation run.</p>
</li>
<li>
<p><a id="enterEventMode"></a> The return argument <code>enterEventMode</code> signals that the importer must call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> to handle a <a href="#step-event">step event</a>.</p>
</li>
<li>
<p><a id="terminateSimulationCIS"></a> When <a href="#terminateSimulationUDS"><code>terminateSimulation == fmi3True</code></a>, the FMU requests to stop the simulation and the importer must call <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>.</p>
<div class="paragraph">
<p>When the importer has reached valid values for the current integration step and one or more event indicators change sign (with respect to the previously completed integrator step), then the importer has to determine the time instant of the sign change that is closest to the previously completed integrator step.
This is usually performed by an iteration where time is varied and <a href="#state"><code>state</code></a> variables are determined by interpolation.
Function <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> must be called after this <a href="#state-event">state event</a> location procedure.
The intended purpose of the function call is to indicate to the FMU that at this stage all <a href="#input"><code>inputs</code></a> and <a href="#state"><code>state</code></a> variables have valid (accepted) values.
After <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> is called, it is still allowed to go back in time (calling <a href="#fmi3SetTime"><code>fmi3SetTime</code></a>) and inquire values of variables at previous time instants with <code>fmi3Get{VariableType}</code> <em>[for example, to determine values of non-state variables at output points]</em>.
However, it is not allowed to go back in time over the previous <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> or the last <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> call.</p>
</div>
<div class="paragraph">
<p><em>[This function might be used, for example, for the following purposes:</em></p>
</div>
</li>
<li>
<p><em>Update delay buffers</em></p>
</li>
<li>
<p><em>Detect <a href="#step-event">step events</a> and request handling of <a href="#step-event">step events</a> for <a href="#dynamic-state-selection">dynamic state selection</a>:</em><br>
<em>The FMU checks whether the dynamically selected states are still numerically appropriate.</em>
<em>If not, the function returns with <code>enterEventMode == fmi3True</code>, the importer will call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> and in <a href="#EventMode"><strong>Event Mode</strong></a> the new mapping is computed by the FMU.</em>
<em>This new mapping might require a reinitialization of continuous states, which must be signaled to the importer by returning from <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> with <a href="#valuesOfContinuousStatesChanged"><code>valuesOfContinuousStatesChanged == fmi3True</code></a>.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>The function <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> is not used to detect <a href="#time-event">time events</a> or <a href="#state-event">state events</a>, for example, by comparing event indicators of the previous with the current call of <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>.</em>
<em><a href="#time-event">Time events</a> and <a href="#state-event">state events</a> must be detected by the importer, which has to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> in these cases, even if the returning from <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> with <code>enterEventMode == fmi3False</code>.]</em></p>
</div>
</dd>
</dl>
</div>
<div id="fmi3EnterEventMode" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterEventModeTYPE(fmi3Instance instance,
                                          fmi3Boolean stepEvent,
                                          fmi3Boolean stateEvent,
                                          const fmi3Int32 rootsFound[],
                                          size_t nEventIndicators,
                                          fmi3Boolean timeEvent);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function changes the state to <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Model Exchange only: <code>stepEvent == fmi3True</code> signals that a <a href="#step-event">step event</a> occurs.</p>
</li>
<li>
<p>Model Exchange only: <code>stateEvent == fmi3True</code> signals that a <a href="#state-event">state event</a> occurs.</p>
</li>
<li>
<p>Model Exchange only: <code>rootsFound</code> is an array of length <code>nEventIndicators</code> that informs the FMU which event indicator has a root.<br>
For <code>i = 0, &#8230;&#8203; nEventIndicators-1, rootsFound[i]</code> informs about event indicator \({\mathbf{z}_{\mathit{i}}}\):</p>
<div class="ulist">
<ul>
<li>
<p><code>rootsFound[i] == 0</code> no root,</p>
</li>
<li>
<p><code>rootsFound[i] == +1</code> indicates the direction of the zero-crossing from negative to positive,</p>
</li>
<li>
<p><code>rootsFound[i] == -1</code> indicates the direction of the zero-crossing from positive to negative.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>nEventIndicators == 0</code> the value of <code>rootsFound</code> is not defined.
The order in the <code>rootsFound</code> array is the same as in <a href="#eventIndicators"><code>eventIndicators</code></a> of <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>.</p>
</div>
</li>
<li>
<p>Model Exchange only: <code>nEventIndicators</code> contains the number of event indicators as deduced from the list <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a> or <code>0</code> if the importer cannot provide this information.</p>
</li>
<li>
<p><a id="timeEvent"></a><code>timeEvent == fmi3True</code> signals that this event is a <a href="#time-event">time event</a> triggered by <a href="#nextEventTime"><code>nextEventTime</code></a> of <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[An <a href="#input-event">input event</a> can be detected by the FMU by keeping track of the calls of <code>fmi3Set{VariableType}</code> in <a href="#EventMode"><strong>Event Mode</strong></a>.]</em></p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that simulation backward in time is only allowed over continuous time intervals.
As soon as an event occurs (<a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> was called), going back in time is forbidden, because <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> / <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> can only compute the next discrete state, not the previous one.</p>
</div>
<div class="paragraph">
<p>Note that during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a>, and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>, <a href="#input"><code>input</code></a> variables can be set with <code>fmi3Set{VariableType}</code> and output variables can be retrieved with <code>fmi3Get{VariableType}</code> interchangeably according to the model structure defined under element <code>&lt;ModelStructure&gt;</code> in the XML file.
<em>[For example, if one <a href="#output"><code>output</code></a> <code>y1</code> depends on two <a href="#input"><code>inputs</code></a> <code>u1</code>, <code>u2</code>, then these two <a href="#input"><code>inputs</code></a> must be set, before <code>y1</code> can be retrieved.</em>
<em>If additionally an <a href="#output"><code>output</code></a> <code>y2</code> depends on an <a href="#input"><code>input</code></a> <code>u3</code>, then <code>u3</code> can be set and <code>y2</code> can be retrieved afterwards.</em>
<em>As a result, artificial or <code>real</code> algebraic loops over connected FMUs in any of these three modes can be handled by using appropriate numerical algorithms.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_example">3.3. Code Example</h3>
<div class="paragraph">
<p>In the following example, the usage of the <code>fmi3XXX</code> functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
Furthermore, it is assumed that one FMU is directly integrated in a simulation environment.
If the FMU would be used inside another model, additional code is needed, especially initialization and event iteration has to be adapted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">m = M_fmi3InstantiateModelExchange("m", INSTANTIATION_TOKEN, NULL, fmi3False, fmi3False, NULL, cb_logMessage);
// "m" is the instance name
// "M_" is the MODEL_IDENTIFIER

if (m == NULL) {
    status = fmi3Error;
    goto TERMINATE;
}

// set the start time
time  = tStart;

// set all variable start values (of "ScalarVariable / &lt;type&gt; / start") and
// set the start values at time = Tstart
// M_fmi3SetReal/Integer/Boolean/String(m, ...)

// initialize
// determine continuous and discrete states
CHECK_STATUS(M_fmi3EnterInitializationMode(m, fmi3False, 0.0, tStart, fmi3True, tEnd));
CHECK_STATUS(M_fmi3ExitInitializationMode(m));

initialEventMode = fmi3True;
enterEventMode   = fmi3False;
timeEvent        = fmi3False;
stateEvent       = fmi3False;

// initialize previous event indicators
CHECK_STATUS(M_fmi3GetEventIndicators(m, previous_z, NZ));

initialEventMode = fmi3False;

CHECK_STATUS(M_fmi3EnterContinuousTimeMode(m));

// retrieve initial state x and
// nominal values of x (if absolute tolerance is needed)
CHECK_STATUS(M_fmi3GetContinuousStates(m, x, NX));
CHECK_STATUS(M_fmi3GetNominalsOfContinuousStates(m, x_nominal, NX));

// retrieve solution at t=Tstart, for example, for outputs
// M_fmi3SetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

while (!terminateSimulation) {

    tNext = time + h;

    // handle events
    if (enterEventMode || stateEvent || timeEvent) {

        if (!initialEventMode) {
            CHECK_STATUS(M_fmi3EnterEventMode(m, fmi3False, rootsFound, NZ, timeEvent));
        }

        // event iteration
        fmi3Boolean newDiscreteStatesNeeded           = fmi3True;
        fmi3Boolean terminateSimulation               = fmi3False;
        fmi3Boolean nominalsOfContinuousStatesChanged = fmi3False;
        fmi3Boolean valuesOfContinuousStatesChanged   = fmi3False;
        fmi3Boolean nextEventTimeDefined              = fmi3False;
        fmi3Float64 nextEventTime                     = 0;

        while (newDiscreteStatesNeeded) {

            // set inputs at super dense time point
            // M_fmi3SetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

            fmi3Boolean nominalsChanged = fmi3False;
            fmi3Boolean statesChanged   = fmi3False;

            // update discrete states
            CHECK_STATUS(M_fmi3NewDiscreteStates(m, &amp;newDiscreteStatesNeeded, &amp;terminateSimulation, &amp;nominalsChanged, &amp;statesChanged, &amp;nextEventTimeDefined, &amp;nextEventTime));

            // getOutput at super dense time point
            // M_fmi3GetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

            nominalsOfContinuousStatesChanged |= nominalsChanged;
            valuesOfContinuousStatesChanged   |= statesChanged;

            if (terminateSimulation) goto TERMINATE;
        }

        // enter Continuous-Time Mode
        CHECK_STATUS(M_fmi3EnterContinuousTimeMode(m));

        // retrieve solution at simulation (re)start
        CHECK_STATUS(recordVariables(outputFile, m, time));

        if (initialEventMode || valuesOfContinuousStatesChanged) {
            // the model signals a value change of states, retrieve them
            CHECK_STATUS(M_fmi3GetContinuousStates(m, x, NX));
        }

        if (initialEventMode || nominalsOfContinuousStatesChanged) {
            // the meaning of states has changed; retrieve new nominal values
            CHECK_STATUS(M_fmi3GetNominalsOfContinuousStates(m, x_nominal, NX));
        }

        if (nextEventTimeDefined) {
            tNext = min(nextEventTime, tEnd);
        } else {
            tNext = tEnd;
        }

        initialEventMode = fmi3False;
    }

    if (time &gt;= tEnd) {
        goto TERMINATE;
    }

    // compute derivatives
    CHECK_STATUS(M_fmi3GetDerivatives(m, der_x, NX));

    // advance time
    h = min(fixedStep, tNext - time);
    time += h;
    CHECK_STATUS(M_fmi3SetTime(m, time));

    // set continuous inputs at t = time
    // M_fmi3SetFloat*(m, ...)

    // set states at t = time and perform one step
    for (size_t i = 0; i &lt; NX; i++) {
        x[i] += h * der_x[i]; // forward Euler method
    }

    CHECK_STATUS(M_fmi3SetContinuousStates(m, x, NX));

    // get event indicators at t = time
    CHECK_STATUS(M_fmi3GetEventIndicators(m, z, NZ));

    stateEvent = fmi3False;

    for (size_t i = 0; i &lt; NZ; i++) {

        // check for zero crossings
        if (previous_z[i] &lt; 0 &amp;&amp; z[i] &gt;= 0) {
            rootsFound[i] = 1;   // -\+
        } else  if (previous_z[i] &gt; 0 &amp;&amp; z[i] &lt;= 0) {
            rootsFound[i] = -1;  // +/-
        } else {
            rootsFound[i] = 0;   // no zero crossing
        }

        stateEvent |= rootsFound[i];

        previous_z[i] = z[i]; // remember the current value
    }

    // inform the model about an accepted step
    CHECK_STATUS(M_fmi3CompletedIntegratorStep(m, fmi3True, &amp;enterEventMode, &amp;terminateSimulation));

    // get continuous output
    // M_fmi3GetFloat*(m, ...)
    CHECK_STATUS(recordVariables(outputFile, m, time));
}

TERMINATE:

if (m &amp;&amp; status != fmi3Error &amp;&amp; status != fmi3Fatal) {
    // retrieve final values and terminate simulation
    CHECK_STATUS(recordVariables(outputFile, m, time));
    fmi3Status s = M_fmi3Terminate(m);
    status = max(status, s);
}

if (m &amp;&amp; status != fmi3Fatal) {
    // clean up
    M_fmi3FreeInstance(m);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above errors are handled by the following definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">#define CHECK_STATUS(S) status = S; if (status != fmi3OK) goto TERMINATE;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="model-exchange-schema">3.4. Description Schema</h3>
<div class="paragraph">
<p>The common XML elements and attributes are defined in <a href="#fmi-description-schema">Section 2.4</a>.
Additional elements and attributes are defined subsequently.
If the FMU implements the Model Exchange interface type, the element <code>&lt;ModelExchange&gt;</code> must be present.
It is defined as:</p>
</div>
<div id="figure-schema-ModelExchange" class="imageblock text-center">
<div class="content">
<img src="images/schema/ModelExchange.png" alt="ModelExchange" width="80%">
</div>
<div class="title">Figure 40. ModelExchange element.</div>
</div>
<div class="paragraph">
<p>The attributes in the following table are defined on top of the <a href="#common-capability-flags">common attributes</a> and have the following meaning (all attributes are optional with exception of <a href="#modelIdentifier"><code>modelIdentifier</code></a>):</p>
</div>
<table id="table-ModelExchange-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. ModelExchange attribute details.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#modelIdentifier"><code>modelIdentifier</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short class name according to C syntax, for example, <code>A_B_C</code>.
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries, but not if the functions are provided by a DLL/SharedObject.
<a href="#modelIdentifier"><code>modelIdentifier</code></a> is also used as name of the static library or DLL/SharedObject.
See also <a href="#header-files-and-naming-of-functions">Section 2.2.1</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>completedIntegratorStepNotNeeded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, function <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> need not be called.
If it is called, it has no effect.<br>
If <code>false</code> (the default), the function must be called after every completed integrator step, see <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="xml-example-model-exchange">3.4.1. Example XML Description File</h4>
<div class="paragraph">
<p>When generating an FMU from the hypothetical model <code>MyLibrary.SpringMassDamper</code>, the XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription
  fmiVersion="3.0-alpha.5"
  modelName="MyLibrary.SpringMassDamper"
  instantiationToken="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2011-09-23T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;ModelExchange modelIdentifier="MyLibrary_SpringMassDamper"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="N.m"&gt;
      &lt;BaseUnit kg="1" m="2" s="-2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;Float64Type name="Modelica.Units.SI.Inertia" quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.Torque" quantity="Torque" unit="N.m"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.AngularVelocity" quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.Angle" quantity="Angle" unit="rad"/&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;Float64 name="inertia1.J" valueReference="1073741824"
      description="Moment of load inertia" causality="parameter" variability="fixed"
      declaredType="Modelica.Units.SI.Inertia" start="1"/&gt;
    &lt;Float64 name="torque.tau" valueReference="536870912"
      description="Accelerating torque acting at flange (= -flange.tau)" causality="input"
      declaredType="Modelica.Units.SI.Torque" start="0"/&gt;
    &lt;Float64 name="inertia1.phi" valueReference="805306368"
      description="Absolute rotation angle of component" causality="output"
      declaredType="Modelica.Units.SI.Angle"/&gt;
    &lt;Float64 name="inertia1.w" valueReference="805306369"
      description="Absolute angular velocity of component (= der(phi))" causality="output"
      declaredType="Modelica.Units.SI.AngularVelocity"/&gt;
    &lt;Float64 name="x[1]" valueReference="0" initial="exact" start="0"/&gt;
    &lt;Float64 name="x[2]" valueReference="1" initial="exact" start="0"/&gt;
    &lt;Float64 name="der(x[1])" valueReference="2" derivative="0"/&gt;
    &lt;Float64 name="der(x[2])" valueReference="3" derivative="1"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Output valueReference="805306368"/&gt;
    &lt;Output valueReference="805306369"/&gt;
    &lt;StateDerivative valueReference="2"/&gt;
    &lt;StateDerivative valueReference="3"/&gt;
    &lt;InitialUnknown valueReference="805306368"/&gt;
    &lt;InitialUnknown valueReference="805306369"/&gt;
    &lt;InitialUnknown valueReference="2" dependencies="0 536870912"/&gt;
    &lt;InitialUnknown valueReference="3" dependencies="0 1"/&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-co-simulation">4. FMI for Co-Simulation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FMI for Co-Simulation provides a standardized interface for execution of simulation models or tools in a co-simulation environment.
In contrast to FMI for Model Exchange, a Co-Simulation FMU implements not only the model algorithm, but also the required solution method.
The data exchange between FMUs is restricted to discrete communication points \(\mathbf{t}_i\) (unless <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> is used).
In the time between two communication points (or between entering <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>), the subsystem inside an FMU is solved independently by internal means.
This leads to a delay for information "traveling through" the FMU, so there cannot be an immediate reaction (direct feedthrough) as in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>.
The co-simulation algorithm of the importer controls the data exchange and the synchronization between FMUs.</p>
</div>
<div class="paragraph">
<p>The co-simulation algorithm itself is not part of the FMI standard.</p>
</div>
<div class="paragraph">
<p>The co-simulation algorithm is responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>advancing the overall simulation time,</p>
</li>
<li>
<p>exchange input and output data,</p>
</li>
<li>
<p>triggering of input clocks, and</p>
</li>
<li>
<p>handling events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For FMI for Co-Simulation the co-simulation algorithm is shielded from how the FMU advances time internally.
For example, FMUs containing ODEs and implementing FMI for Co-Simulation require to include an ODE solver inside the FMU to internally advance time between the communication points.
As another example, FMUs representing controller code, an internal scheduling algorithm will trigger tasks at the correct time and order while advancing time to the next communication point.</p>
</div>
<div class="paragraph">
<p>A schematic view of an FMU for Co-Simulation is shown in <a href="#figure-co-simulation-data-flow">Figure 41</a> (<a href="#KS00">[KS00]</a>).</p>
</div>
<div id="figure-co-simulation-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-data-flow.svg" alt="co simulation data flow" width="80%">
</div>
<div class="title">Figure 41. Data flow between the co-simulation algorithm of the importer and the FMU for Co-Simulation</div>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation enables the following features, allowing co-simulation algorithms of arbitrary sophistication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>variable or constant communication step sizes \(\mathbf{h}_i\) (see <a href="#communicationStepSize"><code>communicationStepSize</code></a>),</p>
</li>
<li>
<p>reject and repeat communication steps (see <a href="#get-set-fmu-state">Section 2.2.6.4</a>), e.g. with reduced communication step size or a different set of input values,</p>
</li>
<li>
<p>update inputs and retrieve outputs at intermediate points within a communication step (see <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>),</p>
</li>
<li>
<p>return early from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> at \(\mathbf{t} \leq \mathbf{t}_{i+1}\), because, for example, an event influencing the environment was detected by the FMU (see <a href="#early-return">Section 4.1.2</a>),</p>
</li>
<li>
<p>dedicated <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, which allows computation of consistent initial conditions over <a href="#algebraic-loops">algebraic loops</a>,</p>
</li>
<li>
<p>handling of <a href="#clock">clocks</a> and <a href="#EventMode">events</a>,</p>
</li>
<li>
<p>the ability of the FMU to provide <a href="#derivative"><code>derivatives</code></a> of <a href="#output"><code>outputs</code></a> w.r.t. time, to allow approximation techniques (<a href="#getting-output-derivatives">Section 2.2.12</a>), and</p>
</li>
<li>
<p>the ability of the FMU to provide <a href="#directionDerivatives">directional</a> and <a href="#adjointDerivatives">adjoint</a> partial derivatives.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which of the features above are supported by a specific FMU is defined by capability flags of the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> (see <a href="#co-simulation-schema">Section 4.4</a>).</p>
</div>
<div class="sect2">
<h3 id="concepts-co-simulation">4.1. Concepts</h3>
<div class="sect3">
<h4 id="smoothness">4.1.1. Smoothness, Continuity and Discontinuity</h4>
<div class="paragraph">
<p>Since inputs will be set at specific communication points by the importing tool, the FMU must make assumptions about the values between these communication points, including points of intermediate updates.</p>
</div>
<div class="paragraph">
<p>Between communication points, even in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>, all changes must be assumed to be continuous.
Changes to <a href="#continuous"><code>continuous</code></a> variables are only considered discrete in <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>If a <a href="#continuous"><code>continuous</code></a> input changes discontinuously (e.g. the actual input value deviates too much from the extrapolation polynomial), the co-simulation algorithm must raise an event (if supported) to indicate to the FMU a discontinuous change at an <a href="#continuous"><code>continuous</code></a> input.
In the case of Co-Simulation without <a href="#EventMode"><strong>Event Mode</strong></a> (see <a href="#eventModeUsed"><code>eventModeUsed</code></a> and <a href="#hasEventMode"><code>hasEventMode</code></a>), detecting discrete changes to continuous input variables (for instance to reset the integration algorithm within the FMU) requires heuristics.</p>
</div>
<div class="paragraph">
<p><a href="#discrete"><code>Discrete</code></a> inputs keep their values between communication points.
Furthermore, changing <a href="#discrete"><code>discrete</code></a> variables at communication points will likely require special handling within the FMU.
Since the FMU itself can detect such changes, the co-simulation algorithm does not need to enter <a href="#EventMode"><strong>Event Mode</strong></a> in such a case, but must do so, in case event iteration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="early-return">4.1.2. Early Return</h4>
<div class="paragraph">
<p>A Co-Simulation FMU is allowed to stop the execution of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and return without reaching the predefined communication time, i.e. <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> <code>+</code> <a href="#communicationStepSize"><code>communicationStepSize</code></a>.
This mechanism is called <a href="#early-return">"early return"</a>.</p>
</div>
<div class="paragraph">
<p>Early return can be used to shorten a communication step because of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an event happened inside the FMU which influences its outputs non-continuously.</p>
</li>
<li>
<p>the importer requests the stop of the current communication step in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>. <em>[E.g. the importer wants to stop a communication step because other parts of the simulation indicate the necessity.]</em></p>
</li>
<li>
<p>the FMU requests an additional communication point. <em>[E.g. the FMU wants to communicate extrema of outputs or prevent model inconsistencies, like negative pressure values, caused by extrapolation of inputs.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For details see <a href="#earlyReturn"><code>earlyReturn</code></a>.</p>
</div>
<div class="paragraph">
<p>The following capability flags describe which features the FMU supports:  <a href="#canReturnEarlyAfterIntermediateUpdate"><code>canReturnEarlyAfterIntermediateUpdate</code></a> and <a href="#hasEventMode"><code>hasEventMode</code></a>.</p>
</div>
<div class="paragraph">
<p>The argument <a href="#earlyReturnAllowed"><code>earlyReturnAllowed</code></a> of <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> signals to the FMU if the importer allows <a href="#early-return">"early return"</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="state-machine-co-simulation">4.2. State Machine for Co-Simulation</h3>
<div class="paragraph">
<p>The state machine in <a href="#figure-co-simulation-state-machine">Figure 42</a> defines the allowed calling sequences for FMI for Co-Simulation.</p>
</div>
<div id="figure-co-simulation-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machine-co-simulation.svg" alt="state machine co simulation" width="80%">
</div>
<div class="title">Figure 42. Calling sequence of Co-Simulation C functions.</div>
</div>
<div class="paragraph">
<p>Common states are defined in <a href="#common-state-machine">Section 2.3</a>, such as super states <a href="#FMUStateSetable"><strong>FMU State Setable</strong></a> and  <a href="#Initialized"><strong>Initialized</strong></a>, states <a href="#Instantiated"><strong>Instantiated</strong></a>, <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a>, <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>, <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a>, <a href="#Terminated"><strong>Terminated</strong></a> and <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>Compared to FMI for Model Exchange, <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> enters directly into <a href="#StepMode"><strong>Step Mode</strong></a>.
This was designed in case the Co-Simulation FMU does not support <a href="#EventMode"><strong>Event Mode</strong></a>.
Importers can directly switch a Co-Simulation FMU into <a href="#EventMode"><strong>Event Mode</strong></a> without calling <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> to handle events immediately after initialization.</p>
</div>
<div class="sect3">
<h4 id="StepMode">4.2.1. State: Step Mode</h4>
<div class="paragraph">
<p>The state <a href="#StepMode"><strong>Step Mode</strong></a> is used to compute the values of all variables between communication points and events and to advance time in the FMU.
If the FMU is connected in loops with other models, iterations over the FMU equations requires setting the FMU to a previous communication point and repeating the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{\mathit{variability == tunable}}\) .</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c+d}(\mathbf{t})\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get values of variables \(\mathbf{v}(\mathbf{t})\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Get{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get time derivatives of <a href="#continuous"><code>continuous</code></a> <a href="#output"><code>outputs</code></a> \(\mathbf{y}_c^{(j)}(\mathbf{t})\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>\((\mathbf{y}_{c+d}, \mathbf{y}_c^{(j)}, \mathbf{x}_d, \mathbf{w}_{c+d}, \mathbf{b}, \mathbf{t}_\mathit{i+1}) := \mathbf{f}_{\mathit{doStep}}({}^{\bullet}\mathbf{x}_d, \mathbf{u}_{c+d}, {}^{\bullet}\mathbf{u}_{c,u}, \mathbf{p}, {}^{\bullet}\mathbf{b}, \mathbf{t}_i, \mathbf{h}_i)\)<br></p>
</li>
<li>
<p>Update previous values of discrete states: \({}^\bullet\mathbf{x}_d:=\mathbf{x}_d\).</p>
</li>
<li>
<p>Update previous values of buffers: \({}^\bullet\mathbf{b}:=\mathbf{b}\).</p>
</li>
<li>
<p>\(\mathbf{t}:=(\mathbf{t}_\mathit{i+1}, 0)\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3DoStep"><code>fmi3DoStep</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((\mathbf{v}_{u}, \mathbf{t}_u) := \mathbf{f}_{\mathit{inter}}({}^{\bullet}\mathbf{x}_d, \mathbf{u}_{c+d}, {}^{\bullet}\mathbf{u}_{c,u}, \mathbf{p}, {}^{\bullet}\mathbf{b}, \mathbf{t}_i, \mathbf{h}_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate event equations \(\mathbf{f}_{\mathit{event}}\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <code>fmi3Set{VariableType}</code></dt>
<dd>
<p>sets the values of variables with:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, or</p>
</li>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>at time \(\mathbf{t}\).</p>
</div>
</dd>
<dt class="hdlist1">Function <code>fmi3Get{VariableType}</code></dt>
<dd>
<p>returns values for all variables at \(\mathbf{t}\).
<code>fmi3Get{VariableType}</code> does not trigger an evaluation of \(\mathbf{f}_\mathit{doStep}\).
Therefore, <a href="#algebraic-loops">algebraic loops</a> at communication points cannot be handled by an appropriate sequence of <code>fmi3Get{VariableType}</code> and <code>fmi3Set{VariableType}</code> calls <em>[contrary to <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>]</em>.
Repeating a communication step requires to reset the FMU state to the previous communication point with <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> and repeating the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with new input values.</p>
<div class="paragraph">
<p>Calling <code>fmi3Get{VariableType}</code> is not allowed after <code>fmi3Set{VariableType}</code> without calling <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> in between.
<em>[This allows for more efficient FMU implementations that avoid double buffering and allows in-place operations.]</em></p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></dt>
<dd>
<p>See <a href="#getting-output-derivatives">Section 2.2.12</a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3DoStep"><code>fmi3DoStep</code></a></dt>
<dd>
<p>The importer requests the computation of the next time step with the following function:</p>
<div id="fmi3DoStep" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3DoStepTYPE(fmi3Instance instance,
                                  fmi3Float64 currentCommunicationPoint,
                                  fmi3Float64 communicationStepSize,
                                  fmi3Boolean noSetFMUStatePriorToCurrentPoint,
                                  fmi3Boolean* eventEncountered,
                                  fmi3Boolean* clocksAboutToTick,
                                  fmi3Boolean* terminateSimulation,
                                  fmi3Boolean* earlyReturn,
                                  fmi3Float64* lastSuccessfulTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> can change the time of a Co-Simulation FMU from the outside (<a href="#advancing-time">time advances internally during <code>fmi3DoStep</code></a>).
Arguments referring to time inherit the the unit of the <a href="#independent"><code>independent</code></a> variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="currentCommunicationPoint"></a> <code>currentCommunicationPoint</code> is the current communication point of the importer (\(\mathbf{t}_\mathit{i}\)) with the unit of the <a href="#independent"><code>independent</code></a> variable.
At the first call of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> must be equal to the argument <a href="#startTime"><code>startTime</code></a> of <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>.</p>
</li>
<li>
<p><a id="communicationStepSize"></a> <code>communicationStepSize</code> is the expected communication step size (\(\mathbf{h}_\mathit{i}\)) with the unit of the <a href="#independent"><code>independent</code></a> variable.
<a href="#communicationStepSize"><code>communicationStepSize</code></a> must be \(&gt; 0.0\).
The FMU is expected to compute until time \(\mathbf{t}_{i+1} = \mathbf{t}_\mathit{i} + \mathbf{h}_\mathit{i}\).
See <a href="#canHandleVariableCommunicationStepSize"><code>canHandleVariableCommunicationStepSize</code></a> for restrictions.</p>
<div class="paragraph">
<p><em>[Formally, argument <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> is not needed.</em>
<em>It is present in order to handle a potential mismatch between the importer&#8217;s and the FMU&#8217;s time representations and/or computations.</em>
<em>Both arguments <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> and <a href="#communicationStepSize"><code>communicationStepSize</code></a> allow computing of</em> \(\mathbf{t}_\mathit{i+1}\) <em>by one addition, avoiding accumulation of numerical errors.]</em></p>
</div>
</li>
<li>
<p><a id="noSetFMUStatePriorToCurrentPoint"></a> <code>noSetFMUStatePriorToCurrentPoint == fmi3True</code> if <code>fmi3SetFMUState</code> will no longer be called for time instants prior to <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> in this simulation run.</p>
<div class="paragraph">
<p><em>[The FMU can use this flag to flush a result buffer.]</em></p>
</div>
</li>
<li>
<p><a id="eventEncountered"></a> <a href="#eventEncountered"><code>eventEncountered == fmi3True</code></a> indicates that an event was encountered at <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> and the importer has to enter <a href="#EventMode"><strong>Event Mode</strong></a> by calling <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.
<a href="#eventEncountered"><code>eventEncountered == fmi3True</code></a> must not be signaled, if the importer indicates to not support <a href="#EventMode"><strong>Event Mode</strong></a> by <a href="#eventModeUsed"><code>eventModeUsed == fmi3False</code></a>.</p>
</li>
<li>
<p><a id="clocksAboutToTick"></a> <a href="#clocksAboutToTick"><code>clocksAboutToTick == fmi3True</code></a> indicates that one or more clocks will tick at <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> and, after calling <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>, <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> must be called to inquire the status of all <a href="#outputClock"><code>output clocks</code></a>.
<a href="#clocksAboutToTick"><code>clocksAboutToTick == fmi3True</code></a> must not be signaled, if the importer indicates to not support <a href="#EventMode"><strong>Event Mode</strong></a> by <a href="#eventModeUsed"><code>eventModeUsed == fmi3False</code></a>.</p>
</li>
<li>
<p><a id="terminateSimulationDS"></a> When <a href="#terminateSimulationDS"><code>terminateSimulation == fmi3True</code></a>, the FMU requests to stop the simulation and the importer must call <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>.</p>
</li>
<li>
<p><a id="earlyReturn"></a> <code>earlyReturn</code> signals to the importer that the FMU returns at \(\mathbf{t}_\mathit{i+1} &lt; \mathbf{t}_i +\)<a href="#communicationStepSize"><code>communicationStepSize</code></a> from the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.
<a href="#earlyReturn"><code>earlyReturn == fmi3True</code></a> is only allowed if <a href="#earlyReturnAllowed"><code>earlyReturnAllowed == fmi3True</code></a> in <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a>.
The time reached is specified in <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a>.
Reasons for <a href="#earlyReturn"><code>earlyReturn == fmi3True</code></a> are</p>
<div class="ulist">
<ul>
<li>
<p>expressed by the return arguments of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> <a href="#eventEncountered"><code>eventEncountered</code></a>, <a href="#clocksAboutToTick"><code>clocksAboutToTick</code></a>, <a href="#terminateSimulationDS"><code>terminateSimulation</code></a>, or</p>
</li>
<li>
<p>the FMU&#8217;s reaction to the importers request for <a href="#earlyReturn"><code>earlyReturn</code></a> by the return argument <a href="#earlyReturnRequested"><code>earlyReturnRequested == fmi3True</code></a> of <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>, or</p>
</li>
<li>
<p>the FMU&#8217;s request for a communication point at <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> for any other reason.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="lastSuccessfulTime"></a> <code>lastSuccessfulTime</code> represents the internal time \(\mathbf{t}_\mathit{i+1}\) of the FMU when <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> returns, for any value of <a href="#earlyReturn"><code>earlyReturn</code></a>.
It is possible that the <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> is equal to <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> when <a href="#earlyReturn"><code>earlyReturn == fmi3True</code></a> to indicate, for example, the detection of an event at <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a>.
Even if the FMU returns from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with <a href="#fmi3OK"><code>fmi3OK</code></a> and <a href="#earlyReturn"><code>earlyReturn == fmi3False</code></a>, it is allowed that <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> deviates from the expected <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> <code>+</code> <a href="#communicationStepSize"><code>communicationStepSize</code></a>.
<em>[Examples:</em></p>
<div class="ulist">
<ul>
<li>
<p><em>A fixed-step integrator inside the FMU cannot reach the requested time exactly.</em>
<em><a href="#fixedInternalStepSize"><code>fixedInternalStepSize</code></a> was introduced to reduce these effects.</em></p>
</li>
<li>
<p><em>A variable-step integrator with minimal step size is not able to land exactly at</em> \(\mathbf{t}_\mathit{i+1}\)<em>.]</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a></dt>
<dd>
<p><a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> switches the FMU itself into the <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a></dt>
<dd>
<p>Changes state to <a href="#EventMode"><strong>Event Mode</strong></a>.
This function must not be called, if <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> signaled <a href="#eventModeUsed"><code>eventModeUsed = fmi3False</code></a>, which can be forced by the FMU with <a href="#hasEventMode"><code>hasEventMode == false</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a></dt>
<dd>
<p><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> changes state to <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.
<a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> must not be called if the FMU contains no <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a> (i.e. with <a href="#causality"><code>causality</code></a>= <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>).</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_examples">4.3. Code Examples</h3>
<div class="sect3">
<h4 id="_co_simulation">4.3.1. Co-Simulation</h4>
<div class="paragraph">
<p>In the following example, the usage of the FMI functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
We consider two FMUs, where both have one <a href="#continuous"><code>continuous</code></a> floating point <a href="#input"><code>input</code></a> and one <a href="#continuous"><code>continuous</code></a> floating point <a href="#output"><code>output</code></a> which are connected in the following way:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-connection-of-FMUs.svg" alt="co simulation connection of FMUs" width="30%">
</div>
<div class="title">Figure 43. Connection graph of FMUs.</div>
</div>
<div class="paragraph">
<p>We assume no algebraic dependency between input and <a href="#output"><code>output</code></a> of each FMU.
The code demonstrates the simplest importer as shown in <a href="#state-machine-co-simulation">Section 4.2</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Constant communication step size.</p>
</li>
<li>
<p>No repeating of communication steps.</p>
</li>
<li>
<p>The error handling is implemented in a very rudimentary way.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">////////////////////////////
// Initialization sub-phase

// instantiate both FMUs
s1 = s1_fmi3InstantiateCoSimulation("instance1",      // instanceName
                                    guid,          // instantiationToken
                                    NULL,          // resourceLocation
                                    fmi3False,     // visible
                                    fmi3False,     // loggingOn
                                    fmi3False,     // eventModeRequired
                                    NULL,          // requiredIntermediateVariables
                                    0,             // nRequiredIntermediateVariables
                                    NULL,          // instanceEnvironment
                                    cb_logMessage, // logMessage
                                    NULL);         // intermediateUpdate

s2 = s2_fmi3InstantiateCoSimulation("instance1",      // instanceName
                                    guid,          // instantiationToken
                                    NULL,          // resourceLocation
                                    fmi3False,     // visible
                                    fmi3False,     // loggingOn
                                    fmi3False,     // eventModeRequired
                                    NULL,          // requiredIntermediateVariables
                                    0,             // nRequiredIntermediateVariables
                                    NULL,          // instanceEnvironment
                                    cb_logMessage, // logMessage
                                    NULL);         // intermediateUpdate

if (s1 == NULL || s2 == NULL)
    return EXIT_FAILURE;

// start and stop time
startTime = 0;
stopTime = 10;

// communication step size
h = 0.01;

// set all variable start values (of "ScalarVariable / &lt;type&gt; / start")
// s1_fmi3SetReal/Integer/Boolean/String(s1, ...);
// s2_fmi3SetReal/Integer/Boolean/String(s2, ...);

// initialize the FMUs
s1_fmi3EnterInitializationMode(s1, fmi3False, 0.0, startTime, fmi3True, stopTime);
s2_fmi3EnterInitializationMode(s2, fmi3False, 0.0, startTime, fmi3True, stopTime);

// set the input values at time = startTime
// fmi3SetReal/Integer/Boolean/String(s1, ...);
// fmi3SetReal/Integer/Boolean/String(s2, ...);

s1_fmi3ExitInitializationMode(s1);
s2_fmi3ExitInitializationMode(s2);

////////////////////////
// Simulation sub-phase
tc = startTime; // current time

while ((tc &lt; stopTime) &amp;&amp; (status == fmi3OK)) {

    // retrieve outputs
    // fmi3GetReal(s1, ..., 1, &amp;y1);
    // fmi3GetReal(s2, ..., 1, &amp;y2);

    // set inputs
    // fmi3SetReal(s1, ..., 1, &amp;y2);
    // fmi3SetReal(s2, ..., 1, &amp;y1);

    // call instance s1 and check status
    fmi3Boolean terminate, earlyReturn;
    fmi3Float64 lastSuccessfulTime;

    status = s1_fmi3DoStep(s1, tc, h, fmi3True, &amp;terminate, &amp;earlyReturn, &amp;lastSuccessfulTime);

    if (terminate) {
        printf("Instance s1 requested to terminate simulation.");
        break;
    }

    // call instance s2 and check status as above
    status = s2_fmi3DoStep(s2, tc, h, fmi3True, &amp;terminate, &amp;earlyReturn, &amp;lastSuccessfulTime);

    // ...

    // increment current time
    tc += h;
 }

//////////////////////////
// Shutdown sub-phase
if (status != fmi3Error &amp;&amp; status != fmi3Fatal) {
    s1_fmi3Terminate(s1);
    s2_fmi3Terminate(s2);
}

if (status != fmi3Fatal) {
    s1_fmi3FreeInstance(s1);
    s2_fmi3FreeInstance(s2);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="code-example-clocked-co-simulation">4.3.2. Clocks</h4>
<div class="paragraph">
<p>In the following example, the usage of the FMI functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
We consider &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>The error handling is implemented in a very rudimentary way.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="co-simulation-schema">4.4. Description Schema</h3>
<div class="paragraph">
<p>The common XML elements and attributes are defined in <a href="#fmi-description-schema">Section 2.4</a>.
Additional elements and attributes are defined subsequently.
If the FMU implements the Co-Simulation interface type, the element <code>&lt;CoSimulation&gt;</code> must be present.
It is defined as:</p>
</div>
<div id="figure-schema-CoSimulation" class="imageblock text-center">
<div class="content">
<img src="images/schema/CoSimulation.png" alt="CoSimulation" width="80%">
</div>
<div class="title">Figure 44. CoSimulation element.</div>
</div>
<div class="paragraph">
<p>The attributes in the following table are defined on top of the <a href="#common-capability-flags">common attributes</a> and have the following meaning (all attributes are optional with exception of <a href="#modelIdentifier"><code>modelIdentifier</code></a>):</p>
</div>
<table id="table-CoSimulation-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. CoSimulation attribute details.</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#modelIdentifier"><code>modelIdentifier</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short class name according to C syntax, for example, <code>A_B_C</code>.
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries, but not if the functions are provided by a DLL/SharedObject.
<a href="#modelIdentifier"><code>modelIdentifier</code></a> is also used as name of the static library or DLL/SharedObject.
See also <a href="#header-files-and-naming-of-functions">Section 2.2.1</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="canHandleVariableCommunicationStepSize"></a> <code>canHandleVariableCommunicationStepSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>canHandleVariableCommunicationStepSize = true</code>, then the communication step size (argument <a href="#communicationStepSize"><code>communicationStepSize</code></a> of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>) can vary for each call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="canReturnEarlyAfterIntermediateUpdate"></a> <code>canReturnEarlyAfterIntermediateUpdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the FMU is able to return early from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> if the co-simulation algorithm returns <a href="#earlyReturnRequested"><code>earlyReturnRequested == fmi3True</code></a> from the callback <a href="#intermediateUpdate"><code>intermediateUpdate</code></a> and <a href="#canReturnEarly"><code>canReturnEarly == fmi3True</code></a>.
The default value of this capability flag is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="fixedInternalStepSize"></a><code>fixedInternalStepSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fixed internal step size of the FMU (optional).
+
<em>[This information can be used by the co-simulation algorithm to synchronize the communication interval with the internal step size of the FMU.</em>
<em>The co-simulation algorithm should calculate the communication points by multiplying (<code>number_of_steps * step_size</code>) instead of repeatedly incrementing (<code>time += step_size</code>) to avoid the accumulation of numerical errors.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="hasEventMode"></a><code>hasEventMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code> the FMU supports <a href="#EventMode"><strong>Event Mode</strong></a>.
Even if this flag is <code>true</code>, the co-simulation algorithm can chose to delegate event handling to the FMU by calling <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> with <a href="#eventModeUsed"><code>eventModeUsed == fmi3False</code></a>.
If <code>eventModeUsed == fmi3True</code>, the co-simulation algorithm will have to actively trigger event handling in the FMU using <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.
<a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> must only be called with <code>eventModeUsed == fmi3True</code> if <a href="#hasEventMode"><code>hasEventMode == true</code></a>.
If the FMU has synchronous clocks, then <code>eventModeUsed == fmi3True</code> and the importer must call <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> with <a href="#eventModeUsed"><code>eventModeUsed == fmi3True</code></a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that if <code>needsExecutionTool = true</code>, then it is required that the original tool is available to be executed during co-simulation.
If <code>needsExecutionTool = false</code>, the FMU is completely contained inside the FMU in source code or binary format (DLL/SharedObject).</p>
</div>
<div class="sect3">
<h4 id="_example_xml_description_file">4.4.1. Example XML Description File</h4>
<div class="sect4">
<h5 id="xml-example-co-simulation">4.4.1.1. Example XML Description File with Early Return</h5>
<div class="paragraph">
<p>The <a href="#xml-example-fmimodeldescription-cosimulation">Example fmiModelDescription</a> below is the same as shown in <a href="#xml-example-model-exchange">Section 3.4.1</a> for a Model Exchange FMU.
The only differences are the replacement of the element <code>&lt;ModelExchange&gt;</code> with the element <code>&lt;CoSimulation&gt;</code> (with additional attributes),  and the removal of <a href="#local"><code>local</code></a> variables, which are associated with continuous <a href="#state"><code>states</code></a> and their <a href="#derivative"><code>derivatives</code></a> and presence of the capability flags <a href="#canHandleVariableCommunicationStepSize"><code>canHandleVariableCommunicationStepSize</code></a> and <a href="#canReturnEarlyAfterIntermediateUpdate"><code>canReturnEarlyAfterIntermediateUpdate</code></a> with value <code>true</code>.</p>
</div>
<div id="xml-example-fmimodeldescription-cosimulation" class="listingblock">
<div class="title">Example fmiModelDescription</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;fmiModelDescription
  fmiVersion="3.0-alpha.5"
  modelName="MyLibrary.SpringMassDamper_Early_Return_example"
  instantiationToken="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2011-09-23T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;CoSimulation
    modelIdentifier="MyLibrary_SpringMassDamper"
    canHandleVariableCommunicationStepSize="true"
    canReturnEarlyAfterIntermediateUpdate="true"
    hasEventMode="true"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="N.m"&gt;
      &lt;BaseUnit kg="1" m="2" s="-2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;Float64Type name="Modelica.Units.SI.Inertia" quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.Torque" quantity="Torque" unit="N.m"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.AngularVelocity" quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.Angle" quantity="Angle" unit="rad"/&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;Float64 name="inertia1.J" valueReference="1073741824"
      description="Moment of load inertia" causality="parameter" variability="fixed"
      declaredType="Modelica.Units.SI.Inertia" start="1"/&gt;
    &lt;Float64 name="torque.tau" valueReference="536870912"
      description="Accelerating torque acting at flange (= -flange.tau)" causality="input"
      declaredType="Modelica.Units.SI.Torque" start="0"/&gt;
    &lt;Float64 name="inertia1.phi" valueReference="805306368"
      description="Absolute rotation angle of component" causality="output"
      declaredType="Modelica.Units.SI.Angle"/&gt;
    &lt;Float64 name="inertia1.w" valueReference="805306369"
      description="Absolute angular velocity of component (= der(phi))" causality="output"
      declaredType="Modelica.Units.SI.AngularVelocity"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Output valueReference="805306368"/&gt;
    &lt;Output valueReference="805306369"/&gt;
    &lt;InitialUnknown valueReference="805306368"/&gt;
    &lt;InitialUnknown valueReference="805306369"/&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xml-example-clocked-co-simulation">4.4.1.2. Example XML Description File with Clocks</h5>
<div class="paragraph">
<p>The example below is the same one as shown in <a href="#xml-example-co-simulation">Section 4.4.1.1</a> for a Co-Simulation FMU.
The only differences are, that the element <code>&lt;fmiModelDescription&gt;&lt;CoSimulation&gt;</code> is present and <a href="#clock"><code>clocks</code></a> are defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
The XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">//include::examples/co_simulation_clocked_cosimulation.xml[]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-scheduled-execution">5. FMI for Scheduled Execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="#fmi-for-co-simulation">Co-Simulation</a> interface provides an indirect control over the computation of model partitions.
With Scheduled Execution, a simulation algorithm can directly control the time of computation (i.e. scheduling) for such model partitions.</p>
</div>
<div class="paragraph">
<p>The Scheduled Execution interface addresses simulation use cases with the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At any time (even for unpredictable events), an event can be signaled to an FMU;</p>
</li>
<li>
<p>If multiple FMUs share resources (e.g. control tasks), the time requirements (e.g. execution time, communication deadlines) of all model partitions have to be observed and respected;</p>
<div class="ulist">
<ul>
<li>
<p>Time requirements may exist due to communication constraints (that are not apparent at FMU simulation level) which have to be fulfilled by the simulation algorithm;</p>
</li>
<li>
<p>That requires a global evaluation order and preemption policy for all model partitions of the multiple FMUs</p>
</li>
<li>
<p>Priority information provided by the FMUs has to be evaluated and merged to an overall priority for available model partitions</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data shall move between the different FMU model partitions for the same or next activation time.</p>
<div class="ulist">
<ul>
<li>
<p>Get/set operations must also be possible for the same activation time for different model partitions between the computation of these model partitions.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The Co-Simulation interface provides support for concurrent computation of model partitions (i.e. a support of multiple rates) on a single computational resource (e.g. CPU-core) of an FMU.
For that a preemptive multitasking regime is intended (cooperative multitasking is not covered by this description).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[A parallel computation of model partitions is not part of the FMI 3.0 API.</em>
<em>An FMU may still internally use parallel computation on multiple cores, but handling this is (currently) not part of the FMI standard. Such an internal parallel computation is not visible to the simulation algorithm.</em>
<em>It is a tool vendor specific solution that has ties to the used OS and the co-simulation environment.]</em></p>
</div>
<div class="sect2">
<h3 id="concepts-scheduled-execution">5.1. Concepts</h3>
<div class="paragraph">
<p>The Scheduled Execution interface has a different timing concept compared to FMI for Co-Simulation.
This is required to cover <a href="#clock"><code>clock</code></a> ticks for <a href="#aperiodic-clocks">aperiodic</a> <a href="#inputClock"><code>input clocks</code></a> which may tick at time a instant that is unpredictable in advance for the simulation algorithm.
Typically, hardware I/O or virtual ECU software events belong to this category.</p>
</div>
<div class="paragraph">
<p>A simulation algorithm&#8217;s call for computing a model partition will compute the results of the model partition defined by an <a href="#inputClock"><code>input clock</code></a> for the current <a href="#clock"><code>clock</code></a> tick time \(\mathbf{t}_i\).</p>
</div>
<div class="paragraph">
<p>The result values will be computed for the current <a href="#clock"><code>clock</code></a> tick time (activation time) \(\mathbf{t}_i\) from the assigned <a href="#inputClock"><code>input clock</code></a> (which is known to the simulation algorithm).
Refer to the <a href="#clock"><code>clock</code></a> time progress definition for periodic <a href="#clock"><code>clocks</code></a>.</p>
</div>
<div class="paragraph">
<p>If required, the FMU can internally derive the <a href="#clock"><code>clock</code></a> interval \(\mathbf{T}_\mathit{interval, i}\) based on the last <a href="#clock"><code>clock</code></a> tick time \(\mathbf{t}_\mathit{i-1}\) i.e. last activation time for this model partition.</p>
</div>
<div class="paragraph">
<p>A model partition can only be activated once per activation time point \(\mathbf{t}_i\).</p>
</div>
<div class="paragraph">
<p>Model partitions that are associated to <a href="#outputClock"><code>output clocks</code></a> will accordingly provide the result values of the model partition&#8217;s variables for the current <a href="#outputClock"><code>output clock</code></a> tick time \(\mathbf{t}_i\) of the active <a href="#outputClock"><code>output clock</code></a>.
The activation of such an <a href="#outputClock"><code>output clock</code></a> is not controlled by the simulation algorithm but internally by the FMU.</p>
</div>
<div class="paragraph">
<p>More details can be found in <a href="#clocks">clocks</a>.</p>
</div>
<div class="sect3">
<h4 id="preemption-support">5.1.1. Preemption Support</h4>
<div class="paragraph">
<p>For real-time applications the simulation time equals the real wall <a href="#clock"><code>clock</code></a> time, thus each <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> computation step has to be finished in real-time within its current period time length (computation time is not only defined by the runtime of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> but also by the time for setting and getting variables and related operations).
Usually a preemptive scheduling of the <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>, <code>fmi3Get{VariableType}</code>, <code>fmi3Set{VariableType}</code> calls is required to respect this constraint.</p>
</div>
<div class="paragraph">
<p>The FMU&#8217;s code has to be prepared for being able to correctly handle preemptive calls of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>, <code>fmi3Get{VariableType}</code>, <code>fmi3Set{VariableType}</code>.
That requires a secured internal and external access to global states and variable values.
Thus in Scheduled Execution a support for a correct handling of the preemption of model partition computations is required.
That also requires that the FMU reports the active state of a <a href="#outputClock"><code>output clock</code></a> only with the first call of <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> for a specific activation of this <a href="#clock"><code>clock</code></a> and sets the reported activation state immediately back to <code>false</code> for the following <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> calls for that <a href="#clock"><code>clock</code></a> until this <a href="#outputClock"><code>output clock</code></a> is internally activated again.</p>
</div>
<div class="paragraph">
<p>If a preemptive multitasking regime is intended an individual task (or thread&#8201;&#8212;&#8201;task and thread are used synonymously here) for each model partition (associated to an <a href="#inputClock"><code>input clock</code></a>) has to be created.
The task for computing each <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> is created and controlled by the simulation algorithm, not by the FMU.
So the FMU exporting tool does not need to take care for that (except for preparing its code to support preemption).</p>
</div>
<div class="paragraph">
<p><em>[If only one single model partition (<a href="#inputClock"><code>input clock</code></a>) is available via the interface of an FMU, preemptive calls of the related <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function are possible by default since there are no external cross dependencies within one model partition between communication points.]</em></p>
</div>
<div class="paragraph">
<p>Based on the <a href="#inputClock"><code>input clock</code></a> settings defined in the XML the simulation algorithm calls <code>fmi3Set{VariableType}</code>, <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>, <code>fmi3Get{VariableType}</code> calls.
Set/get calls for each task are only allowed for variables that are associated to the <a href="#inputClock"><code>input clock</code></a> associated to that task or - here preemption issues become important - to variables that are associated to no <a href="#clock"><code>clocks</code></a> (global variables), based on the XML information (see <a href="#table-overview-clocks">Table 5</a>).</p>
</div>
<div class="paragraph">
<p><em>[The recommendation is to avoid global variable associations as much as possible in the XML.</em>
<em>It is also recommended to reduce dependencies (defined in XML model structure) between variables located in different model partitions of one FMU, since this also requires in most cases that the related variables have to be global variables.]</em></p>
</div>
<div class="paragraph">
<p>The simulation algorithm has no knowledge about the FMU internal communication between the model partitions of a single FMU and does not handle it.</p>
</div>
<div class="paragraph">
<p>The simulation algorithm schedules the <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> (as well as related <code>fmi3Get{VariableType}</code> and <code>fmi3Set{VariableType}</code>) calls based on given priorities for <a href="#inputClock"><code>input clocks</code></a> defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</p>
</div>
<div class="paragraph">
<p>Priority (see <a href="#priority"><code>priority</code></a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Same priority: Model partitions (e.g. tasks) cannot preempt each other.
Arbitrary evaluation order is possible for model partitions of the same priority.</p>
</li>
<li>
<p>Different priorities: Model partitions of a higher priority preempt partitions of a lower priority as soon as the higher priority partition needs to be computed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[If multiple tasks are needed to be scheduled for computation at a certain time instant a simulation algorithm must schedule a task of a higher priority always before a task of a lower priority]</em></p>
</div>
<div class="paragraph">
<p><a href="#input"><code>Input</code></a> <a href="#clock"><code>clock</code></a> ticks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>periodic (period can be predefined by FMU or be defined by simulation algorithm, depending on XML information)</p>
</li>
<li>
<p>aperiodic (based on external possibly unpredictable events or on an <a href="#outputClock"><code>output clock</code></a> of the same FMU)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Based on the period and priority definitions the exporting tool can restrict the code evaluation order.
It nevertheless has to secure its code against concurrent evaluation <em>[not against parallel evaluation, as this is not supported for model partitions of an FMU in the interface description of this mode]</em> along the defined priority restrictions.
Mostly this is required for internal inter-model-partition communication and in general for the joint use of global variables within the FMU.
The exporting tool has to consider the effect of <a href="#input"><code>input</code></a> aperiodic <a href="#clock"><code>clocks</code></a> and the influences of computing speed, so the exact preemption occurrence points cannot be foreseen (within the given priority and period restrictions).</p>
</div>
<div class="paragraph">
<p>To guard certain code parts against preemption they must be enclosed with the callback functions <code>lockPreemption</code> and <code>unlockPreemption</code>.</p>
</div>
<div class="paragraph">
<p><em>[Such locks should be used with care and only for securing very short code parts that cannot be secured otherwise.]</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void       (*fmi3CallbackLockPreemption)   ();
typedef void       (*fmi3CallbackUnlockPreemption) ();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if the scheduler does not support preemption, at least an empty implementation of these callback functions must be provided to allow the reuse of code for different modes together with an efficient preemption.
<em>[This avoids checks for null function pointers.</em>
<em>A function call to a void-void function with an immediate return is hardly any overhead.]</em></p>
</div>
<div class="paragraph">
<p>Example for the use of <code>fmi3CallbackLockPreemption</code> and <code>fmi3CallbackUnlockPreemption</code> callback functions in the FMU code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">Int16 DataBuffer[3];   // global buffer

void Task1(void) //low priority
{
   ...
   // write data to DataBuffer
   fmi3CallbackLockPreemption();
   DataBuffer[0] = internal_out_RootSys1_1;
   DataBuffer[1] = internal_out_RootSys1_2;
   DataBuffer[2] = internal_out_RootSys1_3;
   fmi3CallbackUnlockPreemption();
   ...
 }

...
void Task2(void) //high priority
{
   ...
   // read data from DataBuffer
   fmi3CallbackLockPreemption();
   internal_in_RootSys2_1 = DataBuffer[0];
   internal_in_RootSys2_2 = DataBuffer[1];
   internal_in_RootSys2_3 = DataBuffer[2];
   fmi3CallbackUnlockPreemption();
   ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="state-machine-scheduled-execution">5.2. State Machine for Scheduled Execution</h3>
<div class="paragraph">
<p>This section contains the description of the Scheduled Execution interface for a C program.</p>
</div>
<div class="paragraph">
<p>The direct scheduling of model partitions based on <a href="#clock"><code>clock</code></a> ticks requires an additional handling mode for FMUs.
The FMU signals its support for direct model partition scheduling in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> via the element <code>&lt;fmiModelDescription&gt;&lt;ScheduledExecution&gt;</code>.
The simulation algorithm signals to the FMU that it supports and has recognized the <a href="#clock"><code>clock</code></a> and model partition scheduling capabilities of the FMU by instantiating it as Scheduled Execution.</p>
</div>
<div class="paragraph">
<p>Error, reset or terminate information is a global state of the FMU.
If e.g. an function returns <a href="#fmi3Discard"><code>fmi3Discard</code></a> or <a href="#fmi3Error"><code>fmi3Error</code></a> this is also assumed for all active or preempted model partitions.
In case of <a href="#fmi3Discard"><code>fmi3Discard</code></a> or <a href="#fmi3Error"><code>fmi3Error</code></a> no repetition of the step is possible, the only possible way to go forward is to enter the <a href="#Terminated"><strong>Terminated</strong></a> state and to end or to reset the simulation or - if supported - to set the FMU back to a former state.</p>
</div>
<div class="paragraph">
<p>This section summarizes the available states and the allowed function calls in the respective states.</p>
</div>
<div id="figure-scheduled-execution-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machine-scheduled-execution.svg" alt="state machine scheduled execution" width="80%">
</div>
<div class="title">Figure 45. Calling sequence of Scheduled Execution C functions.</div>
</div>
<div class="paragraph">
<p>If the simulation algorithm intends to enter the state <a href="#Terminated"><strong>Terminated</strong></a> it must ensure that all tasks related to model partitions of the FMU have ended.
Hence if in states <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>, <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>, or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> a function returns <a href="#fmi3Fatal"><code>fmi3Fatal</code></a> the simulation algorithm may prematurely end all tasks related to the computation of model partitions of this FMU.
If in these states a function returns <a href="#fmi3Discard"><code>fmi3Discard</code></a> or <a href="#fmi3Error"><code>fmi3Error</code></a> the simulation algorithm may wait until all other tasks of the model partitions of this FMU have ended, but new tasks must not be started.</p>
</div>
<div class="paragraph">
<p>Each state of the state machine corresponds to a certain phase of a simulation.
Common states are defined in <a href="#common-state-machine">Section 2.3</a>, such as super states <a href="#FMUStateSetable"><strong>FMU State Setable</strong></a> and  <a href="#Initialized"><strong>Initialized</strong></a>, states <a href="#Instantiated"><strong>Instantiated</strong></a>, <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a>, <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>, <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#Terminated"><strong>Terminated</strong></a> and <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.</p>
</div>
<div class="sect3">
<h4 id="Initialized-SE">5.2.1. Super State: Initialized</h4>
<div class="paragraph">
<p>Special to Scheduled Execution, the following additional constrains apply to the state <a href="#Initialized"><strong>Initialized</strong></a>.
The FMU enters state <a href="#Terminated"><strong>Terminated</strong></a> only after all other tasks related to the computation of model partitions of this FMU have ended.
After <a href="#fmi3Terminate"><code>fmi3Terminate</code></a> has been called no new tasks can be started (e.g. related to <a href="#outputClock"><code>output clock</code></a> ticks) and all other function calls for this FMU must return <a href="#fmi3Error"><code>fmi3Error</code></a> until the state <a href="#Terminated"><strong>Terminated</strong></a> is reached.</p>
</div>
</div>
<div class="sect3">
<h4 id="ClockActivationMode">5.2.2. State: Clock Activation Mode</h4>
<div class="paragraph">
<p>The FMU enters this state when the simulation algorithm calls <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> in state <a href="#InitializationMode"><strong>Initialization Mode</strong></a> or <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a> in state <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>In this state the simulation algorithm can create multiple concurrent tasks related to an FMU and in each task the simulation algorithm can activate one or multiple <a href="#inputClock"><code>input clocks</code></a> of an FMU based on the defined <a href="#clock"><code>clock</code></a> properties via a <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call for each <a href="#clock"><code>clock</code></a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{\mathit{variability == tunable}}\) .</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set discrete-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{d}(\mathbf{t})\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get values of variables \(\mathbf{v}(\mathbf{t})\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Get{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When an input clock \(\mathbf{k}_i\) is active, activate the corresponding model partition:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\((\mathbf{y}_\mathit{d,k_i}, \mathbf{x}_\mathit{d,k_i}, \mathbf{w}_\mathit{d,k_i}) := \mathbf{f}_{\mathit{activate}}({}^{\bullet}\mathbf{x}_\mathit{d}, \mathbf{w}_d, \mathbf{u}_\mathit{d}, \mathbf{p}, \mathbf{k_i})\)<br></p>
</li>
<li>
<p>Update previous values of discrete states of the corresponding model partition: \({}^\bullet\mathbf{x}_\mathit{d,k_i}:=\mathbf{x}_\mathit{d,k_i}\).</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((\mathbf{v}_{u}) := \mathbf{f}_{\mathit{inter}}({}^{\bullet}\mathbf{x}_d, \mathbf{u}_{d}, {}^{\bullet}\mathbf{u}_{u}, \mathbf{p} )\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3CallbackIntermediateUpdateSE"><code>fmi3CallbackIntermediateUpdate</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></dt>
<dd>
<p>This function can be called before scheduling a model partition for variables assigned to that model partition via its associated <a href="#clock"><code>clock</code></a> and all variables not associated to a <a href="#clock"><code>clock</code></a> (global variables).</p>
</dd>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</a></code></dt>
<dd>
<p>These functions can be called after the computation of a model partition for variables assigned to that model partition via its associated <a href="#clock"><code>clock</code></a> and all variables not associated to a <a href="#clock"><code>clock</code></a> (global variables).</p>
<div class="paragraph">
<p>Set/get operations must be atomic for a single variable.</p>
</div>
<div class="paragraph">
<p><em>[Because of real-time constraints, the computational effort has to be predictable for all operations in Scheduled Execution.</em>
<em>Therefore, all computationally expensive operations to compute a model partition have to be contained within the <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function.</em>
<em>The simulation algorithm can assume that <code>fmi3Get{VariableType}</code> and <code>fmi3Set{VariableType}</code> operations are not computationally expensive.</em>
<em>It is recommended, to call <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> in the same task as <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.]</em></p>
</div>
<div class="paragraph">
<p>The restrictions related to variable <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a> defined for <a href="#StepMode"><strong>Step Mode</strong></a> in <a href="#fmi-for-co-simulation"><code>Co-Simulation</code></a> apply.</p>
</div>
<div class="paragraph">
<p>It is not allowed to call <code>fmi3Get{VariableType}</code> functions after <code>fmi3Set{VariableType}</code> functions without an <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call in between.</p>
</div>
<div class="paragraph">
<p><em>[The reason is to avoid different interpretations of the caching, since contrary to <a href="#fmi-for-model-exchange"><code>FMI for Model Exchange</code></a>, <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> will perform the actual calculation instead of <code>fmi3Get{VariableType}</code>, and therefore, dummy algebraic loops at communication points cannot be handled by an appropriate sequence of <code>fmi3Get{VariableType}</code> and <code>fmi3Set{VariableType}</code> calls as for Model Exchange.]</em></p>
</div>
</dd>
<dt class="hdlist1"><a id="fmi3ActivateModelPartition"></a> Function <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a></dt>
<dd>
<p>Each <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call is now associated to the computation of a (publicly disclosed, externally controlled) model partition of the model and therefore to a single defined <a href="#inputClock"><code>input clock</code></a>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ActivateModelPartitionTYPE(fmi3Instance instance,
                                                  fmi3ValueReference clockReference,
                                                  size_t clockElementIndex,
                                                  fmi3Float64 activationTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function has the following arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="clockReference"></a> <code>clockReference</code>: <a href="#valueReference"><code>valueReference</code></a> of an <a href="#inputClock"><code>input clock</code></a> which shall be activated</p>
</li>
<li>
<p><a id="clockElementIndex"></a> <code>clockElementIndex</code>: The element index of the <a href="#inputClock"><code>input clock</code></a> variable which shall be activated.
For a scalar <a href="#clock"><code>clock</code></a> variable this must be 0; for array <a href="#clock"><code>clock</code></a> variables, the element clock to activate is specified using the 1-based element index.
Using the element index 0 means all elements of the <a href="#clock"><code>clock</code></a> variable.
(Note: If an array has more than one dimension the indices are serialized in the same order as defined for values in <a href="#serialization-of_variables">Section 2.2.6.1</a>).</p>
</li>
<li>
<p><a id="activationTime"></a> <code>activationTime</code>: value of the <a href="#independent"><code>independent</code></a> variable of the assigned <a href="#inputClock"><code>input clock</code></a> tick time \(\mathbf{t}_i\) <em>[typically: simulation (i.e. virtual) time]</em> (which is known to the simulation algorithm).</p>
<div class="paragraph">
<p>The importer schedules calls of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> for each FMU.
Calls are based on activations of <a href="#inputClock"><code>input clocks</code></a>.
These <a href="#inputClock"><code>input clock</code></a> activations can be based on <a href="#clock"><code>clock</code></a> activations from FMU external sources (e.g. <a href="#outputClock"><code>output clocks</code></a> of other FMUs).
The <a href="#inputClock"><code>input clock</code></a> activations can also be based on <a href="#outputClock"><code>output clock</code></a> ticks of the same FMU.
The <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function must not be called on <a href="#outputClock"><code>output clocks</code></a> of an FMU.</p>
</div>
<div class="paragraph">
<p>This is a different timing concept compared to <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> calls for Co-Simulation FMUs or the <a href="#fmi3SetTime"><code>fmi3SetTime</code></a> for Model Exchange FMUs.
An <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call will compute the results of the model partition defined by <a href="#clockReference"><code>clockReference</code></a> and <a href="#clockElementIndex"><code>clockElementIndex</code></a> (i.e. <a href="#valueReference"><code>valueReference</code></a> of the variable that defines a <a href="#clock"><code>clock</code></a> and an element index into that for arrays) for the current <a href="#clock"><code>clock</code></a> tick \(\mathbf{t}_i\).</p>
</div>
<div class="paragraph">
<p>If required, the FMU can internally derive the <a href="#clock"><code>clock</code></a> interval \(\mathbf{T}_\mathit{interval, i}\) based on the last <a href="#clock"><code>clock</code></a> tick time \(\mathbf{t}_\mathit{i-1}\) i.e. last <code>activationTime</code> for this <a href="#clockReference"><code>clockReference</code></a> and <a href="#clockElementIndex"><code>clockElementIndex</code></a> (based on last <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call).</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consecutive calls to <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> for a <a href="#clockReference"><code>clockReference</code></a> and <a href="#clockElementIndex"><code>clockElementIndex</code></a> (i.e. <a href="#valueReference"><code>valueReference</code></a> of <a href="#clock"><code>clock</code></a> variable and element index into that for arrays) must have strictly monotonically increasing <code>activationTime</code> \(\mathbf{t}_i\).</p>
</div>
</dd>
<dt class="hdlist1"><a id="fmi3CallbackIntermediateUpdateSE"></a> Function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a></dt>
<dd>
<p><a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> switches the FMU itself into the <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.
The callback may be called from concurrent tasks within <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a>, <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a>, <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a>, <a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a></dt>
<dd>
<p>These functions must not be called if any model partition is currently active or preempted.
<em>[This is because these functions apply to the whole FMU and not only to a specific model partition.]</em></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-scheduled-execution">5.3. Code Example</h3>
<div class="paragraph">
<p>The FMU ThreeInputClocks sketches the usage of the FMI functions.
The example is given in a mix of pseudo-code and C, in order to keep it small and understandable.
We consider one FMU with three model partitions.
Two model partitions associated to two periodic <a href="#inputClock"><code>input clocks</code></a> 10msClock and 50msClock (<a href="#clock"><code>clock</code></a> periods 10 ms and 50 ms) and one aperiodic <a href="#inputClock"><code>input clock</code></a> AperiodicClock.</p>
</div>
<div class="paragraph">
<p>During the execution of the model partition of <a href="#inputClock"><code>input clock</code></a> 10msClock the <a href="#outputClock"><code>output clock</code></a> OutClock may tick and invoke the execution of model partition of aperiodic <a href="#inputClock"><code>input clock</code></a> AperiodicClock.</p>
</div>
<div class="paragraph">
<p>The function calls <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> are executed in the context of preemptable tasks whose priorities are derived from the respective <a href="#inputClock"><code>input clock</code></a> configurations of the FMU.
In this example the execution of the task of <a href="#inputClock"><code>input clock</code></a> AperiodicClock is waiting for the task of <a href="#inputClock"><code>input clock</code></a> 10msClock to finish.
Likewise the task of AperiodicClock is suspended when the task of higher priority is scheduled again.</p>
</div>
<div class="paragraph">
<p>The example also depicts how a task associated to an even lower prior <a href="#inputClock"><code>input clock</code></a> 50msClock is delayed several times by tasks of higher priority.
Note that the point of time when the task was scheduled is the <code>activationTime</code> of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> (&#8230;&#8203;Activate&#8230;&#8203;(<code>input clock</code>, <code>activationTime</code>)).</p>
</div>
<div id="figure-scs_example" class="imageblock text-center">
<div class="content">
<img src="images/se_example.png" alt="se example" width="90%">
</div>
<div class="title">Figure 46. Scheduled Execution Example ThreeInputClocks</div>
</div>
<div class="sect3">
<h4 id="_simulation_algorithm_implementation">5.3.1. Simulation Algorithm Implementation</h4>
<div class="paragraph">
<p>To enable the computation of a Scheduled Execution FMU a simulation algorithm has to provide a task scheduler.
Depending on the particular configuration the simulation algorithm sets up tasks for every <a href="#inputClock"><code>input clock</code></a>.
When executed each task calls <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> for its respective <a href="#inputClock"><code>input clock</code></a>.
The <code>activationTime</code> is provided by the simulation algorithm.
Periodic tasks can be scheduled on initialization of the simulation application.
Aperiodic tasks are scheduled explicitly during the execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">Task10ms.Execute()
{
   // Set inputs with valueReference 0 and 1 associated to clockIndex 5
   fmi3SetFloat64(s, {0,1}, &amp;AIn);
   // call for 10msClock tick (clockIndex 5)
   fmi3ActivateModelPartition(s, 5, 0, Task10ms.ActivationTime);
   // Get output with valueReference 2 associated to clockIndex 0
   fmi3GetFloat64(s, {2}, &amp;AOut);
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>As specified in the XML file, <a href="#inputClock"><code>input clock</code></a> AperiodicClock is triggered by <a href="#outputClock"><code>output clock</code></a> OutClock thus the simulation algorithm ensures the task associated to AperiodicClock is scheduled when <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> is called by the FMU and OutClock has ticked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">void CallbackIntermediateUpdate(..., fmi3Boolean clocksTicked, ...)
{
   fmi3ValueReference outputClockReferences = {7};
   fmi3Boolean[] clocksActivationState = {fmi3ClockInactive};
   if (clocksTicked)
   {
      // ask FMU if output clock has ticked
      fmi3GetClocks(... outputClockReferences, &amp;clocksActivationState, ...);
   }
   if (clocksActivationState[0])
   {
      // schedule task for AperiodicClock
      Scheduler-&gt;ScheduleTask(TaskAperiodic);
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fmu_implementation">5.3.2. FMU Implementation</h4>
<div class="paragraph">
<p>The FMU implements <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> dispatching for every <a href="#inputClock"><code>input clock</code></a> so the code might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi3Status fmi3ActivateModelPartition(fmi3Instance *instance,
   fmi3ValueReference clockReference, fmi3Float64 activationTime)
{
   switch (clockReference)
   {
      case 5:
         // Input clock 10msClock
         activateModelPartition10ms(instance, activationTime);
      case 6:
         // Input clock AperiodicClock
         activateModelPartitionAperiodic(instance, activationTime);
      case 8:
         // Input clock AperiodicClock
         activateModelPartition50ms(instance, activationTime);
      ...
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the context of the task being executed every 10 ms, the FMU lets <a href="#outputClock"><code>output clock</code></a> OutClock tick and calls <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">void activateModelPartition10ms(fmi3Instance *instance, ...)
{
   ...
   if (...)
   {
      // outputClock ticks
      fmi3SetClock({7});
      // inform simulation algorithm that output clock has ticked
      fmi3Boolean clocksTicked = fmi3True;
      instance-&gt;fmi3CallbackIntermediateUpdate(..., clocksTicked, ...);
   }
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> is called for a certain <a href="#outputClock"><code>output clock</code></a> the <a href="#outputClock"><code>output clock</code></a> is reset.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi3Status fmi3GetClock(..., fmi3ValueReference outputClockReferences,
   fmi3Clock *clocksActivationState, ...)
{
   if (outputClockReferences[0] == 7)
   {
      clocksActivationState[0] = outClockActivationState;
      outClockActivationState = fmi3ClockInactive;
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scheduled-execution-schema">5.4. Description Schema</h3>
<div class="paragraph">
<p>The common XML elements and attributes are defined in <a href="#fmi-description-schema">Section 2.4</a>.
Additional elements and attributes are defined subsequently.
If the FMU implements the Scheduled Execution interface type, the element <code>&lt;ScheduledExecution&gt;</code> must be present.
It is defined as:</p>
</div>
<div id="figure-schema-ScheduledExecution" class="imageblock text-center">
<div class="content">
<img src="images/schema/ScheduledExecution.png" alt="ScheduledExecution" width="80%">
</div>
<div class="title">Figure 47. ScheduledExecution element.</div>
</div>
<div class="paragraph">
<p>The attribute in the following table is defined on top of the <a href="#common-capability-flags">common attributes</a> and have the following meaning (all attributes are optional with exception of <a href="#modelIdentifier"><code>modelIdentifier</code></a>):</p>
</div>
<table id="table-ScheduledExecution-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. ScheduledExecution attribute details.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#modelIdentifier"><code>modelIdentifier</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short class name according to C syntax, for example, <code>A_B_C</code>.
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries, but not if the functions are provided by a DLL/SharedObject.
<a href="#modelIdentifier"><code>modelIdentifier</code></a> is also used as name of the static library or DLL/SharedObject.
See also <a href="#header-files-and-naming-of-functions">Section 2.2.1</a>.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_example_xml_description_file_2">5.4.1. Example XML Description File</h4>
<div class="paragraph">
<p>The simulation algorithm collects the information about the number and properties of <a href="#clock"><code>clocks</code></a> supported by the FMU via analyzing the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> as defined in <a href="#fmi-description-schema">Section 2.4</a>.
For every <a href="#inputClock"><code>input clock</code></a> the simulation algorithm defines a task.
The properties <code>period</code> and <code>priority</code> are defined based on the <a href="#inputClock"><code>input clocks'</code></a> <code>period</code> and <code>priority</code> defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
The simulation algorithm can read from the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> that <a href="#outputClock"><code>output clock</code></a> OutClock may tick triggered by <a href="#inputClock"><code>input clock</code></a> 10msClock and that <a href="#inputClock"><code>input clock</code></a> AperiodicClock is triggered by OutClock.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription fmiVersion="3.0" modelName="ThreeInputClocks"&gt;
	&lt;ScheduledExecution modelIdentifier="ThreeInputClocks" canBeInstantiatedOnlyOncePerProcess="true"/&gt;
	&lt;LogCategories&gt;
		&lt;Category name="logStatusError" description="Log error messages"/&gt;
	&lt;/LogCategories&gt;
	&lt;DefaultExperiment startTime="0" stopTime="6" stepSize="0.001"/&gt;
	&lt;ModelVariables&gt;
		&lt;!-- Variables related to input clock 10msClock  --&gt;
		&lt;Float64 name="AIn1" valueReference="0" causality="input"  clockReference="5"	start="0"/&gt;
		&lt;Float64 name="AIn2" valueReference="1" causality="input"  clockReference="5"	start="0"/&gt;
		&lt;Float64 name="AOut" valueReference="2" causality="output" clockReference="5"/&gt;

		&lt;!-- Variables related to input clock AperiodicClock  --&gt;
		&lt;Float64 name="BIn"  valueReference="3" causality="input"  clockReference="6"	start="0"/&gt;
		&lt;Float64 name="BOut" valueReference="4" causality="output" clockReference="6"/&gt;

		&lt;!-- Clock variables --&gt;
		&lt;!-- Periodic input clock --&gt;
		&lt;Clock name="10msClock" valueReference="5" causality="input"
		priority="1" periodic="true" strict="true" intervalCounter="10" resolution="1000"/&gt;
		&lt;!-- Input clock that must be triggered by OutClock --&gt;
		&lt;Clock name="AperiodicClock" valueReference="6" causality="input"
		priority="2" triggeredBy="7" /&gt;
		&lt;!-- Output clock activated in model partition associated to 10msClock   --&gt;
		&lt;Clock name="OutClock" valueReference="7" causality="output"
		priority="2" clockReference="5" /&gt;
		&lt;!-- Periodic input clock --&gt;
		&lt;Clock name="50msClock" valueReference="8" causality="input" 
		priority="3" periodic="true" strict="true" intervalCounter="50" resolution="1000"/&gt;
	&lt;/ModelVariables&gt;
	&lt;ModelStructure&gt;
		&lt;Output valueReference="2"/&gt;
		&lt;Output valueReference="4"/&gt;
	&lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="ABL12"></a>[ABL12] &#197;kesson J., Braun W., Lindholm P., and Bachmann B. (2012): <strong>Generation of Sparse Jacobians for the Functional Mockup Interface 2.0</strong>. 9th International Modelica Conference, Munich, 2012. <a href="http://www.ep.liu.se/ecp/076/018/ecp12076018.pdf" class="bare">http://www.ep.liu.se/ecp/076/018/ecp12076018.pdf</a></p>
</li>
<li>
<p><a id="BPRS15"></a>[BPRS15] Atilim Gunes Baydin, Barak A. Pearlmutter, Alexey Andreyevich Radul, Jeffrey Mark Siskind (2015): <strong>Automatic differentiation in machine learning: a survey</strong>. <a href="https://arxiv.org/abs/1502.05767" class="bare">https://arxiv.org/abs/1502.05767</a></p>
</li>
<li>
<p><a id="BCP10"></a>[BCP10] Benveniste A., Caillaud B., Pouzet M. (2010): <strong>The Fundamentals of Hybrid Systems Modelers</strong>. In 49th IEEE International Conference on Decision and Control (CDC), Atlanta, Georgia, USA, December 15-17. <a href="http://www.di.ens.fr/~pouzet/bib/cdc10.pdf" class="bare">http://www.di.ens.fr/~pouzet/bib/cdc10.pdf</a></p>
</li>
<li>
<p><a id="BOA11"></a>[BOA11] Blochwitz T., Otter M., Arnold M., Bausch C., Clau&#223; C., Elmqvist H., Junghanns A., Mauss J., Monteiro M., Neidhold T., Neumerkel D., Olsson H., Peetz J.-V., Wolf S. (2011): <strong>The Functional Mockup Interface for Tool independent Exchange of Simulation Models</strong>. 8th International Modelica Conference, Dresden 2011. <a href="http://www.ep.liu.se/ecp/063/013/ecp11063013.pdf" class="bare">http://www.ep.liu.se/ecp/063/013/ecp11063013.pdf</a></p>
</li>
<li>
<p><a id="BKF17"></a>[BKF17] Braun W., Kulshreshtha K., Franke R., Walther A., Bachmann B., Towards Adjoint and Directional Derivatives in FMI utilizing ADOL-C within OpenModelica, 12th International Modelica Conference, Prague, 2017. <a href="https://2017.international.conference.modelica.org/proceedings/html/submissions/ecp17132363_BraunKulshreshthaFrankeBachmannWalther.pdf" class="bare">https://2017.international.conference.modelica.org/proceedings/html/submissions/ecp17132363_BraunKulshreshthaFrankeBachmannWalther.pdf</a></p>
</li>
<li>
<p><a id="BOA12"></a>[BOA12] Blochwitz T., Otter M., &#197;kesson J., Arnold M., Clau&#223; C., Elmqvist H., Friedrich M., Junghanns A., Mauss J., Neumerkel D., Olsson H., Viel A. (2012): <strong>Functional Mockup Interface 2.0: The Standard for Tool independent Exchange of Simulation Models</strong>. 9th International Modelica Conference, Munich, 2012. <a href="http://www.ep.liu.se/ecp/076/017/ecp12076017.pdf" class="bare">http://www.ep.liu.se/ecp/076/017/ecp12076017.pdf</a></p>
</li>
<li>
<p><a id="KS00"></a>[KS00] K&#252;bler R., Schiehlen W. (2000): <strong>Two methods of simulator coupling</strong>. Mathematical and Computer Modeling of Dynamical Systems 6 pp. 93-113.</p>
</li>
<li>
<p><a id="LZ07"></a>[LZ07] Lee E.A., Zheng H. (2007): <strong>Leveraging Synchronous Language Principles for Heterogeneous Modeling and Design of Embedded Systems</strong>. EMSOFT'07, September 30-October 3, Salzburg, Austria. <a href="https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf" class="bare">https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf</a></p>
</li>
<li>
<p><a id="MS93"></a>[MS93] Mattsson S. E. and S&ouml;derlind G.: <strong>Index Reduction in Differential Algebraic Equations Using Dummy Derivatives</strong>. SIAM Journal on Scientific Computing, Vol. 14, No. 3,  pp. 677692, 1993.</p>
</li>
<li>
<p><a id="MLS12"></a>[MLS12] Modelica (2012): <strong>Modelica, A Unified Object-Oriented Language for Systems Modeling</strong>. Language Specification, Version 3.3, May 9, 2012. <a href="https://www.modelica.org/documents/ModelicaSpec33.pdf" class="bare">https://www.modelica.org/documents/ModelicaSpec33.pdf</a></p>
</li>
<li>
<p><a id="MG09"></a>[MG09] MODELISAR Glossary (2009): <strong>MODELISAR WP2 Glossary and Abbreviations</strong>. Version 1.0, June 9, 2009.</p>
</li>
<li>
<p><a id="PZ06"></a>[PZ06] Pouzet M. (2006): <strong>Lucid Synchrone</strong>. Version 3.0, Tutorial and Reference Manual. <a href="http://www.di.ens.fr/~pouzet/lucid-synchrone/" class="bare">http://www.di.ens.fr/~pouzet/lucid-synchrone/</a></p>
</li>
<li>
<p><a id="CGM84"></a>[CGM84] Coleman, Garbow, Mor&#233; (1984): <strong>Software for estimating sparse Jacobian matrices, ACM Transactions on Mathematical Software</strong>. TOMS , vol. 10, no. 3, pp. 346-347</p>
</li>
<li>
<p><a id="PW13"></a>[PW13] Preston-Werner, T. (2013): <strong>Semantic Versioning 2.0.0</strong>.  <a href="https://semver.org/spec/v2.0.0.html" class="bare">https://semver.org/spec/v2.0.0.html</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="glossary">Appendix A: Glossary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This glossary is a subset of (<em>MODELISAR Glossary, 2009</em>) with some extensions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Term</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>argument</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refers to a function parameter.
Not to be confused with <em>parameter</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>capability flag</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capability flags are used to indicate to the importer what optional functionality the FMU supports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>clock</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable to report events or trigger events or model partitions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>clock tick</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the <a href="#clock"><code>clock</code></a> ticks an event is present, otherwise the event is absent.
This document calls a <a href="#clock"><code>clock</code></a> tick a <a href="#clock"><code>clock</code></a> activation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time grid for data exchange between importer and FMU(s) in a (co-)simulation environment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>communication points</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous-time instant</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#time-instant">time instant</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>co-simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coupling of several <em>simulation programs</em> in order to compute the global behavior of a system that consists of several subsystems.
The subsystems are coupled in the sense that the behavior of each subsystem depends on the behavior of the remaining subsystems, so that the co-simulation must be computed in a step-by-step fashion.
Each simulation program is responsible for computing the behavior of a subsystem, using the outputs produced by the other simulation programs.
Synonyms: dynamic mutual-exchange, simulator coupling, and coupled simulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>direct feedthrough</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct feedthrough describes that values of output variables depend directly on values of input variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="dynamic-state-selection"></a><em>dynamic state selection</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic State Selection is a method to solve differential algebraic equations (DAEs).
The FMU checks whether the dynamically selected states are still numerically appropriate.
If not, a new mapping between states and variables is computed.
For details see <a href="#MS93">[MS93]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ECU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Electronic Control Unit (Microprocessor that is used to control a technical system).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something that occurs instantaneously at a specific time or when a specific condition occurs.
At an event, numerical integration is suspended and variables may change their values discontinuously.
Internal events occur inside the FMU and should be signaled to the environment without any delay and can cause event handling and/or the activation of an output clock.
Input clocks are activated by the environment to inform the FMU about the exact moment an event across FMUs has to be handled.
See <a href="#state-event">state event</a>, <a href="#step-event">step event</a> and <a href="#time-event">time event</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="eventIndicator"></a><em>event indicator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable that changes sign exactly at an event.
See <a href="#state-event">event indicator</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>exporter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A program that creates an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>external scheduler</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>scheduler</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>feedthrough</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>direct feedthrough</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-Up Interface:<br>
Interface of a functional mock-up in form of a model.
In analogy to the term digital mock-up (see <em>mock-up</em>), functional mock-up describes a computer-based representation of the functional behaviour of a system for all kinds of analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI functions</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The function of the FMI C-API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for co-simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-Up Interface for Co-Simulation:<br>
One of the MODELISAR <em>Functional Mock-Up Interface types.</em> It connects the <em>importer</em> with one or more <em>FMU</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for model exchange</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-Up Interface for Model Exchange:<br>
One of the MODELISAR <em>Functional Mock-Up Interface types.</em> It consists of the <em>model description</em> and the <em>C API</em>.<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-Up Unit:<br>
A "model class" following the interface type FMI for Model Exchange, or a model following the interface types FMI for Co-Simulation or FMI for Scheduled Execution).
An FMU is one ZIP file as defined in <a href="#fmu-distribution">Section 2.5</a>.
The zip file comprises essentially an XML file that defines the model variables, and a set of C function implementations (see <a href="#general-mechanisms">Section 2.2</a>).
The implementations can be in source or binary form.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMU clock</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#clock"><code>clock</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>importer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tool that imports or loads one or more FMUs.
Also called simulation environment, environment, calling environment, (co-)simulation algorithm, target platform, target environment, integrator (in ME).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>independent variable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All variables are a function of this <a href="#independent"><code>independent</code></a> variable, typically time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="input-event"></a><em>input event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An input event occurs when a discrete input variable changes, a continuous input variable has a discontinuity or a <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a> changes its value.
<em>[Note that if an FMU A is connected to an FMU B, and an event is triggered for A, then potentially all <a href="#output"><code>outputs</code></a> of A will be discontinuous at this time instant.</em>
<em>It is therefore advisable to move B into <a href="#EventMode"><strong>Event Mode</strong></a> at this time instant too if an <a href="#output"><code>output</code></a> of A is connected to B.</em>
<em>This means to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> on B.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integration algorithm</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The numerical algorithm to solve differential equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integrator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>software component</em>, which implements an <em>integration algorithm</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An abstraction of a <em>software component</em> that describes its behavior without dealing with the internal implementation.
<em>Software components</em> communicate with each other via interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>machine epsilon</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smallest floating point value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>mock-up</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A full-sized structural, but not necessarily functional model built accurately to scale, used chiefly for study, testing, or display.
In the context of computer aided design (CAD), a digital mock-up (DMU) means a computer-based representation of the product geometry with its parts, usually in 3-D, for all kinds of geometrical and mechanical analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A model is a mathematical or logical representation of a system of entities, phenomena, or processes.
Basically a model is a simplified abstract view of the complex reality.<br>
It can be used to compute its expected behavior under specified conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model description file</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The model description file is an XML file, which supplies a description of all properties of a <em>model</em> (for example, <a href="#input"><code>input</code></a> / <a href="#output"><code>output</code></a> variables).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model description interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An interface description to write or retrieve information from the <em>model description file</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Model Description Schema</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <em>XML</em> schema that defines how all relevant, non-executable, information about a "model class" (<em>FMU)</em> is stored in a text file in <em>XML</em> format.
Most important, data for every variable is defined (variable name, handle, data type, variability, unit, etc.), see <a href="#fmi-description-schema">Section 2.4</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model rate</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverse of time interval between two communication points associated to an exposed model partition within the FMU (i.e. <a href="#clock"><code>clock</code></a> is defined in interface).
In general multiple rates i.e. multiple model partitions can be defined for an Co-Simulation FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="model-partition"></a><em>model partition</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Model partitions can be associated to a discrete or (piecewise) continuous part of the FMU.
The computation of model partitions can be externally controlled based on <a href="#clock"><code>clock</code></a> ticks of associated <a href="#inputClock"><code>input clocks</code></a>.</p>
<p class="tableblock">Not all FMU internal model partitions have to be exposed in the Co-Simulation interface as <a href="#clock"><code>clock</code></a> and can also be handled FMU internally (e.g. internal subsampling).
Nevertheless, it is assumed that the activation of all exposed <a href="#inputClock"><code>input clocks</code></a> results in the computation of the complete FMU.</p>
<p class="tableblock">As stated above, continuous parts of the FMU are also associated to model partitions that define the communication points for the <a href="#continuous"><code>continuous</code></a> values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ODE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>Ordinary Differential Equation</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Ordinary Differential Equation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Differential equation containing one or more functions of one independent variable (typically time) and the derivatives of those functions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tool internal time grid for saving output data to file (in some tools also known as "<em>communication points</em>" - but this term is used in a different way in FMI for Co-Simulation, see above).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>output points</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A quantity within a <em>model</em>, which remains constant during <em>simulation (<a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameter</code></a>) or may change at event instances (<a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a>)</em>.
Examples are a mass, stiffness, etc.
These parameters are different from <a href="#calculatedParameter">calculated parameters</a>, because they can be changed independently (according to their <a href="#variability"><code>variability</code></a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>run-time environment</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See co-simulation environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>scheduled execution</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMI type that externalizes the scheduler to run <em>model partitions</em>, potentially synchronized between more than one FMU and exchanging input and output variables accordingly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute the behavior of one or several <em>models</em> under specified conditions.<br>
(see also <em>co-simulation</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>model</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation program</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software to develop and/or solve simulation <em>models</em>.
The software includes a <em>solver</em>, may include a user interface and methods for post processing (see also: <em>simulation tool</em>, <em>simulation environment</em>).<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation tool</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>simulation program</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simulator can include one or more <em>simulation programs</em>, which solve a common simulation task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulator coupling</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>tool coupling</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>solver</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Software component,</em> which includes algorithms to solve <em>models</em>, for example, <em>integration algorithms</em> and <em>event handling</em> methods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The continuous <a href="#state"><code>states</code></a> of a model are all variables that appear differentiated in the model and are independent from each other.<br>
The discrete-time states of a model are time-discrete variables that have two values in a model: The value of the variable from the previous <em>event</em> instant, and the value of the variable at the actual event instant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time of <a href="#state-event">state <em>events</em></a> is not known apriori.
<a href="#fmi3GetEventIndicators">Event indicators</a> are used to allow the importer finding the time of these state events precisely.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="step-event"></a><em>step event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that might occur at a completed integrator step signaled by calling <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>.
Step events are, for example, used to change the mapping of the continuous states to variables (<a href="#dynamic-state-selection">dynamic state selection</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>structural parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A parameter influencing the size and/or dimensionality of an array variable of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="super-dense-time"></a><em>super-dense time</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A precise definition of time taking into account iterations at an event.
For an <em>FMU</em>, the <a href="#independent"><code>independent</code></a> variable time \(\mathbf{t} \in \mathbb{T}\) is a tuple \(\mathbf{t} = (\mathbf{t}_R, \mathbf{t}_I)\) where \(\mathbf{t}_R \in  \mathbb{R}, \mathbf{t}_I \in \mathbb{N} = \{0,1,2,\ldots\}\).
The real part \(\mathbf{t}_R\) of this tuple is the <a href="#independent"><code>independent</code></a> variable of the FMU for describing the continuous-time behavior of the model between events.
During continuous-time integration \(\mathbf{t}_I = 0\).
The integer part \(\mathbf{t}_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(\mathbf{t}_R\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>super-dense time instant</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#time-instant">time instant</a> and <a href="#super-dense-time">super-dense time</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>task</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Special kind of <em>model partition</em> that is used in control code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="time-event"></a><em>time event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that is defined by a predefined time instant.
Since the time instant is known in advance, the integrator can select its step size so that the event point is directly reached.
Therefore, this event can be handled efficiently.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="time-instant"></a><em>time instant</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A moment in time, either a continuous-time instant \(\mathbf{t} = \mathbf{t}_R\), or a super-dense time instant \(\mathbf{t} = (\mathbf{t}_R, \mathbf{t}_I)\), see also <a href="#super-dense-time">super-dense time</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tick relationshipt</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that is defined by a predefined time instant.
Since the time instant is known in advance, the integrator can select its step size so that the event point is directly reached.
Therefore, this event can be handled efficiently.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>see Transmission Line Method</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transmission Line Method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A mathematical method which uses physically motivated time delays to decouple an equation system into independent parts during a specified time frame without compromising numerical stability.
Also known as the <em>bi-lateral delay line</em> method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The part of the simulation program that gives the user control over the simulation and allows watching results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XML</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eXtensible Markup Language (<a href="http://www.w3.org/XML/">www.w3.org/XML</a>, <a href="http://en.wikipedia.org/wiki/Xml">en.wikipedia.org/wiki/XML</a>) - An open standard to store information in text files in a structured form.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements">Appendix B: Acknowledgements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Until Dec. 2011, this work was carried out within the ITEA2 MODELISAR project (project number: ITEA2-07006, <a href="https://itea3.org/project/modelisar.html" class="bare">https://itea3.org/project/modelisar.html</a>).</p>
</div>
<div class="paragraph">
<p>Daimler AG, DLR, ITI GmbH, Martin Luther University Halle-Wittenberg, QTronic GmbH and SIMPACK AG thank BMBF for partial funding of this work within MODELISAR (BMBF F&#246;rderkennzeichen: 01lS0800x).</p>
</div>
<div class="paragraph">
<p>Dassault Syst&#232;mes (Sweden) thanks the Swedish funding agency VINNOVA (2008-02291) for partial funding of this work within MODELISAR.</p>
</div>
<div class="paragraph">
<p>LMS Imagine and IFPEN thank DGCIS for partial funding of this work within MODELISAR.</p>
</div>
<div class="paragraph">
<p>Since Sept. 2012 until Nov. 2015, this work is partially carried out within the ITEA2 MODRIO project (project number: ITEA 2-11004, <a href="https://itea3.org/project/modrio.html" class="bare">https://itea3.org/project/modrio.html</a>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DLR, ITI GmbH, QTronic GmbH and SIMPACK AG thank BMBF for partial funding of this work within MODRIO (BMBF F&#246;rderkennzeichen: 01IS12022E).</p>
</li>
<li>
<p>Dassault Syst&#232;mes (Sweden), Link&#246;ping University and Modelon AB thank the Swedish funding agency VINNOVA (2012&#8212;&#8203;01157) for partial funding of this work within MODRIO.</p>
</li>
<li>
<p>Siemens PLM Software (France) and IFPEN thank DGCIS for partial funding of this work within MODRIO.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>